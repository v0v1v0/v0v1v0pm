<div class="container">

<table style="width: 100%;"><tr>
<td>binPeaks</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Align Peaks into discrete bins.
</h2>

<h3>Description</h3>

<p>This function looks for similar peaks (mass) across
<code>MassPeaks</code> objects and equalizes their mass.
</p>


<h3>Usage</h3>

<pre><code class="language-R">binPeaks(l, method=c("strict", "relaxed", "reference"), tolerance=0.002)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>l</code></td>
<td>

<p><code>list</code>, list of <code>MassPeaks</code> objects.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>

<p>bin creation rule. <code>"strict"</code> creates bins never containing two
or more peaks of the same sample. <code>"relaxed"</code> allows multiple
peaks of the same sample in one bin. <code>"reference"</code> generates bins
around the mass values from the first <code>MassPeaks</code> object
in <code>l</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolerance</code></td>
<td>

<p><code>double</code>, maximal relative deviation of a peak position (mass) to be
considered as identical. Must be multiplied by <code>10^-6</code> for ppm,
e.g. use <code>tolerance=5e-6</code> for 5 ppm.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The algorithm is based on the following workflow:
</p>

<ol>
<li>
<p>Put all mass in a sorted vector.
</p>
</li>
<li>
<p>Calculate differences between each neighbor.
</p>
</li>
<li>
<p>Divide the mass vector at the largest gap (largest difference) and form
a left and a right bin.
</p>
</li>
<li>
<p>Rerun step 3 for the left and/or the right bin if they don't fulfill
the following criteria:
</p>

<ul>
<li>
<p>All peaks in a bin are near to the mean (<code>method == "strict"</code>
or <code>method == "relaxed"</code>)
(<code>abs(mass-meanMass)/meanMass &lt; tolerance</code>) or the
reference mass (<code>method == "reference"</code>;
<code>abs(mass-reference)/reference &lt; tolerance</code>).
</p>
</li>
<li>
<p><code>method == "strict"</code>: The bin doesn't contain two or more
peaks of the same sample.
</p>
</li>
</ul>
</li>
</ol>
<p><code>method == "strict"</code>: The new peak positions (mass value) are the
mean mass of a bin. <br><code>method == "relaxed"</code>: The new peak positions for the highest peaks of each
sample in a bin are generated by the mean mass of this peaks. The lower
peaks are not changed.
<code>method == "reference"</code>: The new peak positions for the highest peaks of
each sample in a bin are generated by the mass of peaks of the first
<code>MassPeaks</code> object. Lower peaks are not changed.
</p>


<h3>Value</h3>

<p>Returns a <code>list</code> of mass adjusted
<code>MassPeaks</code> objects.
</p>


<h3>Author(s)</h3>

<p>Sebastian Gibb <a href="mailto:mail@sebastiangibb.de">mail@sebastiangibb.de</a>
</p>


<h3>See Also</h3>

<p><code>intensityMatrix</code>,
<code>MassPeaks</code>
</p>
<p>Website: <a href="https://strimmerlab.github.io/software/maldiquant/">https://strimmerlab.github.io/software/maldiquant/</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## load package
library("MALDIquant")

## create two MassPeaks objects
p &lt;- list(createMassPeaks(mass=seq(100, 500, 100), intensity=1:5),
          createMassPeaks(mass=c(seq(100.2, 300.2, 100), 395), intensity=1:4))

binnedPeaks &lt;- binPeaks(p, tolerance=0.002)

## compare result
iM1 &lt;- intensityMatrix(p)
iM2 &lt;- intensityMatrix(binnedPeaks)

all(dim(iM1) == c(2, 9)) # TRUE
all(dim(iM2) == c(2, 6)) # TRUE

show(iM2)

## increase tolerance
binnedPeaks &lt;- binPeaks(p, tolerance=0.1)

iM3 &lt;- intensityMatrix(binnedPeaks)

all(dim(iM3) == c(2, 5)) # TRUE

show(iM3)

## differences between "strict" and "relaxed"
p &lt;- c(createMassPeaks(mass=c(1, 1.01, 3), intensity=c(2, 1, 1)),
       createMassPeaks(mass=c(0.99, 3), intensity=rep(1, 2)),
       createMassPeaks(mass=c(1.02, 3), intensity=rep(1, 2)))

intensityMatrix(binPeaks(p, method="strict", tolerance=0.05))
intensityMatrix(binPeaks(p, method="relaxed", tolerance=0.05))

## use a reference
ref &lt;- createMassPeaks(mass=c(1, 3), intensity=rep(1, 2))
## include the reference
intensityMatrix(binPeaks(c(ref, p), method="reference", tolerance=0.05))
## drop the reference
intensityMatrix(binPeaks(c(ref, p), method="reference", tolerance=0.05)[-1])
</code></pre>


</div>