<div class="container">

<table style="width: 100%;"><tr>
<td>mams</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Function to design multi-arm multi-stage studies with normal endpoints</h2>

<h3>Description</h3>

<p>The function determines the boundaries of a multi-arm multi-stage study
for a given boundary shape and finds the required number of subjects.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mams(obj = NULL, K=NULL, J=NULL, alpha=NULL, power=NULL, r=NULL, 
                     r0=NULL, p=NULL, p0=NULL, delta=NULL, delta0=NULL, 
                     sd=NULL,ushape=NULL, lshape=NULL, ufix=NULL, lfix=NULL, 
                     nstart=NULL, nstop=NULL, sample.size=NULL, Q=NULL,
                     type=NULL, parallel=NULL, print=NULL, nsim=NULL, 
                     H0=NULL, method=NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>obj</code></td>
<td>
<p>object of class <code>MAMS</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>Number of experimental treatments (default=4).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>J</code></td>
<td>
<p>Number of stages (default=2).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>One-sided familywise error rate (default=0.05).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>power</code></td>
<td>
<p>Desired power (default=0.9).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>Vector of allocation ratios (default=1:2).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r0</code></td>
<td>
<p>Vector ratio on control (default=1:2).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>Interesting treatment effect on the probability scale.
See Details (default=0.75).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p0</code></td>
<td>
<p>Uninteresting treatment effect on the probability scale.
See Details (default=0.5). Note that this parameter affects the sample size
estimation to ensure that Treatment 1 is best only when selecting the
simultaneous stopping rule (i.e., 'method = "simultaneous"') and, for all
methods, as values for treatment arms 2 to K in the simulations under H1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p>Interesting treatment effect on the traditional scale.
See Details (default=NULL).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta0</code></td>
<td>
<p>Uninteresting treatment effect on the traditional scale.
See Details (default=NULL). Note that this parameter affects the sample size
estimation to ensure that Treatment 1 is best only when selecting the
simultaneous stopping rule (i.e., 'method = "simultaneous"') and, for all
methods, as values for treatment arms 2 to K in the simulations under H1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sd</code></td>
<td>
<p>Standard deviation, assumed to be known.
See Details (default=NULL).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ushape</code></td>
<td>
<p>Shape of upper boundary. Either a function specifying the shape
or one of "pocock", "obf" (the default), "triangular" and "fixed".
See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lshape</code></td>
<td>
<p>Shape of lower boundary. Either a function specifying the shape
or one of "pocock", "obf", "triangular" and "fixed" (the default).
See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ufix</code></td>
<td>
<p>Fixed upper boundary (default=NULL). Only used if shape="fixed".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lfix</code></td>
<td>
<p>Fixed lower boundary (default=0). Only used if shape="fixed".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nstart</code></td>
<td>
<p>Starting point for finding the sample size (default=1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nstop</code></td>
<td>
<p>Stopping point for finding the sample size (default=NULL).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample.size</code></td>
<td>
<p>Logical if sample size should be found as well
(default=TRUE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Q</code></td>
<td>
<p>Number of quadrature points per dimension in the outer integral
(default=20).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Will be changed automatically by the wrappers tite.mams()
(to "tite") and ordinal.mams() (to "ordinal") to customise the output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>if TRUE (default), allows parallelization of the computation
via a user-defined strategy specified by means of the function
future::plan().
If not set differently, the default strategy is sequential, which
corresponds to a computation without parallelization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print</code></td>
<td>
<p>if TRUE (default), indicate at which stage the computation is.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim</code></td>
<td>
<p>a scalar indicating the number of simulations (default = 50'000,
minimum = 1000)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>H0</code></td>
<td>
<p>if TRUE (default), the simulation also considers the case with all
effect sizes set to 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Type of the desired design: <code>simultaneous</code>(default) for
simultaneous stopping rules, <code>sep</code> for separate stopping, and <code>dtl</code>
for drop-the-losers design.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function finds the boundaries and sample size of a multi-arm multi-stage
study with K active treatments plus control in which all promising
treatments are continued at interim analyses as described in
Magirr et al (2012). At each interim analysis the test statistics are
compared to the lower (futility) bound and any treatment whose corresponding
test statistic falls below that bound is discontinued. Similarly if any test
statistic exceeds the upper (efficacy) bound the null hypothesis
corresponding to that treatment can be rejected and superiority of that
treatment over control claimed. At the same time the study is stopped.
If at least one test statistic exceeds the lower bound and none exceeds the
upper bound the study is continued and further patients are recruited to all
remaining experimental treatments plus control.
</p>
<p>The design is found under the least favorable configuration, which requires
an interesting treatment effect <code>p</code> that if present we would like to find
with
high probability and an uninteresting effect <code>p0</code>. Both <code>p</code> and <code>p0</code> are
parameterized as <code class="reqn">P(X_k &gt; X_0 ) = p</code>, that is the
probability of a randomly selected person on treatment k observing a
better outcome than a random person on control. For <code>p=0.5</code> the experimental
treatment and control perform equally well.
The advantage of this parameterization is that no knowledge about the
variance is required. To convert traditional effect sizes,
d<code class="reqn">\delta</code>
to this format use
<code class="reqn">p=\Phi(\frac{\delta}{\sqrt{2}\sigma})</code>.
Alternatively, the interesting and uninteresting effect size can also be
specified directly on the traditional scale of <code>delta</code> and <code>delta</code> with an
additional specification of the standard deviation <code>sd</code> assumed to be known.
</p>
<p>The shape of the boundaries (<code>ushape</code>, <code>lshape</code>) are either using the
predefined shapes following Pocock (1977), O'Brien &amp; Fleming (1979) or the
triangular Test (Whitehead, 1997) using options "<code style="white-space: pre;">⁠pocock"⁠</code>, <code>"obf"</code>or
<code>"triangular"</code> respectively, are constant (option <code>"fixed"</code>) or supplied
in as a function.
If a function is passed it should require exactly one argument specifying
the number of stages and return a vector of the same length. The lower
boundary shape is required to be non-decreasing while the upper boundary
shape needs to be non-increasing. If a fixed lower boundary is used, <code>lfix</code>
must be smaller than <code class="reqn">\Phi^{-1}(1-\alpha)/2</code>
to ensure that it is smaller than the upper boundary.
</p>
<p>The default starting point for finding the sample size is <code>nstart=1</code>, and
the default point where the search is stopped (when <code>nstop=NULL</code>) is 3
times the sample size of the corresponding fixed single-stage design.
</p>
<p>Computation of designs with more than four stages are very time consuming
and not advised. The parameter <code>sample.size</code> controls whether the required
sample size is computed as well. Setting to <code>FALSE</code> approximately halves
the computation time.
</p>
<p>For designs with more than 2 stages, parallelization of the computation by
means of the packages <span class="pkg">future</span> and <span class="pkg">future.apply</span> lead to decreased
computation times when choosing a parallelization strategy like, for
example, <code>multicore</code> (using separate forked R processes, available to
unix/osx users) or <code>multisession</code> (using separate R sessions, available
to all users) (refer to future::plan() for detail).
</p>


<h3>Value</h3>

<p>An object of the class MAMS containing the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>l</code></td>
<td>
<p>Lower boundary.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>Upper boundary.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Sample size on control in stage 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>Maximum total sample size.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>Number of experimental treatments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>J</code></td>
<td>
<p>Number of stages in the trial.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>Familywise error rate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha.star</code></td>
<td>
<p>Cumulative familywise error rate spent by each analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>power</code></td>
<td>
<p>Power under least favorable configuration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rMat</code></td>
<td>
<p>Matrix of allocation ratios. First row corresponds to control
while subsequent rows are for the experimental treatments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sim</code></td>
<td>
<p>a list indicating, for each hypothesis of interest (null and/or
alternative), the expected sample size and standard deviation per group
(ess), the cumulated probability of efficacy (efficacy) and futility
(futility) per treatment arm and look</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>input</code></td>
<td>
<p>the list of all input parameters except K and J</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Thomas Jaki, Dominic Magirr, Dominique-Laurent Couturier
and Nikita Mozgunov
</p>


<h3>References</h3>

<p>Jaki T., Pallmann P., and Magirr D. (2019), <em>The R Package MAMS for
Designing Multi-Arm Multi-Stage Clinical Trials</em>, <b>Journal of
Statistical Software</b>, 88(4), 1-25. Link:
<a href="https://doi.org/10.18637/jss.v088.i04">doi:10.18637/jss.v088.i04</a>
</p>
<p>Magirr D., Jaki T., and Whitehead J. (2012), <em>A generalized Dunnett test
for multi-arm multi-stage clinical studies with treatment selection</em>,
<b>Biometrika</b>, 99(2), 494-501. Link:
<a href="https://doi.org/10.1093/biomet/ass002">doi:10.1093/biomet/ass002</a>
</p>
<p>Pocock S.J. (1977), <em>Group sequential methods in the design and analysis
of clinical trials</em>, <b>Biometrika</b>, 64(2), 191-199.
</p>
<p>O'Brien P.C., and Fleming T.R. (1979), <em>A multiple testing procedure for
clinical trials</em>, <b>Biometrics</b>, 35(3), 549-556.
</p>
<p>Whitehead J. (1997), <em>The Design and Analysis of Sequential
Clinical Trials</em>, <b>Wiley</b>: Chichester, UK.
Wason J, Stallard N, Bowden J, Jennison C. A multi-stage drop-the-losers
design for multi-arm clinical trials. Statistical Methods in Medical
Research. 2017;26(1):508-524. doi:10.1177/0962280214550759
</p>


<h3>See Also</h3>

<p>new.bounds, ordinal.mams, tite.mams.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## A fixed sample (single stage) design specified on the p scale
mams(K=4, J=1, alpha=0.05, power=0.9, r=1, r0=1, p=0.65, p0=0.55)

## The same design specified on the delta scale

mams(K=4, J=1, alpha=0.05, power=0.9, r=1, r0=1, p=NULL, p0=NULL,
     delta=0.545, delta0=0.178, sd=1)

## An example in Table 1 of Magirr et al (2012)
# 2-stage design with O'Brien &amp; Fleming efficacy and zero futility boundary

mams(K=4, J=2, alpha=0.05, power=0.9, r=1:2, r0=1:2, p=0.65, p0=0.55,
     ushape="obf", lshape="fixed", lfix=0, nstart=40)

## An example of separate stopping rules
# 2-stage design with O'Brien &amp; Fleming efficacy and zero futility boundary

mams(method = "sep",K=4, J=2, alpha=0.05, power=0.9, r=1:2, r0=1:2, 
       p=0.65, p0=0.55, ushape="obf", lshape="fixed", lfix=0, nstart=40)

# An example of running drop-the-losers design 
# `K` should be defined as vector length of J defining allocation arms per 
# stages with final element equal to 1.
mams(method = "dtl", K=c(4,1), J=2, alpha=0.05,  
         power=0.9, r=1:2, r0=1:2, p=0.65, p0=0.55, ushape="obf", 
         lshape="fixed", lfix=0, nstart=40)



# Note that these examples may take a few minutes to run

## 3-stage design with Triangular efficacy and futility boundary
mams(K=4, J=3, alpha=0.05, power=0.9, r=1:3, r0=1:3, p=0.65, p0=0.55,
  ushape="triangular", lshape="triangular", nstart=30)

## Different allocation ratios between control and experimental treatments.
## Twice as many patients are randomized to control at each stage.
  mams(K=4, J=2, alpha=0.05, power=0.9, r=1:2, r0=c(2, 4), p=0.65, 
  p0=0.55, ushape="obf", lshape="fixed", lfix=0, nstart=30)


  ##
  ## example considering different parallelization strategies
  ##


  # parallel = FALSE (future framework not used)
  set.seed(1)
  system.time(
  print(mams(K=4, J=3, alpha=0.05, power=0.9, r=1:3, r0=1:3,
          p=0.65, p0=0.55, ushape="triangular", lshape="triangular",
          nstart=30, parallel = FALSE))
          )
 # parallel = TRUE (default) with default strategy (sequential computation)
 plan(sequential)
 set.seed(1)
 system.time(
 print(mams(K=4, J=3, alpha=0.05, power=0.9, r=1:3, r0=1:3,
          p=0.65, p0=0.55, ushape="triangular", lshape="triangular", 
          nstart=30))
          )
 # parallel = TRUE(default) with multisession strategy (parallel computation)
 plan(multisession)
 set.seed(1)
 system.time(
 print(mams(K=4, J=3, alpha=0.05, power=0.9, r=1:3, r0=1:3, 
          p=0.65, p0=0.55, ushape="triangular", lshape="triangular",
           nstart=30))
          )
          plan("default")
          
</code></pre>


</div>