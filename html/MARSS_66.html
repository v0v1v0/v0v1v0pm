<div class="container">

<table style="width: 100%;"><tr>
<td>MARSS.marxss</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> Multivariate AR-1 State-space Model with Inputs </h2>

<h3>Description</h3>

<p>The argument <code>form="marxss"</code> in a <code>MARSS()</code> function call specifies a MAR-1 model with eXogenous variables model.  This is a MARSS(1) model of the form:
</p>
<p style="text-align: center;"><code class="reqn">\mathbf{x}_{t} = \mathbf{B}_t \mathbf{x}_{t-1} + \mathbf{u}_t + \mathbf{C}_t \mathbf{c}_t + \mathbf{G}_t \mathbf{w}_t, \textrm{ where } \mathbf{W}_t \sim \textrm{MVN}(0,\mathbf{Q}_t)</code>
</p>

<p style="text-align: center;"><code class="reqn">\mathbf{y}_t = \mathbf{Z}_t \mathbf{x}_t + \mathbf{a}_t + \mathbf{D}_t \mathbf{d}_t + \mathbf{H}_t \mathbf{v}_t, \textrm{ where } \mathbf{V}_t \sim \textrm{MVN}(0,\mathbf{R}_t)</code>
</p>

<p style="text-align: center;"><code class="reqn">\mathbf{X}_1 \sim \textrm{MVN}(\mathbf{x0}, \mathbf{V0}) \textrm{ or } \mathbf{X}_0 \sim \textrm{MVN}(\mathbf{x0}, \mathbf{V0}) </code>
</p>

<p>Note, by default <code class="reqn">\mathbf{V0}</code> is a matrix of all zeros and thus <code class="reqn">\mathbf{x}_1</code> or <code class="reqn">\mathbf{x}_0</code> is treated as an estimated parameter not a diffuse prior.
</p>
<p>Note, "marxss" is a model form.  A model form is defined by a collection of form functions discussed in <code>marssMODEL</code>.  These functions are not exported to the user, but are called by <code>MARSS()</code> using the argument <code>form</code>.  
</p>


<h3>Details</h3>

<p>The allowed arguments when <code>form="marxss"</code> are 1) the arguments common to all forms: "y" (data), "inits", "control", "method", "form", "fit", "silent", "fun.kf" (see <code>MARSS</code> for information on these arguments) and 2) the argument "model" which is a list describing the MARXSS model (the model list is described below).
See the <a href="https://cran.r-project.org/package=MARSS/vignettes/Quick_Start.html">Quick Start Guide</a> guide or the <a href="https://cran.r-project.org/package=MARSS/vignettes/UserGuide.pdf">User Guide</a> for examples.
</p>
<p>The argument <code>model</code> must be a list.  The elements in the list specify the structure for the <code class="reqn">\mathbf{B}</code>, <code class="reqn">\mathbf{u}</code>, <code class="reqn">\mathbf{C}</code>, <code class="reqn">\mathbf{c}</code>, <code class="reqn">\mathbf{Q}</code>, <code class="reqn">\mathbf{Z}</code>, <code class="reqn">\mathbf{a}</code>, <code class="reqn">\mathbf{D}</code>, <code class="reqn">\mathbf{d}</code>, <code class="reqn">\mathbf{R}</code>, <code class="reqn">\mathbf{x}_0</code>, and <code class="reqn">\mathbf{V}_0</code> in the MARXSS model (above).  The list elements can have the following values:
</p>

<dl>
<dt><code>Z</code></dt>
<dd>
<p>Default="identity".  A text string, "identity","unconstrained", "diagonal and unequal", "diagonal and equal", "equalvarcov", or "onestate", or a length n vector of factors specifying which of the m hidden state time series correspond to which of the n observation time series.   May be specified as a n x m list matrix for general specification of both fixed and shared elements within the matrix.  May also be specified as a numeric n x m matrix to use a custom fixed <code class="reqn">\mathbf{Z}</code>. "onestate" gives a n x 1 matrix of 1s. "identity","unconstrained", "diagonal and unequal", "diagonal and equal", and "equalvarcov" all specify n x n matrices.</p>
</dd>
<dt><code>B</code></dt>
<dd>
<p>Default="identity".  A text string, "identity", "unconstrained", "diagonal and unequal", "diagonal and equal", "equalvarcov", "zero". Can also be specified as a list matrix for general specification of both fixed and shared elements within the matrix.  May also be specified as a numeric m x m matrix to use custom fixed <code class="reqn">\mathbf{B}</code>, but in this case all the eigenvalues of <code class="reqn">\mathbf{B}</code> must fall in the unit circle.</p>
</dd>
<dt>
<code>U</code>, <code>x0</code>
</dt>
<dd>
<p>Default="unconstrained". A text string, "unconstrained", "equal", "unequal" or "zero". May be specified as a m x 1 list matrix for general specification of both fixed and shared elements within the matrix. May also be specified as a numeric m x 1 matrix to use a custom fixed <code class="reqn">\mathbf{u}</code> or <code class="reqn">\mathbf{x}_0</code>. Notice that <code>U</code> is capitalized in the <code>model</code> argument and output lists.</p>
</dd>
<dt><code>A</code></dt>
<dd>
<p>Default="scaling".  A text string, "scaling","unconstrained", "equal", "unequal" or "zero". May be specified as a  n x 1 list matrix for general specification of both fixed and shared elements within the matrix. May also be specified as a numeric n x 1 matrix to use a custom fixed <code class="reqn">\mathbf{a}</code>. Care must be taken when specifying <code>A</code> so that the model is not under-constrained and unsolvable model.  The default, "scaling", only applies to <code class="reqn">\mathbf{Z}</code> matrices that are design matrices (only 1s and 0s and all rows sum to 1). When a column in <code class="reqn">\mathbf{Z}</code> has multiple 1s, the first row in the <code class="reqn">\mathbf{a}</code> matrix associated with those <code class="reqn">\mathbf{Z}</code> rows is 0 and the other associated <code class="reqn">\mathbf{a}</code> rows have an estimated value. This is used to treat <code class="reqn">\mathbf{a}</code> as an intercept where one intercept for each <code class="reqn">\mathbf{x}</code> (hidden state) is fixed at 0 and any other intercepts associated with that <code class="reqn">\mathbf{x}</code> have an estimated intercept.  This ensures a solvable model when <code class="reqn">\mathbf{Z}</code> is a design matrix. Note in the model argument and output, <code>A</code> is capitalized.</p>
</dd>
<dt><code>Q</code></dt>
<dd>
<p>Default="diagonal and unequal".  A text string, "identity", "unconstrained", "diagonal and unequal", "diagonal and equal", "equalvarcov", "zero". May be specified as a list matrix for general specification of both fixed and shared elements within the matrix.  May also be specified as a numeric g x g matrix to use a custom fixed matrix. Default value of g is m, so <code class="reqn">\mathbf{Q}</code> is a m x m matrix.  g is the number of columns in <code class="reqn">\mathbf{G}</code> (below).</p>
</dd>
<dt><code>R</code></dt>
<dd>
<p>Default="diagonal and equal".  A text string, "identity", "unconstrained", "diagonal and unequal", "diagonal and equal", "equalvarcov", "zero". May be specified as a list matrix for general specification of both fixed and shared elements within the matrix.  May also be specified as a numeric h x h matrix to use a custom fixed matrix. Default value of h is n, so <code class="reqn">\mathbf{R}</code> is a n x n matrix.  h is the num of columns in <code class="reqn">\mathbf{H}</code> (below).</p>
</dd>
<dt><code>V0</code></dt>
<dd>
<p>Default="zero".  A text string, "identity", "unconstrained", "diagonal and unequal", "diagonal and equal", "equalvarcov", "zero". May be specified as a list matrix for general specification of both fixed and shared elements within the matrix.  May also be specified as a numeric m x m matrix to use a custom fixed matrix.</p>
</dd>
<dt>
<code>D</code> and <code>C</code>
</dt>
<dd>
<p>Default="zero".  A text string, "identity", "unconstrained", "diagonal and unequal", "diagonal and equal", "equalvarcov", "zero". Can be specified as a list matrix for general specification of both fixed and shared elements within the matrix.  May also be specified as a numeric matrix to use custom fixed values. Must have n rows (<code class="reqn">\mathbf{D}</code>) or m rows (<code class="reqn">\mathbf{C}</code>).</p>
</dd>
<dt>
<code>d</code> and <code>c</code>
</dt>
<dd>
<p>Default="zero".  Numeric matrix.  No missing values allowed.  Must have 1 column or the same number of columns as the data, <code class="reqn">\mathbf{y}</code>.  The numbers of rows in <code class="reqn">\mathbf{d}</code> must be the same as number of columns in <code class="reqn">\mathbf{D}</code>; similarly for <code class="reqn">\mathbf{c}</code> and <code class="reqn">\mathbf{C}</code>.</p>
</dd>
<dt>
<code>G</code> and <code>H</code>
</dt>
<dd>
<p>Default="identity".  A text string, "identity". Can be specified as a numeric matrix or array for time-varying cases. Must have m rows and g columns (<code class="reqn">\mathbf{G}</code>) or n rows and h columns (<code class="reqn">\mathbf{H}</code>). g is the dim of <code class="reqn">\mathbf{Q}</code> and h is the dim of <code class="reqn">\mathbf{R}</code>.</p>
</dd>
<dt><code>tinitx</code></dt>
<dd>
<p>Default=0.  Whether the initial state is specified at t=0 (default) or t=1.</p>
</dd>
</dl>
<p>All parameters except <code class="reqn">\mathbf{x}_0</code> and <code class="reqn">\mathbf{V}_0</code> may be time-varying.  If time-varying, then text shortcuts cannot be used.  Enter as an array with the 3rd dimension being time.   Time dimension must be 1 or equal to the number of time-steps in the data.    See Quick Start guide (<code>RShowDoc("Quick_Start",package="MARSS")</code>) or the User Guide (<code>RShowDoc("UserGuide",package="MARSS")</code>) for  examples.Valid model structures for <code>method="BFGS"</code> are the same as for <code>method="kem"</code>.  See  <code>MARSSoptim()</code> for the allowed options for this method.
</p>
<p>The default estimation method, <code>method="kem"</code>, is the EM algorithm described in the MARSS User Guide.  The default settings for the control and inits arguments are set via <code>MARSS:::alldefaults$kem</code> in <code>MARSSsettings.R</code>.  The defaults for the model argument are set in <code>MARSS_marxss.R</code> For this method, they are:
</p>

<ul>
<li>
<p>inits = list(B=1, U=0, Q=0.05, Z=1, A=0, R=0.05, x0=-99, V0=0.05, G=0, H=0, L=0, C=0, D=0, c=0, d=0)
</p>
</li>
<li>
<p>model = list(Z="identity", A="scaling", R="diagonal and equal", B="identity", U="unconstrained", Q="diagonal and unequal", x0="unconstrained", V0="zero", C="zero",D="zero",c=matrix(0,0,1), d=matrix(0,0,1), tinitx=0, diffuse=FALSE)
</p>
</li>
<li>
<p>control=list(minit=15, maxit=500, abstol=0.001, trace=0, sparse=FALSE,
safe=FALSE, allow.degen=TRUE, min.degen.iter=50, degen.lim=1.0e-04, 
min.iter.conv.test=15, conv.test.deltaT=9, conv.test.slope.tol= 0.5,  demean.states=FALSE) You can read about these in <code>MARSS()</code>.  If you want to speed up your fits, you can turn off most of the model checking using <code>trace=-1</code>. 
</p>
</li>
<li>
<p>fun.kf = "MARSSkfas"; This sets the Kalman filter function to use.  <code>MARSSkfas()</code> is generally more stable as it uses Durban &amp; Koopman's algorithm.  But it may dramatically slow down when the data set is large (more than 10 rows of data).  Try the classic Kalman filter algorithm to see if it runs faster by setting <code>fun.kf="MARSSkfss"</code>. You can read about the two algorithms in <code>MARSSkf</code>.
</p>
</li>
</ul>
<p>For <code>method="BFGS"</code>, type  <code>MARSS:::alldefaults$BFGS</code> to see the defaults.
</p>


<h3>Value</h3>

<p>A object of class <code>marssMLE</code>.  See <code>print.marssMLE</code> for a discussion of the various output available for <code>marssMLE</code> objects (coefficients, residuals, Kalman filter and smoother output, imputed values for missing data, etc.).  See <code>MARSSsimulate</code> for simulating from <code>marssMLE</code> objects. <code>MARSSboot</code> for bootstrapping, <code>MARSSaic</code> for calculation of various AIC related model selection metrics, and <code>MARSSparamCIs</code> for calculation of confidence intervals and bias. See <code>plot.marssMLE</code> for some default plots of a model fit.
</p>


<h3>Usage</h3>

<p><code>MARSS(y, 
    inits = NULL, 
    model = NULL, 
    miss.value = as.numeric(NA), 
    method = "kem", 
    form = "marxss", 
    fit = TRUE, 
    silent = FALSE, 
    control = NULL, 
    fun.kf = "MARSSkfas", 
    ...)</code>
</p>


<h3>Author(s)</h3>

 
<p>Eli Holmes, NOAA, Seattle, USA.
</p>


<h3>See Also</h3>

 <p><code>marssMODEL</code>, <code>MARSS.dfa()</code> </p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
#See the MARSS man page for examples
?MARSS

#and the Quick Examples chapter in the User Guide
RShowDoc("UserGuide",package="MARSS")

## End(Not run)
</code></pre>


</div>