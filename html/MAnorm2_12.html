<div class="container">

<table style="width: 100%;"><tr>
<td>estimatePriorDfRobust</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Assess the Goodness of Fit of Mean-Variance Curves in a Robust Manner</h2>

<h3>Description</h3>

<p>Given a set of <code>bioCond</code> objects of which each has been
associated with a mean-variance curve, <code>estimatePriorDfRobust</code>
derives a common number of prior degrees of freedom assessing the
overall goodness of fit of the mean-variance curves and accordingly
adjusts the variance ratio factor of each of the <code>bioCond</code>s.
Compared with <code>estimatePriorDf</code>, the underlying methods
of <code>estimatePriorDfRobust</code> for parameter estimation are
<em>robust</em> to outliers.
</p>


<h3>Usage</h3>

<pre><code class="language-R">estimatePriorDfRobust(
  conds,
  occupy.only = TRUE,
  p_low = 0.01,
  p_up = 0.1,
  d0_low = 0.001,
  d0_up = 1e+06,
  eps = d0_low,
  nw = gauss.quad(128, kind = "legendre"),
  return.d0 = FALSE,
  no.rep.rv = NULL,
  .call = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>conds</code></td>
<td>
<p>A list of <code>bioCond</code> objects, of which each has a
<code>fit.info</code> field describing its mean-variance curve (see also
<code>fitMeanVarCurve</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>occupy.only</code></td>
<td>
<p>A logical scalar. If it is <code>TRUE</code> (default), only
occupied intervals are used to estimate the number of
prior degrees of freedom and adjust the variance ratio factors.
Otherwise, all intervals are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_low, p_up</code></td>
<td>
<p>Lower- and upper-proportions of extreme values to be
Winsorized (see "References"). Each of them must be strictly larger than
0, and their sum must be strictly smaller than 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d0_low, d0_up</code></td>
<td>
<p>Positive reals specifying the lower and upper bounds
of estimated <code class="reqn">d0</code> (i.e., number of prior degrees of freedom).
<code>Inf</code> is <em>not</em> allowed.
</p>
<p>During the estimation process, if <code class="reqn">d0</code> is sure to be less than
or equal to <code>d0_low</code>, it will be considered as 0, and if it is
sure to be larger than or equal to <code>d0_up</code>, it will be considered
as positive infinity.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps</code></td>
<td>
<p>The required numeric precision for estimating <code class="reqn">d0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nw</code></td>
<td>
<p>A list containing <code>nodes</code> and <code>weights</code> variables for
calculating the definite integral of a function <code>f</code> over the
interval <code>[-1, 1]</code>, which is approximated by
<code>sum(nw$weights * f(nw$nodes))</code>. By default,
a set of Gauss-Legendre nodes along with the corresponding weights
calculated by <code>gauss.quad</code> is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.d0</code></td>
<td>
<p>A logical scalar. If set to <code>TRUE</code>, the function
simply returns the estimated <code class="reqn">d0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>no.rep.rv</code></td>
<td>
<p>A positive real specifying the variance ratio factor of
those <code>bioCond</code>s without replicate samples, if any. By default,
it's set to the geometric mean of variance ratio factors of the other
<code>bioCond</code>s.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.call</code></td>
<td>
<p>Never care about this argument.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The core function of <code>estimatePriorDfRobust</code> is very similar to that
of <code>estimatePriorDf</code>, except that the former estimates the
number of prior degrees of freedom and variance ratio factors
<em>in a robust manner</em> (see also "References").
</p>
<p>Unlike <code>estimatePriorDf</code>, you need to call explicitly
<code>estimatePriorDfRobust</code> if you are intended to perform <em>robust</em>
parameter estimation after associating a mean-variance curve with a set of
<code>bioCond</code> objects (via <code>fitMeanVarCurve</code> for
example; see "Examples" below).
</p>


<h3>Value</h3>

<p>By default, <code>estimatePriorDfRobust</code> returns
the argument list of <code>bioCond</code> objects,
with the estimated number of prior degrees of
freedom substituted for the <code>"df.prior"</code> component of each of them.
Besides, their <code>"ratio.var"</code> components have been adjusted
accordingly, and an attribute named <code>"no.rep.rv"</code> is added to the
list if it's ever been used as the variance ratio factor of the
<code>bioCond</code>s without replicate samples. A special case is that the
estimated number of prior degrees of freedom is 0. In this case,
<code>estimatePriorDfRobust</code> won't adjust existing variance ratio
factors, and you may want to use <code>setPriorDfVarRatio</code> to
explicitly specify variance ratio factors.
</p>
<p>If <code>return.d0</code> is set to <code>TRUE</code>, <code>estimatePriorDfRobust</code>
simply returns the estimated number of prior degrees of freedom.
</p>


<h3>References</h3>

<p>Tukey, J.W., <em>The future of data analysis.</em> The annals of
mathematical statistics, 1962. <strong>33</strong>(1): p. 1-67.
</p>
<p>Phipson, B., et al., <em>Robust Hyperparameter Estimation
Protects against Hypervariable Genes and Improves Power to Detect
Differential Expression.</em> Annals of Applied Statistics, 2016.
<strong>10</strong>(2): p. 946-963.
</p>


<h3>See Also</h3>

<p><code>bioCond</code> for creating a <code>bioCond</code> object;
<code>fitMeanVarCurve</code> for fitting a mean-variance curve and
using a <code>fit.info</code> field to characterize it;
<code>estimatePriorDf</code> for the ordinary (non-robust) version of
<code>estimatePriorDfRobust</code>; <code>setPriorDfRobust</code> for setting
the number of prior degrees of freedom and accordingly adjusting the
variance ratio factors of a set of <code>bioCond</code>s
<em>in a robust manner</em>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(H3K27Ac, package = "MAnorm2")
attr(H3K27Ac, "metaInfo")

## Estimate parameters regarding the associated mean-variance curve in a
## robust manner. Here we treat each cell line (i.e., individual) as a
## biological condition.

# Perform MA normalization and construct bioConds to represent cell lines.
norm &lt;- normalize(H3K27Ac, 4, 9)
norm &lt;- normalize(norm, 5:6, 10:11)
norm &lt;- normalize(norm, 7:8, 12:13)
conds &lt;- list(GM12890 = bioCond(norm[4], norm[9], name = "GM12890"),
              GM12891 = bioCond(norm[5:6], norm[10:11], name = "GM12891"),
              GM12892 = bioCond(norm[7:8], norm[12:13], name = "GM12892"))
autosome &lt;- !(H3K27Ac$chrom %in% c("chrX", "chrY"))
conds &lt;- normBioCond(conds, common.peak.regions = autosome)

# Fit a mean-variance curve by using the parametric method.
conds &lt;- fitMeanVarCurve(conds, method = "parametric", occupy.only = TRUE)

# Estimate the associated number of prior degrees of freedom and variance
# ratio factors in a robust manner.
conds2 &lt;- estimatePriorDfRobust(conds, occupy.only = TRUE)

# In this case, there is little difference in estimation results between the
# ordinary routine and the robust one.
sapply(conds, function(x) c(x$fit.info$df.prior, x$fit.info$ratio.var))
sapply(conds2, function(x) c(x$fit.info$df.prior, x$fit.info$ratio.var))

</code></pre>


</div>