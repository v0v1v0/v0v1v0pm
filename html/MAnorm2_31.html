<div class="container">

<table style="width: 100%;"><tr>
<td>mean_var_logwinf</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Expectation and Variance of Log Winsorized <em>F</em> Distribution</h2>

<h3>Description</h3>

<p><code>mean_var_logwinf</code> calculates the expectation and
variance of a log Winsorized <em>F</em> distribution by
appealing to methods for numerical integration.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mean_var_logwinf(
  df1,
  df2,
  p_low = 0.01,
  p_up = 0.1,
  nw = gauss.quad(128, kind = "legendre")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df1, df2</code></td>
<td>
<p>Vectors of numbers of numerator and denominator degrees of
freedom. <code>Inf</code> is allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_low, p_up</code></td>
<td>
<p>Vectors of lower- and upper-tail probabilities for
Winsorizing. Each element must be strictly larger than 0, and each pair
of <code>p_low</code> and <code>p_up</code> must have a sum strictly smaller than 1.
</p>
<p>Note that <code>df1</code>,
<code>df2</code>, <code>p_low</code>, and <code>p_up</code> are recycled to align with the
longest of them.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nw</code></td>
<td>
<p>A list containing <code>nodes</code> and <code>weights</code> variables for
calculating the definite integral of a function <code>f</code> over the
interval <code>[-1, 1]</code>, which is approximated by
<code>sum(nw$weights * f(nw$nodes))</code>. By default,
<code>mean_var_logwinf</code> uses
a set of Gauss-Legendre nodes along with the corresponding weights
calculated by <code>gauss.quad</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function implements exactly the same method described in
Phipson et al., 2016 (see "References").
</p>


<h3>Value</h3>

<p>A list consisting of the following components:
</p>

<dl>
<dt><code>mu</code></dt>
<dd>
<p>Vector of expectations.</p>
</dd>
<dt><code>v</code></dt>
<dd>
<p>Vector of variances.</p>
</dd>
</dl>
<h3>References</h3>

<p>Phipson, B., et al., <em>Robust Hyperparameter Estimation
Protects against Hypervariable Genes and Improves Power to Detect
Differential Expression.</em> Annals of Applied Statistics, 2016.
<strong>10</strong>(2): p. 946-963.
</p>


<h3>See Also</h3>

<p><code>gauss.quad</code> for calculating nodes and
weights for Gaussian quadrature.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Derive the expectation and variance of a log Winsorized F distribution by
# simulation.
random_logwinf &lt;- function(n, df1, df2, p_low, p_up) {
    x &lt;- rf(n, df1, df2)
    q_low &lt;- qf(p_low, df1, df2, lower.tail = TRUE)
    q_up &lt;- qf(p_up, df1, df2, lower.tail = FALSE)
    x[x &lt; q_low] &lt;- q_low
    x[x &gt; q_up] &lt;- q_up
    x &lt;- log(x)
    c(mean(x), var(x))
}

# Set parameters.
n &lt;- 10000
df1 &lt;- 2
df2 &lt;- 2 ^ (0:10)
p_low &lt;- 0.01
p_up &lt;- 0.1

# Compare simulation results with those from numerical integration.
set.seed(100)
res1 &lt;- vapply(df2, function(x) random_logwinf(n, df1, x, p_low, p_up),
               numeric(2))
res2 &lt;- mean_var_logwinf(df1, df2, p_low, p_up)

# Compare mean.
plot(0:10, res1[1, ], type = "l", lwd = 2, col = "red", xlab = "Log2(df2)",
     ylab = "Mean")
lines(0:10, res2$mu, lty = 5, lwd = 2, col = "blue")
legend("topright", c("Simulation", "Numerical integration"), lty = c(1, 5),
       lwd = 2, col = c("red", "blue"))

# Compare variance.
plot(0:10, res1[2, ], type = "l", lwd = 2, col = "red", xlab = "Log2(df2)",
     ylab = "Var")
lines(0:10, res2$v, lty = 5, lwd = 2, col = "blue")
legend("topright", c("Simulation", "Numerical integration"), lty = c(1, 5),
       lwd = 2, col = c("red", "blue"))

# When df2 is Inf.
random_logwinf(n, df1, Inf, p_low, p_up)
mean_var_logwinf(df1, Inf, p_low, p_up)

</code></pre>


</div>