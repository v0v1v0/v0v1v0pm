<div class="container">

<table style="width: 100%;"><tr>
<td>ss.aipe.rmsea.sensitivity</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>a priori Monte Carlo simulation for sample size planning for RMSEA in SEM
</h2>

<h3>Description</h3>

<p>Conduct a priori Monte Carlo simulation to empirically study the effects of (mis)specifications of input information on the calculated sample size. The sample size is planned so that the expected width of a confidence interval for the population RMSEA is no larger than desired. Random data are generated from the true covariance matrix but fit to the proposed model, whereas sample size is calculated based on the input covariance matrix and proposed model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ss.aipe.rmsea.sensitivity(width, model, Sigma, N=NULL, 
conf.level=0.95, G=200, save.file="sim.results.txt", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>width</code></td>
<td>
<p>desired confidence interval width for the model parameter of interest </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p> the model the researcher proposes, may or may not be the true model. This argument should be an RAM (reticular action model; e.g., McArdle &amp; McDonald, 1984) specification of a structural equation model, and should be of class <code>mod</code>. The model is specified in the same manner as does the <code>sem</code> package; see <code>sem</code> and <code>specify.model</code> for detailed documentation about model specifications in the RAM notation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma</code></td>
<td>
<p>the true population covariance matrix, which will be used to generate random data for the simulation study. The row names and column names of <code>Sigma</code> should be the same as the manifest variables in <code>model</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>if <code>N</code> is specified, random sample of the specified <code>N</code> size will be generated. Otherwise the sample size is calculated with the sample size planning method with the goal that the expected width of a confidence interval for population RMSEA is no larger than desired.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p> confidence level (i.e., 1- Type I error rate)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>G</code></td>
<td>
<p>number of replications in the Monte Carlo simulation </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save.file</code></td>
<td>
<p>the name of the file that simulation results will be saved to</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>  allows one to potentially include parameter values for inner functions</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function implements the sample size planning methods proposed in Kelley and Lai (2010). It depends on the 
function <code>sem</code> in the <code>sem</code> package to fit the proposed model to random data, and uses the same notation to specify SEM 
models as does <code>sem</code>. Please refer to <code>sem</code> for more detailed documentation 
about model specifications, the RAM notation, and model fitting techniques. For technical discussion 
on how to obtain the model implied covariance matrix in the RAM notation given model parameters, see McArdle and McDonald (1984)
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>successful.replication</code></td>
<td>
<p>the number of successful replications</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>the <code>G</code> random confidence interval widths </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RMSEA.hat</code></td>
<td>
<p>the <code>G</code> estimated RMSEA values based on the <code>G</code> random samples </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample.size</code></td>
<td>
<p>the sample size calculated </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>degrees of freedom of the proposed model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RMSEA.pop</code></td>
<td>
<p>the input RMSEA value that is used to calculated the necessary sample size</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>desired.width</code></td>
<td>
<p>desired confidence interval width</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mean.width</code></td>
<td>
<p>mean of the random confidence interval widths</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>median.width</code></td>
<td>
<p>median of the random confidence interval widths</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assurance</code></td>
<td>
<p>the proportion of confidence interval widths narrower than desired</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantile.width</code></td>
<td>
<p>99, 97, 95, 90, 80, 70, and 60 percentiles of the random confidence interval widths</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha.upper</code></td>
<td>
<p>the upper empirical Type I error rate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha.lower</code></td>
<td>
<p>the lower empirical Type I error rate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>total empirical Type I error rate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>confidence level</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sim.results.txt</code></td>
<td>
<p>a text file that saves the simulation results; it updates after each replication. 'sim.results.txt' is the default file name</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>Sometimes this function jumps out of the loop before it finishes the simulation. The reason is because the 
<code>sem</code> function that this function calls to fit the model fails to converge when searching for
maximum likelihood estimates of model parameters. Since the results in previous replications are saved, the
user can start this function again, and specify the number of replications (i.e., <code>G</code>) to be the desired
total number of replications minus the number of previous successful replications.
</p>


<h3>Author(s)</h3>

<p>Keke Lai (University of California – Merced) and Ken Kelley (University of Notre Dame; <a href="mailto:KKelley@ND.Edu">KKelley@ND.Edu</a>)
</p>


<h3>References</h3>

<p>Cudeck, R., &amp; Browne, M. W. (1992). Constructing a covariance matrix that yields a specified minimizer and a specified minimum discrepancy function value. <em>Psychometrika, 57</em>, 357–369. 
</p>
<p>Fox, J. (2006). Structural equation modeling with the sem package in R. <em>Structural Equation Modeling, 13</em>, 465–486.
</p>
<p>Kelley, K., &amp; Lai, K. (2010). Accuracy in parameter estimation for the root mean square of approximation: Sample size planning for narrow confidence intervals. <em>Manuscript under review</em>.
</p>
<p>McArdle, J. J., &amp; McDonald, R. P. (1984). Some algebraic properties of the reticular action model. <em>British Journal of Mathematical and Statistical Psychology, 37</em>, 234–251.
</p>


<h3>See Also</h3>

<p><code>sem</code>; <code>specify.model</code>; <code>ss.aipe.rmsea</code>; <code>theta.2.Sigma.theta</code>; <code>Sigma.2.SigmaStar</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
#########################
EXAMPLE 1 
######################### 
# To replicate the simulation in the first panel, second column of 
# Table 2 (i.e., population RMSEA=0.0268, df=23, desired width=0.02) 
# in Lai and Kelley (2010), the following steps can be used.

## STEP 1: Obtain the (correct) population covariance matrix implied by Model 2
# This requires the model and its population model parameter values.
library(MASS)
library(sem)

# Specify Model 2 in the RAM notation
model.2&lt;-specifyModel()
xi1 -&gt; y1, lambda1, 1
xi1 -&gt; y2, NA, 1
xi1 -&gt; y3, lambda2, 1
xi1 -&gt; y4, lambda3, 0.3
eta1 -&gt; y4, lambda4, 1
eta1 -&gt; y5, NA, 1
eta1 -&gt; y6, lambda5, 1
eta1 -&gt; y7, lambda6, 0.3
eta2 -&gt; y6, lambda7, 0.3
eta2 -&gt; y7, lambda8, 1
eta2 -&gt; y8, NA, 1
eta2 -&gt; y9, lambda9, 1
xi1 -&gt; eta1, gamma11, 0.6
eta1 -&gt; eta2, beta21, 0.6 
xi1 &lt;-&gt; xi1, phi11, 0.49
eta1 &lt;-&gt; eta1, psi11, 0.3136
eta2 &lt;-&gt; eta2, psi22, 0.3136
y1 &lt;-&gt; y1, delta1, 0.51
y2 &lt;-&gt; y2, delta2, 0.51
y3 &lt;-&gt; y3, delta3, 0.51
y4 &lt;-&gt; y4, delta4, 0.2895
y5 &lt;-&gt; y5, delta5, 0.51
y6 &lt;-&gt; y6, delta6, 0.2895
y7 &lt;-&gt; y7, delta7, 0.2895
y8 &lt;-&gt; y8, delta8, 0.51
y9 &lt;-&gt; y9, delta9, 0.51


# To inspect the specified model
model.2

# Specify model parameter values
theta &lt;- c(1, 1, 0.3, 1,1, 0.3, 0.3, 1, 1, 0.6, 0.6,
0.49, 0.3136, 0.3136, 0.51, 0.51, 0.51, 0.2895, 0.51, 0.2895, 0.2895, 0.51, 0.51)

names(theta) &lt;- c("lambda1","lambda2","lambda3",
"lambda4","lambda5","lambda6","lambda7","lambda8","lambda9",
"gamma11", "beta21",
"phi11", "psi11", "psi22", 
"delta1","delta2","delta3","delta4","delta5","delta6","delta7",
"delta8","delta9")

res&lt;-theta.2.Sigma.theta(model=model.2, theta=theta, 
latent.vars=c("xi1", "eta1","eta2"))

Sigma.theta &lt;- res$Sigma.theta
# Then 'Sigma.theta' is the (true) population covariance matrix

## STEP 2: Create a misspecified model
# The following model is misspecified in the same way as did Lai and Kelley (2010)
# with the goal to obtain a relatively small population RMSEA

model.2.mis&lt;-specifyModel()
xi1 -&gt; y1, lambda1, 1
xi1 -&gt; y2, NA, 1
xi1 -&gt; y3, lambda2, 1
xi1 -&gt; y4, lambda3, 0.3
eta1 -&gt; y4, lambda4, 1
eta1 -&gt; y5, NA, 1
eta1 -&gt; y6, lambda5, 0.96
eta2 -&gt; y6, lambda7, 0.33
eta2 -&gt; y7, lambda8, 1.33
eta2 -&gt; y8, NA, 1
eta2 -&gt; y9, lambda9, 1
xi1 -&gt; eta1, gamma11, 0.6
eta1 -&gt; eta2, beta21, 0.65 
xi1 &lt;-&gt; xi1, phi11, 0.49
eta1 &lt;-&gt; eta1, psi11, 0.3136
eta2 &lt;-&gt; eta2, psi22, 0.23
y1 &lt;-&gt; y1, delta1, 0.51
y2 &lt;-&gt; y2, delta2, 0.51
y3 &lt;-&gt; y3, delta3, 0.51
y4 &lt;-&gt; y4, delta4, 0.2895
y5 &lt;-&gt; y5, delta5, 0.51
y6 &lt;-&gt; y6, delta6, 0.29
y7 &lt;-&gt; y7, delta7, 0.22
y8 &lt;-&gt; y8, delta8, 0.56
y9 &lt;-&gt; y9, delta9, 0.56


# To verify the population RMSEA of this misspecified model
fit&lt;-sem(ram=model.2.mis, S=Sigma.theta, N=1000000)
summary(fit)$RMSEA

## STEP 3: Conduct the simulation
# The number of replications is set to a very small value just to demonstrate
# and save time. Real simulation studies require a larger number (e.g., 500, 1,000)

ss.aipe.rmsea.sensitivity(width=0.02, model=model.2.mis, Sigma=Sigma.theta, G=10)

## STEP 3+: In cases where this function stops before it finishes the simulation
# Suppose it stops at the 7th replication. The text 
# file "results_ss.aipe.rmsea.sensitivity.txt" saves the results in all 
# previous replications; in this case it contains 6 replications since
# the simulation stopped at the 7th. The user can start this function again and specify
# 'G' to 4 (i.e., 10-6). New results will be appended to previous ones in the same file.

ss.aipe.rmsea.sensitivity(width=0.02, model=model.2.mis, Sigma=Sigma.theta, G=4)

########################################
EXAMPLE 2
########################################
# In addition to create a misspecified model by changing the model
# parameters in the true model as does Example 1, a misspecified
# model can also be created with the Cudeck-Browne (1992) procedure. 
# This procedure is implemented in the 'Sigma.2.SigmaStar( )' function in
# the MBESS package. Please refer to the help file of 'Sigma.2.SigmaStar( )'
# for detailed documentation.

## STEP 1: Specify the model
# This model is the same as the model in the first step of Example 1, but the
# model-implied population covariance matrix is no longer the true population 
# covariance matrix. The true population covariance matrix will be generated
# in Step 2 with the Cudeck-Browne procedure.
library(MASS)
library(sem)

model.2&lt;-specifyModel()
xi1 -&gt; y1, lambda1, 1
xi1 -&gt; y2, NA, 1
xi1 -&gt; y3, lambda2, 1
xi1 -&gt; y4, lambda3, 0.3
eta1 -&gt; y4, lambda4, 1
eta1 -&gt; y5, NA, 1
eta1 -&gt; y6, lambda5, 1
eta1 -&gt; y7, lambda6, 0.3
eta2 -&gt; y6, lambda7, 0.3
eta2 -&gt; y7, lambda8, 1
eta2 -&gt; y8, NA, 1
eta2 -&gt; y9, lambda9, 1
xi1 -&gt; eta1, gamma11, 0.6
eta1 -&gt; eta2, beta21, 0.6 
xi1 &lt;-&gt; xi1, phi11, 0.49
eta1 &lt;-&gt; eta1, psi11, 0.3136
eta2 &lt;-&gt; eta2, psi22, 0.3136
y1 &lt;-&gt; y1, delta1, 0.51
y2 &lt;-&gt; y2, delta2, 0.51
y3 &lt;-&gt; y3, delta3, 0.51
y4 &lt;-&gt; y4, delta4, 0.2895
y5 &lt;-&gt; y5, delta5, 0.51
y6 &lt;-&gt; y6, delta6, 0.2895
y7 &lt;-&gt; y7, delta7, 0.2895
y8 &lt;-&gt; y8, delta8, 0.51
y9 &lt;-&gt; y9, delta9, 0.51



theta &lt;- c(1, 1, 0.3, 1,1, 0.3, 0.3, 1, 1, 0.6, 0.6,
0.49, 0.3136, 0.3136, 0.51, 0.51, 0.51, 0.2895, 0.51, 0.2895, 0.2895, 0.51, 0.51)

names(theta) &lt;- c("lambda1","lambda2","lambda3",
"lambda4","lambda5","lambda6","lambda7","lambda8","lambda9",
"gamma11", "beta21",
"phi11", "psi11", "psi22", 
"delta1","delta2","delta3","delta4","delta5","delta6","delta7",
"delta8","delta9")

## STEP 2: Create the true population covariance matrix, so that (a) the model fits
# to this covariance matrix with specified discrepancy; (b) the population model
# parameters (the object 'theta') is the minimizer in fitting the model to the true 
# population covariance matrix.

# Since the desired RMSEA is 0.0268 and the df is 22, the MLE discrepancy value
# is specified to be 22*0.0268*0.0268, given the definition of RMSEA.

res &lt;- Sigma.2.SigmaStar(model=model.2, model.par=theta, 
latent.var=c("xi1", "eta1", "eta2"), discrep=22*0.0268*0.0268)

Sigma.theta.star &lt;- res$Sigma.star

# To verify that the population RMSEA is 0.0268
res2 &lt;- sem(ram=model.2, S=Sigma.theta.star, N=1000000)
summary(res2)$RMSEA

## STEP 3: Conduct the simulation
# Note although Examples 1 and 2 have the same population RMSEA, the
# model df and true population covariance matrix are different. Example 1
# uses 'model.2.mis' and 'Sigma.theta', whereas Example 2 uses 'model.2'
# and 'Sigma.theta.star'. Since the df is different, it requires a different sample
# size to achieve the same desired confidence interval width. 
ss.aipe.rmsea.sensitivity(width=0.02, model=model.2, Sigma=Sigma.theta.star, G=10)

## End(Not run)
</code></pre>


</div>