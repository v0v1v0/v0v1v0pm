<div class="container">

<table style="width: 100%;"><tr>
<td>diffQ</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculation of the melting temperature (Tm) from the first derivative</h2>

<h3>Description</h3>

<p><code>diffQ</code> is used to calculate the melting temperature (Tm) but also for
elementary graphical operations (e.g., show the Tm or the derivative). It
does not require smoothed data for the MCA. The parameter <code>rsm</code> can be
used to double the temperature resolution by calculation of the mean
temperature and mean fluorescence. Note: mcaSmoother has the <code>n</code>
parameter with a similar functionality. First the approximate Tm is
determined as the <code>min()</code> and/or <code>max()</code> from the first
derivative. The first numeric derivative (Forward Difference) is estimated
from the values of the function values obtained during an experiment since
the exact function of the melting curve is unknown. The method used in
<code>diffQ</code> is suitable for independent variables that are equally and
unequally spaced. Alternatives for the numerical differentiation include
Backward Differences, Central Differences or Three-Point (Forward or
Backward) Difference based on Lagrange Estimation (currently not implemented
in <code>diffQ</code>). The approximate peak value is the starting-point for a
function based calculation. The function takes a defined number n (maximum
8) of the left and the right neighbor values and fits a quadratic
polynomial. The quadratic regression of the X (temperature) against the Y
(fluorescence) range gives the coefficients. The optimal quadratic
polynomial is chosen based on the highest adjusted R-squared value.
<code>diffQ</code> returns an objects of the class <code>list</code>. To accessing
components of lists is done as described elsewhere either by name or by
number. <code>diffQ</code> has a simple plot function. However, for sophisticated
analysis and plots its recommended to use <code>diffQ</code> as presented in the
examples as part of algorithms.
</p>


<h3>Usage</h3>

<pre><code class="language-R">diffQ(
  xy,
  fct = min,
  fws = 8,
  col = 2,
  plot = FALSE,
  verbose = FALSE,
  warn = TRUE,
  peak = FALSE,
  negderiv = TRUE,
  deriv = FALSE,
  derivlimits = FALSE,
  derivlimitsline = FALSE,
  vertiline = FALSE,
  rsm = FALSE,
  inder = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>xy</code></td>
<td>
<p>is a <code>data.frame</code> containing in the first column the
temperature and in the second column the fluorescence values. Preferably the
output from <code>mcaSmoother</code> is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fct</code></td>
<td>
<p>accepts <code>min</code> or <code>max</code> as option and is used to define
whether to find a local minimum (“negative peak”) or local maximum
(“positive peak”).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fws</code></td>
<td>
<p>defines the number (n) of left and right neighbors to use for the
calculation of the quadratic polynomial.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>is a graphical parameter used to define the length of the line
used in the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>shows a plot of a single melting curve. To draw multiple curves
in a single plot set <code>plot = FALSE</code> and create and empty plot instead
(see examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>shows additional information (e.g., approximate derivative,
ranges used for calculation, approximate Tm) of the calculation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warn</code></td>
<td>
<p>diffQ tries to keep the user as informed as possible about the
quality of the analysis. However, in some scenarios are the warning and
message about analysis not needed or disturbing.  <code>warn</code> can be used to
stop the swapping of the output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>peak</code></td>
<td>
<p>shows the peak in the plot (see examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>negderiv</code></td>
<td>
<p>uses the positive first derivative instead of the negative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deriv</code></td>
<td>
<p>shows the first derivative with the color assigned to
<code>col</code> (see examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>derivlimits</code></td>
<td>
<p>shows the neighbors (fws) used to calculate the Tm as
points in the plot (see examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>derivlimitsline</code></td>
<td>
<p>shows the neighbors (fws) used to calculate the Tm as
line in the plot (see examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vertiline</code></td>
<td>
<p>draws a vertical line at the Tms (see examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rsm</code></td>
<td>
<p>performs a doubling of the temperature resolution by calculation
of the mean temperature and mean fluorescence between successive temperature
steps. Note: <code>mcaSmoother</code> has the "n" parameter with a similar but
advanced functionality.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inder</code></td>
<td>
<p>Interpolates first derivatives using the five-point stencil.
See <code>chipPCR</code> package for details.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>diffQ() </code></td>
<td>
<p>returns a comprehensive list (if parameter verbose
is TRUE) with results from the first derivative. The list includes a
<code>data.frame</code> of the derivative ("xy"). The temperature range
("limits.xQ") and fluorescence range ("limits.diffQ") to calculate the peak
value. "fluo.x" is the approximate fluorescence at the approximate melting
temperature. The calculated melting temperature ("Tm") with the
corresponding fluorescence intensity ("fluoTm"). The number of neighbors
("fws"), the adjusted R-squared ("adj.r.squared") and the
normalized-root-mean-squared-error ("NRMSE") to fit. The quality of the
calculated melting temperature ("Tm") can be checked with devsum which
reports the relative deviation (in percent) between the approximate melting
temperature and the calculated melting temperature, if NRMSE is less than
0.08 and the adjusted R-squared is less than 0.85. A relative deviation
larger than 10 percent will result in a warning. Reducing fws might improve
the result. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Tm </code></td>
<td>
<p>returns the calculated melting temperature ("Tm").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fluoTm </code></td>
<td>
<p>returns the calculated fluorescence at the calculated melting
temperature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Tm.approx </code></td>
<td>
<p>returns the approximate melting temperature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fluo.x </code></td>
<td>
<p>returns the approximate fluorescence at the calculated
melting temperature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xy </code></td>
<td>
<p>returns the approximate derivative value used for the calculation
of the melting peak.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>limits.xQ </code></td>
<td>
<p>returns a data range of temperature values used to
calculate the melting temperature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>limits.diffQ </code></td>
<td>
<p>returns a data range of fluorescence values used to
calculate the melting temperature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adj.r.squared </code></td>
<td>
<p>returns the adjusted R-squared from the quadratic
model fitting function (see also <code>fit</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NRMSE </code></td>
<td>
<p>returns the normalized root-mean-squared-error (NRMSE) from
the quadratic model fitting function (see also <code>fit</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fws </code></td>
<td>
<p>returns the number of points used for the calculation of the
melting temperature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>devsum </code></td>
<td>
<p>returns measures to show the difference between the
approximate and calculated melting temperature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>temperature </code></td>
<td>
<p>returns measures to investigate the temperature
resolution of the melting curve. Raw fluorescence measurements at irregular
temperature resolutions (intervals) can introduce artifacts and thus lead to
wrong melting point estimations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>temperature$T.delta </code></td>
<td>
<p>returns the difference between two successive
temperature steps.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>temperature$mean.T.delta </code></td>
<td>
<p>returns the mean difference between two
temperature steps.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>temperature$sd.T.delta </code></td>
<td>
<p>returns the standard deviation of the
temperature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>temperature$RSD.T.delta </code></td>
<td>
<p>returns the relative standard deviation
(RSD) of the temperature in percent.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit </code></td>
<td>
<p>returns the summary of the results of the quadratic model
fitting function.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Stefan Roediger
</p>


<h3>References</h3>

<p>A Highly Versatile Microscope Imaging Technology Platform for
the Multiplex Real-Time Detection of Biomolecules and Autoimmune Antibodies.
S. Roediger, P. Schierack, A. Boehm, J. Nitschke, I. Berger, U. Froemmel, C.
Schmidt, M. Ruhland, I. Schimke, D. Roggenbuck, W. Lehmann and C.
Schroeder.  <em>Advances in Biochemical Bioengineering/Biotechnology</em>.
133:33–74, 2013. <a href="https://pubmed.ncbi.nlm.nih.gov/22437246/">https://pubmed.ncbi.nlm.nih.gov/22437246/</a>
</p>
<p>Nucleic acid detection based on the use of microbeads: a review. S.
Roediger, C. Liebsch, C. Schmidt, W. Lehmann, U. Resch-Genger, U. Schedler,
P. Schierack. <em>Microchim Acta</em> 2014:1–18. DOI:
10.1007/s00604-014-1243-4
</p>
<p>Roediger S, Boehm A, Schimke I. Surface Melting Curve Analysis with R.
<em>The R Journal</em> 2013;5:37–53.
</p>
<p>Roediger S et al. R as an Environment for the Reproducible 
Analysis of DNA Amplification Experiments. <em>The R Journal</em> 
2015;7:127–150.
</p>


<h3>See Also</h3>

<p><code>diffQ2</code>, <code>mcaSmoother</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# First Example
# Plot the first derivative of different samples for single melting curve
# data. Note that the argument "plot" is TRUE.

default.par &lt;- par(no.readonly = TRUE)

data(MultiMelt)
par(mfrow = c(1,2))
sapply(2L:14, function(i) {
        tmp &lt;- mcaSmoother(MultiMelt[, 1], MultiMelt[, i])
        diffQ(tmp, plot = TRUE)
  }
)
par(mfrow = c(1,1))
# Second example
# Plot the first derivative of different samples from MultiMelt
# in a single plot.
data(MultiMelt)

# First create an empty plot
plot(NA, NA, xlab = "Temperature", ylab ="-d(refMFI)/d(T)",
        main = "Multiple melting peaks in a single plot", xlim = c(65,85),
        ylim = c(-0.4,0.01), pch = 19, cex = 1.8)
# Prepossess the selected melting curve data (2,6,12) with mcaSmoother 
# and apply them to diffQ. Note that the argument "plot" is FALSE
# while other arguments like derivlimitsline or peak are TRUE. 
sapply(c(2,6,12), function(i) {
	tmp &lt;- mcaSmoother(MultiMelt[, 1], MultiMelt[, i], 
			    bg = c(41,61), bgadj = TRUE)
	diffQ(tmp, plot = FALSE, derivlimitsline = TRUE, deriv = TRUE, 
	      peak = TRUE, derivlimits = TRUE, col = i, vertiline = TRUE)
  }
)
legend(65, -0.1, colnames(MultiMelt[, c(2,6,12)]), pch = c(15,15,15), 
	col = c(2,6,12))

# Third example
# First create an empty plot
plot(NA, NA, xlim = c(50,85), ylim = c(-0.4,2.5), 
     xlab = "Temperature", 
     ylab ="-refMFI(T) | refMFI'(T) | refMFI''(T)",
     main = "1st and 2nd Derivatives", 
     pch = 19, cex = 1.8)

# Prepossess the selected melting curve data with mcaSmoother 
# and apply them to diffQ and diffQ2. Note that 
# the argument "plot" is FALSE while other 
# arguments like derivlimitsline or peak are TRUE.

tmp &lt;- mcaSmoother(MultiMelt[, 1], MultiMelt[, 2], 
		    bg = c(41,61), bgadj = TRUE)
lines(tmp, col= 1, lwd = 2)

# Note the different use of the argument derivlimits in diffQ and diffQ2
diffQ(tmp, fct = min, derivlimitsline = TRUE, deriv = TRUE, 
	    peak = TRUE, derivlimits = FALSE, col = 2, vertiline = TRUE)
diffQ2(tmp, fct = min, derivlimitsline = TRUE, deriv = TRUE, 
	    peak = TRUE, derivlimits = TRUE, col = 3, vertiline = TRUE)

# Add a legend to the plot
legend(65, 1.5, c("Melting curve",
		  "1st Derivative", 
		  "2nd Derivative"), 
		  pch = c(19,19,19), col = c(1,2,3))

# Fourth example
# Different curves may potentially have different quality in practice. 
# For example, using data from MultiMelt should return a 
# valid result and plot.
data(MultiMelt)

diffQ(cbind(MultiMelt[, 1], MultiMelt[, 2]), plot = TRUE)$Tm
# limits_xQ
#  77.88139

# Imagine an experiment that went terribly wrong. You would 
# still get an estimate for the Tm. The output from diffQ, 
# with an error attached, lets the user know that this Tm 
# is potentially meaningless. diffQ() will give several 
# warning messages.

set.seed(1)
y = rnorm(55,1.5,.8)
diffQ(cbind(MultiMelt[, 1],y), plot = TRUE)$Tm

# The distribution of the curve data indicates noise.
# The data should be visually inspected with a plot 
# (see examples of diffQ). The Tm calculation (fit, 
# adj. R squared ~ 0.157, NRMSE ~ 0.279) is not optimal 
# presumably due to noisy data. Check raw melting 
# curve (see examples of diffQ).
# Calculated Tm 
#      56.16755


# Sixth example
# Curves may potentially have a low temperature resolution. The rsm 
# parameter can be used to double the temperature resolution.
# Use data from MultiMelt column 15 (MLC2v2).
data(MultiMelt)
tmp &lt;- cbind(MultiMelt[, 1], MultiMelt[, 15])

# Use diffQ without and with the rsm parameter and plot
# the results in a single row
par(mfrow = c(1,2))

diffQ(tmp, plot = TRUE)$Tm
  text(60, -0.15, "without rsm parameter")

diffQ(tmp, plot = TRUE, rsm = TRUE)$Tm
  text(60, -0.15, "with rsm parameter")
par(default.par)

</code></pre>


</div>