<div class="container">

<table style="width: 100%;"><tr>
<td>diffQ2</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculation of the melting temperatures (Tm, Tm1D2 and Tm2D2) from the first
and the second derivative</h2>

<h3>Description</h3>

<p><code>diffQ2()</code> calls instances of <code>diffQ()</code> to calculate the Tm1D2 and
Tm2D2. The options are similar to <code>diffQ()</code>. Both <code>diffQ()</code> and
<code>diffQ2()</code> return objects of the class <code>list</code>.  To accessing
components of lists is done as described elsewhere either be name or by
number. <code>diffQ2</code> has no standalone plot function. For sophisticated
analysis and plots it is recommended to use <code>diffQ2</code> as presented in the
examples as part of algorithms.
</p>


<h3>Usage</h3>

<pre><code class="language-R">diffQ2(
  xy,
  fct = max,
  fws = 8,
  col = 2,
  plot = FALSE,
  verbose = FALSE,
  peak = FALSE,
  deriv = FALSE,
  negderiv = TRUE,
  derivlimits = FALSE,
  derivlimitsline = FALSE,
  vertiline = FALSE,
  rsm = FALSE,
  inder = FALSE,
  warn = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>xy</code></td>
<td>
<p>is a <code>data.frame</code> containing in the first column the
temperature and in the second column the fluorescence values. Preferably the
output from <code>mcaSmoother</code> is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fct</code></td>
<td>
<p>accepts <code>min</code> or <code>max</code> as option and is used to define
whether to find a local minimum (“negative peak”) or local maximum
(“positive peak”).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fws</code></td>
<td>
<p>defines the number (n) of left and right neighbors to use for the
calculation of the quadratic polynomial.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>is a graphical parameter used to define the length of the line
used in the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>shows a plot of a single melting curve with (Tm) as vertical
line and the second derivatives (Tm1D2 and Tm2D2). To draw multiple curves
in a single plot set <code>plot = FALSE</code> and create and empty plot instead
(see examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>shows additional information (e.g., first and second
approximate derivatives, ranges used for calculation, approximate Tm, Tm1D2,
Tm2D2) of the calculation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>peak</code></td>
<td>
<p>shows the peak in the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deriv</code></td>
<td>
<p>shows the first derivative with the color assigned to
<code>col</code> (see examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>negderiv</code></td>
<td>
<p>calculates the negative derivative (default). If
<code>FALSE</code> the positive first negative is calculated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>derivlimits</code></td>
<td>
<p>shows the number (n) used to calculate the Tm as points
in the plot (see examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>derivlimitsline</code></td>
<td>
<p>shows the number (n) used to calculate the Tm as line
in the plot (see examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vertiline</code></td>
<td>
<p>draws a vertical line at the Tms (see examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rsm</code></td>
<td>
<p>performs a doubling of the temperature resolution by calculation
of the mean temperature and mean fluorescence between successive temperature
steps. Note: mcaSmoother has the "n" parameter with a similar but advanced
functionality.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inder</code></td>
<td>
<p>Interpolates derivatives using the five-point stencil.  See
<code>chipPCR</code> package for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warn</code></td>
<td>
<p>diffQ tries to keep the user as informed as possible about the
quality of the analysis. However, in some scenarios are the warning and
message about analysis not needed or disturbing.  <code>warn</code> can be used to
stop the swapping of the output.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>$TmD1</code></td>
<td>
<p><code>TmD1</code> returns a comprehensive list (if parameter verbose
is TRUE) with results from the first derivative. The list includes a
<code>data.frame</code> of the derivative ("xy"). The temperature range
("limits.xQ") and fluorescence range ("limits.diffQ") to calculate the peak
value. "fluo.x" is the approximate fluorescence at the approximate melting
temperature. The calculated melting temperature ("Tm") with the
corresponding fluorescence intensity ("fluoTm"). The number of points
("fws") and the adjusted R-squared ("adj.r.squared") to fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$TmD1$Tm</code></td>
<td>
<p>returns the calculated melting temperature ("Tm") from the
first derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$TmD1$fluoTm</code></td>
<td>
<p>returns the calculated fluorescence at the calculated
melting temperature ("Tm").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$TmD1$Tm.approx</code></td>
<td>
<p>returns the approximate melting temperature ("Tm")
from the first derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$TmD1$fluo.x</code></td>
<td>
<p>returns the approximate fluorescence at the calculated
melting temperature ("Tm").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$TmD1$xy</code></td>
<td>
<p>is a <code>data.frame</code> containing in the first column the
temperature and in the second column the fluorescence values. Preferably the
output from <code>mcaSmoother</code> is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$TmD1$limits.xQ</code></td>
<td>
<p>returns a data range of temperature values used to
calculate the melting temperature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$TmD1$limits.diffQ</code></td>
<td>
<p>returns a data range of fluorescence values used
to calculate the melting temperature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$TmD1$adj.r.squared</code></td>
<td>
<p>returns the adjusted R-squared from the quadratic
model fitting function (see also <code>fit</code>) of the first derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$TmD1$NRMSE</code></td>
<td>
<p>returns the normalized root-mean-squared-error (NRMSE)
from the quadratic model fitting function (see also <code>fit</code>) of the first
derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$TmD1$fws</code></td>
<td>
<p>returns the number of points used for the calculation of
the melting temperature of the first derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$TmD1$devsum</code></td>
<td>
<p>returns measures to show the difference between the
approximate and calculated melting temperature of the first derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$TmD1$fit</code></td>
<td>
<p>returns the summary of the results of the quadratic model
fitting function of the first derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm1D2</code></td>
<td>
<p>returns the "left" melting temperature ("Tm1D2 ") values from
the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm1D2$Tm</code></td>
<td>
<p>returns the "left" calculated melting temperature ("Tm1D2")
from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm1D2$fluoTm</code></td>
<td>
<p>returns the "left" calculated fluorescence at the
calculated melting temperature ("Tm1D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm1D2$Tm.approx</code></td>
<td>
<p>returns the "left" approximate melting temperature
("Tm1D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm1D2$fluo.x</code></td>
<td>
<p>returns the "left" approximate fluorescence at the
calculated melting temperature ("Tm1D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm1D2$xy</code></td>
<td>
<p>is a <code>data.frame</code> containing in the first column the
temperature and in the second column the fluorescence values of the "left"
melting temperature ("Tm1D2") from the second derivative. Preferably the
output from <code>mcaSmoother</code> is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm1D2$limits.xQ</code></td>
<td>
<p>returns a data range of temperature values used to
calculate the melting temperature of the "left" melting temperature
("Tm1D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm1D2$limits.diffQ</code></td>
<td>
<p>returns a data range of fluorescence values used
to calculate the melting temperature of the "left" melting temperature
("Tm1D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm1D2$adj.r.squared</code></td>
<td>
<p>returns the adjusted R-squared from the
quadratic model fitting function (see also <code>fit</code>) of the "left" melting
temperature ("Tm1D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm1D2$NRMSE</code></td>
<td>
<p>returns normalized root-mean-squared-error (NRMSE) from
the quadratic model fitting function (see also <code>fit</code>) of the "left"
melting temperature ("Tm1D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm1D2$fws</code></td>
<td>
<p> returns the number of points used for the calculation of
the melting temperature of the "left" melting temperature ("Tm1D2") from the
second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm1D2$devsum</code></td>
<td>
<p> returns measures to show the difference between the
approximate and calculated melting temperature of the "left" melting
temperature ("Tm1D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm1D2$fit</code></td>
<td>
<p>returns the summary of the results of the quadratic model
fitting function of the "left" melting temperature ("Tm1D2") from the second
derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm2D2</code></td>
<td>
<p>returns the "right" melting temperature ("Tm2D2 ") values from
the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm2D2$Tm</code></td>
<td>
<p>returns the "right" calculated melting temperature
("Tm2D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm2D2$fluoTm</code></td>
<td>
<p>returns the "right" calculated fluorescence at the
calculated melting temperature ("Tm2D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm2D2$Tm.approx</code></td>
<td>
<p>returns the "right" approximate melting temperature
("Tm1D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm2D2$fluo.x</code></td>
<td>
<p>returns the "left" approximate fluorescence at the
calculated melting temperature ("Tm2D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm2D2$xy</code></td>
<td>
<p>is a <code>data.frame</code> containing in the first column the
temperature and in the second column the fluorescence values of the "right"
melting temperature ("Tm2D2") from the second derivative.  Preferably the
output from <code>mcaSmoother</code> is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm2D2$limits.xQ</code></td>
<td>
<p>returns a data range of temperature values used to
calculate the melting temperature of the "right" melting temperature
("Tm2D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm2D2$limits.diffQ</code></td>
<td>
<p>returns a data range of fluorescence values used
to calculate the melting temperature of the "right" melting temperature
("Tm"D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm2D2$adj.r.squared</code></td>
<td>
<p>returns the adjusted R-squared from the
quadratic model fitting function (see also <code>fit</code>) of the "right"
melting temperature ("Tm2D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm2D2$NRMSE</code></td>
<td>
<p>returns normalized root-mean-squared-error (NRMSE) from
the quadratic model fitting function (see also <code>fit</code>) of the "right"
melting temperature ("Tm2D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm2D2$fws</code></td>
<td>
<p>returns the number of points used for the calculation of
the melting temperature of the "right" melting temperature ("Tm2D2") from
the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm2D2$devsum</code></td>
<td>
<p>returns measures to show the difference between the
approximate and calculated melting temperature of the "right" melting
temperature ("Tm2D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$Tm2D2$fit</code></td>
<td>
<p>returns the summary of the results of the quadratic model
fitting function of the "right" melting temperature ("Tm2D2") from the
second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$xTm1.2.D2</code></td>
<td>
<p>returns only the "left" and right calculated melting
temperature ("Tm1D2, Tm2D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$yTm1.2.D2</code></td>
<td>
<p>returns only the "left" and right calculated fluorescence
("Tm1D2, Tm2D2") from the second derivative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$temperature</code></td>
<td>
<p>returns measures to investigate the temperature
resolution of the melting curve. Raw fluorescence measurements at irregular
temperature resolutions (intervals) can introduce artifacts and thus lead to
wrong melting point estimations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$temperature$T.delta</code></td>
<td>
<p>returns the difference between two successive
temperature steps.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$temperature$mean.T.delta</code></td>
<td>
<p>returns the mean difference between two
temperature steps.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$temperature$sd.T.delta</code></td>
<td>
<p>returns the standard deviation of the
temperature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>$temperature$RSD.T.delta</code></td>
<td>
<p>returns the relative standard deviation
(RSD) of the temperature in percent.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Stefan Roediger
</p>


<h3>References</h3>

<p>A Highly Versatile Microscope Imaging Technology Platform for
the Multiplex Real-Time Detection of Biomolecules and Autoimmune Antibodies.
S. Roediger, P. Schierack, A. Boehm, J. Nitschke, I. Berger, U. Froemmel, C.
Schmidt, M. Ruhland, I. Schimke, D. Roggenbuck, W. Lehmann and C.
Schroeder.  <em>Advances in Biochemical Bioengineering/Biotechnology</em>.
133:33–74, 2013. <a href="https://pubmed.ncbi.nlm.nih.gov/22437246/">https://pubmed.ncbi.nlm.nih.gov/22437246/</a>
</p>
<p>Nucleic acid detection based on the use of microbeads: a review. S.
Roediger, C. Liebsch, C. Schmidt, W. Lehmann, U. Resch-Genger, U. Schedler,
P. Schierack. <em>Microchim Acta</em> 2014:1–18. DOI:
10.1007/s00604-014-1243-4
</p>
<p>Roediger S, Boehm A, Schimke I. Surface Melting Curve Analysis with R.
<em>The R Journal</em> 2013;5:37–53.
</p>
<p>Roediger S et al. R as an Environment for the Reproducible 
Analysis of DNA Amplification Experiments. <em>The R Journal</em> 
2015;7:127–150.
</p>


<h3>See Also</h3>

<p><code>diffQ</code>, <code>mcaSmoother</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
default.par &lt;- par(no.readonly = TRUE)
# First Example
# Plot the first and the second derivative melting curves of MLC-2v
# for a single melting curve. Should give a warning message but the graph 
# will show you that the calculation is OK
data(MultiMelt)
tmp &lt;- mcaSmoother(MultiMelt[, 1], MultiMelt[, 14])
diffQ2(tmp, fct = min, verbose = FALSE, plot = TRUE)

# Second Example
# Calculate the maximum fluorescence of a melting curve, Tm, 
# Tm1D2 and Tm2D2 of HPRT1 for 12 microbead populations and assign the 
# values to the matrix HPRT1
data(MultiMelt)
HPRT1 &lt;- matrix(NA,12,4,
	dimnames = list(colnames(MultiMelt[, 2L:13]),
	    c("Fluo", "Tm", "Tm1D2", "Tm2D2")))
for (i in 2L:13) {
       tmp &lt;- mcaSmoother(MultiMelt[, 1], 
                     MultiMelt[, i])
       tmpTM &lt;- diffQ2(tmp, fct = min, verbose = TRUE)
       HPRT1[i-1, 1] &lt;- max(tmp$y)
       HPRT1[i-1, 2] &lt;- tmpTM$TmD1$Tm
       HPRT1[i-1, 3] &lt;- tmpTM$Tm1D2$Tm
       HPRT1[i-1, 4] &lt;- tmpTM$Tm2D2$Tm
}
HPRT1

# Third Example
# Use diffQ2 to determine the second derivative.

data(MultiMelt)
HPRT1 &lt;- matrix(NA,12,4,
	dimnames = list(colnames(MultiMelt[, 2L:13]),
	    c("Fluo", "Tm", "Tm1D2", "Tm2D2")))
for (i in 2L:13) {
       tmp &lt;- mcaSmoother(MultiMelt[, 1], 
                     MultiMelt[, i])
       tmpTM &lt;- diffQ2(tmp, fct = min, verbose = TRUE)
       HPRT1[i-1, 1] &lt;- max(tmp[["y.sp"]])
       HPRT1[i-1, 2] &lt;- tmpTM[["TmD1"]][["Tm"]]
       HPRT1[i-1, 3] &lt;- tmpTM[["Tm1D2"]][["Tm"]]
       HPRT1[i-1, 4] &lt;- tmpTM[["Tm2D2"]][["Tm"]]
}
plot(HPRT1[, 1], HPRT1[, 2], 
       xlab = "refMFI", ylab = "Temperature", 
       main = "HPRT1", xlim = c(2.1,2.55),
       ylim = c(72,82), pch = 19,
       col = 1:12, cex = 1.8)
points(HPRT1[, 1], HPRT1[, 3], pch = 15)
points(HPRT1[, 1], HPRT1[, 4], pch = 15)
abline(lm(HPRT1[, 2] ~ HPRT1[, 1]))
abline(lm(HPRT1[, 3] ~ HPRT1[, 1]))
abline(lm(HPRT1[, 4] ~ HPRT1[, 1]))

# Fourth Example
# Use diffQ2 with inder parameter to determine the second derivative.
data(MultiMelt)

tmp &lt;- mcaSmoother(MultiMelt[, 1], MultiMelt[, 14])
diffQ2(tmp, fct = min, verbose = FALSE, plot = TRUE, inder = FALSE)
diffQ2(tmp, fct = min, verbose = FALSE, plot = TRUE, inder = TRUE)

par(default.par)

</code></pre>


</div>