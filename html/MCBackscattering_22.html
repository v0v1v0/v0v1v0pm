<div class="container">

<table style="width: 100%;"><tr>
<td>Simulation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Runs the Monte Carlo Simulation</h2>

<h3>Description</h3>

<p>This function performs all actions to run the simulation. It calls other functions that prepare computation and calculate photon trajectory. Please keep in mind, that this technique can be slow depending on the number of photons and computational power of your hardware.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Simulation(myObject,iAngle=0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>myObject</code></td>
<td>
<p>The mandatory parameter of this function is the MCBS class created by <code>MCBS</code> constructor function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iAngle</code></td>
<td>
<p>The optional parameter <code>iAngle</code> defines the incident angle of light beam. It is measured from normal position, perpendicular to the surface. The default value is zero (iAngle=0). This parameter is passed to <code>Launch</code> function.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function <code>Simulation</code>, alias <code>Simulation.MCBS</code>, was designed to take every steps such as <code>Setup</code> initial conditions and compute each photon trajectory individually. It was written keeping clarity in mind. In case you want to make your own procedure, this function can be used as a template.
</p>
<p>The result of simulation is photon flux, which is expressed as relative fluence rate (F/P, 1/cm^2) where F is the fluence rate and P is the power of light source. The fluence rate (F) is computed in concentric rings around the incident point.
</p>


<h3>Value</h3>

<p>The <code>Simulation</code> function returns an MCBS object as <code>class</code>. Typically the same object is used in argument and result.
The main objective of the simulation is to calculate spatial photon flux. The flux is computed with radial averaging relative to the incident point. Each value represent the average flux of the ring with the width of resolution (1 pixel).
</p>
<table><tr style="vertical-align: top;">
<td><code>heat</code></td>
<td>
<p>calculated photon flux, 1/cm^2</p>
</td>
</tr></table>
<h3>Note</h3>

<p>Please note that quality of results depends on the number of photons. The more is used the better quality you get. The minimum suggested number is 100,000 photons. If you calculate the amount of photons with sensor or camera integration time, this number will increase above billion.
Validation of computations is difficult, because other Monte Carlo programs or the diffusion theory model can be used as reference. The diffusion theory model does not consider many parameters included in Monte Carlo simulation, such as beam radius, incident angle, anisotropy. Please note that models and reports usually use the reduced scattering coefficient <code>rms = (1-g)*ms</code> what means that different scattering and anisotropy parameters, like <code>list(ms=20,g=0)</code> and <code>list(ms=200,g=0.9)</code>, result the same reduced scattering coefficient.
Do not access and manipulate the result data vector <code>myObject$heat</code> directly. You can receive results by using the <code>Export</code> function.
</p>


<h3>References</h3>

<p>Farrell, T.J., Patterson, M.S., Wilson, B. (1992)
A diffusion theory model of spatially resolved, steady-state diffuse reflectance for the noninvasive determination of tissue optical properties in vivo.
<em>Medical Physics</em>, <b>19(4)</b>: 879–888.
doi: <a href="https://doi.org/10.1118/1.596777">10.1118/1.596777</a>.
</p>
<p>Jacques, S.L. (1998)
Light Distributions from Point, Line and Plane Sources for Photochemical Reactions and Fluorescence in Turbid Biological Tissues.
<em>Photochemistry and Photobiology</em>, <b>67(1)</b>: 23-–32.
doi: <a href="https://doi.org/10.1111/j.1751-1097.1998.tb05161.x">10.1111/j.1751-1097.1998.tb05161.x</a>.
</p>
<p>Wang, L., Jacques, S.L., Zheng, L. (1995)
MCML – Monte Carlo modeling of light transport in multi-layered tissues.
<em>Computer Methods and Programs in Biomedicine</em>, <b>47</b>: 131-–146.
doi: <a href="https://doi.org/10.1016/0169-2607(95)01640-F">10.1016/0169-2607(95)01640-F</a>.
</p>
<p>Wang, L., Jacques, S.L., Zheng, L. (1997)
CONV-convolution for responses to a finite diameter photon beam incident on multi-layered tissues.
<em>Computer Methods and Programs in Biomedicine</em>, <b>54</b>: 141–-150.
doi: <a href="https://doi.org/10.1016/S0169-2607(97)00021-7">10.1016/S0169-2607(97)00021-7</a>.
</p>
<p>Zołek, N.S., Liebert, A., Maniewski, R. (2006)
Optimization of the Monte Carlo code for modeling of photon migration in tissue.
<em>Computer Methods and Programs in Biomedicine</em>, <b>84</b>: 50–-57.
doi: <a href="https://doi.org/10.1016/j.cmpb.2006.07.007">10.1016/j.cmpb.2006.07.007</a>.
</p>
<p>Baranyai, L., Zude, M. (2009)
Analysis of laser light propagation in kiwifruit using backscattering imaging and Monte Carlo simulation.
<em>Computers and Electronics in Agriculture</em>, <b>69</b>: 33-–39.
doi: <a href="https://doi.org/10.1016/j.compag.2009.06.011">10.1016/j.compag.2009.06.011</a>.
</p>
<p>Baranyai, L. (2020)
Laser induced diffuse reflectance imaging – Monte Carlo simulation of backscattering measured on the surface.
<em>MethodsX</em>, <b>7</b>: 100958.
doi: <a href="https://doi.org/10.1016/j.mex.2020.100958">10.1016/j.mex.2020.100958</a>.
</p>


<h3>See Also</h3>

<p><code>MCBS</code> for construction of object with initial input parameters.
<code>Setup</code> for initial computation of specular reflection and transport albedo.
<code>Randomize</code> for adjustment of random trajectory vectors.
<code>print</code> show adjusted parameters and total backscattered reflection.
<code>Chart</code> for plot of calculated photon flux profile.
<code>Export</code> for export of photon flux with corresponding radii.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Apple simulation data according to Qin and Lu (2006).
## DOI: 10.13031/2013.20862

# create object
cfgMedia &lt;- c(0.63,30,0,1.4)
# the 100 low number of photons is only for demonstration
cfgSimulation &lt;- c(100,0.05,1e-9,3,0.1)
apple &lt;- MCBS(cfgMedia,cfgSimulation)

# run simulation with default incident angle
apple &lt;- Simulation(apple)
print(apple)

# run simulation with 10 deg incident angle
apple &lt;- Simulation(apple,10)
Chart(apple)
</code></pre>


</div>