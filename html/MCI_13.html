<div class="container">

<table style="width: 100%;"><tr>
<td>huff.fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Fitting the Huff model using local optimization of attractivity 
</h2>

<h3>Description</h3>

<p>This function fits the Huff model with a given interaction matrix by optimizing the attractivity values of suppliers/locations iteratively and calculates the market shares/market areas
</p>


<h3>Usage</h3>

<pre><code class="language-R">huff.fit(huffdataset, origins, locations, attrac, dist, lambda = -2, dtype = "pow", 
lambda2 = NULL, localmarket_dataset, origin_id, localmarket, location_dataset, 
location_id, location_total, tolerance = 5, iterations = 3, output = "total", 
show_proc = FALSE, check_df = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>huffdataset</code></td>
<td>

<p>an interaction matrix which is a <code>data.frame</code> containing the origins, locations and the explanatory variables (attraction, transport costs)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>origins</code></td>
<td>

<p>the column in the interaction matrix <code>huffdataset</code> containing the origins (e.g. ZIP codes)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>locations</code></td>
<td>

<p>the column in the interaction matrix <code>huffdataset</code> containing the locations (e.g. store codes)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>attrac</code></td>
<td>

<p>the column in the interaction matrix <code>huffdataset</code> containing the attraction variable (e.g. sales area)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>

<p>the column in the interaction matrix <code>huffdataset</code> containing the transport costs (e.g. travelling time or street distance)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>

<p>a single numeric value of <code class="reqn">\lambda</code> for the (exponential) weighting of distance (transport costs, default: -2)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dtype</code></td>
<td>

<p>Type of distance weighting function: <code>"pow"</code> (power function), <code>"exp"</code> (exponential function) or <code>"logistic"</code> (logistic function) (default: <code>dtype = "pow"</code>)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda2</code></td>
<td>

<p>if <code>dtype = "logistic"</code> a second <code class="reqn">\lambda</code> parameter is needed
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>localmarket_dataset</code></td>
<td>

<p>A <code>data.frame</code> containing the origins saved in a column which has the same name as in <code>huffdataset</code> and another column containing the local market potential 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>origin_id</code></td>
<td>

<p>the column in the dataset <code>localmarket_dataset</code> containing the origins (e.g. statistical districts, ZIP codes)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>localmarket</code></td>
<td>

<p>the column in the dataset <code>localmarket_dataset</code> containing the local market potential (e.g. purchasing power, number of customers)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>location_dataset</code></td>
<td>

<p>A <code>data.frame</code> containing the suppliers/locations and their observed total values 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>location_id</code></td>
<td>

<p>the column in the dataset <code>location_dataset</code> containing the locations (e.g. store codes), <code class="reqn">j</code>, according to the codes in <code>huffdataset</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>location_total</code></td>
<td>

<p>the column in the dataset <code>location_dataset</code> containing the observed total values of suppliers/locations, <code class="reqn">T_{j,obs}</code> (e.g. annual sales, total number of customers)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolerance</code></td>
<td>

<p>accepted value of absolute percentage error between observed (<code class="reqn">T_{j,obs}</code>) and modeled total values (<code class="reqn">T_{j,exp}</code>) to skip a local optimization of location/supplier <code class="reqn">j</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iterations</code></td>
<td>

<p>a single numeric value for the desired number of iterations
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output</code></td>
<td>

<p>Type of function output: <code>output = "matrix"</code> returns a Huff interaction matrix with the optimized attractivity values and the expected market shares/market areas. If <code>output = "total"</code>, the old (observed) and the new (expected) total values are returned. If <code>output = "diag"</code>, the function returns the diagnosis results (fitting measures) 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_proc</code></td>
<td>

<p>logical argument that indicates if the function prints messages about the state of process during the work (e.g. “Processing variable xyz ...” or “Variable xyz is regarded as dummy variable”). Default: <code>show_proc = FALSE</code> (messages off)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check_df</code></td>
<td>

<p>logical argument that indicates if the given dataset is checked for correct input, only for internal use, should not be deselected (default: <code>TRUE</code>)
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In many cases, only total empirical values of the suppliers/locations can be used for market area estimation. This function fits the <em>Huff model</em> not by estimating the parameters but by optimizing the attraction variable (transport cost weighting by <code class="reqn">\lambda</code> is given) using an optimization algorithm based on the idea of the <em>local optimization of attraction</em> algorithm developed by Guessefeldt (2002) and other model fit approaches. The fitting process in the <code>huff.fit</code> includes of given number of (<code class="reqn">m</code>) iterations, while the fit gets better with every iteration. The algorithm results can be evaluated by several diagnosis criteria which have been frequently used to evaluate <em>Huff model</em> results: Besides the sum of squared residuals, the function also calculates a <em>Pseudo-R-squared</em> measure and the <em>MAPE (mean average percentage error)</em>, both used by De Beule et al. (2014), and the <em>global error</em> used by Klein (1988).      
</p>


<h3>Value</h3>

<p>The function output can be controlled by the function argument <code>output</code>. If <code>output = "matrix"</code> the function returns a Huff interaction matrix with the optimized attractivity values and the expected market shares/market areas. If <code>output = "total"</code>, the old (observed) and the new (expected) total values are returned. If <code>output = "diag"</code>, the diagnosis results (fitting measures) are returned. All results are <code>data.frame</code>. 
</p>


<h3>Note</h3>

<p>Note that the iterations can be time-consuming and depend on the number of suppliers/locations. Use <code>show_proc = TRUE</code> for monitoring the iteration process.
</p>


<h3>Author(s)</h3>

<p>Thomas Wieland
</p>


<h3>References</h3>

<p>De Beule, M./Van den Poel, D./Van de Weghe, N. (2014): “An extended Huff-model for robustly benchmarking and predicting retail network performance”. In: <em>Applied Geography</em>, <b>46</b>, 1, p. 80-89.
</p>
<p>Guessefeldt, J. (2002): “Zur Modellierung von raeumlichen Kaufkraftstroemen in unvollkommenen Maerkten”. In: <em>Erdkunde</em>, <b>56</b>, 4, p. 351-370.
</p>
<p>Klein, R. (1988): “Der Lebensmittel-Einzelhandel im Raum Verden. Raeumliches Einkaufsverhalten unter sich wandelnden Bedingungen”. <em>Flensburger Arbeitspapiere zur Landeskunde und Raumordnung</em>, <b>6</b>. Flensburg.
</p>
<p>Wieland, T. (2015): “Nahversorgung im Kontext raumoekonomischer Entwicklungen im Lebensmitteleinzelhandel - Konzeption und Durchfuehrung einer GIS-gestuetzten Analyse der Strukturen des Lebensmitteleinzelhandels und der Nahversorgung in Freiburg im Breisgau”. Projektbericht. Goettingen : GOEDOC, Dokumenten- und Publikationsserver der Georg-August-Universitaet Goettingen. <a href="http://webdoc.sub.gwdg.de/pub/mon/2015/5-wieland.pdf">http://webdoc.sub.gwdg.de/pub/mon/2015/5-wieland.pdf</a>
</p>


<h3>See Also</h3>

<p><code>huff.attrac</code>, <code>huff.shares</code>, <code>huff.decay</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(Freiburg1)
data(Freiburg2)
data(Freiburg3)
# Loading the three Freiburg datasets

# NOTE: This may take a while!
# huff_total_opt2 &lt;- huff.fit(Freiburg1, "district", "store", "salesarea", "distance", 
# lambda = -2, dtype= "pow", lambda2 = NULL, Freiburg2, "district", "ppower", 
# Freiburg3, "store", "annualsales", tolerance = 1, iterations = 2, output = "total", 
# show_proc = TRUE)
# 2 iterations of the optimization algorithm with an accepted difference of +/- 1 %
# Output of total sales/shares, stored in dataset huff_total_opt10

# model.fit(huff_total_opt2$total_obs, huff_total_opt2$sum_E_j, plotVal = TRUE)
# total_obs = observed total values, originally from dataset Freiburg3
# sum_E_j = expected total values
</code></pre>


</div>