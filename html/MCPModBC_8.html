<div class="container">

<table style="width: 100%;"><tr>
<td>weibfit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Computes different estimators for the censored Weibull regression model</h2>

<h3>Description</h3>

<p>Computes the maximum likelihood estimators (MLE) for the censored Weibull
regression model. The bias-corrected estimators based on the Cox and Snell's
and Firth's methods also are available. In addition, for the covariance
matrix the corrected estimators discussed in Magalhaes et al. 2021 also are
available.
</p>


<h3>Usage</h3>

<pre><code class="language-R">weibfit(formula, data, L = Inf, estimator = "MLE", 
	corrected.var = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A formula that contains on the left hand side an object of
the type Surv and on the right hand side the covariates definition</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data.frame in which the formula argument can be evaluated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>L</code></td>
<td>
<p>the prefixed censoring times. <code class="reqn">L=\infty</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimator</code></td>
<td>
<p>the class of estimator used: MLE (maximum likelihood
estimator, by default), BCE (bias-corrected estimator based on the Cox and
Snell's method) and Firth (bias-corrected estimator based on the Firth's
method).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corrected.var</code></td>
<td>
<p>should the covariance-corrected estimator be used?
(FALSE by default). See details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The Weibull distribution considered here has probability density function
</p>
<p style="text-align: center;"><code class="reqn"> f(t;\lambda, \sigma)=\frac{1}{\sigma
\lambda^{1/\sigma}}t^{1/\sigma-1}\exp\left\{-\left(\frac{t}{\lambda}\right)^{1/\sigma}\right\},
\quad t, \sigma, \lambda&gt;0. </code>
</p>
<p> The regression structure is incorporated as
</p>
<p style="text-align: center;"><code class="reqn"> \log(\lambda_i)={\bm x}_i^\top {\bm \beta}, \quad i=1,\ldots,n. </code>
</p>
<p> For
the computation of the bias-corrected estimators, <code class="reqn">\sigma</code> is assumed as
fixed in the jackknife estimator based on the traditional MLE.
</p>
<p>The Fisher information matrix for <code class="reqn">\bm \beta</code> is given by <code class="reqn">{\bm
K}=\sigma^{-2} {\bm X}^\top {\bm W} {\bm X}</code>, where <code class="reqn">{\bm X}=({\bm
x}_1,\ldots,{\bm x}_n)^\top</code>, <code class="reqn">{\bm W}=\mbox{diag}(w_1,\ldots,w_n)</code>, and
</p>
<p style="text-align: center;"><code class="reqn"> w_i=E\left[\exp\left(\frac{y_i-\log
\lambda_i}{\sigma}\right)\right]=q \times \left\{ 1 - \exp\left[
-L_i^{1/\sigma} \exp(-\mu_i/\sigma) \right] \right\} + (1-q)\times
\left(r/n\right), </code>
</p>
<p> with <code class="reqn">q = P\left(W_{(r)}\leq \log L_i\right)</code> and
<code class="reqn">W_{(r)}</code> denoting the <code class="reqn">r</code>th order statistic from <code class="reqn">W_1, \ldots,
W_n</code>, with <code class="reqn">q=1</code> and <code class="reqn">q=0</code> for types I and II censoring,
respectively. (See Magalhaes et al. 2019 for details).
</p>
<p>The bias-corrected maximum likelihood estimator based on the Cox and Snell's
method (say <code class="reqn">\widetilde{\bm \beta}</code>) is based on a corrective approach
given by <code class="reqn">\widetilde{\beta}=\widehat{\beta}-B(\widehat{\beta})</code>, where
</p>
<p style="text-align: center;"><code class="reqn"> B({\bm \beta})= - \frac{1}{2 \sigma^3} {\bm P} {\bm Z}_d \left({\bm
W} + 2 \sigma {\bm W}^{\prime}\right) {\bm 1}, </code>
</p>
<p> with <code class="reqn">{\bm P} = {\bm
K}^{-1} {\bm X}^{\top}</code>, <code class="reqn">{\bm Z} = {\bm X} {\bm K}^{-1} {\bm
X}^{\top}</code>, <code class="reqn">{\bm Z}_d</code> is a diagonal matrix with diagonal given by the
diagonal of <code class="reqn">{\bm Z}</code>, <code class="reqn">{\bm W}^{\prime} =</code> diag<code class="reqn">(w_1^{\prime},
\ldots, w_n^{\prime})</code>, <code class="reqn">w_i^{\prime} = - \sigma^{-1} L_i^{1/\sigma}
\exp\{ -L_i^{1/\sigma} \exp(-\mu_i/\sigma) - \mu_i/\sigma \}</code> and <code class="reqn">{\bm
1}</code> is a <code class="reqn">n</code>-dimensional vector of ones.
</p>
<p>The bias-corrected maximum likelihood estimator based on the Firth's method
(say <code class="reqn">\check{\bm \beta}</code>) is based on a preventive approach, which is
the solution for the equation <code class="reqn">{\bm U}_{{\bm \beta}}^{\star} = {\bm 0}</code>,
where </p>
<p style="text-align: center;"><code class="reqn"> {\bm U}_{{\bm \beta}}^{\star} = {\bm U}_{{\bm \beta}} - {\bm
K}_{{\bm \beta} {\bm \beta}} B({\bm \beta}). </code>
</p>

<p>The covariance correction is based on the general result of Magalhaes et al.
2021 given by </p>
<p style="text-align: center;"><code class="reqn"> \mbox{{\bf Cov}}_{\bm 2}^{\bm \tau}({\bm
\beta}^{\star}) = {\bm K}^{-1} + {\bm K}^{-1} \left\{ {\bm \Delta} + {\bm
\Delta}^{\top} \right\} {\bm K}^{-1} + \mathcal{O}(n^{-3}) </code>
</p>
<p> where
<code class="reqn">{\Delta} = -0.5 {\Delta}^{(1)} + 0.25 {\Delta}^{(2)} + 0.5 \tau_2
{\Delta}^{(3)}</code>, with </p>
<p style="text-align: center;"><code class="reqn"> \Delta^{(1)} = \frac{1}{\sigma^4} {\bm
X}^{\top} {\bm W}^{\star} {\bm Z}_{d} {\bm X}, </code>
</p>
 <p style="text-align: center;"><code class="reqn"> \Delta^{(2)} = -
\frac{1}{\sigma^6} {\bm X}^{\top} \left[ {\bm W} {\bm Z}^{(2)} {\bm W} - 2
\sigma {\bm W} {\bm Z}^{(2)} {\bm W}^{\prime} - 6 \sigma^2 {\bm W}^{\prime}
{\bm Z}^{(2)} {\bm W}^{\prime} \right] {\bm X}, </code>
</p>
<p> and </p>
<p style="text-align: center;"><code class="reqn"> \Delta^{(3)} =
\frac{1}{\sigma^5} {\bm X}^{\top} {\bm W}^{\prime} {\bm W}^{\star\star} {\bm
X}, </code>
</p>
<p> where <code class="reqn">{\bm W}^{\star} =</code> diag<code class="reqn">(w_1^{\star}, \ldots,
w_n^{\star})</code>, <code class="reqn">w_i^{\star} = w_i (w_i -2) - 2 \sigma w_i^{\prime} +
\sigma \tau_1 (w_i^{\prime} + 2 \sigma w_i^{\prime\prime})</code>, <code class="reqn">{\bm
Z}^{(2)} = {\bm Z} \odot {\bm Z}</code>, with <code class="reqn">\odot</code> representing a direct
product of matrices (Hadamard product), <code class="reqn">{\bm W}^{\star\star}</code> is a
diagonal matrix, with <code class="reqn">{\bm Z} ( {\bm W} + 2 \sigma {\bm W}^{\prime})
{\bm Z}_{d} {\bm 1}</code> as its diagonal, <code class="reqn">{\bm W}^{\prime\prime} =</code>
diag<code class="reqn">(w_1^{\prime\prime}, \ldots, w_n^{\prime\prime})</code>,
<code class="reqn">w_i^{\prime\prime} = - \sigma^{-1} w_i^{\prime} \left[ L_i^{1/\sigma}
\exp(-\mu_i/\sigma) - 1 \right]</code>, <code class="reqn">{\bm \tau} = (\tau_1, \tau_2) = (1,
1)</code> indicating the second-order covariance matrix of the MLE <code class="reqn">{\bm
\beta}^{\star} = \widehat{{\bm \beta}}</code> denoted by <code class="reqn">\mbox{{\bf
Cov}}_{\bm 2}(\widehat{{\bm \beta}})</code> and <code class="reqn">{\bm \tau} = (0, -1)</code>
indicating the second-order covariance matrix of the BCE <code class="reqn">{\bm
\beta}^{\star} = \widetilde{{\bm \beta}}</code> denoted by <code class="reqn">\mbox{{\bf
Cov}}_{\bm 2}(\widetilde{{\bm \beta}})</code>.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>a vector with the estimated coefficients for
<code class="reqn">\bm \beta</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var</code></td>
<td>
<p>a matrix with the estimated covariance matrix
for the estimates of the regression coefficients <code class="reqn">\bm \beta</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>the estimated scale parameter <code class="reqn">\sigma</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loglik</code></td>
<td>
<p>the
value for the logarithm of the likelihood function evaluated in the
estimates of <code class="reqn">\bm \beta</code> and <code class="reqn">\sigma</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linear.predictors</code></td>
<td>
<p>a
vector with the estimated linear predictor <code class="reqn">{\bm x}_i^\top {\bm \beta}</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a vector with the observed times (possibly censored)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimator</code></td>
<td>
<p>the estimator used for <code class="reqn">\bm \beta</code>: MLE, BCE or Firth.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corrected.var</code></td>
<td>
<p>logical. TRUE if a correction for the covariance was
used, FALSE otherwise.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Gallardo D.I., Diniz, M.A., Magalhaes, T.M.
</p>


<h3>References</h3>

<p>Cox, D.R., Snell E.J. A general definition of residuals Journal
of the Royal Statistical Society. Series B (Methodological).
1968;30:248-275.
</p>
<p>Diniz, Márcio A. and Gallardo, Diego I. and Magalhães, Tiago M. (2023). Improved inference  
for MCP-Mod approach for time-to-event endpoints with small sample sizes. arXiv 
&lt;doi.org/10.48550/arXiv.2301.00325&gt;
</p>
<p>Firth, D. Bias reduction of maximum likelihood estimates Biometrika.
1993;80:27-38.
</p>
<p>Magalhaes Tiago M., Botter Denise A., Sandoval Monica C. A general
expression for second- order covariance matrices - an application to
dispersion models Brazilian Journal of Probability and Statistics.
2021;35:37-49.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
require(survival)
set.seed(2100)

##Generating covariates
n=20; 
x&lt;-runif(n, max=10)
lambda&lt;-exp(1.2-0.5*x); sigma&lt;-1.5

##Drawing T from Weibull model and fixing censoring at 1.5
T&lt;-rweibull(n, shape=1/sigma, scale=lambda); L&lt;-rep(1.5, n)

##Defining the observed times and indicators of failure
y&lt;-pmin(T,L); 
delta&lt;-ifelse(T&lt;=L, 1, 0)
data=data.frame(y=y, delta=delta, x=x)

##Fitting for Weibull regression model

##Traditional MLE with corrected variance
ex1=weibfit(Surv(y,delta)~x, data=data, L=L, estimator="MLE", 
	corrected.var=TRUE)
summary(ex1)

##BCE without corrected variance
ex2=weibfit(Surv(y,delta)~x, data=data, L=L, estimator="BCE", 
	corrected.var=FALSE)
summary(ex2)

##BCE with corrected variance
ex3=weibfit(Surv(y,delta)~x, data=data, L=L, estimator="BCE", 
	corrected.var=TRUE)
summary(ex3)

##Firth's correction without corrected variance
ex4=weibfit(Surv(y,delta)~x, data=data, L=L, estimator="BCE", 
	corrected.var=FALSE)
summary(ex4)

</code></pre>


</div>