<div class="container">

<table style="width: 100%;"><tr>
<td>EMS</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> Expected values of M and S </h2>

<h3>Description</h3>

<p>Compute expected values of <code class="reqn">M</code> and <code class="reqn">S</code> given <code class="reqn">q_\mathrm{min}</code> and define the quantity
</p>
<p style="text-align: center;"><code class="reqn">z_r = \Phi^{(1)}(q_\mathrm{min})\mbox{,}</code>
</p>

<p>where <code class="reqn">\Phi^{(1)}(\cdot)</code> is the inverse of the standard normal distribution. As result, <code class="reqn">q_\mathrm{min}</code> is itself a probability because it is an argument to the <code>qnorm()</code> function. The expected value <code class="reqn">M</code> is defined as
</p>
<p style="text-align: center;"><code class="reqn">M = \Psi(z_r, 1)\mbox{,}</code>
</p>

<p>where <code class="reqn">\Psi(a,b)</code> is the <code>gtmoms</code> function. The <code class="reqn">S</code> requires the conditional moments of the Chi-square (<code>CondMomsChi2</code>) defined as the two value vector <code class="reqn">\mbox{}_2S</code> that provides the values <code class="reqn">\alpha = \mbox{}_2S_1^2 / \mbox{}_2S_2</code> and <code class="reqn">\beta = \mbox{}_2S_2 / \mbox{}_2S_1</code>. The <code class="reqn">S</code> is then defined by
</p>
<p style="text-align: center;"><code class="reqn">S = \sqrt{\beta}\biggl(\frac{\Gamma(\alpha+0.5)}{\Gamma(\alpha)}\biggr)\mbox{.}</code>
</p>



<h3>Usage</h3>

<pre><code class="language-R">EMS(n, r, qmin)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>The number of observations;</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>The number of truncated observations? (confirm); and</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qmin</code></td>
<td>
<p>A nonexceedance probability threshold for <code class="reqn">X &gt; q_\mathrm{min}</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The expected values of <code class="reqn">M</code> and <code class="reqn">S</code> in the form of an <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> <code>vector</code>.
</p>


<h3>Note</h3>

<p>TAC sources call on the explicit first index of <code class="reqn">M</code> as literally “<code>Em[1]</code>” for the returned vector, which seems unnecessary. This is a potential weak point in design because the <code>gtmoms</code> function is naturally vectorized and could potentially produce a vector of <code class="reqn">M</code> values. For the implementation here, only the first value in <code>qmin</code> is used and a warning otherwise issued. Such coding prevents the return value from <code>EMS</code> accidentally acquiring a length greater than two. For at least samples of size <code class="reqn">n=2</code>, overranging in a call to <code>lgamma(alpha)</code> happens for <code>alpha=0</code>. A <code>suppressWarnings()</code> is wrapped around the applicable line. The resulting <code>NaN</code> cascades up the chain, which will end up inside <code>peta</code>, but therein <code>SigmaMp</code> is not finite and a p-value of unity is returned.
</p>


<h3>Author(s)</h3>

<p> W.H. Asquith consulting T.A. Cohn sources </p>


<h3>Source</h3>

<p><code>LowOutliers_jfe(R).txt</code>, <code>LowOutliers_wha(R).txt</code>, <code>P3_089(R).txt</code>—Named <code>EMS</code>
</p>


<h3>References</h3>

<p>Cohn, T.A., 2013–2016, Personal communication of original R source code: U.S. Geological Survey, Reston, Va.
</p>


<h3>See Also</h3>

<p><code>CondMomsChi2</code>, <code>EMS</code>, <code>VMS</code>, <code>V</code>, <code>gtmoms</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">EMS(58,2,.5)
#[1] 0.7978846 0.5989138

#  Monte Carlo experiment to test EMS and VMS functions
"test_EMS" &lt;- function(nrep=1000, n=100, r=0, qr=0.2, ss=1) { # TAC named function
   set.seed(ss)
   Moms &lt;- replicate(n=nrep, {
          x &lt;- qnorm(runif(n-r,min=qr,max=1));
          c(mean(x),var(x))}); xsi &lt;- qnorm(qr);
          list(
    MeanMS_obs = c(mean(Moms[1,]), mean(sqrt(Moms[2,])), mean(Moms[2,])),
    EMS        = c(EMS(n,r,qr), gtmoms(xsi,2) - gtmoms(xsi,1)^2),
    CovMS2_obs = cov(t(Moms)),
    VMS2       = V(n,r,qr),
    VMS_obs    = array(c(var(     Moms[1,]),
                         rep(cov( Moms[1,], sqrt(Moms[2,])),2),
                         var(sqrt(Moms[2,]))),    dim=c(2,2)),
    VMS        = VMS(n,r,qr)  )
}
test_EMS()
</code></pre>


</div>