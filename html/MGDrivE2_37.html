<div class="container">

<table style="width: 100%;"><tr>
<td>sim_trajectory_CSV_decoupled</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate Trajectory From a SPN Model</h2>

<h3>Description</h3>

<p>This function provides a unified interface to the various simulation algorithms
for SPN, returning output sampled at a lattice of time points to the user, and
handling various exogenous events that may occur during the simulation
(such as release of adult mosquitoes). This function is used in decoupled sampling, where
the mosquito and human states are separated. This is used primarily when using the
Imperial model of malaria transmission.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sim_trajectory_CSV_decoupled(
  x0,
  h0,
  inf_labels,
  tmax,
  dt = 1,
  dt_stoch = 0.1,
  folders = "./",
  S,
  hazards,
  SPN_P,
  theta,
  Sout = NULL,
  sampler = "tau",
  method = "lsoda",
  events = NULL,
  batch = NULL,
  verbose = TRUE,
  human_ode = "Imperial",
  cube = cube,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x0</code></td>
<td>
<p>the initial marking of the SPN (initial state, M0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h0</code></td>
<td>
<p>the initial human state distribution</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inf_labels</code></td>
<td>
<p>labels corresponding to female mosquito infection hazard</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tmax</code></td>
<td>
<p>the final time to end simulation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dt</code></td>
<td>
<p>the time-step at which to return output (<strong>not</strong> the time-step of the sampling algorithm)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dt_stoch</code></td>
<td>
<p>time-step used for approximation of hazards</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>folders</code></td>
<td>
<p>vector of folders to write output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S</code></td>
<td>
<p>a stoichiometry <code>Matrix-class</code> object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hazards</code></td>
<td>
<p>list of hazard functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SPN_P</code></td>
<td>
<p>stochastic petri net places</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sout</code></td>
<td>
<p>an optional matrix to track event firings</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sampler</code></td>
<td>
<p>determines sampling algorithm, one of; "ode", "tau", "cle", or "dm"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>if <code>sampler</code> is "ode", the solver to use, from <code>deSolve</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>events</code></td>
<td>
<p>a <code>data.frame</code> of events</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>batch</code></td>
<td>
<p>a <code>list</code> of batch migration events, created from <code>batch_migration</code>, may be set to <code>NULL</code> if not used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>print a progress bar?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>human_ode</code></td>
<td>
<p>human ode function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cube</code></td>
<td>
<p>inheritance cube</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further named arguments passed to the step function</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>dt_stoch</code> is used by the Poisson Time-Step (<code>step_PTS</code>) and
Chemical Langevin (<code>step_CLE</code>) methods to approximate the hazards.
A smaller <code>dt_stoch</code> provides a better approximation, but will take longer
to run.
</p>
<p>The stoichiometry matrix (<code>S</code>) is generated in <code>spn_S</code>.
</p>
<p>The list of hazards (<code>hazards</code>) come from <code>spn_hazards</code>.
</p>
<p>Several samplers are provided. The default is a Poisson Time-Step
(<code>step_PTS</code>) method. Other options are Gillespie's Direct Method
(<code>step_DM</code>) and a Chemical Langevin sampler (<code>step_CLE</code>).
Additionally, for convenience, an ODE "sampler" (<code>step_ODE</code>) is
provided for compatibility with other samplers. This function uses methods from
<code>deSolve</code>.
</p>
<p>If using the <code>ode</code> sampler, several <code>methods</code> are provided in the <code>deSolve</code>
package, see <code>ode</code>. For inhomogeneous systems, consider
using the "rk4" method to avoid excessive integration times.
</p>
<p>Additionally, <code>events</code> objects must follow the format required by
<code>deSolve</code>. This was done for consistency, see <code>events</code>
for more information.
</p>
<p>This function writes all output to .csv files. Each simulation is written to
a <code>folder</code> element - the number of repetitions is the number of folders
provided. For now, only adult mosquito states, human states, clinical incidence, and pathogen prevalence are
written to CSVs.
</p>
<p>This function tracks state variables specified by argument <code>stage</code> by default; an optional argument <code>Sout</code>
can be provided to track number of event firings each time step (for discrete stochastic simulations),
or cumulative intensity (for continuous stochastic simulations), or the rate function of
particular events for ODE simulation. The matrix must have number of columns equal to
number of events in the system (the number of hazard functions), and a row for each tracking
variable. If <code>Sout</code> is provided, it outputs an additional csv, "Tracking.csv".
The function <code>track_hinf</code> is provided, which builds a matrix to track
human infection events.
</p>
<p>To return simulations to R for further processing, see <code>sim_trajectory_R</code>.
</p>


<h3>Value</h3>

<p>NULL - prints output to .csv files
</p>


</div>