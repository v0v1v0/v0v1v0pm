<div class="container">

<table style="width: 100%;"><tr>
<td>preproc_MFPCA</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Preprocessing step to create MFPCA object</h2>

<h3>Description</h3>

<p>This function takes the data und uses the residuals of marker-specific
additive models to estimate the covariance structure for a MFPCA
</p>


<h3>Usage</h3>

<pre><code class="language-R">preproc_MFPCA(
  data,
  uni_mean = "y ~ s(obstime) + s(x2)",
  time = "obstime",
  id = "id",
  marker = "marker",
  M = NULL,
  weights = FALSE,
  remove_obs = NULL,
  method = c("fpca", "fpca.sc", "FPCA", "PACE"),
  nbasis = 10,
  nbasis_cov = nbasis,
  bs_cov = "symm",
  npc = NULL,
  fve_uni = 0.99,
  pve_uni = 0.99,
  fit = FALSE,
  max_time = NULL,
  save_uniFPCA = FALSE,
  save_uniGAM = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data.frame such as returned by function simMultiJM.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uni_mean</code></td>
<td>
<p>String to crate a formula for the univariate addtive models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>String giving the name of the longitudinal time variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>String giving the name of the identifier.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>marker</code></td>
<td>
<p>String giving the name of the longitudinal marker variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M</code></td>
<td>
<p>Number of mFPCs to compute in the MFPCA. If not supplied, it
defaults to the maximum number of computable mFPCs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>TRUE if inverse sum of univariate eigenvals should be used as
weights in the scalar product of the MFPCA. Defaults to FALSE (weights 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>remove_obs</code></td>
<td>
<p>Minimal number of observations per individual and marker to
be included in the FPC estimation. Defaults to NULL (all observations). Not
removing observations can lead to problems if the univariate variance
estimate is negative and has to be truncated, then the scores for IDs with
few observations cannot be estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Which package to use for the univariate FPCA. Either function
adapted function 'fpca', 'FPCA' from package <code>fdapace</code>, 'fpca.sc' from
package <code>refund</code>, or function 'PACE' from package <code>MFPCA</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbasis</code></td>
<td>
<p>Number of B-spline basis functions for mean estimate for
methods fpca, fpca.sc, PACE. For fpca.sc, PACE also bivariate smoothing of
covariance estimate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbasis_cov</code></td>
<td>
<p>Number of basis functions used for the bivariate
smoothing of the covariance surface for method fpca.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bs_cov</code></td>
<td>
<p>Type of spline for the bivariate smoothing of the covariance
surface for method fpca. Default is symmetric fast covariance smoothing
proposed by Cederbaum.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>npc</code></td>
<td>
<p>Number of univariate principal components to use in fpca.sc, PACE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fve_uni</code></td>
<td>
<p>Fraction of univariate variance explained for method FPCA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pve_uni</code></td>
<td>
<p>Proportion of univariate variance explained for methods
fpca, fpca.sc, PACE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>MFPCA argument to return a truncated KL fit to the data. Defaults
to FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_time</code></td>
<td>
<p>If supplied, forces the evaluation of the MFPCs up to maxtime.
Only implemented for method = 'fpca'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save_uniFPCA</code></td>
<td>
<p>TRUE to attach list of univariate FPCAs as attribute to
output. Defaults to FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save_uniGAM</code></td>
<td>
<p>TRUE to attach list of univariate additive models used to
calculate the residuals. Defaults to FALSE.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>MFPCAfit</code> with additional attributes
depending on the arguments <code>save_uniFPCA</code>, <code>save_uniGAM</code>,
<code>fit</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(pbc_subset)
mfpca &lt;- preproc_MFPCA(pbc_subset, uni_mean = paste0(
    "logy ~ 1 + sex + drug + s(obstime, k = 10, bs = 'ps') + ",
    "s(age, k = 10, bs = 'ps')"),
    pve_uni = 0.99, nbasis = 5, weights = TRUE, save_uniFPCA = TRUE)
</code></pre>


</div>