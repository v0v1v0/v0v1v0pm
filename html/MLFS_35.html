<div class="container">

<table style="width: 100%;"><tr>
<td>predict_mortality</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>predict_mortality</h2>

<h3>Description</h3>

<p>This sub model first fits a binary model to derive the effects of individual
tree, site and climate variables on mortality; and afterwards predict the
probability of dying for each tree from df_predict
</p>


<h3>Usage</h3>

<pre><code class="language-R">predict_mortality(
  df_fit,
  df_predict,
  df_climate,
  mortality_share = NA,
  mortality_share_type = "volume",
  include_climate,
  site_vars,
  select_months_climate = c(6, 8),
  mortality_model = "rf",
  nb_laplace = 0,
  sim_crownHeight = FALSE,
  k = 10,
  eval_model_mortality = TRUE,
  blocked_cv = TRUE,
  sim_mortality = TRUE,
  sim_step_years = 5,
  rf_mtry = NULL,
  df_max_size = NULL,
  ingrowth_codes = 3,
  include_mortality_BAI = TRUE,
  intermediate_print = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df_fit</code></td>
<td>
<p>a data frame with individual tree data and site descriptors
where code is used to specify a status of each tree</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df_predict</code></td>
<td>
<p>data frame which will be used for mortality predictions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df_climate</code></td>
<td>
<p>data frame with monthly climate data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mortality_share</code></td>
<td>
<p>a value defining the proportion of the volume which is
to be the subject of mortality</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mortality_share_type</code></td>
<td>
<p>character, it can be 'volume' or 'n_trees'. If
'volume' then the mortality share relates to total standing volume, if
'n_trees' then mortality share relates to the total number of standing trees</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include_climate</code></td>
<td>
<p>logical, should climate variables be included as
predictors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>site_vars</code></td>
<td>
<p>a character vector of variable names which are used as site
descriptors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>select_months_climate</code></td>
<td>
<p>vector of subset months to be considered.
Default is c(1,12), which uses all months.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mortality_model</code></td>
<td>
<p>logical, should the mortality model be evaluated
and returned as the output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nb_laplace</code></td>
<td>
<p>value used for Laplace smoothing (additive smoothing) in
naive Bayes algorithm. Defaults to 0 (no Laplace smoothing).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sim_crownHeight</code></td>
<td>
<p>logical, should crown heights be considered as a
predictor variable? If TRUE, a crownHeight column is expected in data_NFI</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>the number of folds to be used in the k fold cross-validation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eval_model_mortality</code></td>
<td>
<p>logical, should the mortality model be evaluated
and returned as the output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocked_cv</code></td>
<td>
<p>logical, should the blocked cross-validation be used in the
evaluation phase?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sim_mortality</code></td>
<td>
<p>logical, should mortality be simulated?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sim_step_years</code></td>
<td>
<p>the simulation step in years</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rf_mtry</code></td>
<td>
<p>number of variables randomly sampled as candidates at each
split of a random forest model. If NULL, default settings are applied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df_max_size</code></td>
<td>
<p>a data frame with the maximum BA values for each species.
If a tree exceeds this value, it dies.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ingrowth_codes</code></td>
<td>
<p>numeric value or a vector of codes which refer to
ingrowth trees</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include_mortality_BAI</code></td>
<td>
<p>logical, should basal area increments (BAI) be
used as independent variable for predicting individual tree morality?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intermediate_print</code></td>
<td>
<p>logical, if TRUE intermediate steps will be printed
while the mortality sub model is running</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a list with three elements:
</p>

<ol>
<li>
<p> $predicted_mortality - a data frame with updated tree status (code) based on the predicted mortality
</p>
</li>
<li>
<p> $eval_mortality - a data frame with predicted and observed probabilities of dying for all individual trees, or character string indicating that mortality sub-model was not evaluated
</p>
</li>
<li>
<p> $model_output - the output model for mortality
</p>
</li>
</ol>
<h3>Examples</h3>

<pre><code class="language-R">data("data_v4")
data("data_mortality")
data("max_size_data")

mortality_outputs &lt;- predict_mortality(
 df_fit = data_mortality,
 df_predict = data_v4,
 mortality_share_type = 'volume',
 df_climate = data_climate,
 site_vars = c("slope", "elevation", "northness", "siteIndex"),
 sim_mortality = TRUE,
 mortality_model = 'naiveBayes',
 nb_laplace = 0,
 sim_crownHeight = TRUE,
 mortality_share = 0.02,
 include_climate = TRUE,
 select_months_climate = c(6,7,8),
 eval_model_mortality = TRUE,
 k = 10, blocked_cv = TRUE,
 sim_step_years = 6,
 df_max_size = max_size_data,
 ingrowth_codes = c(3,15),
 include_mortality_BAI = TRUE)

 df_predicted &lt;- mortality_outputs$predicted_mortality
 df_evaluation &lt;- mortality_outputs$eval_mortality

 # confusion matrix
 table(df_evaluation$mortality, round(df_evaluation$mortality_pred, 0))

</code></pre>


</div>