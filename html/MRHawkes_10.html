<div class="container">

<table style="width: 100%;"><tr>
<td>TmllMRH</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Minus loglikelihood of an (bivariate) MRHawkes model with truncated most 
recent immigrant probabilities
</h2>

<h3>Description</h3>

<p>Calculates the minus loglikelihood of an (bivariate) MRHawkes model with 
given immigration hazard functions <code class="reqn">\mu</code>, offspring density functions 
<code class="reqn">h</code> and bracnhing ratios <code class="reqn">\eta</code> for event times and event types 
<code>data</code> on interval <code class="reqn">[0,cens]</code> with truncated most recent immigrant 
probabilities looking back at only the previous <code>B</code> event times.
</p>


<h3>Usage</h3>

<pre><code class="language-R">TmllMRH(data, cens, par, B = 25,
        h1.fn = function(x, p) 1 / p * exp( - x / p),
        h2.fn = function(x, p) 1 / p * exp( - x / p),
        mu1.fn = function(x, p){ 
               exp(dweibull(x, shape = p[1], scale = p[2], log = TRUE) -
                   pweibull(x, shape = p[1], scale = p[2], lower.tail = FALSE, 
                   log.p = TRUE))
        },
        mu2.fn = function(x, p){
              exp(dweibull(x, shape = p[1], scale = p[2], log = TRUE) -
                  pweibull(x, shape = p[1], scale = p[2], lower.tail = FALSE, 
                  log.p = TRUE))
        },
        H1.fn = function(x, p) pexp(x, rate = 1 / p),
        H2.fn = function(x, p) pexp(x, rate = 1 / p),
        Mu1.fn = function(x, p){
          - pweibull(x, shape = p[1], scale = p[2], lower.tail = FALSE, 
                    log.p = TRUE)
        },
        Mu2.fn = function(x, p){
          - pweibull(x, shape = p[1], scale = p[2], lower.tail = FALSE, 
                     log.p = TRUE)
        })
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>A two column matrix. The first column contains the event times sorted in 
ascending order. The second column contains the corresponding event type
with the label one or two.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cens</code></td>
<td>

<p>A scalar. The censoring time.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par</code></td>
<td>

<p>A numeric vector. Contains the ten parameters of the model, in order of 
the immigration parameters <code class="reqn">\mu(.)</code> for the two renewal distributions, 
the two offspring parameters <code class="reqn">h(.)</code> and lastly the four branching 
ratios <code class="reqn">\eta</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>

<p>A scalar. The number of previous events that are considered to be possible
last immigrant arrivals.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h1.fn</code></td>
<td>

<p>A (vectorized) function. The offspring density function for type one 
events. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h2.fn</code></td>
<td>

<p>A (vectorized) function. The offspring density function for type two 
events. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu1.fn</code></td>
<td>

<p>A (vectorized) function. The immigration hazard function for events of type
one. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu2.fn</code></td>
<td>

<p>A (vectorized) function. The immigration hazard function for events of type 
two. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>H1.fn</code></td>
<td>

<p>A (vectorized) function. Its value at <code>t</code> gives the integral of
the offspring density function from 0 to <code>t</code> for type one events. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>H2.fn</code></td>
<td>

<p>A (vectorized) function. Its value at <code>t</code> gives the integral of
the offspring density function from 0 to <code>t</code> for type two events. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Mu1.fn</code></td>
<td>

<p>A (vectorized) function. Its value at <code>t</code> gives the integral of
the immigrant hazard function from 0 to <code>t</code> for type one events. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Mu2.fn</code></td>
<td>

<p>A (vectorized) function. Its value at <code>t</code> gives the integral of
the immigrant hazard function from 0 to <code>t</code> for type two events. 
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Value of the negative log-liklihood. 
</p>


<h3>Author(s)</h3>

<p>Tom Stindl &lt;t.stindl@unsw.edu.au&gt;
Feng Chen &lt;feng.chen@unsw.edu.au&gt;
</p>


<h3>Examples</h3>

<pre><code class="language-R">  ## Magnitude 5.5 or greater earthquakes over the 25 year period from 
  ## 01/01/1991 to 31/12/2015.
  data(fivaqks); 
  near.fiji &lt;- grep("Fiji", fivaqks$place)
  near.vanuatu &lt;- grep("Vanuatu", fivaqks$place)
  t.beg &lt;- strptime("1991-01-01 00:00:00", "%Y-%m-%d %H:%M:%S", tz = "UTC")
  t.end &lt;- strptime("2015-12-31 23:59:59", "%Y-%m-%d %H:%M:%S", tz = "UTC")
  t0 &lt;- 0
  t1 &lt;- as.numeric(t.end - t.beg)
  tms &lt;- strptime(fivaqks$time, "%Y-%m-%dT%H:%M:%OSZ", tz = "UTC")
  ts &lt;- as.numeric(tms[-1] - t.beg)
  ts &lt;- c(as.numeric(tms[1] - t.beg)/24, ts)
  ts.fi &lt;- ts[near.fiji]; ts.fi &lt;- ts.fi[ts.fi &gt;= 0 &amp; ts.fi &lt;= t1]
  ts.va &lt;- ts[near.vanuatu]; ts.va &lt;- ts.va[ts.va &gt;=0 &amp; ts.va &lt;= t1]
  ts.c &lt;- c(ts.fi, ts.va)
  z.c &lt;- c(rep(1, times = length(ts.fi)), rep(2, times = length(ts.va)))
  o &lt;- order(ts.c)
  data &lt;- cbind(ts.c[o], z.c[o])
  
  ## calculate the minus loglikelihood of an (bivariate) MRHawkes with some 
  ## parameters the default hazard functions and density functions are Weibull 
  ## and exponential respectivley
  TmllMRH(data, cens = t1, par = c(0.488, 20.10, 0.347, 9.53, 461, 720,
                                  0.472, 0.293, 0.399, -0.0774), B = 200)
                                  
  ## calculate the MLE for the parameter assuming known parametric forms
  ## of the immigrant hazard function and offspring density functions.  
  
    system.time(est &lt;- optim(c(0.488, 20.10, 0.347, 9.53, 461, 720,
                                  0.472, 0.293, 0.399, -0.0774), 
                             TmllMRH, data = data, cens = t1, B = 200,
                             control = list(maxit = 5000, trace = TRUE),
                             hessian = TRUE)
    )
    ## point estimate by MLE
    est$par
    ## standard error estimates:
    diag(solve(est$hessian))^0.5
  
</code></pre>


</div>