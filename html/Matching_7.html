<div class="container">

<table style="width: 100%;"><tr>
<td>MatchBalance</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Tests for Univariate and Multivariate Balance</h2>

<h3>Description</h3>

<p>This function provides a variety of balance statistics useful for
determining if balance exists in any unmatched dataset and
in matched datasets produced by the <code>Match</code>
function.  Matching is performed by the <code>Match</code> function,
and <code>MatchBalance</code> is used to determine if <code>Match</code>
was successful in achieving balance on the observed covariates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">MatchBalance(formul, data = NULL, match.out = NULL, ks = TRUE,
             nboots=500, weights=NULL, digits=5, paired=TRUE, print.level=1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formul</code></td>
<td>

<p>This formula does <em>not</em> estimate any model.  The formula is
simply an efficient way to use the R modeling language to list the
variables we wish to obtain univariate balance statistics for.  The
dependent variable in the formula is usually the treatment
indicator.  One should include many functions of the observed
covariates.  Generally, one should request balance statistics on
more higher-order terms and interactions than were used to conduct
the matching itself.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p> A data frame which contains all of the variables in the
formula.  If a data frame is not provided, the variables are
obtained via lexical scoping.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>match.out</code></td>
<td>
<p> The output object from the <code>Match</code>
function.  If this output is included, <code>MatchBalance</code> will provide
balance statistics for both before and after matching. Otherwise
balance statistics will only be reported for the raw unmatched
data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ks</code></td>
<td>
<p> A logical flag for whether the univariate bootstrap
Kolmogorov-Smirnov (KS) test should be calculated.  If the ks option
is set to true, the univariate KS test is calculated for all
non-dichotomous variables.  The bootstrap KS test is consistent even
for non-continuous variables.  See <code>ks.boot</code> for more
details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>An optional vector of observation specific weights.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nboots</code></td>
<td>
<p>The number of bootstrap samples to be run.  If zero, no
bootstraps are done.  Bootstrapping is highly recommended because
the bootstrapped Kolmogorov-Smirnov test provides correct coverage
even when the distributions being compared are not continuous.  At
least 500 <code>nboots</code> (preferably 1000) are recommended for
publication quality p-values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>The number of significant digits that should be
displayed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>paired</code></td>
<td>
<p>A flag for whether the paired <code>t.test</code> should be
used after matching.  Regardless of the value of this option, an
unpaired <code>t.test</code> is done for the unmatched data because
it is assumed that the unmatched data were not generated by a paired
experiment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.level</code></td>
<td>
<p>The amount of printing to be done.  If zero, there is
no printing.  If one, the results are summarized.  If
two, details of the computations are printed.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function can be used to determine if there is balance in the pre-
and/or post-matching datasets.  Difference of means between treatment
and control groups are provided as well as a variety of summary
statistics for the empirical CDF (eCDF) and empirical-QQ (eQQ) plot
between the two groups.  The eCDF results are the standardized mean,
median and maximum differences in the empirical CDF. The eQQ results
are summaries of the raw differences in the empirical-QQ plot.<br></p>
<p>Two univariate tests are also provided: the t-test and the bootstrap
Kolmogorov-Smirnov (KS) test. These tests should not be treated as
hypothesis tests in the usual fashion because we wish to maximize
balance without limit.  The bootstrap KS test is highly
recommended (see the <code>ks</code> and <code>nboots</code> options) because the
bootstrap KS is consistent even for non-continuous distributions.
Before matching, the two sample t-test is used; after matching, the
paired t-test is used.<br></p>
<p>Two multivariate tests are provided.  The KS and Chi-Square null
deviance tests.  The KS test is to be preferred over the Chi-Square
test because the Chi-Square test is not testing the relevant
hypothesis.  The null hypothesis for the KS test is equal balance
in the estimated probabilities between treated and control.  The null
hypothesis for the Chi-Square test, however, is all of the
parameters being insignificant; a comparison of residual versus null
deviance.  If the covariates being considered are discrete, this KS
test is asymptotically nonparametric as long as the logit model does
not produce zero parameter estimates.
</p>
<p><code>NA</code>'s are handled by the <code>na.action</code> option.  But it
is highly recommended that <code>NA</code>'s not simply be deleted, but
one should check to make sure that missingness is balanced.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>BeforeMatching</code></td>
<td>
<p>A list containing the before matching univariate
balance statistics. That is, a list containing the results of
the  <code>balanceUV</code> function applied to all of the
covariates described in <code>formul</code>.  Note that the univariate
test results for all of the variables in <code>formul</code> are printed
if <code>verbose &gt; 0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AfterMatching</code></td>
<td>
<p>A list containing the after matching univariate
balance statistics. That is, a list containing the results of
the  <code>balanceUV</code> function applied to all of the
covariates described in <code>formul</code>.  Note that the univariate
test results for all of the variables in <code>formul</code> are printed
if <code>verbose &gt; 0</code>.  This object is <code>NULL</code>, if no matched
dataset was provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BMsmallest.p.value</code></td>
<td>
<p>The smallest p.value found across all of the
<em>before</em> matching balance tests (including t-tests and KS-tests.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BMsmallestVarName</code></td>
<td>
<p>The name of the variable with the
<code>BMsmallest.p.value</code> (a vector in case of ties).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BMsmallestVarNumber</code></td>
<td>
<p>The number of the variable with the
<code>BMsmallest.p.value</code> (a vector in case of ties).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AMsmallest.p.value</code></td>
<td>
<p>The smallest p.value found across all of the
<em>after</em> matching balance tests (including t-tests and
KS-tests.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AMsmallestVarName</code></td>
<td>
<p>The name of the variable with the
<code>AMsmallest.p.value</code> (a vector in case of ties).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AMsmallestVarNumber</code></td>
<td>
<p>The number of the variable with the
<code>AMsmallest.p.value</code> (a vector in case of ties).</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Jasjeet S. Sekhon, UC Berkeley, <a href="mailto:sekhon@berkeley.edu">sekhon@berkeley.edu</a>,
<a href="https://www.jsekhon.com">https://www.jsekhon.com</a>.
</p>


<h3>References</h3>

<p>Sekhon, Jasjeet S. 2011.  "Multivariate and Propensity Score
Matching Software with Automated Balance Optimization.”
<em>Journal of Statistical Software</em> 42(7): 1-52.
<a href="https://doi.org/10.18637/jss.v042.i07">doi:10.18637/jss.v042.i07</a>
</p>
<p>Diamond, Alexis and Jasjeet S. Sekhon. 2013. "Genetic
Matching for Estimating Causal Effects: A General Multivariate
Matching Method for Achieving Balance in Observational Studies.”
<em>Review of Economics and Statistics</em>.  95 (3): 932–945.
<a href="https://www.jsekhon.com">https://www.jsekhon.com</a>
</p>
<p>Abadie, Alberto.  2002.  “Bootstrap Tests for Distributional Treatment
Effects in Instrumental Variable Models.” <em>Journal of the
American Statistical Association</em>, 97:457 (March) 284-292.
</p>
<p>Hall, Peter. 1992. <em>The Bootstrap and Edgeworth Expansion</em>.  New
York: Springer-Verlag.
</p>
<p>Wilcox, Rand R. 1997. <em>Introduction to Robust Estimation</em>.  San
Diego, CA: Academic Press.
</p>
<p>William J. Conover (1971), <em>Practical nonparametric statistics</em>.
New York: John Wiley &amp; Sons. Pages 295-301 (one-sample
"Kolmogorov" test), 309-314 (two-sample "Smirnov" test).
</p>
<p>Shao, Jun and Dongsheng Tu. 1995. <em>The Jackknife and Bootstrap</em>.
New York: Springer-Verlag.
</p>


<h3>See Also</h3>

<p>Also see <code>Match</code>, <code>GenMatch</code>,
<code>balanceUV</code>, <code>qqstats</code>, <code>ks.boot</code>,
<code>GerberGreenImai</code>, <code>lalonde</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#
# Replication of Dehejia and Wahba psid3 model
#
# Dehejia, Rajeev and Sadek Wahba. 1999.``Causal Effects in
# Non-Experimental Studies: Re-Evaluating the Evaluation of Training
# Programs.''Journal of the American Statistical Association 94 (448):
# 1053-1062.

data(lalonde)

#
# Estimate the propensity model
#
glm1  &lt;- glm(treat~age + I(age^2) + educ + I(educ^2) + black +
             hisp + married + nodegr + re74  + I(re74^2) + re75 + I(re75^2) +
             u74 + u75, family=binomial, data=lalonde)


#
#save data objects
#
X  &lt;- glm1$fitted
Y  &lt;- lalonde$re78
Tr  &lt;- lalonde$treat

#
# one-to-one matching with replacement (the "M=1" option).
# Estimating the treatment effect on the treated (the "estimand" option which defaults to 0).
#
rr  &lt;- Match(Y=Y,Tr=Tr,X=X,M=1);

#Let's summarize the output
summary(rr)

# Let's check the covariate balance
# 'nboots' is set to small values in the interest of speed.
# Please increase to at least 500 each for publication quality p-values.
mb  &lt;- MatchBalance(treat~age + I(age^2) + educ + I(educ^2) + black +
                    hisp + married + nodegr + re74  + I(re74^2) + re75 + I(re75^2) +
                    u74 + u75, data=lalonde, match.out=rr, nboots=10)
</code></pre>


</div>