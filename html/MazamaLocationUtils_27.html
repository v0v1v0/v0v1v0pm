<div class="container">

<table style="width: 100%;"><tr>
<td>table_addOpenCageInfo</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add address fields to a known location table</h2>

<h3>Description</h3>

<p>The OpenCage reverse geocoding service is used to update an
existing table. Updated columns include:
</p>

<ul>
<li>
<p>countryCode
</p>
</li>
<li>
<p>stateCode
</p>
</li>
<li>
<p>countyName
</p>
</li>
<li>
<p>timezone
</p>
</li>
<li>
<p>houseNumber
</p>
</li>
<li>
<p>street
</p>
</li>
<li>
<p>city
</p>
</li>
<li>
<p>postalCode
</p>
</li>
<li>
<p>address
</p>
</li>
</ul>
<p>When <code>replaceExisting = TRUE</code>, all existing address fields are discarded
in favor of the OpenCage versions. To only fill in missing values in
<code>locationTbl</code>, use <code>replaceExisting = FALSE</code>.
</p>
<p>The OpenCage service returns a large number of fields, some of which may be
useful. To add all OpenCage fields to a location table, use
<code>retainOpenCage = TRUE</code>. This will append 78+ fields of information,
each each named with a prefix of <code>"opencage_"</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">table_addOpenCageInfo(
  locationTbl = NULL,
  replaceExisting = FALSE,
  retainOpenCage = FALSE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>locationTbl</code></td>
<td>
<p>Tibble of known locations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>replaceExisting</code></td>
<td>
<p>Logical specifying whether to replace existing data
with data obtained from OpenCage.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>retainOpenCage</code></td>
<td>
<p>Logical specifying whether to retain all fields obtained
from OpenCage, each named with a prefix of <code>opencage_</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical controlling the generation of progress messages.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Tibble of "known locations" enhanced with information from the
OpenCage reverse geocoding service.
</p>


<h3>Note</h3>

<p>The OpenCage service requires an API key which can be obtained from
their web site. This API key must be set as an environment variable with:
</p>
<pre>
Sys.setenv("OPENCAGE_KEY" = "&lt;your api key&gt;")
</pre>
<p>Parameters are set for use at the OpenCage "free trial" level which allows
for 1 request/sec and a maximum of 2500 requests per day.
</p>
<p>Because of the 1 request/sec default, it is recommended that
<code>table_addOpenCageInfo()</code> only be used in an interactive session when
updating a table with a large number of records.
</p>


<h3>References</h3>

<p><a href="https://opencagedata.com">https://opencagedata.com</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(MazamaLocationUtils)

# Fail gracefully if any resources are not available
try({

  myTbl &lt;- id_monitors_500[1:3,]
  myTbl$countryCode[1] &lt;- NA
  myTbl$countryCode[2] &lt;- "WRONG"
  myTbl$countyName[3] &lt;- "WRONG"
  myTbl$timezone &lt;- NA

  dplyr::glimpse(myTbl)

  Sys.setenv("OPENCAGE_KEY" = "&lt;YOUR_KEY&gt;")

  table_addOpenCageInfo(myTbl) %&gt;% 
    dplyr::glimpse()

  table_addOpenCageInfo(myTbl, replaceExisting = TRUE) %&gt;% 
    dplyr::glimpse()

  table_addOpenCageInfo(myTbl, replaceExisting = TRUE, retainOpenCage = TRUE) %&gt;% 
    dplyr::glimpse()
  
}, silent = FALSE)

</code></pre>


</div>