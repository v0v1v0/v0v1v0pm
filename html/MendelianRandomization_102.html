<div class="container">

<table style="width: 100%;"><tr>
<td>mr_mvcML</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Multivariable constrained maximum likelihood method</h2>

<h3>Description</h3>

<p>The <code>mr_mvcML</code> function performs multivariable Mendelian randomization via the constrained maximum likelihood method, which is robust to both correlated and uncorrelated pleiotropy.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mr_mvcML(
  object,
  n,
  DP = TRUE,
  rho_mat = diag(ncol(object@betaX) + 1),
  K_vec = 0:(ceiling(nrow(object@betaX)/2)),
  random_start = 0,
  num_pert = 100,
  min_theta_range = -0.5,
  max_theta_range = 0.5,
  maxit = 100,
  alpha = 0.05,
  seed = 314159265
)

## S4 method for signature 'MRMVInput'
mr_mvcML(
  object,
  n,
  DP = TRUE,
  rho_mat = diag(ncol(object@betaX) + 1),
  K_vec = 0:(ceiling(nrow(object@betaX)/2)),
  random_start = 0,
  num_pert = 200,
  min_theta_range = -0.5,
  max_theta_range = 0.5,
  maxit = 100,
  alpha = 0.05,
  seed = 314159265
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An <code>MRMVInput</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Sample size. The smallest sample size among all (both exposures and outcome) GWAS used in the analysis is recommended.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>DP</code></td>
<td>
<p>Whether data perturbation is applied or not. Default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho_mat</code></td>
<td>
<p>The correlation matrix among the exposures and outcome GWAS estimates, which can be estimated by the intercept term from bivariate LDSC. See reference for more discussions. Default is the identify matrix, for example, in the absence of overlapping samples among GWAS datasets.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K_vec</code></td>
<td>
<p>Set of candidate K's, the constraint parameter 
representing number of invalid IVs. It can range from 0 up to #IV - (#exposure + 1). Default is from 0 to (#IV/2).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random_start</code></td>
<td>
<p>Number of random starting points for MVMRcML, default is 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_pert</code></td>
<td>
<p>Number of perturbation when DP is TRUE, default is 200.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_theta_range</code></td>
<td>
<p>The lower bound of the uniform distribution for each initial value for theta generated from, default is -0.5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_theta_range</code></td>
<td>
<p>The uppder bound of the uniform distribution for each initial value for theta generated from, default is 0.5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>
<p>Maximum number of iterations for each optimization. Default is 100.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>Significance level for the confidence interval for estimate, default is 0.05.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>The random seed to use when generating the perturbed samples (for reproducibility). The default value is 314159265. If set to <code>NA</code>, the random seed will not be set (for example, if the function is used as part of a larger simulation).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Multivariable MRcML (MVMRcML) is an extension of MRcML to deal with multiple exposures of interest. It is robust to both correlated and uncorrelated pleiotropy as its univariable version.
</p>
<p>In practice, the data perturbation (DP) version is preferred in practice for a more robust inference as it can account for the uncertainty in model selection.
However, it may take a longer time especially when the number of IVs is large (so the range of <code>K_vec</code> can be large too).
One strategy is to try a small range of K (the number of invalid IVs) first (with a small <code>num_pert</code>), 
then adjust it if the number of selected invalid IVs fall close to the boundary.
You can also use other methods, e.g. <code>mr_mvlasso</code>, to get a rough sense of the number of invalid IVs.
</p>
<p>Similar to <code>mr_cML</code>, multiple random starting points could be used to find a global minimum.
</p>


<h3>Value</h3>

<p>The output from the function is an <code>MVMRcML</code> object containing:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Exposure</code></td>
<td>
<p>A character vector with the names given to the exposure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Outcome</code></td>
<td>
<p>A character string with the names given to the outcome.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Estimate</code></td>
<td>
<p>A vector of causal estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>StdError</code></td>
<td>
<p>A vector of standard errors of the causal estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CILower</code></td>
<td>
<p>The lower bounds of the causal estimates based on the estimated standard errors and the significance level provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CIUpper</code></td>
<td>
<p>The upper bounds of the causal estimates based on the estimated standard errors and the significance level provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Alpha</code></td>
<td>
<p>The significance level used when calculating the confidence intervals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Pvalue</code></td>
<td>
<p>The p-values associated with the estimates (calculated as Estimate/StdError as per Wald test) using a normal distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BIC_invalid</code></td>
<td>
<p>Set of selected invalid IVs by MVMRcML-BIC.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K_hat</code></td>
<td>
<p>The number of selected invalid IVs by MVMRcML-BIC, or a vector for each data perturbation in MVMRcML-DP.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eff_DP_B</code></td>
<td>
<p>The number of data perturbations with successful convergence in MVMRcML-DP.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SNPs</code></td>
<td>
<p>The number of genetic variants (SNPs) included in the analysis.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Lin, Z., Xue, H., &amp; Pan, W. (2023). Robust multivariable Mendelian randomization based on constrained maximum likelihood. The American Journal of Human Genetics, 110(4), 592-605.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Perform MVMRcML-DP:
mr_mvcML(mr_mvinput(bx = cbind(ldlc, hdlc, trig), bxse = cbind(ldlcse, hdlcse, trigse),
   by = chdlodds, byse = chdloddsse), n = 17723, num_pert = 5, random_start = 5)
  # num_pert is set to 5 to reduce runtime for the mr_mvcML method,
  # At least 100 perturbations should be used and more is preferred for a stable result.

rho_mat = matrix(c(1,-0.1,0.2,0,-0.1,1,-0.3,0,
 				  0.2,-0.3,1,0,0,0,0,1),ncol=4) ## Toy example of rho_mat
mr_mvcML(mr_mvinput(bx = cbind(ldlc, hdlc, trig), bxse = cbind(ldlcse, hdlcse, trigse),
   by = chdlodds, byse = chdloddsse), n = 17723, num_pert = 5, rho_mat = rho_mat)

# Perform MVMRcML-BIC:
mr_mvcML(mr_mvinput(bx = cbind(ldlc, hdlc, trig), bxse = cbind(ldlcse, hdlcse, trigse),
   by = chdlodds, byse = chdloddsse), n = 17723, DP = FALSE)

</code></pre>


</div>