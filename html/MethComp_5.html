<div class="container">

<table style="width: 100%;"><tr>
<td>BA.plot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bland-Altman plot of differences versus averages.</h2>

<h3>Description</h3>

<p>For two vectors of equal length representing measurements of the same
quantity by two different methods, the differences are plotted versus the
average. The limits of agreement (prediction limits for the differences) are
plotted, optionally a regression of differences of means is given too. Works
with <code>Meth</code> and <code>MethComp</code> objects too.
</p>
<p>A plot method for the <code>"PBreg"</code> class object, that is a result of
Passing-Bablok regression.
</p>
<p>When a method comparison model i fitted and stored in a <code>MCmcmc</code>
object, then the posterior distributions of the variance components are
plotted, in separate displays for method.
</p>


<h3>Usage</h3>

<pre><code class="language-R">BA.plot(
  y1,
  y2,
  meth.names = NULL,
  wh.comp = 1:2,
  pl.type = "BA",
  dif.type = "const",
  sd.type = "const",
  model = if (inherits(y1, "Meth") &amp; has.repl(y1)) "exch" else NULL,
  eqax = FALSE,
  axlim = if (is.data.frame(y1)) range(y1$y) else range(c(y1, y2)),
  diflim = NULL,
  grid = TRUE,
  N.grid = 10,
  col.grid = grey(0.9),
  points = TRUE,
  col.points = "black",
  cex.points = 1,
  pch.points = 16,
  lwd = c(3, 1, 1),
  col.lines = "blue",
  repl.conn = FALSE,
  col.conn = "gray",
  lwd.conn = 1,
  xlab = NULL,
  ylab = NULL,
  eqn = FALSE,
  col.eqn = col.lines,
  font.eqn = 2,
  digits = 2,
  Transform = if (mult) "log" else NULL,
  mult = FALSE,
  alpha = NULL,
  ...
)

## S3 method for class 'PBreg'
plot(
  x,
  pch = 21,
  bg = "#2200aa33",
  xlim = c(0, max(x$model)),
  ylim = c(0, max(x$model)),
  xlab = x$meths[1],
  ylab = x$meths[2],
  subtype = 1,
  colors = list(CI = "#ccaaff50", fit = "blue", ref = "#99999955", bars = "gray", dens =
    "#8866aaa0", ref2 = c("#1222bb99", "#bb221299")),
  ...
)

## S3 method for class 'Meth'
plot(
  x,
  which = NULL,
  col.LoA = "blue",
  col.pt = "black",
  cex.name = 2,
  var.range,
  diff.range,
  var.names = FALSE,
  pch = 16,
  cex = 0.7,
  Transform,
  ...
)

## S3 method for class 'VarComp'
plot(
  x,
  which,
  lwd.line = rep(2, 4),
  col.line = c("red", "green", "blue", "black"),
  lty.line = rep(1, 4),
  grid = TRUE,
  col.grid = gray(0.8),
  rug = TRUE,
  probs = c(5, 50, 95),
  tot.var = FALSE,
  same.ax = TRUE,
  meth.names = TRUE,
  VC.names = "first",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y1</code></td>
<td>
<p>Numerical vector of measurements by 1st method. Can also be a
<code>Meth</code> or a <code>MethComp</code> object, see details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y2</code></td>
<td>
<p>Numerical vector of measurements by 2nd method. Must of same
length as <code>x</code>. Ignored if a <code>Meth</code> or a
<code>MethComp</code> objects is given for <code>y1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>meth.names</code></td>
<td>
<p>Should the names of the methods be put on the plots?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wh.comp</code></td>
<td>
<p>Which methods should be compared. Either numerical or
character.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pl.type</code></td>
<td>
<p>What type of plot should be made, <code>"BA"</code> for differences
versus averages, <code>"conv"</code> for method 1 versus method 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dif.type</code></td>
<td>
<p>How should difference depend on the averages. <code>"const"</code>
or <code>"lin"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sd.type</code></td>
<td>
<p>How should the standard deviation depend on the averages.
<code>"const"</code> or <code>"lin"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>Should a variance component model be used to compute the limits
of agreement? If <code>NULL</code> a simple analysis is made; other possibilities
are <code>"exch"</code> or <code>"linked"</code> for exchangeable or linked replicates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eqax</code></td>
<td>
<p>Should the axes be identical? If a Bland-Altman plot is drawn,
the axis for the differences will have the same extent as the axis for the
averages, but centered on 0 (see <code>diflim</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>axlim</code></td>
<td>
<p>The limits of the axes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>diflim</code></td>
<td>
<p>The limits of the difference axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grid</code></td>
<td>
<p>Logical. Should a vertical grid be set up? If numeric it is set
up at the values specified. If <code>same.ax</code>, the range of the grid is
taken to be the extent of the x-axis for all plots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N.grid</code></td>
<td>
<p>How many grid-lines should be drawn.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.grid</code></td>
<td>
<p>The color of the grid.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>points</code></td>
<td>
<p>Logical. Should the observed points be drawn?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.points</code></td>
<td>
<p>What color should they have?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex.points</code></td>
<td>
<p>How large should they be?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pch.points</code></td>
<td>
<p>What plot character for the points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwd</code></td>
<td>
<p>Numerical vector of 3, giving the width of the conversion line
(mean difference) and the limits of agreement.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.lines</code></td>
<td>
<p>What color should the lines have.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>repl.conn</code></td>
<td>
<p>Should replicate measurements be connected (within items)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.conn</code></td>
<td>
<p>Color of connecting lines.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwd.conn</code></td>
<td>
<p>Width of connecting lines.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>Label on the x-axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>Label on the y-axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eqn</code></td>
<td>
<p>Logical. Should the equations linking the methods be shown on the
plot? If a Bland-Altman plot is made, both the equations linking the methods
and the equation for the differences versus the averages are shown.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.eqn</code></td>
<td>
<p>Color for equations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>font.eqn</code></td>
<td>
<p>Font for equations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>How many digits after the decimal point should be used when
showing the equations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Transform</code></td>
<td>
<p>Transformation used to the measurements prior to plotting.
Function or character, see <code>choose.trans</code> for possible values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mult</code></td>
<td>
<p>Logical. If TRUE, ratios of measurement instead of differences
will be plotted in the Bland-Altman plot on a logarithmic axis, and limits
of agreement will be given on this scale?  This gives the same analysis as
using <code>Transform="log"</code>, but a different plot. Using another
transformation than the log is accommodated, but no LoA is shown on the
axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>1 minus the confidence level. If <code>NULL</code> a multiplier of 2
is used for constructing prediction limits, otherwise a t-quantile with d.f.
equal th number of items minus 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Parameters passed on the <code>density</code> furnction that
does the smoothing of the posterior samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A <code>MCmcmc</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pch</code></td>
<td>
<p>Plot character for points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bg</code></td>
<td>
<p>Background colour for the plotting character.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim</code></td>
<td>
<p>Limits for the x-axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>Limits for the y-axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subtype</code></td>
<td>
<p>a numeric value or vector, that selects the desired plot
subtype.  Subtype <b>1</b> is an x-y plot of raw data with regression line
and confidence boundaries for the fit as a shaded area.  This is the
default.  Subtype <b>2</b> is a ranked residuals plot.  Subtype <b>3</b> is
the "Cusum" plot useful for assessing linearity of the fit. Plot subtypes 1
through 3 are standard plots from the 1983 paper by Passing and Bablok - see
the reference.  Plot subtype <b>4</b> is a histogram (with overlaid density
line) of the individual slopes.  The range of this plot is limited to 5 x
IQR for better visibility.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colors</code></td>
<td>
<p>A list of 6 elements allowing customization of colors of
various plot elements. For plot subtype 1: "CI" is the color of the shaded
confidence interval area; and "fit" is the color of fit line. For plot
subtypes 2 &amp; 3: "ref" is the color of the horizontal reference line. For
plot subtype 4: "bars" is the bar background color, "dens" is the color of
the density line, and "ref2" is a vector of two colors for lines indicating
the median and confidence limits.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>which</code></td>
<td>
<p>For which of the compared methods should the plot be made?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.LoA</code></td>
<td>
<p>What color should be used for the limits of agreement.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.pt</code></td>
<td>
<p>What color should be used for the points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex.name</code></td>
<td>
<p>Character expansion factor for plotting method names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.range</code></td>
<td>
<p>The range of both axes in the scatter plot and the x-axis
in the Bland-Altman plot be?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>diff.range</code></td>
<td>
<p>The range of yaxis in the Bland-Altman plot. Defaults to a
range as the x-axis, but centered around 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.names</code></td>
<td>
<p>If logical: should the individual panels be labelled with
the variable names?. If character, then the values of the character will be
used to label the methods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex</code></td>
<td>
<p>Plot charcter expansion for points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwd.line</code></td>
<td>
<p>Line width for drawing the density.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.line</code></td>
<td>
<p>Color for drawing the densities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lty.line</code></td>
<td>
<p>Line type for drawing the densities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rug</code></td>
<td>
<p>Should a small rug at the bottom show posterior quantiles?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probs</code></td>
<td>
<p>Numeric vector with numbers in the range from 0 to 100,
indicating the posterior percentiles to be shown in the rug.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tot.var</code></td>
<td>
<p>Should the posterior of the total variance also be shown?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>same.ax</code></td>
<td>
<p>Should the same axes be used for all methods?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>VC.names</code></td>
<td>
<p>Should the names of the variance components be put on the
first plot (<code>"first"</code>), the last (<code>"last"</code>), all (<code>"all"</code>) or
none (<code>"none"</code>). Only the first letter is needed.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A plot of the relationship between the methods is produced; either a
Bland-Altman plot of the differences versus averages, or a 45 degree
rotation as a conversion between the methods. If <code>model=NULL</code> a simple
regression of averages on differences is made by calling <code>DA.reg</code>, and
the specified conversion plotted.
</p>
<p>The function generates a series of plots, one for each method compared in
the <code>MCmcmc</code> object supplied (or those chosen by <code>which=</code>).
Therefore the user must take care to set <code>mfrow</code> or <code>mfcol</code> to
capture all the plots.
</p>


<h3>Value</h3>

<p>An object of class <code>MethComp</code> and either <code>DA.reg</code>
(if <code>model=NULL</code>) or <code>BA.est</code> (if <code>model</code> is character).
</p>
<p>A plot as a side effect
</p>
<p>A list with one element for each method.  Each element of this is a
list of densities, i.e. of objects of class <code>density</code>, one for each
variance component.
</p>


<h3>Author(s)</h3>

<p>Bendix Carstensen <a href="mailto:bendix.carstensen@regionh.dk">bendix.carstensen@regionh.dk</a>,
<a href="http://BendixCarstensen.com">http://BendixCarstensen.com</a>.
</p>
<p>Michal J. Figurski <a href="mailto:mfigrs@gmail.com">mfigrs@gmail.com</a>
</p>
<p>Bendix Carstensen, <a href="mailto:bendix.carstensen@regionh.dk">bendix.carstensen@regionh.dk</a>
</p>


<h3>References</h3>

<p>JM Bland and DG Altman: Statistical methods for assessing
agreement between two methods of clinical measurement, Lancet, i, 1986, pp.
307-310.
</p>
<p>JM Bland and DG Altman. Measuring agreement in method comparison studies.
Statistical Methods in Medical Research, 8:136-160, 1999.
</p>
<p>B Carstensen: Comparing methods of measurement: Extending the LoA by
regression. Stat Med. 2010 Feb 10;29(3):401-10.
</p>
<p>Passing, H. and Bablok, W. (1983), A New Biometrical Procedure
for Testing the Equality of Measurements from Two Different Analytical
Methods. <em>Journal of Clinical Chemistry and Clinical Biochemistry</em>,
<b>Vol 21</b>, 709â€“720
</p>


<h3>See Also</h3>

<p><code>BA.est</code>, <code>DA.reg</code>, <code>MCmcmc</code>.
</p>
<p><code>PBreg, Deming</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data( ox )
ox &lt;- Meth( ox )
# The simplest possible Bland-Altman plot
BA.plot( ox )

## With bells and whistles, comparing the naive and model
par( mfrow=c(2,2) )
BA.plot( ox, model=NULL, repl.conn=TRUE, col.lines="blue",
         axlim=c(0,100), diflim=c(-50,50), xaxs="i", yaxs="i",
         las=1, eqn=TRUE, dif.type="lin", pl.type="BA", sd.type="lin",
         grid=1:9*10, digits=3,font.eqn=1)
par(new=TRUE)
BA.plot( ox, model="linked", repl.conn=TRUE, col.lines="red",
         axlim=c(0,100), diflim=c(-50,50), xaxs="i", yaxs="i",
         las=1, eqn=FALSE, dif.type="lin", pl.type="BA", sd.type="lin",
        grid=1:0*10, digits=3)
BA.plot( ox, model=NULL, repl.conn=TRUE, col.lines="blue",
         axlim=c(0,100), diflim=c(-50,50), xaxs="i", yaxs="i",
         las=1, eqn=TRUE, dif.type="lin", pl.type="conv", sd.type="lin",
        grid=1:9*10, digits=3,font.eqn=1)
par(new=TRUE)
BA.plot( ox, model="linked", repl.conn=TRUE, col.lines="red",
         axlim=c(0,100), diflim=c(-50,50), xaxs="i", yaxs="i",
         las=1, eqn=FALSE, dif.type="lin", pl.type="conv", sd.type="lin",
         grid=1:9*10, digits=3)
# The same again, but now logit-transformed
BA.plot( ox, model=NULL, repl.conn=TRUE, col.lines="blue",
         axlim=c(0,100), diflim=c(-50,50), xaxs="i", yaxs="i",
         las=1, eqn=TRUE, dif.type="lin", pl.type="BA", sd.type="lin",
         grid=1:9*10, digits=3,font.eqn=1,Transform="pctlogit")
par(new=TRUE)
BA.plot( ox, model="linked", repl.conn=TRUE, col.lines="red",
         axlim=c(0,100), diflim=c(-50,50), xaxs="i", yaxs="i",
         las=1, eqn=FALSE, dif.type="lin", pl.type="BA", sd.type="lin",
         grid=1:0*10, digits=3,Transform="pctlogit")
BA.plot( ox, model=NULL, repl.conn=TRUE, col.lines="blue",
         axlim=c(0,100), diflim=c(-50,50), xaxs="i", yaxs="i",
         las=1, eqn=TRUE, dif.type="lin", pl.type="conv", sd.type="lin",
         grid=1:9*10, digits=3,font.eqn=1,Transform="pctlogit")
par(new=TRUE)
BA.plot( ox, model="linked", repl.conn=TRUE, col.lines="red",
         axlim=c(0,100), diflim=c(-50,50), xaxs="i", yaxs="i",
         las=1, eqn=FALSE, dif.type="lin", pl.type="conv", sd.type="lin",
         grid=1:9*10, digits=3,Transform="pctlogit")


  ## Model data frame generation
  a &lt;- data.frame(x=seq(1, 30)+rnorm(mean=0, sd=1, n=30),
                  y=seq(1, 30)*rnorm(mean=1, sd=0.4, n=30))

  ## Call to PBreg
  x &lt;- PBreg(a)
  print(x)
  par(mfrow=c(2,2))
  plot(x, s=1:4)

  ## Or the same using "Meth" object
  a &lt;- Meth(a, y=1:2)
  x &lt;- PBreg(a)
  print(x)
  par(mfrow=c(2,2))
  plot(x, s=1:4)

</code></pre>


</div>