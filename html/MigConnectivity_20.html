<div class="container">

<table style="width: 100%;"><tr>
<td>isoAssign</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generate probabilistic isotope assignments</h2>

<h3>Description</h3>

<p>The <code>isoAssign</code> function generates origin assignments using
stable-hydrogen isotopes in tissue. The function generates a probability
surface of origin assignment from a vector of stable-isotope values for each
animal/sample of interest. Probabilistic assignments are constructed by first
converting observed stable-isotope ratios (isoscape) in either precipitation
or surface waters into a 'tissuescape' using a user-provided intercept, slope
and standard deviation. See
<a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0035137">Hobson et. al. (2012)</a>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">isoAssign(
  isovalues,
  isoSTD,
  intercept,
  slope,
  odds = 0.67,
  restrict2Likely = TRUE,
  nSamples = NULL,
  sppShapefile = NULL,
  relAbund = NULL,
  isoWeight = NULL,
  abundWeight = NULL,
  population = NULL,
  assignExtent = c(-179, -60, 15, 89),
  element = "Hydrogen",
  surface = FALSE,
  period = "Annual",
  seed = NULL,
  verbose = 1,
  generateSingleCell = FALSE,
  mapDirectory = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>isovalues</code></td>
<td>
<p>vector of tissue isotope values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>isoSTD</code></td>
<td>
<p>standard deviation from calibration</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>intercept value from calibration</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>slope</code></td>
<td>
<p>value from calibration</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>odds</code></td>
<td>
<p>odds ratio to use to set likely and unlikely locations defaults
to 0.67</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>restrict2Likely</code></td>
<td>
<p>if <code>TRUE</code> restricts locations to fall within the
'likely' assignment locations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nSamples</code></td>
<td>
<p>integer specifying how many random samples to draw from a
multinomial distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sppShapefile</code></td>
<td>
<p>A polygon spatial layer (sf - MULTIPOLYGON) defining
species range. Assignments are restricted to these areas.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>relAbund</code></td>
<td>
<p>raster (<code>SpatRast</code>) with relative abundance (must match
extent of isotope assignment)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>isoWeight</code></td>
<td>
<p>weighting value to apply to isotope assignment</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>abundWeight</code></td>
<td>
<p>weighting value to apply to relative abundance prior</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>population</code></td>
<td>
<p>vector identifying location where animal was captured.
Same order as <code>isovalues</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assignExtent</code></td>
<td>
<p>definition for the extent of the assignment. Can be used
in place of <code>sppShapefile</code> to limit assignment. Input should
follow <code>c(xmin,xmax,ymin,ymax)</code> in degrees longitude and
latitude</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>element</code></td>
<td>
<p>The elemental isotope of interest. Currently the only
elements that are implemented are 'Hydrogen' (default) and 'Oxygen'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surface</code></td>
<td>
<p>DEPRECATED function no longer returns surface water values.
Default is 'FALSE' which returns the precipitation isotopes ratio.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>period</code></td>
<td>
<p>The time period of interest. If 'Annual' returns a raster
of mean annual values in precipitation for the <code>element</code>. If
'GrowingSeason' returns growing season values in precipitation for
<code>element</code> of interest</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>numeric value fed to <code>set.seed</code> for random number
generation. Default = NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>takes values 0, 1 (default) or 2. 0 prints no output during
run. 1 prints a message detailing where in the process the function
is. 2 prints the animal currently being sampled.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>generateSingleCell</code></td>
<td>
<p>if 'TRUE' generates a single origin location using
the posterior assignment distribution - this takes a while to run.
If 'FALSE' (default), no coordinates are generated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mapDirectory</code></td>
<td>
<p>Directory to save/read isotope map from. Can use relative
or absolute addressing. The default value (NULL) downloads to a temporary
directory, so we strongly recommend changing this from the default unless
you're sure you're not going to need these data more than once.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>returns an <code>isoAssign</code> object containing the following:
</p>

<dl>
<dt><code>probassign</code></dt>
<dd>
<p>SpatRast stack of individual probabilistic assignments</p>
</dd>
<dt><code>oddsassign</code></dt>
<dd>
<p>SpatRast stack that includes likely vs unlikely origin for each animal</p>
</dd>
<dt><code>popassign</code></dt>
<dd>
<p>a SpatRast for population level assignment (sum of <code>oodsassign</code> if <code>population</code> = NULL).
If <code>population</code> is a vector then returns a raster stack for each unique <code>population</code> provided</p>
</dd>
<dt><code>probDF</code></dt>
<dd>
<p>data.frame of individual probability surfaces</p>
</dd>
<dt><code>oddsDF</code></dt>
<dd>
<p>data.frame of likely vs unlikely surfaces</p>
</dd>
<dt><code>popDF</code></dt>
<dd>
<p>data.frame of population level assignment</p>
</dd>
<dt><code>SingeCell</code></dt>
<dd>
<p>array of coordinates (longitude,latitude) for
single cell assignment</p>
</dd>
<dt><code>targetSites</code></dt>
<dd>
<p><code>sf - MULTIPOLYGON</code> layer representing
isotope bands equivalent to <code>isoSTD</code></p>
</dd>
<dt><code>RandomSeed</code></dt>
<dd>
<p>the RNG seed used when generating locations from
the multinomial distribution</p>
</dd>
</dl>
<h3>References</h3>

<p>Cohen, E. B., C. S. Rushing, F. R. Moore, M. T. Hallworth, J. A. Hostetler,
M. Gutierrez Ramirez, and P. P. Marra. 2019. The strength of
migratory connectivity for birds en route to breeding through the Gulf of
Mexico. Ecography 42: 658-669.
</p>
<p>Hobson, K. A., S. L. Van Wilgenburg, L. I. Wassenaar, and K. Larson. 2012.
Linking hydrogen isotopes in feathers and precipitation: sources of
variance and consequences for assignment to isoscapes. PLoS ONE 7: e35137.
</p>


<h3>See Also</h3>

<p><code>weightAssign</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
extensions &lt;- c("shp", "shx", "dbf", "sbn", "sbx")
tmp &lt;- tempdir()
for (ext in extensions) {
download.file(paste0(
              "https://raw.githubusercontent.com/SMBC-NZP/MigConnectivity",
                     "/master/data-raw/Spatial_Layers/OVENdist.",
                     ext),
              destfile = paste0(tmp, "/OVENdist.", ext), mode = "wb")
}
OVENdist &lt;- sf::st_read(paste0(tmp, "/OVENdist.shp"))
OVENdist &lt;- OVENdist[OVENdist$ORIGIN==2,] # only breeding
sf::st_crs(OVENdist) &lt;- sf::st_crs(4326)

download.file(paste0(
  "https://raw.githubusercontent.com/SMBC-NZP/MigConnectivity",
                     "/master/data-raw/deltaDvalues.csv"),
              destfile = paste0(tmp, "/deltaDvalues.csv"))
OVENvals &lt;- read.csv(paste0(tmp, "/deltaDvalues.csv"))


a &lt;- Sys.time()
b &lt;- isoAssign(isovalues = OVENvals[,2],
              isoSTD = 12,
              intercept = -10,
              slope = 0.8,
              odds = NULL,
              restrict2Likely = TRUE,
              nSamples = 1000,
              sppShapefile = OVENdist,
              assignExtent = c(-179,-60,15,89),
              element = "Hydrogen",
              period = "GrowingSeason") # this setting for demonstration only
Sys.time()-a


</code></pre>


</div>