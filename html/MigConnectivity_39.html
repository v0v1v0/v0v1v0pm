<div class="container">

<table style="width: 100%;"><tr>
<td>simCountData</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulates Breeding Bird Survey-style count data</h2>

<h3>Description</h3>

<p>Recently updated (version 0.4.3) to more properly match current BBS models.
<code>modelCountDataJAGS</code> has not been updated yet
</p>


<h3>Usage</h3>

<pre><code class="language-R">simCountData(
  nStrata,
  routesPerStrata,
  nYears,
  alphaStrat,
  beta = 0,
  eta = 0,
  sdRoute = 0,
  sdYear = 0,
  sdObs = 0,
  sdCount = 0,
  model = c("S", "Sh", "D", "Dh"),
  obsSurvival = 1,
  fixedyear = round(nYears/2),
  nuCount = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>nStrata</code></td>
<td>
<p>Number of populations/regions/strata</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>routesPerStrata</code></td>
<td>
<p>Vector of length 1 or nStrata containing the number of
routes (i.e. counts) per stratum. If length(routesPerStrata) == 1, number of
routes is identical for each population</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nYears</code></td>
<td>
<p>Number of years surveys were conducted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alphaStrat</code></td>
<td>
<p>Vector of length 1 or nStrata containing the log expected
number of individuals counted at each route for each population. If
length(alphaStrat) == 1, expected counts are identical for each population</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>Coefficient of linear year effect (default 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eta</code></td>
<td>
<p>Coefficient of first time run effect (default 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sdRoute</code></td>
<td>
<p>Standard deviation of random route-level variation. Default is
0, and if you're setting sdObs, it's probably best to keep it that way</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sdYear</code></td>
<td>
<p>Standard deviation of random year-level variation (default 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sdObs</code></td>
<td>
<p>Standard deviation of random observer variation (default 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sdCount</code></td>
<td>
<p>Standard deviation of random count-level variation (default 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>One of "S" (default), "Sh", "D", and "Dh". See Link et al.
(2020) for descriptions of these models</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obsSurvival</code></td>
<td>
<p>Annual probability that the observer that ran a route one
year will run it the next. Default 1 (each route has only one observer)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixedyear</code></td>
<td>
<p>The year within nYears that alphaStrat applies directly to
(default halfway through)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nuCount</code></td>
<td>
<p>For the "h" models, parameter for extra variation in counts
(default 1)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>simCountData</code> returns a list containing:
</p>

<dl>
<dt><code>nStrata</code></dt>
<dd>
<p>Number of populations/regions.</p>
</dd>
<dt><code>nRoutes</code></dt>
<dd>
<p>Total number of routes.</p>
</dd>
<dt><code>nYears</code></dt>
<dd>
<p>Number of years.</p>
</dd>
<dt><code>routesPerStrata</code></dt>
<dd>
<p>Number of routes per population.</p>
</dd>
<dt><code>year</code></dt>
<dd>
<p>Vector of length nYears with standardized year values.</p>
</dd>
<dt><code>strat</code></dt>
<dd>
<p>Vector of length nRoutes indicating the
population/region in which each route is located.</p>
</dd>
<dt><code>alphaStrat</code></dt>
<dd>
<p>log expected count for each populations.</p>
</dd>
<dt><code>epsRoute</code></dt>
<dd>
<p>realized deviation from alphaStrat for each route.</p>
</dd>
<dt><code>epsYear</code></dt>
<dd>
<p>realized deviation from alphaStrat for each year.</p>
</dd>
<dt><code>beta</code></dt>
<dd>
<p>linear year effect.</p>
</dd>
<dt><code>sdRoute</code></dt>
<dd>
<p>standard deviation of random route-level variation.</p>
</dd>
<dt><code>sdYear</code></dt>
<dd>
<p>standard deviation of random year-level variation.</p>
</dd>
<dt><code>expectedCount</code></dt>
<dd>
<p>nRoutes by nYears matrix containing
deterministic expected counts.</p>
</dd>
<dt><code>C</code></dt>
<dd>
<p>nRoutes by nYears matrix containing observed counts.</p>
</dd>
</dl>
<h3>References</h3>

<p>Cohen, E. B., J. A. Hostetler, M. T. Hallworth, C. S. Rushing, T. S. Sillett,
and P. P. Marra. 2018. Quantifying the strength of migratory connectivity.
Methods in Ecology and Evolution 9: 513-524.
<a href="https://doi.org/10.1111/2041-210X.12916">doi:10.1111/2041-210X.12916</a>
</p>
<p>Link, W. A., J. R. Sauer, and D. K. Niven. 2020. Model selection for the
North American Breeding Bird Survey. Ecological Applications 30: e02137.
<a href="https://doi.org/10.1002/eap.2137">doi:10.1002/eap.2137</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(150)

### Set parameters for simulation ----

# Number of populations
nStrata. &lt;- 4
# Number of routes w/i each population (assumed to be balanced)
routePerStrat. &lt;- 30 # reduced from 90 for example speed
# Number of years
nYears. &lt;- 5 # reduced from 10 for example speed
# log(Expected number of birds counted at each route)
alphaStrat. &lt;- 1.95
# standard deviation of normal distribution assumed for route/observer random
# effects
sdRoute. &lt;- 0.6
# standard deviation of normal distribution assumed for year random effects
sdYear. &lt;- 0.18


# Number of simulated datasets to create and model
nsims &lt;- 50 # reduced from 100 for example speed
# Number of MCMC iterations
ni. &lt;- 1000 # reduced from 15000 for example speed
# Number of iterations to thin from posterior (reduced from 5)
nt. &lt;- 1
# Number of iterations to discard as burn-in
nb. &lt;- 500 # reduced from 5000 for example speed
# Number of MCMC chains
nc. &lt;- 1 # reduced from 3 for example speed

### Create empty matrix to store model output ---
sim_in &lt;- vector("list", nsims)
sim_out &lt;- vector("list", nsims)


# Simulation ---

system.time(for(s in 1:nsims){
  cat("Simulation",s,"of",nsims,"\n")

  # Simulate data
  sim_data &lt;- simCountData(nStrata = nStrata., routesPerStrata = routePerStrat.,
                           nYears = nYears., alphaStrat = alphaStrat.,
                           sdRoute = sdRoute., sdYear = sdYear.)
  sim_in[[s]] &lt;- sim_data


  # Estimate population-level abundance
  out_mcmc &lt;- modelCountDataJAGS(count_data = sim_data, ni = ni., nt = nt.,
                                 nb = nb., nc = nc.)

  # Store model output
  sim_out[[s]] &lt;- out_mcmc
  remove(out_mcmc)

})


### Check that relative abundance is, on average, equal for each population
prop.table(sapply(sim_in, function(x) return(rowsum(colSums(x$C), x$strat))), 2)

rel_names &lt;- paste0('relN[', 1:nStrata., ']')
rel_abund1 &lt;- data.frame(sim=1:nsims,
                         ra1.mean=NA, ra2.mean=NA, ra3.mean=NA, ra4.mean=NA,
                         ra1.low=NA, ra2.low=NA, ra3.low=NA, ra4.low=NA,
                         ra1.high=NA, ra2.high=NA, ra3.high=NA, ra4.high=NA,
                         ra1.cover=0, ra2.cover=0, ra3.cover=0, ra4.cover=0)
for (s in 1:nsims) {
  rel_abund1[s, 2:5] &lt;- summary(sim_out[[s]])$statistics[rel_names, "Mean"]
  rel_abund1[s, 6:9] &lt;- summary(sim_out[[s]])$quantiles[rel_names, 1]
  rel_abund1[s, 10:13] &lt;- summary(sim_out[[s]])$quantiles[rel_names, 5]
}
rel_abund1 &lt;- transform(rel_abund1,
                        ra1.cover = (ra1.low&lt;=0.25 &amp; ra1.high&gt;=0.25),
                        ra2.cover = (ra2.low&lt;=0.25 &amp; ra2.high&gt;=0.25),
                        ra3.cover = (ra3.low&lt;=0.25 &amp; ra3.high&gt;=0.25),
                        ra4.cover = (ra4.low&lt;=0.25 &amp; ra4.high&gt;=0.25))

summary(rel_abund1)


</code></pre>


</div>