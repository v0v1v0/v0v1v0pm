<div class="container">

<table style="width: 100%;"><tr>
<td>simMove</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulates position of birds by individual, season, year, and month.</h2>

<h3>Description</h3>

<p>Incorporates migratory connectivity, movement within season, and dispersal
between seasons. Does not incorporate births or deaths.
</p>


<h3>Usage</h3>

<pre><code class="language-R">simMove(
  breedingAbund,
  breedingDist,
  winteringDist,
  psi,
  nYears = 10,
  nMonths = 3,
  winMoveRate = 0,
  sumMoveRate = 0,
  winDispRate = 0,
  sumDispRate = 0,
  natalDispRate = 0,
  breedDispRate = 0,
  verbose = 0
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>breedingAbund</code></td>
<td>
<p>Vector with number of birds to simulate starting at
each breeding site.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breedingDist</code></td>
<td>
<p>Distances between the breeding sites. Symmetric matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>winteringDist</code></td>
<td>
<p>Distances between the wintering sites. Symmetric
matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>psi</code></td>
<td>
<p>Transition probabilities between B origin and W target sites.
A matrix with B rows and W columns where rows sum to 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nYears</code></td>
<td>
<p>Number of years to simulate movement.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nMonths</code></td>
<td>
<p>Number of months per breeding and wintering season.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>winMoveRate</code></td>
<td>
<p>Within winter movement rate.  Defaults to 0 (no
movement).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sumMoveRate</code></td>
<td>
<p>Within summer movement rate.  Defaults to 0 (no
movement).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>winDispRate</code></td>
<td>
<p>Between winter dispersal rate.  Defaults to 0 (no
dispersal).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sumDispRate</code></td>
<td>
<p>Between summer dispersal rate.  Defaults to 0 (no
dispersal).  Setting this to a value above 0 is equivalent to setting
both natal and breeding dispersal to that same value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>natalDispRate</code></td>
<td>
<p>Natal dispersal rate. Controls the movement of
animals from their birthplace on their first return to the breeding
grounds.  Defaults to 0 (return to the birthplace for all).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breedDispRate</code></td>
<td>
<p>Breeding dispersal rate. Controls the movement of
animals between breeding sites on spring migrations after the first.
Defaults to 0 (return to the same breeding site each year).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>If set to a value &gt; 0, informs the user on the passage
of years and seasons during the simulation. Defaults to 0 (no output
during simulation).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>simMove</code> returns a list with elements:
</p>

<dl>
<dt><code>animalLoc</code></dt>
<dd>
<p><code>sum(breedingAbund)</code> (number of animals)
by 2 by <code>nYears</code> by <code>nMonths</code> array with the simulated
locations of each animal in each month of each season (summer or
winter) of each year.  Values of cells are 1...B (first column) and
1...W (second column) where B is the number of breeding sites and W is
the number of wintering sites.</p>
</dd>
<dt><code>breedDispMat</code></dt>
<dd>
<p>B by B matrix of probabilities of breeding
dispersal between each pair of 1...B breeding sites.  Direction is from
row to column, so each row sums to 1.</p>
</dd>
<dt><code>natalDispMat</code></dt>
<dd>
<p>B by B matrix of probabilities of natal
dispersal between each pair of 1...B breeding sites.  Direction is from
row to column, so each row sums to 1.</p>
</dd>
<dt><code>sumMoveMat</code></dt>
<dd>
<p>B by B matrix of probabilities of within season
movement between each pair of 1...B breeding sites.  Direction is from
row to column, so each row sums to 1.</p>
</dd>
<dt><code>winDispMat</code></dt>
<dd>
<p>W by W matrix of probabilities of dispersal
between each pair of 1...W nonbreeding sites.  Direction is from
row to column, so each row sums to 1.</p>
</dd>
<dt><code>winMoveMat</code></dt>
<dd>
<p>W by W matrix of probabilities of within season
movement between each pair of 1...W nonbreeding sites.  Direction is
from row to column, so each row sums to 1.</p>
</dd>
</dl>
<h3>References</h3>

<p>Cohen, E. B., J. A. Hostetler, M. T. Hallworth, C. S. Rushing, T. S. Sillett,
and P. P. Marra. 2018. Quantifying the strength of migratory connectivity.
Methods in Ecology and Evolution 9: 513-524.
<a href="https://doi.org/10.1111/2041-210X.12916">doi:10.1111/2041-210X.12916</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">### Dispersal simulation ----
## Utility functions for use in simulations

# Simple approach to estimate psi matrix and MC from simulated (or real) data
# (doesn't include uncertainty).  Only uses one year for computation
calcPsiMC &lt;- function(originDist, targetDist, originRelAbund, locations,
                      years = 1, months = 1, verbose=FALSE) {
  nOrigin &lt;- nrow(originDist)
  nTarget &lt;- nrow(targetDist)
  psiMat &lt;- matrix(0, nOrigin, nTarget)
  nInd &lt;- dim(locations)[1]
  nYears &lt;- dim(locations)[3]
  nMonths &lt;- dim(locations)[4]
  for (i in 1:nInd) {
    if (i %% 1000 == 0 &amp;&amp; verbose) #
      cat("Individual", i, "of", nInd, "\n")
    originMat &lt;- locations[i, 1, years, months]
    targetMat &lt;- locations[i, 2, years, months]
    bIndices &lt;- which(!is.na(originMat))
    wIndices &lt;- which(!is.na(targetMat))
    if (length(bIndices) &amp;&amp; length(wIndices))
      for (bi in bIndices)
        for (wi in wIndices)
          psiMat[originMat[bi], targetMat[wi]] &lt;- psiMat[originMat[bi], targetMat[wi]] + 1
  }
  psiMat &lt;- apply(psiMat, 2, "/", rowSums(psiMat))
  MC &lt;- calcMC(originDist, targetDist, psi = psiMat,
               originRelAbund = originRelAbund, sampleSize = nInd)
  return(list(psi=psiMat, MC=MC))
}

## Simulation
originNames &lt;- c("A", "B", "C")
nBreeding &lt;- length(originNames) # Number of sites reduced for example speed
targetNames &lt;- as.character(1:4)
nWintering &lt;- length(targetNames)

psi &lt;- matrix(c(0.5, 0.25, 0.15, 0.1,
                0.15, 0.4, 0.25, 0.2,
                0.1, 0.15, 0.2, 0.55), nBreeding, nWintering,
              TRUE, list(originNames, targetNames))
psi
breedingPos &lt;- matrix(c(seq(-99, -93, 3),
                        rep(40, nBreeding)), nBreeding, 2)
winteringPos &lt;- matrix(c(seq(-88, -82, 2),
                         rep(0, nWintering)), nWintering, 2)
breedingPos
winteringPos

breedDist &lt;- distFromPos(breedingPos, 'ellipsoid')
nonbreedDist &lt;- distFromPos(winteringPos, 'ellipsoid')

# Breeding Abundance
breedingN &lt;- rep(50, nBreeding) # Reduced from 5000 for example speed
breedingRelN &lt;- breedingN/sum(breedingN)


# Baseline strength of migratory connectivity

  MC &lt;- calcMC(breedDist, nonbreedDist, breedingRelN, psi, sum(breedingN))
  round(MC, 4)

# Other basic simulation parameters

## Dispersal simulations---
set.seed(1516)
nYears &lt;- 4 # Reduced from 15 for example speed
nMonths &lt;- 2 # Each season, reduced from 4 for example speed
Drates &lt;- c(0.04, 0.16) # Rates of dispersal, fewer for example speed


  birdLocDisp &lt;- vector('list', length(Drates))
  Disp.df  &lt;- data.frame(Year=rep(1:nYears, length(Drates)),
                         Rate=rep(Drates, each = nYears), MC = NA)
  for(i in 1:length(Drates)){
    cat('Dispersal Rate', Drates[i], '\n')
    birdLocDisp[[i]] &lt;- simMove(breedingN, breedDist, nonbreedDist, psi, nYears,
                                nMonths, sumDispRate = Drates[i])
    for(j in 1:nYears){
      cat('\tYear', j, '\n')
      temp.results &lt;- calcPsiMC(breedDist, nonbreedDist, breedingRelN,
                                   birdLocDisp[[i]]$animalLoc, years = j)
      Disp.df$MC[j + (i - 1) * nYears] &lt;- temp.results$MC
    }
  } # end i loop

  Disp.df$Year &lt;- Disp.df$Year - 1 #just run once!
  data.frame(Disp.df, roundMC = round(Disp.df$MC, 2),
             nearZero = Disp.df$MC &lt; 0.01)

  # Convert dispersal rates to probabilities of dispersing at least certain
  # distance
  threshold &lt;- 1000
  probFarDisp &lt;- matrix(NA, nBreeding, length(Drates),
                        dimnames = list(NULL, Drates))
  for (i in 1:length(Drates)) {
    for (k in 1:nBreeding) {
      probFarDisp[k, i] &lt;- sum(
        birdLocDisp[[i]]$natalDispMat[k, which(breedDist[k, ]&gt;= threshold)])
    }
  }
  summary(probFarDisp)

  #plot results
  with(subset(Disp.df, Rate == 0.04),
       plot(Year, MC, "l", col = "blue", ylim = c(0, 0.3), lwd = 2))
  lines(Disp.df$Year[Disp.df$Rate==0.16], Disp.df$MC[Disp.df$Rate==0.16],
        col = "darkblue", lwd = 2)
  legend("bottomleft", legend = Drates, col = c("blue", "darkblue"), lty = 1,
         lwd = 2)


</code></pre>


</div>