<div class="container">

<table style="width: 100%;"><tr>
<td>detect_segments</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>detect_segments</h2>

<h3>Description</h3>

<p>A three step algorithm to identify segments of continuous presence within trace data
</p>


<h3>Usage</h3>

<pre><code class="language-R">detect_segments(
  locs,
  times,
  param_min_days = 2,
  param_prop_days = 0.05,
  param_window_size_days = 20,
  param_ol_min_frac = 1,
  return_intermediate_results = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>locs</code></td>
<td>
<p>(character). A vector containing locations corresponding to <code>times </code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>times</code></td>
<td>
<p>(POSIXct). A vector containing timestamps corresponding to <code>locs</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param_min_days</code></td>
<td>
<p>(Optional) numeric. The minimum length in days of a segment. Smaller segments will be eliminated during stage 1. Default is <code>2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param_prop_days</code></td>
<td>
<p>(Optional) numeric. The minimum fraction of days in a segment during which a user must have been observed at a location. Segments with a smaller proportion will be eliminated. Default is <code>0.05</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param_window_size_days</code></td>
<td>
<p>(Optional) numeric. The minimum forward window size in days for step 1. Observations separated by a smaller timespan will be connected. Default is <code>20</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param_ol_min_frac</code></td>
<td>
<p>(Optional) numeric. In step 3, do not remove the overlapped segment if the place it belongs to is the mode during the period of overlap and if the place contains more than this fraction of all occurrences. Default is 1 meaning that no segments can persist at overlaps.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_intermediate_results</code></td>
<td>
<p>(Optional) logical. Should the results of Step 1 and 2 be returned as well? If <code>TRUE</code> the result will be a list of length 3. Default is <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>


<p>The first step in detecting migration requires detecting periods of time when
an individual is continuously present in a single location,
allowing for some margin of travel from that location (Chi et al., 2020).
</p>
<p>These segments are identified from the time series of <code>locs</code> and <code>times</code> in a
three-step procedure:
</p>
<ul>
<li>
<p>Step 1: <strong>Identify</strong> contiguous segments, with no gap exceeding <code>param_window_size_days days</code>,
where the individual is present for at least <code>param_prop_days</code> percent of days in the segment,
and the total length of the segment is at least <code>param_min_days</code>,
</p>
</li>
<li>
<p>Step 2: <strong>Merge</strong> segments if there are no segments in other locations between them.,
</p>
</li>
<li>
<p>Step 3: <strong>Prune</strong> overlapping time from segments,
when an individual is associated with segments in multiple locations at a single point in time.
overlapping segments may be allowed to persist if they
contain at least <code>param_ol_min_frac</code> of all observations during the overlap period.</p>
</li>
</ul>
<h3>Value</h3>

<p>A tibble containing the detected segments as interval with their location as Character.
</p>


<h3>Author(s)</h3>

<p>Johannes Mast <a href="mailto:Johannes.Mast@dlr.de">Johannes.Mast@dlr.de</a>, based on the algorithm by Guanghua Chi <a href="mailto:guanghua@berkeley.edu">guanghua@berkeley.edu</a>
</p>


<h3>References</h3>

<p>Chi, Guanghua, Fengyang Lin, Guangqing Chi, and Joshua Blumenstock. 2020. “A General Approach to Detecting Migration Events in Digital Trace Data.” Edited by Song Gao. PLOS ONE 15 (10): e0239408. https://doi.org/10.1371/journal.pone.0239408.
</p>


<h3>Examples</h3>

<pre><code class="language-R">trace &lt;- MigrationDetectR::example_trace

# Detect segments
segments &lt;-
  detect_segments(
      locs = trace$location,
      times = trace$timestamp,
      param_min_days = 3,
      param_prop_days = 0.06,
      param_window_size_days = 7,
      param_ol_min_frac= 0.5)
 nrow(segments) # check the number of detected segments
 head(segments) # check the segments
</code></pre>


</div>