<div class="container">

<table style="width: 100%;"><tr>
<td>upset_pq</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Make upset plot for phyloseq object.</h2>

<h3>Description</h3>


<a href="https://adrientaudiere.github.io/MiscMetabar/articles/Rules.html#lifecycle">
<img src="https://img.shields.io/badge/lifecycle-experimental-orange" alt="lifecycle-experimental"></a>

<p>Alternative to venn plot.
</p>


<h3>Usage</h3>

<pre><code class="language-R">upset_pq(
  physeq,
  fact,
  taxa_fill = NULL,
  min_nb_seq = 0,
  na_remove = TRUE,
  numeric_fonction = sum,
  rarefy_after_merging = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>physeq</code></td>
<td>
<p>(required): a <code>phyloseq-class</code> object obtained
using the <code>phyloseq</code> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fact</code></td>
<td>
<p>(required): Name of the factor to cluster samples by modalities.
Need to be in <code>physeq@sam_data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>taxa_fill</code></td>
<td>
<p>(default NULL) fill the ASV upset using a column in
<code>tax_table</code> slot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_nb_seq</code></td>
<td>
<p>minimum number of sequences by OTUs by
samples to take into count this OTUs in this sample. For example,
if min_nb_seq=2,each value of 2 or less in the OTU table
will not count in the venn diagram</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na_remove</code></td>
<td>
<p>: if TRUE (the default), NA values in fact are removed
if FALSE, NA values are set to "NA"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numeric_fonction</code></td>
<td>
<p>(default : sum) the function for numeric vector
useful only for complex plot (see examples)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rarefy_after_merging</code></td>
<td>
<p>Rarefy each sample after merging by the
modalities of <code>fact</code> parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments passed on to the <code>ComplexUpset::upset()</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <code>ggplot</code>2 plot
</p>


<h3>Author(s)</h3>

<p>Adrien Taudi√®re
</p>


<h3>See Also</h3>

<p><code>ggvenn_pq()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">if (requireNamespace("ComplexUpset")) {
  upset_pq(data_fungi_mini,
    fact = "Height", width_ratio = 0.2,
    taxa_fill = "Class"
  )
}

if (requireNamespace("ComplexUpset")) {
  upset_pq(data_fungi_mini, fact = "Height", min_nb_seq = 1000)
  upset_pq(data_fungi_mini, fact = "Height", na_remove = FALSE)

  upset_pq(data_fungi_mini, fact = "Time", width_ratio = 0.2, rarefy_after_merging = TRUE)

  upset_pq(
    data_fungi_mini,
    fact = "Time",
    width_ratio = 0.2,
    annotations = list(
      "Sequences per ASV \n (log10)" = (
        ggplot(mapping = aes(y = log10(Abundance)))
        +
          geom_jitter(aes(
            color =
              Abundance
          ), na.rm = TRUE)
          +
          geom_violin(alpha = 0.5, na.rm = TRUE) +
          theme(legend.key.size = unit(0.2, "cm")) +
          theme(axis.text = element_text(size = 12))
      ),
      "ASV per phylum" = (
        ggplot(mapping = aes(fill = Phylum))
        +
          geom_bar() +
          ylab("ASV per phylum") +
          theme(legend.key.size = unit(0.2, "cm")) +
          theme(axis.text = element_text(size = 12))
      )
    )
  )

  upset_pq(
    data_fungi_mini,
    fact = "Time",
    width_ratio = 0.2,
    numeric_fonction = mean,
    annotations = list(
      "Sequences per ASV \n (log10)" = (
        ggplot(mapping = aes(y = log10(Abundance)))
        +
          geom_jitter(aes(
            color =
              Abundance
          ), na.rm = TRUE)
          +
          geom_violin(alpha = 0.5, na.rm = TRUE) +
          theme(legend.key.size = unit(0.2, "cm")) +
          theme(axis.text = element_text(size = 12))
      ),
      "ASV per phylum" = (
        ggplot(mapping = aes(fill = Phylum))
        +
          geom_bar() +
          ylab("ASV per phylum") +
          theme(legend.key.size = unit(0.2, "cm")) +
          theme(axis.text = element_text(size = 12))
      )
    )
  )

  upset_pq(
    subset_taxa(data_fungi_mini, Phylum == "Basidiomycota"),
    fact = "Time",
    width_ratio = 0.2,
    base_annotations = list(),
    annotations = list(
      "Sequences per ASV \n (log10)" = (
        ggplot(mapping = aes(y = log10(Abundance)))
        +
          geom_jitter(aes(
            color =
              Abundance
          ), na.rm = TRUE)
          +
          geom_violin(alpha = 0.5, na.rm = TRUE) +
          theme(legend.key.size = unit(0.2, "cm")) +
          theme(axis.text = element_text(size = 12))
      ),
      "ASV per phylum" = (
        ggplot(mapping = aes(fill = Class))
        +
          geom_bar() +
          ylab("ASV per Class") +
          theme(legend.key.size = unit(0.2, "cm")) +
          theme(axis.text = element_text(size = 12))
      )
    )
  )

  data_fungi2 &lt;- data_fungi_mini
  data_fungi2@sam_data[["Time_0"]] &lt;- data_fungi2@sam_data$Time == 0
  data_fungi2@sam_data[["Height__Time_0"]] &lt;-
    paste0(data_fungi2@sam_data[["Height"]], "__", data_fungi2@sam_data[["Time_0"]])
  data_fungi2@sam_data[["Height__Time_0"]][grepl("NA", data_fungi2@sam_data[["Height__Time_0"]])] &lt;-
    NA
  upset_pq(data_fungi2, fact = "Height__Time_0", width_ratio = 0.2, min_size = 2)
}

</code></pre>


</div>