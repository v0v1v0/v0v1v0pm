<div class="container">

<table style="width: 100%;"><tr>
<td>formattable_pq</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a visualization table to describe taxa distribution across a modality</h2>

<h3>Description</h3>


<a href="https://adrientaudiere.github.io/MiscMetabar/articles/Rules.html#lifecycle">
<img src="https://img.shields.io/badge/lifecycle-maturing-blue" alt="lifecycle-maturing"></a>

<p>Allow to visualize a table with graphical input.
</p>


<h3>Usage</h3>

<pre><code class="language-R">formattable_pq(
  physeq,
  modality,
  taxonomic_levels = c("Phylum", "Order", "Family", "Genus"),
  min_nb_seq_taxa = 1000,
  log10trans = FALSE,
  void_style = FALSE,
  lev_col_taxa = "Phylum",
  arrange_by = "nb_seq",
  descending_order = TRUE,
  na_remove = TRUE,
  formattable_args = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>physeq</code></td>
<td>
<p>(required): a <code>phyloseq-class</code> object obtained
using the <code>phyloseq</code> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modality</code></td>
<td>
<p>(required) The name of a column present in the <code style="white-space: pre;">⁠@sam_data⁠</code> slot
of the physeq object. Must be a character vector or a factor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>taxonomic_levels</code></td>
<td>
<p>(default = c("Phylum", "Order", "Family", "Genus"))
The taxonomic levels (must be present in the <code style="white-space: pre;">⁠@sam_data⁠</code> slot) you want to
see and/or used (for example to compute a color) in the table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_nb_seq_taxa</code></td>
<td>
<p>(default = 1000) filter out taxa with less than <code>min_nb_seq_taxa</code>
sequences</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log10trans</code></td>
<td>
<p>(logical, default TRUE) Do sequences count is log10 transformed
(using log10(x + 1) to allow 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>void_style</code></td>
<td>
<p>(logical, default FALSE) Do the default style is discard ?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lev_col_taxa</code></td>
<td>
<p>Taxonomic level used to plot the background color of taxa names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>arrange_by</code></td>
<td>
<p>The column used to sort the table.
Can take the values NULL, "proportion_samp", "nb_seq" (default), , "nb_sam" "OTU", or a column names
from the levels of modality or from taxonomic levels</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>descending_order</code></td>
<td>
<p>(logical, default TRUE) Do we use descending order when sort the table
(if arrange_by is not NULL) ?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na_remove</code></td>
<td>
<p>(logical, default TRUE) if TRUE remove all the samples
with NA in the <code>split_by</code> variable of the <code>physeq@sam_data</code> slot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formattable_args</code></td>
<td>
<p>Other args to the formattable function. See examples and <code>formattable::formattable()</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is mainly a wrapper of the work of others.
Please make a reference to <code>formattable::formattable()</code> if you
use this function.
</p>


<h3>Value</h3>

<p>A datatable
</p>


<h3>Author(s)</h3>

<p>Adrien Taudière
</p>


<h3>See Also</h3>

<p><code>formattable::formattable()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">if (requireNamespace("formattable")) {
  ## Distribution of the nb of sequences per OTU across Height
  ##   modality (nb of sequences are log-transformed).
  ## Only OTU with more than 10000 sequences are taking into account
  ## The Phylum column is discarded
  formattable_pq(
    data_fungi,
    "Height",
    min_nb_seq_taxa = 10000,
    formattable_args = list("Phylum" = FALSE),
    log10trans = TRUE
  )

  ## Distribution of the nb of samples per OTU across Height modality
  ## Only OTU  present in more than 50 samples are taking into account
  formattable_pq(
    as_binary_otu_table(data_fungi),
    "Height",
    min_nb_seq_taxa = 50,
    formattable_args = list("nb_seq" = FALSE),
  )

  ## Distribution of the nb of sequences per OTU across Time modality
  ##  arranged by Family Name in ascending order.
  ## Only OTU with more than 10000 sequences are taking into account
  ## The Phylum column is discarded
  formattable_pq(
    data_fungi,
    "Time",
    min_nb_seq_taxa = 10000,
    taxonomic_levels = c("Order", "Family", "Genus", "Species"),
    formattable_args = list(
      Order = FALSE,
      Species = formattable::formatter(
        "span",
        style = x ~ formattable::style(
          "font-style" = "italic",
          `color` = ifelse(is.na(x), "white", "grey")
        )
      )
    ),
    arrange_by = "Family",
    descending_order = FALSE
  )
}

if (requireNamespace("formattable")) {
  ## Distribution of the nb of sequences per OTU across Height modality
  ##  (nb of sequences are log-transformed).
  ## OTU name background is light gray for Basidiomycota
  ##  and dark grey otherwise (Ascomycota)
  ## A different color is defined for each modality level
  formattable_pq(
    data_fungi,
    "Height",
    taxonomic_levels = c("Phylum", "Family", "Genus"),
    void_style = TRUE,
    formattable_args = list(
      OTU = formattable::formatter(
        "span",
        style = ~ formattable::style(
          "display" = "block",
          `border-radius` = "5px",
          `background-color` = ifelse(Phylum == "Basidiomycota", transp("gray"), "gray")
        ),
        `padding-right` = "2px"
      ),
      High = formattable::formatter(
        "span",
        style = x ~ formattable::style(
          "font-size" = "80%",
          "display" = "inline-block",
          direction = "rtl",
          `border-radius` = "0px",
          `padding-right` = "2px",
          `background-color` = formattable::csscolor(formattable::gradient(
            as.numeric(x), transp("#1a91ff"), "#1a91ff"
          )),
          width = formattable::percent(formattable::proportion(as.numeric(x), na.rm = TRUE))
        )
      ),
      Low = formattable::formatter(
        "span",
        style = x ~ formattable::style(
          "font-size" = "80%",
          "display" = "inline-block",
          direction = "rtl",
          `border-radius` = "0px",
          `padding-right` = "2px",
          `background-color` = formattable::csscolor(formattable::gradient(
            as.numeric(x),
            transp("green"), "green"
          )),
          width = formattable::percent(formattable::proportion(as.numeric(x), na.rm = TRUE))
        )
      ),
      Middle = formattable::formatter(
        "span",
        style = x ~ formattable::style(
          "font-size" = "80%",
          "display" = "inline-block",
          direction = "rtl",
          `border-radius` = "0px",
          `padding-right` = "2px",
          `background-color` = formattable::csscolor(formattable::gradient(
            as.numeric(x), transp("orange"), "orange"
          )),
          width = formattable::percent(formattable::proportion(as.numeric(x), na.rm = TRUE))
        )
      )
    )
  )
}

</code></pre>


</div>