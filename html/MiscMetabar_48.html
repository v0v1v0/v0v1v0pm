<div class="container">

<table style="width: 100%;"><tr>
<td>ggaluv_pq</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Alluvial plot for taxonomy and samples factor vizualisation</h2>

<h3>Description</h3>


<a href="https://adrientaudiere.github.io/MiscMetabar/articles/Rules.html#lifecycle">
<img src="https://img.shields.io/badge/lifecycle-experimental-orange" alt="lifecycle-experimental"></a>

<p>Basically a wrapper of <a href="https://corybrunson.github.io/ggalluvial/index.html">ggalluvial</a>
package
</p>


<h3>Usage</h3>

<pre><code class="language-R">ggaluv_pq(
  physeq,
  taxa_ranks = c("Phylum", "Class", "Order", "Family"),
  wrap_factor = NULL,
  by_sample = FALSE,
  rarefy_by_sample = FALSE,
  fact = NULL,
  type = "nb_seq",
  width = 1.2,
  min.size = 3,
  na_remove = FALSE,
  use_ggfittext = FALSE,
  use_geom_label = FALSE,
  size_lab = 2,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>physeq</code></td>
<td>
<p>(required): a <code>phyloseq-class</code> object obtained
using the <code>phyloseq</code> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>taxa_ranks</code></td>
<td>
<p>A vector of taxonomic ranks. For examples c("Family","Genus").
If taxa ranks is not set
(default value = c("Phylum", "Class", "Order", "Family")).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wrap_factor</code></td>
<td>
<p>A name to determine
which samples to merge using <code>merge_samples2()</code> function.
Need to be in <code>physeq@sam_data</code>.
Need to be use when you want to wrap by factor the final plot
with the number of taxa (type="nb_taxa")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by_sample</code></td>
<td>
<p>(logical) If FALSE (default), sample information is not taking
into account, so the taxonomy is studied globally. If fact is not NULL, by_sample
is automatically set to TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rarefy_by_sample</code></td>
<td>
<p>(logical, default FALSE) If TRUE, rarefy
samples using <code>phyloseq::rarefy_even_depth()</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fact</code></td>
<td>
<p>(required) Name of the factor in <code>physeq@sam_data</code> used to plot  the last column</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>If "nb_seq" (default), the number of sequences is
used in plot. If "nb_taxa", the number of ASV is plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>width</code></td>
<td>
<p>(passed on to <code>ggalluvial::geom_flow()</code>) the width of each stratum,
as a proportion of the distance between axes. Defaults to 1/3.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.size</code></td>
<td>
<p>(passed on to <code>ggfittext::geom_fit_text()</code>) Minimum font size,
in points. Text that would need to be shrunk below this size to fit the box will
be hidden. Defaults to 4 pt.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na_remove</code></td>
<td>
<p>(logical, default FALSE) If set to TRUE, remove samples with
NA in the variables set in formula.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_ggfittext</code></td>
<td>
<p>(logical, default FALSE) Do we use ggfittext to plot labels?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_geom_label</code></td>
<td>
<p>(logical, default FALSE) Do we use geom_label to plot labels?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>size_lab</code></td>
<td>
<p>Size for label if use_ggfittext is FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments passed on to <code>ggalluvial::geom_flow()</code> function.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is mainly a wrapper of the work of others.
Please make a reference to <code>ggalluvial</code> package if you
use this function.
</p>


<h3>Value</h3>

<p>A ggplot object
</p>


<h3>Author(s)</h3>

<p>Adrien Taudi√®re
</p>


<h3>See Also</h3>

<p><code>sankey_pq()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">if (requireNamespace("ggalluvial")) {
  ggaluv_pq(data_fungi_mini)
}

if (requireNamespace("ggalluvial")) {
  ggaluv_pq(data_fungi_mini, type = "nb_taxa")

  ggaluv_pq(data_fungi_mini, wrap_factor = "Height", by_sample = TRUE, type = "nb_taxa") +
    facet_wrap("Height")

  ggaluv_pq(data_fungi_mini,
    width = 0.9, min.size = 10,
    type = "nb_taxa", taxa_ranks = c("Phylum", "Class", "Order", "Family", "Genus")
  ) +
    coord_flip() + scale_x_discrete(limits = rev)
}

</code></pre>


</div>