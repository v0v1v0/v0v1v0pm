<div class="container">

<table style="width: 100%;"><tr>
<td>ggvenn_pq</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Venn diagram of <code>phyloseq-class</code> object using
<code>ggVennDiagram::ggVennDiagram</code> function</h2>

<h3>Description</h3>


<a href="https://adrientaudiere.github.io/MiscMetabar/articles/Rules.html#lifecycle">
<img src="https://img.shields.io/badge/lifecycle-maturing-blue" alt="lifecycle-maturing"></a>

<p>Note that you can use ggplot2 function to customize the plot
for ex. <code>+ scale_fill_distiller(palette = "BuPu", direction = 1)</code>
and <code>+ scale_x_continuous(expand = expansion(mult = 0.5))</code>. See
examples.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ggvenn_pq(
  physeq = NULL,
  fact = NULL,
  min_nb_seq = 0,
  taxonomic_rank = NULL,
  split_by = NULL,
  add_nb_samples = TRUE,
  add_nb_seq = FALSE,
  rarefy_before_merging = FALSE,
  rarefy_after_merging = FALSE,
  return_data_for_venn = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>physeq</code></td>
<td>
<p>(required): a <code>phyloseq-class</code> object obtained
using the <code>phyloseq</code> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fact</code></td>
<td>
<p>(required): Name of the factor to cluster samples by modalities.
Need to be in <code>physeq@sam_data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_nb_seq</code></td>
<td>
<p>minimum number of sequences by OTUs by
samples to take into count this OTUs in this sample. For example,
if min_nb_seq=2,each value of 2 or less in the OTU table
will not count in the venn diagram</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>taxonomic_rank</code></td>
<td>
<p>Name (or number) of a taxonomic rank
to count. If set to Null (the default) the number of OTUs is counted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>split_by</code></td>
<td>
<p>Split into multiple plot using variable split_by.
The name of a variable must be present in <code>sam_data</code> slot
of the physeq object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_nb_samples</code></td>
<td>
<p>(logical, default TRUE) Add the number of samples to
levels names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_nb_seq</code></td>
<td>
<p>(logical, default FALSE) Add the number of sequences to
levels names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rarefy_before_merging</code></td>
<td>
<p>Rarefy each sample before merging by the
modalities of args <code>fact</code>. Use <code>phyloseq::rarefy_even_depth()</code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rarefy_after_merging</code></td>
<td>
<p>Rarefy each sample after merging by the
modalities of args <code>fact</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_data_for_venn</code></td>
<td>
<p>(logical, default FALSE) If TRUE, the plot is
not returned, but the resulting dataframe to plot with ggVennDiagram package
is returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments for the <code>ggVennDiagram::ggVennDiagram</code> function
for ex. <code>category.names</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <code>ggplot</code>2 plot representing Venn diagram of
modalities of the argument <code>factor</code> or if split_by is set a list
of plots.
</p>


<h3>Author(s)</h3>

<p>Adrien Taudi√®re
</p>


<h3>See Also</h3>

<p><code>upset_pq()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">if (requireNamespace("ggVennDiagram")) {
  ggvenn_pq(data_fungi, fact = "Height")
}

if (requireNamespace("ggVennDiagram")) {
  ggvenn_pq(data_fungi, fact = "Height") +
    ggplot2::scale_fill_distiller(palette = "BuPu", direction = 1)
  pl &lt;- ggvenn_pq(data_fungi, fact = "Height", split_by = "Time")
  for (i in seq_along(pl)) {
    p &lt;- pl[[i]] +
      scale_fill_distiller(palette = "BuPu", direction = 1) +
      theme(plot.title = element_text(hjust = 0.5, size = 22))
    print(p)
  }

  data_fungi2 &lt;- subset_samples(data_fungi, data_fungi@sam_data$Tree_name == "A10-005" |
    data_fungi@sam_data$Height %in% c("Low", "High"))
  ggvenn_pq(data_fungi2, fact = "Height")

  ggvenn_pq(data_fungi, fact = "Height", add_nb_seq = TRUE, set_size = 4)
  ggvenn_pq(data_fungi, fact = "Height", rarefy_before_merging = TRUE)
  ggvenn_pq(data_fungi, fact = "Height", rarefy_after_merging = TRUE) +
    scale_x_continuous(expand = expansion(mult = 0.5))

  # For more flexibility, you can save the dataset for more precise construction
  # with ggplot2 and ggVennDiagramm
  # (https://gaospecial.github.io/ggVennDiagram/articles/fully-customed.html)
  res_venn &lt;- ggvenn_pq(data_fungi, fact = "Height", return_data_for_venn = TRUE)

  ggplot() +
    # 1. region count layer
    geom_polygon(aes(X, Y, group = id, fill = name),
      data = ggVennDiagram::venn_regionedge(res_venn)
    ) +
    # 2. set edge layer
    geom_path(aes(X, Y, color = id, group = id),
      data = ggVennDiagram::venn_setedge(res_venn),
      show.legend = FALSE, linewidth = 3
    ) +
    # 3. set label layer
    geom_text(aes(X, Y, label = name),
      data = ggVennDiagram::venn_setlabel(res_venn)
    ) +
    # 4. region label layer
    geom_label(
      aes(X, Y, label = paste0(
        count, " (",
        scales::percent(count / sum(count), accuracy = 2), ")"
      )),
      data = ggVennDiagram::venn_regionlabel(res_venn)
    ) +
    theme_void()
}

</code></pre>


</div>