<div class="container">

<table style="width: 100%;"><tr>
<td>hill_pq</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Graphical representation of hill number 0, 1 and 2 across a factor</h2>

<h3>Description</h3>


<a href="https://adrientaudiere.github.io/MiscMetabar/articles/Rules.html#lifecycle">
<img src="https://img.shields.io/badge/lifecycle-experimental-orange" alt="lifecycle-experimental"></a>

<p>Hill numbers are the number of equiprobable species giving the same
diversity value as the observed distribution. The Hill number 0
correspond to Species richness), the Hill number 1 to
the exponential of Shannon Index and the Hill number 2 to the inverse
of Simpson Index)
</p>
<p>Note that (if correction_for_sample_size is TRUE, default behavior)
this function use a sqrt of the read numbers in the linear
model in order to correct for uneven sampling depth. This correction
is only done before tuckey HSD plot and do not change the hill number
computed.
</p>


<h3>Usage</h3>

<pre><code class="language-R">hill_pq(
  physeq,
  fact = NULL,
  variable = NULL,
  hill_scales = c(0, 1, 2),
  color_fac = NA,
  letters = FALSE,
  add_points = FALSE,
  add_info = TRUE,
  kruskal_test = TRUE,
  one_plot = FALSE,
  plot_with_tuckey = TRUE,
  correction_for_sample_size = TRUE,
  na_remove = TRUE,
  vioplot = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>physeq</code></td>
<td>
<p>(required): a <code>phyloseq-class</code> object obtained
using the <code>phyloseq</code> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fact</code></td>
<td>
<p>(required): The variable to test. Must be present in
the <code>sam_data</code> slot of the physeq object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variable</code></td>
<td>
<p>: Alias for factor. Kept only for backward compatibility.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hill_scales</code></td>
<td>
<p>(a vector of integer) The list of q values to compute
the hill number H^q. If Null, no hill number are computed. Default value
compute the Hill number 0 (Species richness), the Hill number 1
(exponential of Shannon Index) and the Hill number 2 (inverse of Simpson
Index).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color_fac</code></td>
<td>
<p>(optional): The variable to color the barplot. For ex.
same as fact. Not very useful because ggplot2 plot colors can be
change using <code>scale_color_XXX()</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>letters</code></td>
<td>
<p>(optional, default FALSE): If set to TRUE, the plot
show letters based on p-values for comparison. Use the
<code>multcompLetters</code> function from the package
multcompLetters. BROKEN for the moment. Note that na values in The
variable param need to be removed (see examples) to use letters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_points</code></td>
<td>
<p>(logical, default FALSE): add jitter point on boxplot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_info</code></td>
<td>
<p>(logical, default TRUE) Do we add a subtitle with
information about the number of samples per modality ?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kruskal_test</code></td>
<td>
<p>(logical, default TRUE) Do we test for global effect of
our factor on each hill scales values? When kruskal_test is TRUE, the
resulting test value are add in each plot in subtitle (unless add_info is
FALSE). Moreover, if at
least one hill scales is not significantly link to fact (pval&gt;0.05),
a message is prompt saying that Tuckey HSD plot is not informative for
those Hill scales and letters are not printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>one_plot</code></td>
<td>
<p>(logical, default FALSE) If TRUE, return a unique
plot with the four plot inside using the patchwork package.
Note that if letters and one_plot are both TRUE, tuckey HSD results
are discarded from the unique plot. In that case, use one_plot = FALSE
to see the tuckey HSD results in the fourth plot of the resulting list.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_with_tuckey</code></td>
<td>
<p>(logical, default TRUE). If one_plot is set to
TRUE and letters to FALSE, allow to discard the tuckey plot part with
plot_with_tuckey = FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>correction_for_sample_size</code></td>
<td>
<p>(logical, default TRUE) This function
use a sqrt of the read numbers in the linear model in order to
correct for uneven sampling depth in the Tuckey TEST. This params
do not change value of Hill number but only the test associated
values (including the pvalues). To rarefy samples, you may use the
function <code>phyloseq::rarefy_even_depth()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na_remove</code></td>
<td>
<p>(logical, default TRUE) Do we remove samples with NA in
the factor fact ? Note that na_remove is always TRUE when using
letters = TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vioplot</code></td>
<td>
<p>(logical, default FALSE) Do we plot violin plot instead of
boxplot ?</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Either an unique ggplot2 object (if one_plot is TRUE) or
a list of n+1 ggplot2 plot (with n the number of hill scale value).
For example, with the default scale value:
</p>

<ul>
<li>
<p> plot_Hill_0 : the boxplot of Hill number 0 (= species richness)
against the variable
</p>
</li>
<li>
<p> plot_Hill_1 : the boxplot of Hill number 1 (= Shannon index)
against the variable
</p>
</li>
<li>
<p> plot_Hill_2 : the boxplot of Hill number 2 (= Simpson index)
against the variable
</p>
</li>
<li>
<p> plot_tuckey : plot the result of the Tuckey HSD test
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Adrien Taudi√®re
</p>


<h3>See Also</h3>

<p><code>psmelt_samples_pq()</code> and <code>ggbetween_pq()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
p &lt;- hill_pq(data_fungi_mini, "Height", hill_scales = 1:2)
p_h1 &lt;- p[[1]] + theme(legend.position = "none")
p_h2 &lt;- p[[2]] + theme(legend.position = "none")
multiplot(plotlist = list(p_h1, p_h2, p[[3]]), cols = 4)

if (requireNamespace("multcompView")) {
  p2 &lt;- hill_pq(data_fungi, "Time",
    correction_for_sample_size = FALSE,
    letters = TRUE, add_points = TRUE,
    plot_with_tuckey = FALSE
  )
  if (requireNamespace("patchwork")) {
    patchwork::wrap_plots(p2, guides = "collect")
  }
  # Artificially modify data_fungi to force alpha-diversity effect
  data_fungi_modif &lt;- clean_pq(subset_samples_pq(data_fungi, !is.na(data_fungi@sam_data$Height)))
  data_fungi_modif@otu_table[data_fungi_modif@sam_data$Height == "High", ] &lt;-
    data_fungi_modif@otu_table[data_fungi_modif@sam_data$Height == "High", ] +
    sample(c(rep(0, ntaxa(data_fungi_modif) / 2), rep(100, ntaxa(data_fungi_modif) / 2)))
  p3 &lt;- hill_pq(data_fungi_modif, "Height",
    letters = TRUE, vioplot = TRUE,
    add_points = TRUE
  )
}

</code></pre>


</div>