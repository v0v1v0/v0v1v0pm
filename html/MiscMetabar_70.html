<div class="container">

<table style="width: 100%;"><tr>
<td>lulu</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Post Clustering Curation of Amplicon Data.</h2>

<h3>Description</h3>


<a href="https://adrientaudiere.github.io/MiscMetabar/articles/Rules.html#lifecycle">
<img src="https://img.shields.io/badge/lifecycle-stable-green" alt="lifecycle-stable"></a>

<p>The original function and documentation was written by Tobias Guldberg Frøslev
in the <a href="https://github.com/tobiasgf/lulu">lulu</a> package.
</p>
<p>This algorithm <code>lulu</code> consumes an OTU table and a matchlist, and
evaluates cooccurence of 'daughters' (potential analytical artefacts) and
their 'parents' (~= real biological species/OTUs). The algorithm requires an
OTU table (species/site matrix), and a match list. The OTU table can be
made with various r-packages (e.g. <code>DADA2</code>) or
external pipelines (<code>VSEARCH, USEARCH, QIIME</code>, etc.), and the
match-list can be made with external bioinformatic tools like
<code>VSEARCH, USEARCH, BLASTN</code> or another algorithm
for pair-wise sequence matching.
</p>


<h3>Usage</h3>

<pre><code class="language-R">lulu(
  otu_table,
  matchlist,
  minimum_ratio_type = "min",
  minimum_ratio = 1,
  minimum_match = 84,
  minimum_relative_cooccurence = 0.95,
  progress_bar = TRUE,
  log_conserved = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>otu_table</code></td>
<td>
<p>a data.frame with with an OTU table that has sites/samples as
columns and OTUs (unique OTU id's) as rows, and observations as read
counts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>matchlist</code></td>
<td>
<p>a data.frame containing three columns: (1) OTU id of
potential child, (2) OTU id of potential parent, (3) match - % identiti
between the sequences of the potential parent and potential child OTUs.
<strong>NB: The matchlist is the product of a mapping of OTU sequences against each other. This is
currently carried out by an external script in e.g. Blastn or VSEARCH, prior to running lulu!</strong></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minimum_ratio_type</code></td>
<td>
<p>sets whether a potential error must have lower
abundance than the parent in all samples <code>min</code> (default), or if an error
just needs to have lower abundance on average <code>avg</code>. Choosing lower
abundance on average over globally lower abundance will greatly increase
the number of designated errors. This option was introduced to make it
possible to account for non-sufficiently clustered intraspecific variation,
but is not generally recommended, as it will also increase the potential of
cluster well-separated, but co-occuring, sequence similar species.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minimum_ratio</code></td>
<td>
<p>sets the minimim abundance ratio between a potential error
and a potential parent to be identified as an error. If the <code>minimum_ratio_type</code> is
set to <code>min</code> (default), the <code>minimum_ratio</code> applies to the lowest observed
ration across the samples.  If the <code>minimum_ratio_type</code> is
set to <code>avg</code> (default), the <code>minimum_ratio</code> applies to the mean of observed
ration across the samples.<code>avg</code>. (default is 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minimum_match</code></td>
<td>
<p>minimum threshold of sequence similarity
for considering any OTU as an error of another can be set (default 84%).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minimum_relative_cooccurence</code></td>
<td>
<p>minimum co-occurrence rate, i.e. the
lower rate of occurrence of the potential error explained by co-occurrence
with the potential parent for considering error state.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress_bar</code></td>
<td>
<p>(Logical, default TRUE) print progress during the calculation or not.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log_conserved</code></td>
<td>
<p>(Logical, default FALSE) conserved log files writed in the disk</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Please cite the lulu original paper: https://www.nature.com/articles/s41467-017-01312-x
</p>


<h3>Value</h3>

<p>Function <code>lulu</code> returns a list of results based on the input OTU
table and match list.
</p>

<ul>
<li> <p><code>curated_table</code> - a curated
OTU table with daughters merged with their matching parents.
</p>
</li>
<li> <p><code>curated_count</code> - number of curated (parent) OTUs.
</p>
</li>
<li> <p><code>curated_otus</code> - ids of the OTUs that were accepted as valid OTUs.
</p>
</li>
<li> <p><code>discarded_count</code> - number of discarded (merged with parent) OTUs.
</p>
</li>
<li> <p><code>discarded_otus</code> - ids of the OTUs that were identified as
errors (daughters) and merged with respective parents.
</p>
</li>
<li> <p><code>runtime</code> - time used by the script.
</p>
</li>
<li> <p><code>minimum_match</code> - the id threshold
(minimum match \
by user).
</p>
</li>
<li> <p><code>minimum_relative_cooccurence</code> - minimum ratio of
daughter-occurences explained by co-occurence with parent (set by user).
</p>
</li>
<li> <p><code>otu_map</code> - information of which daughters were mapped to which
parents.
</p>
</li>
<li> <p><code>original_table</code> - original OTU table.
</p>
</li>
</ul>
<p>The matchlist is the product of a mapping of OTU sequences against each other. This is
currently carried out by an external script in e.g. BLASTN or VSEARCH, prior to running <code>lulu</code>!
Producing the match list requires a file with all the OTU sequences (centroids) - e.g. <code>OTUcentroids.fasta</code>. The matchlist can be produced by mapping all OTUs against each other with an external algorithm like VSEARCH or BLASTN. In <code>VSEARCH</code> a matchlist can be produced e.g. with the following command: <code>vsearch --usearch_global OTUcentroids.fasta --db OTUcentroids.fasta --strand plus --self --id .80 --iddef 1 --userout matchlist.txt --userfields query+target+id --maxaccepts 0 --query_cov .9 --maxhits 10</code>. In <code>BLASTN</code> a matchlist can be produces e.g. with the following commands. First we produce a blast-database from the fasta file: <code>makeblastdb -in OTUcentroids.fasta -parse_seqids -dbtype nucl</code>, then we match the centroids against that database: <code>blastn -db OTUcentoids.fasta -num_threads 10 -outfmt'6 qseqid sseqid pident' -out matchlist.txt -qcov_hsp_perc .90 -perc_identity .84 -query OTUcentroids.fasta</code>
</p>


<h3>Author(s)</h3>

<p>Tobias Guldberg Frøslev (orcid: <a href="https://orcid.org/0000-0002-3530-013X">0000-0002-3530-013X</a>),
modified by Adrien Taudière
</p>


</div>