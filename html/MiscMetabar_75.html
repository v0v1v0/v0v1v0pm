<div class="container">

<table style="width: 100%;"><tr>
<td>merge_samples2</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Merge samples by a sample variable or factor</h2>

<h3>Description</h3>


<a href="https://adrientaudiere.github.io/MiscMetabar/articles/Rules.html#lifecycle">
<img src="https://img.shields.io/badge/lifecycle-stable-green" alt="lifecycle-stable"></a>

<p>Firstly release in the <a href="https://github.com/mikemc/speedyseq/">speedyseq</a> R
package by Michael R. McLaren.
</p>
<p>This function provides an alternative to <code>phyloseq::merge_samples()</code> that
better handles sample variables of different types, especially categorical
sample variables. It combines the samples in <code>x</code> defined by the sample
variable or factor <code>group</code> by summing the abundances in <code>otu_table(x)</code> and
combines sample variables by the summary functions in <code>funs</code>. The default
summary function, <code>unique_or_na()</code>, collapses the values within a group to a
single unique value if it exists and otherwise returns NA. The new (merged)
samples are named by the values in <code>group</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">merge_samples2(
  x,
  group,
  fun_otu = sum,
  funs = list(),
  reorder = FALSE,
  default_fun = unique_or_na
)

## S4 method for signature 'phyloseq'
merge_samples2(
  x,
  group,
  fun_otu = sum,
  funs = list(),
  reorder = FALSE,
  default_fun = unique_or_na
)

## S4 method for signature 'otu_table'
merge_samples2(
  x,
  group,
  fun_otu = sum,
  reorder = FALSE,
  default_fun = unique_or_na
)

## S4 method for signature 'sample_data'
merge_samples2(
  x,
  group,
  funs = list(),
  reorder = FALSE,
  default_fun = unique_or_na
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A <code>phyloseq</code>, <code>otu_table</code>, or <code>sample_data</code> object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group</code></td>
<td>
<p>A sample variable or a vector of length <code>nsamples(x)</code> defining
the sample grouping. A vector must be supplied if x is an otu_table</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fun_otu</code></td>
<td>
<p>Function for combining abundances in the otu_table; default
is <code>sum</code>. Can be a formula to be converted to a function by
<code>purrr::as_mapper()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>funs</code></td>
<td>
<p>Named list of merge functions for sample variables; default is
<code>unique_or_na</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reorder</code></td>
<td>
<p>Logical specifying whether to reorder the new (merged)
samples by name</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>default_fun</code></td>
<td>
<p>Default functions if funs is not set. Per default
the function unique_or_na is used. See <code>diff_fct_diff_class()</code> for
a useful alternative.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A new phyloseq-class, otu_table or sam_data object depending on
the class of the x param
</p>


<h3>Author(s)</h3>

<p>Michael R. McLaren (orcid: <a href="https://orcid.org/0000-0003-1575-473X">0000-0003-1575-473X</a>) modified by Adrien Taudiere
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(enterotype)

# Merge samples with the same project and clinical status
ps &lt;- enterotype
sample_data(ps) &lt;- sample_data(ps) %&gt;%
  transform(Project.ClinicalStatus = Project:ClinicalStatus)
sample_data(ps) %&gt;% head()
ps0 &lt;- merge_samples2(ps, "Project.ClinicalStatus",
  fun_otu = mean,
  funs = list(Age = mean)
)
sample_data(ps0) %&gt;% head()
</code></pre>


</div>