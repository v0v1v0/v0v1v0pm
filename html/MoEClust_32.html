<div class="container">

<table style="width: 100%;"><tr>
<td>MoE_stepwise</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Stepwise model/variable selection for MoEClust models</h2>

<h3>Description</h3>

<p>Conducts a greedy forward stepwise search to identify the optimal <code>MoEClust</code> model according to some <code>criterion</code>. Components and/or <code>gating</code> covariates and/or <code>expert</code> covariates are added to new <code>MoE_clust</code> fits at each step, while each step is evaluated for all valid <code>modelNames</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">MoE_stepwise(data,
             network.data = NULL,
             gating = NULL,
             expert = NULL,
             modelNames = NULL,
             fullMoE = FALSE,
             noise = FALSE,
             initialModel = NULL,
             initialG = NULL,
             stepG = TRUE,
             criterion = c("bic", "icl", "aic"),
             equalPro = c("all", "both", "yes", "no"),
             noise.gate = c("all", "both", "yes", "no"),
             verbose = interactive(),
             ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A numeric vector, matrix, or data frame of observations. Categorical variables are not allowed. If a matrix or data frame, rows correspond to observations and columns correspond to variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>network.data</code></td>
<td>
<p>An optional matrix or data frame in which to look for the covariates specified in the <code>gating</code> &amp;/or <code>expert</code> networks, if any. Must include column names. Columns in <code>network.data</code> corresponding to columns in <code>data</code> will be automatically removed. While a single covariate can be supplied as a vector (provided the '<code>$</code>' operator or '<code>[]</code>' subset operator are not used), it is safer to supply a named 1-column matrix or data frame in this instance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gating</code></td>
<td>
<p>A vector giving the names of columns in <code>network.data</code> used to define the scope of the gating network. By default, the initial model will contain no covariates (unless <code>initialModel</code> is supplied with gating covariates), thereafter all variables in <code>gating</code> (save for those in <code>initialModel</code>, if any) will be considered for inclusion where appropriate.
</p>
<p>If <code>gating</code> is not supplied (or set to <code>NULL</code>), <em>all</em> variables in <code>network.data</code> will be considered for the gating network. <code>gating</code> can also be supplied as <code>NA</code>, in which case <em>no</em> gating network covariates will ever be considered (save for those in <code>initialModel</code>, if any). Supplying <code>gating</code> and <code>expert</code> can be used to ensure different subsets of covariates enter different parts of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expert</code></td>
<td>
<p>A vector giving the names of columns in <code>network.data</code> used to define the scope of the expert network. By default, the initial model will contain no covariates (unless <code>initialModel</code> is supplied with expert covariates), thereafter all variables in <code>expert</code> (save for those in <code>initialModel</code>, if any) will be considered for inclusion where appropriate.
</p>
<p>If <code>expert</code> is not supplied (or set to <code>NULL</code>), <em>all</em> variables in <code>network.data</code> will be considered for the expert network. <code>expert</code> can also be supplied as <code>NA</code>, in which case <em>no</em> expert network covariates will ever be considered (save for those in <code>initialModel</code>, if any). Supplying <code>expert</code> and <code>gating</code> can be used to ensure different subsets of covariates enter different parts of the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modelNames</code></td>
<td>
<p>A character string of valid model names, to be used to restrict the size of the search space, if desired. By default, <em>all</em> valid model types are explored. Rather than considering the changing of the model type as an additional step, every step is evaluated over all entries in <code>modelNames</code>. See <code>MoE_clust</code> for more details. 
</p>
<p>Note that if <code>initialModel</code> is supplied (see below), <code>modelNames</code> will be augmented with <code>initialModel$modelName</code> if needs be.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fullMoE</code></td>
<td>
<p>A logical which, when <code>TRUE</code>, ensures that only models where the same covariates enter both parts of the model (the gating and expert networks) are considered. This restricts the search space to exclude models where covariates differ across networks. Thus, the search is likely to be faster, at the expense of potentially missing out on optimal models. Defaults to <code>FALSE</code>. 
</p>
<p>Furthermore, when <code>TRUE</code>, the set of candidate covariates is automatically taken to be the <strong>union</strong> of the <em>named</em> covariates in <code>gating</code> and <code>expert</code>, for convenience. In other words, <code>gating=NA</code> will only work if <code>expert=NA</code> also, and both should be set to <code>NULL</code> in order to consider all potential covariates. 
</p>
<p>In addition, caution is advised using this argument in conjunction with <code>initialModel</code>, which must satisfy the constraint that the same set of covariates be used in both parts of the model, for initial models where gating covariates are allowable. Finally, note that this argument does not preclude a model with only expert covariates included if the number of components is such that the inclusion of gating covariates is infeasible.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>noise</code></td>
<td>
<p>A logical indicating whether to assume all models contain an additional noise component (<code>TRUE</code>) or not (<code>FALSE</code>, the default). If <code>initialModel</code> or <code>initialG</code> is not specified, the search starts from a <code>G=0</code> noise-only model when <code>noise</code> is <code>TRUE</code>, otherwise the search starts from a <code>G=1</code> model with no covariates when <code>noise</code> is <code>FALSE</code>. See <code>MoE_control</code> for more details. Note, however, that if the model specified in <code>initialModel</code> contains a noise component, the value of the <code>noise</code> argument will be overridden to <code>TRUE</code>; similarly, if the <code>initialModel</code> model does not contain a noise component, <code>noise</code> will be overridden to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initialModel</code></td>
<td>
<p>An object of class <code>"MoEClust"</code> generated by <code>MoE_clust</code> or an object of class <code>"MoECompare"</code> generated by <code>MoE_compare</code>. This gives the initial model to use at the first step of the selection algorithm, to which components and/or covariates etc. can be added. Especially useful if the model is expected to have more than one component <em>a priori</em> (see <code>initialG</code> below as an alternative). The <code>initialModel</code> model must have been fitted to the same data in <code>data</code>. 
</p>
<p>If <code>initialModel</code> is not specified, the search starts from a <code>G=0</code> noise-only model when <code>noise</code> is <code>TRUE</code>, otherwise the search starts from a <code>G=1</code> model with no covariates when <code>noise</code> is <code>FALSE</code>. If <code>initialModel</code> <em>is</em> supplied and it contains a noise component, only models with a noise component will be considered thereafter (i.e. the <code>noise</code> argument can be overridden by the <code>initialModel</code> argument). If <code>initialModel</code> contains gating &amp;/or expert covariates, these covariates will be included in all subsequent searches, with covariates in <code>expert</code> and <code>gating</code> still considered as candidates for additional inclusion, as normal.
</p>
<p>However, while <code>initialModel</code> <em>can</em> include covariates not specified in <code>gating</code> &amp;/or <code>expert</code>, the <code>initialModel$modelName</code> <strong>should</strong> be included in the specified <code>modelNames</code>; if it is not, <code>modelNames</code> will be forcibly augmented with <code>initialModel$modelName</code> (as stated above). Furthermore, it is assumed that <code>initialModel</code> is already optimal with respect to the model type. If it is not, the algorithm may be liable to converge to a sub-optimal model, and so a warning will be printed if the function suspects that this <em>might</em> be the case.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initialG</code></td>
<td>
<p>A single (positive) integer giving the number of mixture components (clusters) to initialise the stepwise search algorithm with. This is a simpler alternative to the <code>initialModel</code> argument, to be used when the only prior knowledge relates to the number of components, and not other features of the model (e.g. the covariates which should be included). Consequently, <code>initialG</code> is only relevant when <code>initialModel</code> is not supplied. When neither <code>initialG</code> nor <code>initialModel</code> is specified, the search starts from a <code>G=0</code> noise-only model when <code>noise</code> is <code>TRUE</code>, otherwise the search starts from a <code>G=1</code> model with no covariates when <code>noise</code> is <code>FALSE</code>. See <code>stepG</code> below for fixing the number of components at this <code>initialG</code> value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stepG</code></td>
<td>
<p>A logical indicating whether the algorithm should consider incrementing the number of components at each step. Defaults to <code>TRUE</code>; use <code>FALSE</code> when searching only over configurations with the same number of components is of interest. Setting <code>stepG</code> to <code>FALSE</code> is possible with or without specifying <code>initialModel</code> or <code>initialG</code>, but is primarily intended for use when one of these arguments is supplied, otherwise the algorithm will be stuck forever with only one component.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>criterion</code></td>
<td>
<p>The model selection criterion used to determine the optimal action at each step. Defaults to <code>"bic"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>equalPro</code></td>
<td>
<p>A character string indicating whether models with equal mixing proportions should be considered. <code>"both"</code> means models with both equal and unequal mixing proportions will be considered, <code>"yes"</code> means only models with equal mixing proportions will be considered, and <code>"no"</code> means only models with unequal mixing proportions will be considered. Notably, no setting for <code>equalPro</code> is enough to rule out models with <code>gating</code> covariates from consideration.
</p>
<p>The default (<code>"all"</code>) is equivalent to <code>"both"</code> with the addition that all possible mixing proportion constraints will be tried for the <code>initialModel</code> (if any, provided it doesn't contain gating covariate(s)) or <code>initialG</code> <em>before</em> adding a component or additional covariates; otherwise, this <code>equalPro</code> argument only governs whether mixing proportion constraints are considered as components are added.
</p>
<p>Considering <code>"all"</code> (or <code>"both"</code>) equal and unequal mixing proportion models increases the search space and the computational burden, but this argument becomes irrelevant after a model, if any, with gating network covariate(s) is considered optimal for a given step. The <code>"all"</code> default is <strong>strongly</strong> recommended so that viable candidate models are not missed out on, particularly when <code>initialModel</code> or <code>initialG</code> are given. However, this does not guarantee that an optimal model will not be skipped; if <code>equalPro</code> is restricted via <code>"yes"</code> or <code>"no"</code>, a suboptimal model at one step may ultimately lead to a better final model, in some edge cases. See <code>MoE_control</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>noise.gate</code></td>
<td>
<p>A character string indicating whether models where the gating network for the noise component depends on covariates are considered. <code>"yes"</code> means only models where this is the case will be considered, <code>"no"</code> means only models for which the noise component's mixing proportion is constant will be considered and <code>"both"</code> means both of these scenarios will be considered.
</p>
<p>The default (<code>"all"</code>) is equivalent to <code>"both"</code> with the addition that all possible gating network noise settings will be tried for the <code>initialModel</code> (if any, provided it contains gating covariates and a noise component) <em>before</em> adding a component or additional covariates; otherwise, this <code>noise.gate</code> argument only governs the inclusion/exclusion of this constraint as components or covariates are added.
</p>
<p>Considering <code>"all"</code> (or <code>"both"</code>) settings increases the search space and the computational burden, but this argument is only relevant when <code>noise=TRUE</code> and <code>gating</code> covariates are being considered. The <code>"all"</code> default is <strong>strongly</strong> recommended so that viable candidate models are not missed out on, particularly when <code>initialModel</code> or <code>initialG</code> are given. However, this does not guarantee that an optimal model will not be skipped; if <code>noise.gate</code> is restricted via <code>"yes"</code> or <code>"no"</code>, a suboptimal model at one step may ultimately lead to a better final model, in some edge cases. See <code>MoE_control</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical indicating whether to print messages pertaining to progress to the screen during fitting. By default is <code>TRUE</code> if the session is interactive, and <code>FALSE</code> otherwise. If <code>FALSE</code>, warnings and error messages will still be printed to the screen, but everything else will be suppressed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to <code>MoE_control</code>, <em>except for those arguments of the same name which are already listed here</em>, e.g. <code>equalPro</code> and <code>noise.gate</code>. Note that these arguments will be supplied to <em>all</em> candidate models for every step. For arguments specific to <code>MoE_control</code> (e.g. <code>stopping</code>, <code>algo</code>, etc.), it is recommended to run <code>MoE_stepwise</code> multiple times while toggling these arguments, if desired.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The arguments <code>modelNames</code>, <code>equalPro</code>, and <code>noise.gate</code> are provided for computational convenience. They can be used to reduce the number of models under consideration at each stage. 
</p>
<p>The same is true of the arguments <code>gating</code> and <code>expert</code>, which can each separately (or jointly, if <code>fullMoE</code> is <code>TRUE</code>) be made to consider all variables in <code>network.data</code>, or a subset, or none at all. 
</p>
<p>Finally, <code>initialModel</code> or <code>initialG</code> can be used to kick-start the search algorithm by incorporating prior information in a more direct way; in the latter case, only in the form of the number of components; in the former case, a full model with a given number of components, certain included gating and expert network covariates, and a certain model type can give the model an even more informed head start. In either case, the <code>stepG</code> argument can be used to fix the number of components and only search over different configurations of covariates.
</p>
<p>Without any prior information, it is best to accept the defaults at the expense of a longer run-time.
</p>


<h3>Value</h3>

<p>An object of class <code>"MoECompare"</code> containing information on all visited models and the optimal model (accessible via <code>x$optimal</code>).
</p>


<h3>Note</h3>

<p>It is advised to run this function once with <code>noise=FALSE</code> and once with <code>noise=TRUE</code> and then choose the optimal model across both sets of results.
</p>
<p>At present, only additions (of components and covariates) are considered. In future updates, it may be possible to allow both additions and removals.
</p>
<p>The function will attempt to remove duplicate variables found in both <code>data</code> and <code>network.data</code>; in particular, they will be removed from <code>network.data</code>. Users are however advised to careful specify <code>data</code> and <code>network.data</code> such that there are no duplicates, especially if the desired variable(s) should belong to <code>network.data</code>.
</p>
<p>Finally, if the user intends to search for the best model according to the <code>"icl"</code> <code>criterion</code>, then specifying either <code>initialModel</code> or <code>initialG</code> is advisable. This is because the algorithm otherwise starts with a single component and thus there is no entropy term, meaning the stepwise search can quickly and easily get stuck at <code>G=1</code>. See the examples below.
</p>


<h3>Author(s)</h3>

<p>Keefe Murphy - &lt;<a href="mailto:keefe.murphy@mu.ie">keefe.murphy@mu.ie</a>&gt;
</p>


<h3>References</h3>

<p>Murphy, K. and Murphy, T. B. (2020). Gaussian parsimonious clustering models with covariates and a noise component. <em>Advances in Data Analysis and Classification</em>, 14(2): 293-325. &lt;<a href="https://doi.org/10.1007/s11634-019-00373-8">doi:10.1007/s11634-019-00373-8</a>&gt;.
</p>


<h3>See Also</h3>

<p><code>MoE_clust</code>, <code>MoE_compare</code>, <code>MoE_control</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># data(CO2data)
# Search over all models where the single covariate can enter either network
# (mod1  &lt;- MoE_stepwise(CO2data$CO2, CO2data[,"GNP", drop=FALSE]))
#
# data(ais)
# Only look for EVE &amp; EEE models with at most one expert network covariate
# Do not consider any gating covariates and only consider models with equal mixing proportions
# (mod2  &lt;- MoE_stepwise(ais[,3:7], ais, gating=NA, expert="sex",
#                        equalPro="yes", modelNames=c("EVE", "EEE")))
#
# Look for models with noise &amp; only those where the noise component's mixing proportion is constant
# Speed up the search with an initialModel, fix G, and restrict the covariates &amp; model type
# init   &lt;- MoE_clust(ais[,3:7], G=2, modelNames="EEE", 
#                     expert= ~ sex, network.data=ais, tau0=0.1)
# (mod3  &lt;- MoE_stepwise(ais[,3:7], ais, noise=TRUE, expert="sex",
#                        gating=c("SSF", "Ht"), noise.gate="no", 
#                        initialModel=init, stepG=FALSE, modelNames="EEE"))
#
# Compare both sets of results (with &amp; without a noise component) for the ais data
# (comp1 &lt;- MoE_compare(mod2, mod3, optimal.only=TRUE))
# comp1$optimal
#
# Target a model for the AIS data which is optimal in terms of ICL, without any restrictions
# mod4   &lt;- MoE_stepwise(ais[,3:7], ais, criterion="icl")
# 
# This gets stuck at a G=1 model, so specify an initial G value as a head start
# mod5   &lt;- MoE_stepwise(ais[,3:7], ais, criterion="icl", initialG=2)
#
# Check that specifying an initial G value enables a better model to be found
# (comp2 &lt;- MoE_compare(mod4, mod5, optimal.only=TRUE, criterion="icl"))

# Finally, restrict the search to full MoE models only
# Notice that the candidate covariates are the union of gating and expert
# Notice also that the algorithm initially traverses models with only
#   expert covariates when the inclusion of gating covariates is infeasible
# mod6   &lt;- MoE_stepwise(ais[,3:7], ais, fullMoE=TRUE, gating="BMI", expert="Bfat")
</code></pre>


</div>