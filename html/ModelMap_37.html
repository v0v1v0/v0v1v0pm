<div class="container">

<table style="width: 100%;"><tr>
<td>model.interaction.plot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
plot of two-way model interactions
</h2>

<h3>Description</h3>

<p>Image or Perspective plot of two-way model interactions. Ranges of two specified predictor variables are plotted on X and Y axis, and fitted model values are plotted on the Z axis. The remaining predictor variables are fixed at their mean (for continuous predictors) or their most common value (for categorical predictors).
</p>


<h3>Usage</h3>

<pre><code class="language-R">model.interaction.plot(model.obj = NULL, x = NULL, y = NULL, 
response.category=NULL, quantiles=NULL, all=FALSE, obs=1, qdata.trainfn = NULL, 
folder = NULL, MODELfn = NULL,  PLOTfn = NULL, pred.means = NULL, 
xlab = NULL, ylab = NULL, x.range = NULL, y.range = NULL, 
z.range = NULL, ticktype = "detailed", theta = 55, phi = 40, 
smooth = "none", plot.type = NULL, device.type = NULL, 
res=NULL, jpeg.res = 72, device.width = 7,  device.height = 7, 
units="in", pointsize=12, cex=par()$cex, 
col = NULL, xlim = NULL, ylim = NULL, zlim = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model.obj</code></td>
<td>
 <p><code>R</code> model object.  The model object to use for prediction.  The model object must be of type <code>"RF"</code> (random forest), <code>"QRF"</code> (quantile random forest), or <code>"CF"</code> (conditional forest). The <code>ModelMap</code> package does not currently support <code>SGB</code> models. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>String or Integer. Name of predictor variable to be plotted on the x axis. Alternativly, can be a number indicating a variable name from <code>predList</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>String or Integer. Name of predictor variable to be plotted on the y axis. Alternatively, can be a number indicating a variable name from <code>predList</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>response.category</code></td>
<td>
<p>String. Used for categorical response models. Specify which category of response variable to use. This category's probabilities will be plotted on the z axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantiles</code></td>
<td>
<p>Numeric. Used for QRF models. Specify which quantile of response variable to use. This quantile will be plotted on the z axis. Note: unlike other functions <code>model.interaction.plot</code> will only use a single quantile. If <code>quantiles</code> is a vector only the first value will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>all</code></td>
<td>
<p>Logical. Used for QRF models. A logical value. <code>all=TRUE</code> uses all observations for prediction. <code>all=FALSE</code> uses only a certain number of observations per node for prediction (set with argument <code>obs</code>). The default is <code>all=FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs</code></td>
<td>
<p>Numeric. Used for QRF models. An integer number. Determines the maximal number of observations per node to use for prediction. The input is ignored for all=TRUE. The default is obs=1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qdata.trainfn</code></td>
<td>
<p>String.  The name (full path or base name with path specified by <code>folder</code>) of the training data file used for building the model (file should include columns for both response and predictor variables).  The file must be a comma-delimited file <code>*.csv</code> with column headings. <code>qdata.trainfn</code> can also be an <code>R</code> dataframe. If predictions will be made (<code>predict = TRUE</code> or <code>map=TRUE</code>) the predictor column headers must match the names of the raster layer files, or a <code>rastLUT</code> must be provided to match predictor columns to the appropriate raster and band.  If <code>qdata.trainfn = NULL</code> (the default), a GUI interface prompts user to browse to the training data file.  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>folder</code></td>
<td>
<p> String.  The folder used for all output.  Do not add ending slash to path string.  If <code>folder = NULL</code> (default), a GUI interface prompts user to browse to a folder.  To use the working directory, specify <code>folder = getwd()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MODELfn</code></td>
<td>
<p> String.  The file name used to save the generated model object, only used if <code>PLOTfn = NULL</code>.  If <code>MODELfn</code> is supplied and If <code>PLOTfn = NULL</code>, a graphical file name is generated by pasting <code>MODELfn_plot.type_x.name_y.name</code>. If <code>PLOTfn = NULL</code> and <code>MODELfn = NULL</code>, a default name is generated by pasting <code>model.type_response.type_response.name_plot.type_x.name_y.name</code>. The filename can be the full path, or it can be the simple basename, in which case the output will be to the folder specified by <code>folder</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PLOTfn</code></td>
<td>
<p> String.  The file name to use to save the generated graphical plots. The filename can be the full path, or it can be the simple basename, in which case the output will be to the folder specified by <code>folder</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pred.means</code></td>
<td>
<p>Vector. Allows specification of values for other predictor variables. If Null, other predictors are set to their mean value (for continuous predictors) or their most common value (for factored predictors).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>String. Allows manual specification of the x label.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>String. Allows manual specification of the y label.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x.range</code></td>
<td>
<p>Vector. Manual range specification for the x axis. Alternate argument name for <code>xlim</code>. Use one or the other. Do not provide both <code>x.range</code> and <code>xlim</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y.range</code></td>
<td>
<p>Vector. Manual range specification for the y axis. Alternate argument name for <code>ylim</code>. Use one or the other. Do not provide both <code>y.range</code> and <code>ylim</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z.range</code></td>
<td>
<p>Vector. Manual range specification for the z axis. Alternate argument name for <code>zlim</code>. Use one or the other. Do not provide both <code>z.range</code> and <code>zlim</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ticktype</code></td>
<td>
<p>Character: "simple" draws just an arrow parallel to the axis to indicate direction of increase; "detailed" (default) draws normal ticks as per 2D plots. If <code>X</code> or <code>y</code> is factored, ticks will be drawn on both axes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>Numeric. Angles defining the viewing direction. <code>theta</code> gives the azimuthal direction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi</code></td>
<td>
<p>Numeric. Angles defining the viewing direction. <code>phi</code> gives the colatitude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smooth</code></td>
<td>
<p>String. controls smoothing of the predicted surface. Options are <code>"none"</code> (default), <code>"model"</code> which uses a glm model to smooth the surface, and <code>"average"</code> which applies a 3x3 smoothing average. Note: smoothing is not appropriate if <code>X</code> or <code>y</code> is factored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.type</code></td>
<td>
<p>Character. <code>"persp"</code> gives a 3-D perspective plot. <code>"image"</code> gives an image plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>device.type</code></td>
<td>
<p> String or vector of strings.  Model validation.  One or more device types for graphical output from model validation diagnostics. 
</p>
<p>Current choices:
</p>

<table>
<tr>
<td style="text-align: left;">
	  </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> <code>"default"</code> </td>
<td style="text-align: left;"> default graphics device</td>
</tr>
<tr>
<td style="text-align: left;">
	  </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> <code>"jpeg"</code> </td>
<td style="text-align: left;"> *.jpg files</td>
</tr>
<tr>
<td style="text-align: left;">
	  </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> <code>"none"</code> </td>
<td style="text-align: left;"> no graphics device generated</td>
</tr>
<tr>
<td style="text-align: left;">	
	  </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> <code>"pdf"</code> </td>
<td style="text-align: left;"> *.pdf files</td>
</tr>
<tr>
<td style="text-align: left;">
	  </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> <code>"postscript"</code> </td>
<td style="text-align: left;"> *.ps files</td>
</tr>
<tr>
<td style="text-align: left;">
	  </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> </td>
<td style="text-align: left;"> <code>"win.metafile"</code> </td>
<td style="text-align: left;"> *.emf files </td>
</tr>
</table>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res</code></td>
<td>
<p> Integer.  Model validation.  Pixels per inch for jpeg, png, and tiff plots.  The default is 72dpi, good for on screen viewing. For printing, suggested setting is 300dpi. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>jpeg.res</code></td>
<td>
<p> Integer.  Model validation.  Deprecated. Ignored unless <code>res</code> not provided. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>device.width</code></td>
<td>
<p> Integer.  Model validation.  The device width for diagnostic plots in inches. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>device.height</code></td>
<td>
<p> Integer.  Model validation.  The device height for diagnostic plots in inches. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>units</code></td>
<td>
<p> Model validation.  The units in which <code>device.height</code> and <code>device.width</code> are given. Can be <code>"px"</code> (pixels), <code>"in"</code> (inches, the default), <code>"cm"</code> or <code>"mm"</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pointsize</code></td>
<td>
<p> Integer.  Model validation.  The default pointsize of plotted text, interpreted as big points (1/72 inch) at <code>res</code> ppi</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex</code></td>
<td>
<p> Integer.  Model validation.  The cex for diagnostic plots. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p> Vector.  Color table to use for image plots ( see help file on image for details). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim</code></td>
<td>
<p>Vector. X limits. Alternate argument name for <code>x.range</code>. Use one or the other. Do not provide both <code>x.range</code> and <code>xlim</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>Vector. Y limits. Alternate argument name for <code>y.range</code>. Use one or the other. Do not provide both <code>y.range</code> and <code>ylim</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zlim</code></td>
<td>
<p>Vector. Z limits. Alternate argument name for <code>z.range</code>. Use one or the other. Do not provide both <code>z.range</code> and <code>zlim</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional graphical parameters (see <code>par</code>).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function provides a diagnostic plot useful in visualizing two-way interactions between predictor variables. Two of the predictor variables from the model are used to produce a grid of possible combinations of predictor values over the range of both variables. The remaining predictor variables from the model are fixed at either their means (for continuous predictors) or their most common value (for categorical predictors). Model predictions are generated over this grid and plotted as the z axis.
</p>
<p>This function works with both continuous and categorical predictors, though the perspective plot should be interpreted with care for categorical predictors. In particular, the <code>smooth</code> option is not appropriate if either of the two selected predictor variables is categorical.
</p>
<p>For categorical response models, a particular value must be specified for the response using the <code>response.category</code> argument. 
</p>


<h3>Author(s)</h3>

<p> Elizabeth Freeman </p>


<h3>References</h3>

<p>This function is adapted from <code>gbm.perspec</code> version 2.9 April 2007, J Leathwick/J Elith. See appendix S3 from:
</p>
<p>Elith, J., Leathwick, J. R. and Hastie, T. (2008). A working guide to boosted regression trees. Journal of Animal Ecology. 77:802-813.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 

###########################################################################
############################# Run this set up code: #######################
###########################################################################

# set seed:
seed=38

# Define training and test files:

qdata.trainfn = system.file("extdata", "helpexamples","DATATRAIN.csv", package = "ModelMap")
qdata.testfn = system.file("extdata", "helpexamples","DATATEST.csv", package = "ModelMap")

# Define folder for all output:
folder=getwd()	

########## Continuous Response, Categorical Predictors ############


#file name to store model:
MODELfn="RF_BIO_TCandNLCD"			

#predictors:
predList=c("TCB","TCG","TCW","NLCD")

#define which predictors are categorical:
predFactor=c("NLCD")

# Response name and type:
response.name="BIO"
response.type="continuous"

#identifier for individual training and test data points

unique.rowname="ID"


###########################################################################
########################### build model: ##################################
###########################################################################


### create model ###

model.obj = model.build( model.type="RF",
                       qdata.trainfn=qdata.trainfn,
                       folder=folder,		
                       unique.rowname=unique.rowname,		
                       MODELfn=MODELfn,
                       predList=predList,
                       predFactor=predFactor,
                       response.name=response.name,
                       response.type=response.type,
                       seed=seed,
                       na.action=na.roughfix
)

###########################################################################
###################### make interaction plots: ############################
###########################################################################

#########################
### Perspective Plots ###
#########################


### specify first and third  predictors in 'predList (both continuous) ###

model.interaction.plot(	model.obj,
			x=1,y=3, 
			main=response.name, 
			plot.type="persp", 
			device.type="default") 


### specify predictors in 'predList' by name (one continuous one factored) ###

model.interaction.plot(model.obj,
			x="TCB", y="NLCD", 
			main=response.name, 
			plot.type="persp", 
			device.type="default") 


###################
### Image Plots ###
###################

### same as previous example, but image plot ###


l &lt;- seq(100,0,length.out=101)
c &lt;- seq(0,100,length.out=101)
col.ramp &lt;- hcl(h = 120, c = c, l = l)
 

model.interaction.plot(	model.obj,
				x="TCB", y="NLCD",
				main=response.name,
				plot.type="image", 
				device.type="default",
				col = col.ramp) 


#########################
### 3-way Interaction ###
#########################

### use 'pred.means' argument to fix values of additional predictors ###

### factored 3rd predictor ###

interaction between TCG and TCW for 3 most common values of NLCD

nlcd&lt;-levels(model.obj$predictor.data$NLCD)
nlcd.counts&lt;-table(model.obj$predictor.data$NLCD)
nlcd.ordered&lt;-nlcd[order(nlcd.counts,decreasing=TRUE)]

for(i in nlcd.ordered[1:3]){
	pred.means=list(NLCD=i)

	model.interaction.plot(	model.obj,
				x="TCG", y="TCW",  
				main=paste("NLCD=",i," (",nlcd.counts[i]," plots)", sep=""),
				pred.means=pred.means, 
				z.range=c(0,110),
				theta=290,
				plot.type="persp", 
				device.type="default") 
}



### continuos 3rd predictor ###


tcb&lt;-seq(	min(model.obj$predictor.data$TCB),
		max(model.obj$predictor.data$TCB),
		length=3)

tcb&lt;-signif(tcb,2)

for(i in tcb){
	pred.means=list(TCB=i)

	model.interaction.plot(	model.obj,
				x="TCG", y="TCW",  
				main=paste("TCB =",i),
				pred.means=pred.means, 
				z.range=c(0,120),
				theta=290,
				plot.type="persp", 
				device.type="default") 
}



### 4-way Interesting combos ###


tcb=c(1300,2900,3400)
nlcd=c(11,90,95)

for(i in 1:3){
	pred.means=list(TCB=tcb[i],NLCD=nlcd[i])

	model.interaction.plot(	model.obj,
				x="TCG", y="TCW",  
				main=paste("TCB =",tcb[i],"        NLCD =",nlcd[i]),
				pred.means=pred.means, 
				z.range=c(0,120),
				theta=290,
				plot.type="persp", 
				device.type="default") 
}

## End(Not run) #end dontrun

</code></pre>


</div>