<div class="container">

<table style="width: 100%;"><tr>
<td>MplusTrees</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Recursive partitioning trees with Mplus models</h2>

<h3>Description</h3>

<p>Generates recursive partitioning trees using M<em>plus</em> models. <code>MplusTrees()</code> takes an
M<em>plus</em> model written in the form of an <code>MplusAutomation</code> script, uses
<code>MplusAutomation</code> to fit the model in M<em>plus</em>, and performs recursive partitioning
using <code>rpart</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">MplusTrees(
  script,
  data,
  rPartFormula,
  catvars = NULL,
  group = ~id,
  control = rpart.control(),
  se = F,
  psplit = F,
  palpha = 0.05,
  cv = F,
  k = 5
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>script</code></td>
<td>
<p>An <code>MplusAutomation</code> script file</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Dataset that is specified in the script</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rPartFormula</code></td>
<td>
<p>Formula of the form ~ variable names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>catvars</code></td>
<td>
<p>Vector of names of categorical covariates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group</code></td>
<td>
<p>id variable. If not specified an id variable is created for each row</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>Control object for <code>rpart</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>Whether to print standard errors and <em>p</em> values. In general should be set to FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>psplit</code></td>
<td>
<p>Whether to use likelihood ratio <em>p</em> values as a splitting criterion</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>palpha</code></td>
<td>
<p>Type I error rate (alpha level) for rejecting with likelihood ratio test when
<code>psplit</code> set to <code>TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cv</code></td>
<td>
<p>Performs k-fold cross-validation to select value of <code>cp</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>number of folds for cross-validation</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function temporarily changes the working directory to the temporary directory. Files used
and generated by M<em>plus</em> are stored here and can be accessed using <code>tempdir()</code>.
</p>
<p>By default <code>MplusTrees()</code> only splits on the criteria specified in the <code>control</code>
argument, the most important of which is the <code>cp</code> parameter. The user can also split on the
<em>p</em> value generated from the likelihood ratio test comparing the parent node to a multiple group
model consisting of 2 groups (the daughter nodes). This <em>p</em> value criterion is used in addition
to the <code>cp</code> criterion in that both must be met for a split to be made. The <code>psplit</code> argument
turns this option on, and <code>palpha</code> sets the alpha level criterion for rejection.
</p>
<p>Cross-validation (CV) can also be used to choose the <code>cp</code> parameter. If this option is used, any
user-specified <code>cp</code> value will be overridden by the optimal <code>cp</code> value chosen by CV. CV fits
the model to the training set and calculates an expected minus 2 log-likelihood (-2LL) for each terminal
node. In the test set, individuals are assigned to terminal nodes based on the tree structure found in
the training set. Their "expected" values are the -2LL values from the respective training set terminal
nodes. The "observed" values are the -2LL values from fitting a multiple group model, with each terminal
node as a group. The <code>cp</code> value chosen is the one that produces the smallest MSE.
</p>
<p>CV should only be used when (1) the M<em>plus</em> model can be fit relatively quickly, (2) there are only
a few covariates with a few response options, and (3) the sample size is large enough that the user is
confident the model can be fit without issue in a sample of size <em>N/k</em> and a tree that partitions
this sample further. If these conditions are not met, the process could take prohibitively long to arrive
at a solution. Note that if even a single model fails to produce a valid log-likelihood value, the
function will terminate with an error.
</p>


<h3>Value</h3>

<p>An object of class '<code>mplustree</code>'. <code>rpart_out</code> provides the tree structure, <code>terminal</code>
gives a vector of terminal nodes, <code>where</code> shows the terminal node of each id, and <code>estimates</code> gives
the parameter estimates for each terminal node.
</p>


<h3>Author(s)</h3>

<p>Ross Jacobucci and Sarfaraz Serang
</p>


<h3>References</h3>

<p>Serang, S., Jacobucci, R., Stegmann, G., Brandmaier, A. M., Culianos, D., &amp; Grimm, K. J. (2021).
Mplus Trees: Structural equation model trees using Mplus. Structural Equation Modeling, 28, 127-137.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
library(lavaan)

script = mplusObject(
   TITLE = "Example #1 - Factor Model;",
   MODEL = "f1 BY x1-x3; f2 BY x4-x6; f3 BY x7-x9;",
   usevariables = c('x1','x2','x3','x4','x5','x6','x7','x8','x9'),
   rdata = HolzingerSwineford1939)

fit = MplusTrees(script, HolzingerSwineford1939, group=~id,
   rPartFormula=~sex+school+grade,
   control=rpart.control(minsplit=100, minbucket=100, cp=.01))

fit

## End(Not run)
</code></pre>


</div>