<div class="container">

<table style="width: 100%;"><tr>
<td>dist_bal_match</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Optimal tradeoffs among distance, exclusion and marginal imbalance</h2>

<h3>Description</h3>

<p>Explores tradeoffs among three important objective functions in
an optimal matching problem:the sum of covariate distances within matched
pairs, the number of treated units included in the match, and the marginal
imbalance on pre-specified covariates (in total variation distance).
</p>


<h3>Usage</h3>

<pre><code class="language-R">dist_bal_match(
  data,
  treat_col,
  marg_bal_col,
  exclusion_penalty = c(),
  balance_penalty = c(),
  dist_matrix = NULL,
  dist_col = NULL,
  exact_col = NULL,
  propensity_col = NULL,
  pscore_name = NULL,
  ignore_col = NULL,
  max_unmatched = 0.25,
  caliper_option = NULL,
  tol = 0.01,
  max_iter = 1,
  rho_max_factor = 10,
  max_pareto_search_iter = 5
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data frame that contain columns indicating treatment, outcome and
covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>treat_col</code></td>
<td>
<p>character of name of the column indicating treatment
assignment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>marg_bal_col</code></td>
<td>
<p>character of column name of the variable on which to
evaluate marginal balance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exclusion_penalty</code></td>
<td>
<p>(optional) numeric vector of values of exclusion
penalty. Default is c(), which would trigger the auto grid search.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>balance_penalty</code></td>
<td>
<p>(optional) factor of values of marginal balance
penalty. Default value is c(), which would trigger the auto grid search.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist_matrix</code></td>
<td>
<p>(optional) a matrix that specifies the pair-wise distances
between any two objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist_col</code></td>
<td>
<p>(optional) character vector of variable names used for
calculating within-pair distance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exact_col</code></td>
<td>
<p>(optional) character vector, variable names that we want
exact matching on; NULL by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>propensity_col</code></td>
<td>
<p>(optional) character vector, variable names on which to
fit a propensity score (to supply a caliper).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pscore_name</code></td>
<td>
<p>(optional) character, giving the variable name for the
fitted propensity score.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ignore_col</code></td>
<td>
<p>(optional) character vector of variable names that should be
ignored when constructing the internal matching. NULL by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_unmatched</code></td>
<td>
<p>(optional) numeric, the maximum proportion of unmatched
units that can be accepted; default is 0.25.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>caliper_option</code></td>
<td>
<p>(optional) numeric, the propensity score caliper value
in standard deviations of the estimated propensity scores; default is NULL,
which is no caliper.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>(optional) numeric, tolerance of close match distance;
default is 1e-2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_iter</code></td>
<td>
<p>(optional) integer,  maximum number of iterations to use in
searching for penalty combintions that improve the matching; default is 1,
where the algorithm searches for one round.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho_max_factor</code></td>
<td>
<p>(optional) numeric, the scaling factor used in proposal
for penalties; default is 10.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_pareto_search_iter</code></td>
<td>
<p>(optional) numeric, the number of tries to
search for the tol that yield pareto optimal solutions; default is 5.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Matched designs generated by this function are Pareto optimal for
the three objective functions.  The degree of relative emphasis among the
three objectives in any specific solution is controlled by the penalties,
denoted by Greek letter rho. Larger values of <code>exclusion_penalty</code>
corresponds to
increased emphasis on retaining treated units (all else being equal), while
larger values of <code>balance_penalty</code> corresponds to increased emphasis
on marginal
balance. Additional details:
</p>

<ul>
<li>
<p> Users may either specify their own distance
matrix via the <code>dist_matrix</code> argument or ask the function to create a
robust Mahalanobis distance matrix internally on a set of covariates specified by
the <code>dist_col</code> argument; if neither argument is specified an error will
result.  User-specified distance matrices should have row count equal to
the number of treated units and column count equal to the number of
controls.
</p>
</li>
<li>
<p> If the <code>caliper_option</code> argument is specified, a propensity
score caliper will be imposed, forbidding matches between units more than a
fixed distance apart on the propensity score.  The caliper will be based
either on a user-fit propensity score, identified in the input dataframe by
argument <code>pscore_name</code>, or by an internally-fit propensity score based on
logistic regression against the variables named in <code>propensity_col</code>.  If
<code>caliper_option</code> is non-NULL and neither of the other arguments is specified
an error will result.
</p>
</li>
<li> <p><code>tol</code> controls the precision at which
the objective functions is evaluated. When matching problems are especially
large or complex it may be necessary to increase toleranceOption in order
to prevent integer overflows in the underlying network flow solver;
generally this will be suggested in appropariate warning messages.
</p>
</li>
<li>
<p> While
by default tradeoffs are only assessed at penalty combinations provided by
the user, the user may ask for the algorithm to search over additional
penalty values in order to identify additional Pareto optimal solutions.
<code>rho_max_factor</code> is a multiplier applied to initial penalties to discover
new solutions, and setting it larger leads to wider exploration; similarly,
<code>max_iter</code> controls how long the exploration routine runs, with larger
values leading to more exploration.
</p>
</li>
</ul>
<h3>Value</h3>

<p>a named list whose elements are: * "rhoList": list of penalty
combinations for each match * "matchList": list of matches indexed by
number
</p>

<ul>
<li>
<p> "treatmentCol": character of treatment variable
</p>
</li>
<li>
<p> "covs":
character vector of names of the variables used for calculating within-pair
distance
</p>
</li>
<li>
<p> "exactCovs": character vector of names of variables that we want
exact or close match on * "idMapping": numeric vector of row indices for
each observation in the sorted data frame for internal use
</p>
</li>
<li>
<p> "stats": data
frame of important statistics (total variation distance) for variable on
which marginal balance is measured
</p>
</li>
<li>
<p> "b.var": character, name of variable
on which marginal balance is measured * "dataTable": data frame sorted by
treatment value
</p>
</li>
<li>
<p> "t": a treatment vector
</p>
</li>
<li>
<p> "df": the original dataframe
input by the user
</p>
</li>
<li>
<p> "pair_cost1": list of pair-wise distance sum using the
first distance measure
</p>
</li>
<li>
<p> "pair_cost2": list of pair-wise distance sum using
the second distance measure (left NULL since only one distance measure is
used here).
</p>
</li>
<li>
<p> "version": (for internal use) the version of the matching
function called; "Basic" indicates the matching comes from dist_bal_match and
"Advanced" from two_dist_match.
</p>
</li>
<li>
<p> "fPair": a vector of values for the first
objective function; it corresponds to the pair-wise distance sum according
to the first distance measure.
</p>
</li>
<li>
<p> "fExclude": a vector of values for the
second objective function; it corresponds to the number of treated units
being unmatched.
</p>
</li>
<li>
<p> "fMarginal": a vector of values for the third objective
function; it corresponds to the marginal balanced distance for the
specified variable(s).
</p>
</li>
</ul>
<h3>See Also</h3>

<p>Other main matching function: 
<code>two_dist_match()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data("lalonde", package="cobalt")
ps_cols &lt;- c("age", "educ", "married", "nodegree", "race")
treat_val &lt;- "treat"
response_val &lt;- "re78"  
pair_dist_val &lt;- c("age", "married", "educ", "nodegree", "race")
my_bal_val &lt;- c("race")
r1s &lt;- c(0.01,1,2,4,4.4,5.2,5.4,5.6,5.8,6)
r2s &lt;- c(0.001)
match_result &lt;- dist_bal_match(data=lalonde, treat_col= treat_val, 
marg_bal_col = my_bal_val, exclusion_penalty=r1s, balance_penalty=r2s, 
dist_col = pair_dist_val, 
propensity_col = ps_cols, max_iter=0)
</code></pre>


</div>