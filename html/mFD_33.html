<div class="container">

<table style="width: 100%;"><tr>
<td>quality.fspaces</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Compute functional spaces and their quality</h2>

<h3>Description</h3>

<p>Compute a Principal Coordinates Analysis (PCoA) using functional distance
between species. Then the function evaluates the quality of spaces built
using an increasing number of principal components. Quality is evaluated as
the (absolute or squared) deviation between trait-based distance (input) and
distance in the PCoA-based space (raw Euclidean distance or scaled distance
according to its maximum value and maximum of trait-based distance). Option
to compute a functional dendrogram and its quality. This function is based
on the framework presented in Maire <em>et al.</em> (2015).
</p>


<h3>Usage</h3>

<pre><code class="language-R">quality.fspaces(
  sp_dist,
  fdendro = NULL,
  maxdim_pcoa = 10,
  deviation_weighting = "absolute",
  fdist_scaling = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sp_dist</code></td>
<td>
<p>a dist object with pairwise distance among all species (at
least 3 species needed). Functional distance matrix from trait values can
be computed using <code>funct.dist</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fdendro</code></td>
<td>
<p>a character string indicating the clustering
algorithm to use to compute dendrogram. Should be one of the method
recognized by <code>hclust</code> (e.g. 'average' for UPGMA).
Default: <code>fdendro = NULL</code> (so no dendrogram computed).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxdim_pcoa</code></td>
<td>
<p>a single numeric value with maximum number of PCoA axes
to consider to build multidimensional functional spaces. Default:
<code>maxdim_pcoa = 10</code>. See below about number of axes actually considered.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deviation_weighting</code></td>
<td>
<p>a character string referring to the
method(s) used to weight the differences between species pairwise distance
in the functional space and trait-based distance. <code>'absolute'</code>
(default) means absolute differences are used to compute mean absolute
deviation <em>mad</em> index; <code>'squared'</code> means squared differences are
used to compute root of mean squared deviation <em>rmsd</em> index. Both
values could be provided to compare quality metrics.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fdist_scaling</code></td>
<td>
<p>a vector with logical value(s) specifying
whether distances in the functional space should be scaled before
computing differences with trait-based distances. Scaling ensures that
trait-based distances and distances in the functional space have the same
maximum.
Default: <code>FALSE</code>. Both values could be provided to compare quality metrics.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list with:
</p>

<ul>
<li> <p><code>$quality_fspaces</code>: a data frame with quality metric(s) for
each functional space. Functional spaces are named as 'pcoa_.d' and if
required 'tree_clustering method'. Quality metrics are named after
deviation_weighting ('mad' for 'absolute' and and 'rmsd' for 'squared')
and if fdist_scaling is TRUE with suffix '_scaled'.
</p>
</li>
<li> <p><code>$details_trdist</code> a list with 2 elements:
<code>$trdist_summary</code>
a vector with minimum (min), maximum (max), mean (mean) and standard
deviation (sd) of <code>sp_dist</code>; <code>$trdist_euclidean</code> a logical
value indicating whether <code>sp_dist</code> checks Euclidean properties.
</p>
</li>
<li> <p><code>$details_fspaces</code> a list with 4 elements: <code>$sp_pc_coord</code>
a matrix with coordinates of species (rows) along Principal Components
(columns) with positive eigenvalues ; <code>$pc_eigenvalues</code> a matrix
with eigenvalues of axes from PCoA ; <code>$dendro</code> a hclust
object with the dendrogram details (null if no dendrogram computed) ;
<code>$pairsp_fspaces_dist</code> a dataframe containing for each pair of
species (rows), their names in the 2 first columns ('sp.x' and 'sp.y'),
their distance based on trait-values ('tr'), and their Euclidean
(for PCoA) or cophenetic (for dendrogram if computed) distance in each
of the functional space computed ('pcoa_1d', 'pcoa_2d', ... ,
'tree_clust');
if <code>fdist_scaling = TRUE</code>, <code>$pairsp_fspaces_dist_scaled</code> a data
frame with scaled values of distances in functional spaces.
</p>
</li>
<li> <p><code>$details_deviation</code> a list of data frames:
<code>$dev_distsp</code> a dataframe containing for each space (columns) the
difference for all species pairs (rows) of the distance in the
functional space and trait-based distance (i.e. positive deviation
indicates overestimation of actual distance) ; <code>$abs_dev_distsp</code>
and/or
<code>$sqr_dev_distsp</code>, dataframes with for each space (columns) and all
species pairs (rows) the absolute or squared deviation of distance ; if
<code>fdist_scaling = TRUE</code> <code>$dev_distsp_scaled</code>, and
<code>$abs_dev_distsp_scaled</code> and/or <code>$sqr_dev_distsp_scaled</code>, data
frames with deviation computed on scaled distance in functional spaces.
</p>
</li>
</ul>
<h3>Note</h3>

<p>The maximum number of dimensions considered for assessing quality of
functional spaces depends on number of PC axes with positive eigenvalues
(i.e. axes with negative eigenvalues are not considered); so it could be
lower than <code>$maxdim_pcoa</code>.
The quality metric obtained with deviation_weighting = 'squared' and
<code>fdist_scaling = TRUE</code> is equivalent to the square-root of the 'mSD'
originally suggested in Maire <em>et al.</em> (2015).
</p>


<h3>Author(s)</h3>

<p>Sebastien Villeger, Eva Maire, and Camille Magneville
</p>


<h3>References</h3>

<p>Maire <em>et al.</em> (2015) How many dimensions are needed to accurately assess
functional diversity? A pragmatic approach for assessing the quality of
functional spaces <em>Global Ecology and Biogeography</em>, <strong>24</strong>, 728-740.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Load Species x Traits Data
data("fruits_traits", package = "mFD")

# Load Traits x Categories Data
data("fruits_traits_cat", package = "mFD")

# Compute Functional Distance
sp_dist_fruits &lt;- mFD::funct.dist(
  sp_tr         = fruits_traits,
  tr_cat        = fruits_traits_cat,
  metric        = "gower",
  scale_euclid  = "scale_center",
  ordinal_var   = "classic",
  weight_type   = "equal",
  stop_if_NA    = TRUE)

# Compute Functional Spaces Quality (to retrieve species coordinates)
fspaces_quality_fruits &lt;- mFD::quality.fspaces(
  sp_dist             = sp_dist_fruits,
  maxdim_pcoa         = 10,
  deviation_weighting = "absolute",
  fdist_scaling       = FALSE,
  fdendro             = "average")
 fspaces_quality_fruits
  
# Retrieve Species Coordinates
sp_faxes_coord_fruits &lt;- fspaces_quality_fruits$details_fspaces$sp_pc_coord
sp_faxes_coord_fruits
</code></pre>


</div>