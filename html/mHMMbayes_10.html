<div class="container">

<table style="width: 100%;"><tr>
<td>pd_RW_emiss_count</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Proposal distribution settings RW Metropolis sampler for mHMM
Poisson-lognormal emission distribution(s)</h2>

<h3>Description</h3>

<p><code>pd_RW_emiss_count</code> provides a framework to manually specify the
settings of the proposal distribution of the random walk (RW) Metropolis
sampler of Poisson emission distribution(s) of the multilevel hidden Markov
model, and creates on object of the class <code>mHMM_pdRW_emiss</code>. The RW
metropolis sampler is used for sampling the subject level parameter estimates
relating to the emission distributions of the dependent variables <code>k</code>,
that is, the Poisson parameters lambda.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pd_RW_emiss_count(gen, emiss_scalar, emiss_w)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>gen</code></td>
<td>
<p>List containing the following elements denoting the general model
properties:
</p>

<ul>
<li>
<p><code>m</code>: numeric vector with length 1 denoting the number
of hidden states
</p>
</li>
<li>
<p><code>n_dep</code>: numeric vector with length 1 denoting the
number of dependent variables
</p>
</li>
<li>
<p><code>q_emiss</code>: only to be specified if the data represents
categorical data. Numeric vector with length <code>n_dep</code> denoting the
number of observed categories for the categorical emission distribution
for each of the dependent variables.</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>emiss_scalar</code></td>
<td>
<p>A list containing <code>n_dep</code> elements
corresponding to each of the dependent variables, where each element is a
numeric vector with length 1 denoting the scale factor <code>s</code>. That is,
the scale of the proposal distribution is composed of a covariance matrix
Sigma, which is then tuned by multiplying it by a scaling factor <code>s</code>^2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>emiss_w</code></td>
<td>
<p>A list containing <code>n_dep</code> elements corresponding
to each of the dependent variables, where each element is a numeric vector
with length 1 denoting the weight for the overall log likelihood (i.e., log
likelihood based on the pooled data over all subjects) in the fractional
likelihood.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When no manual values for the settings of the proposal distribution of the
random walk (RW) Metropolis sampler are specified at all (that is, the
function <code>pd_RW_emiss_count</code> is not used), <code>emiss_scalar</code> set
to 2.38, and <code>emiss_w</code> set to 0.1. See the section <em>Scaling the
proposal distribution of the RW Metropolis sampler</em> in
<code>vignette("estimation-mhmm")</code> for details.
</p>
<p>Within the function <code>mHMM</code>, the acceptance rate of the RW metropolis
sampler relating to the emission distribution(s) can be tracked using the
output parameter <code>emiss_naccept</code>. An acceptance rate of about 45% is
considered optimal when a single parameter is being updated (Gelman,
Carlin, Stern &amp; Rubin, 2014).
</p>


<h3>Value</h3>

<p><code>pd_RW_emiss_count</code> returns an object of class
<code>mHMM_pdRW_emiss</code>, containing settings of the proposal distribution of
the random walk (RW) Metropolis sampler on the categorical emission
distribution(s) of the multilevel hidden Markov model. The object is
specifically created and formatted for use by the function <code>mHMM</code>, and
checked for correct input dimensions. The object contains the following
components:
</p>

<dl>
<dt><code>gen</code></dt>
<dd>
<p>A list containing the elements <code>m</code> and
<code>n_dep</code>, used for checking equivalent general model properties
specified under <code>pd_RW_emiss_count</code> and <code>mHMM</code>.</p>
</dd>
<dt><code>emiss_scalar</code></dt>
<dd>
<p>A list containing <code>n_dep</code> elements denoting
the scale factor <code>s</code> of the proposal distribution.</p>
</dd>
<dt><code>emiss_w</code></dt>
<dd>
<p>A list containing <code>n_dep</code> elements denoting
denoting the weight for the overall log likelihood in the fractional
likelihood.</p>
</dd>
</dl>
<h3>References</h3>

<p>Gelman A, Carlin JB, Stern HS, Rubin DB (2014).
<em>Bayesian Data Analysis vol. 2</em>.
Taylor &amp; Francis.
</p>
<p>Rossi PE, Allenby GM, McCulloch R (2012).
<em>Bayesian statistics and marketing</em>.
John Wiley &amp; Sons.
</p>


<h3>Examples</h3>

<pre><code class="language-R">###### Example using simulated data
# specifying general model properties:
n_t     &lt;- 200     # Number of observations on the dependent variable
m       &lt;- 3        # Number of hidden states
n_dep   &lt;- 2        # Number of dependent variables
n_subj  &lt;- 30        # Number of subjects

gamma   &lt;- matrix(c(0.9, 0.05, 0.05,
                    0.2, 0.7, 0.1,
                    0.2,0.3, 0.5), ncol = m, byrow = TRUE)

emiss_distr &lt;- list(matrix(c(20,
                             10,
                             5), nrow = m, byrow = TRUE),
                    matrix(c(50,
                             3,
                             20), nrow = m, byrow = TRUE))

# Define between subject variance to use on the simulating function:
# here, the variance is varied over states within the dependent variable.
var_emiss &lt;- list(matrix(c(5.0, 3.0, 1.5), nrow = m),
                  matrix(c(5.0, 5.0, 5.0), nrow = m))

# Simulate count data:
data_count &lt;- sim_mHMM(n_t = n_t,
                       n = n_subj,
                       data_distr = "count",
                       gen = list(m = m, n_dep = n_dep),
                       gamma = gamma,
                       emiss_distr = emiss_distr,
                       var_gamma = 0.1,
                       var_emiss = var_emiss,
                       return_ind_par = TRUE)


# Transition probabilities
start_gamma &lt;- diag(0.8, m)
start_gamma[lower.tri(start_gamma) | upper.tri(start_gamma)] &lt;- (1 - diag(start_gamma)) / (m - 1)

# Emission distribution
start_emiss &lt;- list(matrix(c(20,10, 5), nrow = m, byrow = TRUE),
                    matrix(c(50, 3,20), nrow = m, byrow = TRUE))

# Specify hyper-prior for the count emission distribution
manual_prior_emiss &lt;- prior_emiss_count(
  gen = list(m = m, n_dep = n_dep),
  emiss_mu0 = list(matrix(c(20, 10, 5), byrow = TRUE, ncol = m),
                   matrix(c(50, 3, 20), byrow = TRUE, ncol = m)),
  emiss_K0  = rep(list(0.1),n_dep),
  emiss_nu  = rep(list(0.1),n_dep),
  emiss_V   = rep(list(rep(10, m)),n_dep)
)

# Specify the desired values for the sampler
manual_emiss_sampler &lt;- pd_RW_emiss_count(gen = list(m = m, n_dep = n_dep),
                                        emiss_scalar = rep(list(2.38),n_dep),
                                        emiss_w = rep(list(0.1), n_dep))

# Run model
# Note that for reasons of running time, J is set at a ridiculous low value.
# One would typically use a number of iterations J of at least 1000,
# and a burn_in of 200.
out_3st_count_RWemiss &lt;- mHMM(s_data = data_count$obs,
                          data_distr = 'count',
                          gen = list(m = m, n_dep = n_dep),
                          start_val = c(list(start_gamma), start_emiss),
                          emiss_hyp_prior = manual_prior_emiss,
                          emiss_sampler = manual_emiss_sampler,
                          mcmc = list(J = 11, burn_in = 5),
                          show_progress = TRUE)

# Examine acceptance rates over dependent variable, individual, and states:
lapply(out_3st_count_RWemiss$emiss_naccept, function(e) e/out_3st_count_RWemiss$input$J)

# Finally, take the average acceptance rate by dependent variable and state:
lapply(out_3st_count_RWemiss$emiss_naccept, function(e) colMeans(e/out_3st_count_RWemiss$input$J))


</code></pre>


</div>