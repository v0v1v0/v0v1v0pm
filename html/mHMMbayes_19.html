<div class="container">

<table style="width: 100%;"><tr>
<td>sim_mHMM</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate data using a multilevel hidden Markov model</h2>

<h3>Description</h3>

<p><code>sim_mHMM</code> simulates data for multiple subjects, for which the data have
either categorical or continuous (i.e., normally distributed)
observations that follow a hidden Markov model (HMM) with a
multilevel structure. The multilevel structure implies that each subject is
allowed to have its own set of parameters, and that the parameters at the
subject level (level 1) are tied together by a population distribution at
level 2 for each of the corresponding parameters. The shape of the population
distribution for each of the parameters is a normal distribution. In addition
to (natural and/or unexplained) heterogeneity between subjects, the subjects
parameters can also depend on a covariate.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sim_mHMM(
  n_t,
  n,
  data_distr = "categorical",
  gen,
  gamma,
  emiss_distr,
  start_state = NULL,
  xx_vec = NULL,
  beta = NULL,
  var_gamma = 0.1,
  var_emiss = NULL,
  return_ind_par = FALSE,
  m,
  n_dep,
  q_emiss,
  log_scale = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n_t</code></td>
<td>
<p>Numeric vector with length 1 denoting the length of the observed
sequence to be simulated for each subject. To only simulate subject
specific transition probability matrices gamma and emission distributions
(and no data), set <code>t</code> to 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Numeric vector with length 1 denoting the number of subjects for
which data is simulated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_distr</code></td>
<td>
<p>A character vector of length 1 denoting the distribution
adopted for the data given the hidden states. It can take the values
'categorical', 'continuous', or 'count', standing for the for categorical
observations following a Multinomial logit, continuous observations
following a normal distribution, and count observations following a
Poisson distribution, correspondingly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gen</code></td>
<td>
<p>List containing the following elements denoting the general model
properties:
</p>

<ul>
<li>
<p><code>m</code>: numeric vector with length 1 denoting the number
of hidden states
</p>
</li>
<li>
<p><code>n_dep</code>: numeric vector with length 1 denoting the
number of dependent variables
</p>
</li>
<li>
<p><code>q_emiss</code>: only to be specified if the data represents
categorical data. Numeric vector with length <code>n_dep</code> denoting the
number of observed categories for the categorical emission distribution
for each of the dependent variables.</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma</code></td>
<td>
<p>A matrix with <code>m</code> rows and <code>m</code> columns containing the
average population transition probability matrix used for simulating the
data. That is, the probability to switch from hidden state <em>i</em> (row
<em>i</em>) to hidden state <em>j</em> (column  <em>j</em>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>emiss_distr</code></td>
<td>
<p>A list with <code>n_dep</code> elements containing the average
population emission distribution(s) of the observations given the hidden
states for each of the dependent variables. If <code>data_distr =
'categorical'</code>, each element is a matrix with <code>m</code> rows and
<code>q_emiss[k]</code> columns for each of the <code>k</code> in <code>n_dep</code> emission
distribution(s). That is, the probability of observing category <em>q</em>
(column <em>q</em>) in state <em>i</em> (row <em>i</em>). If <code>data_distr =
'continuous'</code>, each element is a matrix with <code>m</code> rows and 2 columns;
the first column denoting the mean of state <em>i</em> (row <em>i</em>) and the
second column denoting the standard deviation of state <em>i</em>
(row <em>i</em>) of the Normal distribution. If <code>data_distr =
'count'</code>, each element is a matrix with <code>m</code> rows and 1 column;
the only column denoting the logmean of state <em>i</em> (row <em>i</em>)
of the lognormal distribution used as prior for the Poisson emissions
(note: by default the logmeans should be specified in the natural scale;
see argument <code>log_scale</code> below, unless covariates are used to predict
a count emission distribution).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start_state</code></td>
<td>
<p>Optional numeric vector with length 1 denoting in which
state the simulated state sequence should start. If left unspecified, the
simulated state for time point 1 is sampled from the initial state
distribution (which is derived from the transition probability matrix
gamma).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xx_vec</code></td>
<td>
<p>List of 1 + <code>n_dep</code> vectors containing the covariate(s) to
predict the transition probability matrix <code>gamma</code> and/or (specific)
emission distribution(s) <code>emiss_distr</code> using the regression parameters
specified in <code>beta</code> (see below). The first element in the list
<code>xx_vec</code> is used to predict the transition matrix. Subsequent elements
in the list are used to predict the emission distribution of (each of) the
dependent variable(s). This means that the covariate used to predict
<code>gamma</code> and <code>emiss_distr</code> can either be the same covariate,
different covariates, or a covariate for certain elements and none for the
other. At this point, it is only possible to use one covariate for both
<code>gamma</code> and <code>emiss_distr</code>. For all elements in the list,
the number of observations in the vectors should be  equal to the number of
subjects to be simulated <code>n</code>. If <code>xx_vec</code> is omitted completely,
<code>xx_vec</code> defaults to NULL, resembling no covariates at all. Specific
elements in the list can also be left empty (i.e., set to <code>NULL</code>) to
signify that either the transition probability matrix or (one of) the
emission distribution(s) is not predicted by covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>List of 1 + <code>n_dep</code> matrices containing the regression
parameters to predict <code>gamma</code> and/or <code>emiss_distr</code> in combination
with <code>xx_vec</code> using (Multinomial logistic) regression. The first
matrix is used to predict the transition probability matrix <code>gamma</code>.
The subsequent matrices are used to predict the emission distribution(s)
<code>emiss_distr</code> of the dependent variable(s). For <code>gamma</code> and
categorical emission distributions, one regression parameter is specified
for each element in <code>gamma</code> and <code>emiss_distr</code>, with the following
exception. The first element in each row of <code>gamma</code> and/or
<code>emiss_distr</code> is used as reference category in the Multinomial
logistic regression. As such, no regression parameters can be specified for
these parameters. Hence, the first element in the list <code>beta</code> to
predict <code>gamma</code> consist of a matrix with the number of rows equal to
<code>m</code> and the number of columns equal to <code>m</code> - 1. For categorical
emission distributions, the subsequent elements in the list <code>beta</code> to
predict <code>emiss_distr</code> consist of a matrix with the number of rows
equal to <code>m</code> and the number of columns equal to <code>q_emiss[k]</code> - 1
for each of the <code>k</code> in <code>n_dep</code> emission distribution(s). See
<em>details</em> for more information. For continuous and count emission
distributions, the subsequent elements in the list <code>beta</code> consist of
a matrix with the number of rows equal to <code>m</code> and 1 column.
</p>
<p>Note that if <code>beta</code> is specified, <code>xx_vec</code> has to be specified as
well. If <code>beta</code> is omitted completely, <code>beta</code> defaults to NULL,
resembling no prediction of <code>gamma</code> and <code>emiss_distr</code> using
covariates. One of the elements in the list can also be left empty
(i.e., set to <code>NULL</code>) to signify that either the transition
probability matrix or a specific emission distribution is not predicted by
covariates. If covariates are used to predict a count emission
distribution (<code>data_distr = 'count'</code>), then the logarithmic scale
should be used for the inputs <code>emiss_distr</code> and <code>var_emiss</code> in
addition to <code>beta</code>, and also set <code>log_scale = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var_gamma</code></td>
<td>
<p>Either a numeric vector with length 1 or a matrix of
(<code>m</code> by <code>m</code> - 1) elements denoting the amount of variance
between subjects in the transition probability matrix. Note that the
value(s) correspond to the variance of the parameters of the Multinomial
distribution (i.e., the intercepts of the regression equation of the
Multinomial distribution used to sample the transition probability
matrix), see details below. Also note that if only one variance value is
provided, it will be adopted for the complete transition probability
matrix, hence the variance is assumed fixed across all components. The
default equals 0.1, which corresponds to little variation between
subjects. If one wants to simulate data from exactly the same HMM for all
subjects, var_gamma should be set to 0. Note that if data for only 1
subject is simulated (i.e., n = 1), <code>var_gamma</code> is set to 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var_emiss</code></td>
<td>
<p>Either a numeric vector with length <code>n_dep</code> or a
list of <code>n_dep</code> matrices denoting the amount of variance between
subjects in the emission distribution(s). When opting for a list of
matrices: if <code>data_distr = 'categorical'</code>, each element of the list
is a matrix with <code>m</code> rows and <code>q_emiss[k] - 1</code> columns for each
of the <code>k</code> in <code>n_dep</code> emission distribution(s) between subject
variances; if <code>data_distr = 'continuous'</code>, each element is a matrix
with <code>m</code> rows and 1 column; the single column denoting the variance
between the subjects' means of state <em>i</em> (row <em>i</em>) of the normal
distribution used as prior for the Normal emissions. If <code>data_distr =
  'count'</code>, each element is a matrix with <code>m</code> rows and 1 column; the
single column denoting the logvariance between the subjects' logmeans of
state <em>i</em> (row <em>i</em>) of the lognormal distribution used as prior
for the Poisson emissions (note: by default the logvariances should be
specified in the natural scale; see argument <code>log_scale</code> below).
</p>
<p>For categorical data, this value corresponds to the variance of the
parameters of the Multinomial distribution (i.e., the intercepts of the
regression equation of the Multinomial distribution used to sample the
components of the emission distribution), see details below. For
continuous data, this value corresponds to the variance in the mean of the
emission distribution(s) across subjects. For count data, it corresponds
to the variance in the logmean of the emission distribution(s) across
subjects and by should be specified in the natural scale (see argument
<code>log_scale</code> below). Note that if only one variance value provided for
each emission distribution, the variance is assumed fixed across states
(and, for the categorical distribution, categories within a state) within
an emission distribution. The default equals 0.1, which corresponds to
little variation between subjects given categorical observations. If one
wants to simulate data from exactly the same HMM for all subjects,
var_emiss should be set to a vector of 0's. Note that if data for only 1
subject is simulated (i.e., n = 1), <code>var_emiss</code> is set to a vector
of 0's.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_ind_par</code></td>
<td>
<p>A logical scalar. Should the subject specific
transition probability matrix <code>gamma</code> and emission probability matrix
<code>emiss_distr</code> be returned by the function (<code>return_ind_par =
TRUE</code>) or not (<code>return_ind_par = FALSE</code>). The default equals
<code>return_ind_par = FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>The argument <code>m</code> is deprecated; please specify using the input
parameter <code>gen</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_dep</code></td>
<td>
<p>The argument <code>n_dep</code> is deprecated; please specify using
the input parameter <code>gen</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q_emiss</code></td>
<td>
<p>The argument <code>q_emiss</code> is deprecated; please specify
using the input parameter <code>gen</code> (only to be specified when simulating
categorical data).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log_scale</code></td>
<td>
<p>A logical scalar. If <code>data_distr = 'count'</code>, should
<code>emiss_distr</code> (i.e., the sample average logmeans) and
<code>var_emiss</code> (i.e., the between subject logvariances) of the lognormal
prior adopted for the count be specified in the logarithmic scale
(<code>log_scale = TRUE</code>) or the natural (i.e., real positive numbers)
scale (<code>log_scale = FALSE</code>). The default equals
<code>log_scale = FALSE</code>. Note that if covariates <code>beta</code> are used to
predict the count emission distribution, then the logarithmic scale should
be used for the inputs <code>emiss_distr</code>, <code>beta</code>, and
<code>var_emiss</code>, and also set <code>log_scale = TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In simulating the data, having a multilevel structure means that the
parameters for each subject are sampled from the population level
distribution of the corresponding parameter. The user specifies the
population distribution for each parameter: the average population transition
probability matrix and its variance, and the average population emission
distribution and its variance. For now, the variance of the mean population
parameters is assumed fixed for all components of the transition probability
matrix and for all components of the emission distribution.
</p>
<p>One can simulate multivariate data. That is, the hidden states depend on more
than 1 observed variable simultaneously. The distributions of multiple
dependent variables for multivariate data are assumed to be independent, and
all distributions for one dataset have to be of the same type (either
categorical or continuous).
</p>
<p>Note that the subject specific initial state distributions (i.e., the
probability of each of the states at the first time point) needed to simulate
the data are obtained from the stationary distributions of the subject
specific transition probability matrices gamma.
</p>
<p><code>beta</code>: As the first element in each row of <code>gamma</code> is used as
reference category in the Multinomial logistic regression, the first matrix
in the list <code>beta</code> used to predict transition probability matrix
<code>gamma</code> has a number of rows equal to <code>m</code> and the number of columns
equal to <code>m</code> - 1. The first element in the first row corresponds to the
probability of switching from state one to state two. The second element in
the first row corresponds to the probability of switching from state one to
state three, and so on. The last element in the first row corresponds to the
probability of switching from state one to the last state. The same principle
holds for the second matrix in the list <code>beta</code> used to predict
categorical emission distribution(s) <code>emiss_distr</code>: the first element in
the first row corresponds to the probability of observing category two in
state one. The second element in the first row corresponds to the probability
of observing category three is state one, and so on. The last element in the
first row corresponds to the probability of observing the last category in
state one.
</p>
<p>Note that when simulating count data (<code>data_distr = 'count'</code>), by
default the emission distribution parameters <code>emiss_distr</code> and
<code>var_emiss</code> are specified in the natural (positive real numbers) scale
(as opposite to the logarithmic scale). If the user wants to manually
specify these values on the logarithmic scale, please set the argument
<code>log_scale = TRUE</code>. Also note that if covariates are used to predict a
count emission distribution, then the logarithmic scale should be used for
the inputs <code>emiss_distr</code>, <code>beta</code>, and <code>var_emiss</code>, and also
set <code>log_scale = TRUE</code>.
</p>


<h3>Value</h3>

<p>The following components are returned by the function <code>sim_mHMM</code>:
</p>

<dl>
<dt><code>states</code></dt>
<dd>
<p>A matrix containing the simulated hidden state
sequences, with one row per hidden state per subject. The first column
indicates subject id number. The second column contains the simulated
hidden state sequence, consecutively for all subjects. Hence, the id number
is repeated over the rows (with the number of repeats equal to the length
of the simulated hidden state sequence <code>T</code> for each subject).</p>
</dd>
<dt><code>obs</code></dt>
<dd>
<p>A matrix containing the simulated observed outputs, with
one row per simulated observation per subject. The first column indicates
subject id number. The second column contains the simulated observation
sequence, consecutively for all subjects. Hence, the id number is repeated
over rows (with the number of repeats equal to the length of the simulated
observation sequence <code>T</code> for each subject).</p>
</dd>
<dt><code>gamma</code></dt>
<dd>
<p>A list containing <code>n</code> elements with the simulated
subject specific transition probability matrices <code>gamma</code>. Only
returned if <code>return_ind_par</code> is set to <code>TRUE</code>.</p>
</dd>
<dt><code>emiss_distr</code></dt>
<dd>
<p>A list containing <code>n</code> elements with the
simulated subject specific emission probability matrices
<code>emiss_distr</code>. Only returned if <code>return_ind_par</code> is set to
<code>TRUE</code>.</p>
</dd>
</dl>
<h3>See Also</h3>

<p><code>mHMM</code> for analyzing multilevel hidden Markov data.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Examples on univariate categorical data
# simulating data for 10 subjects with each 100 categorical observations
n_t     &lt;- 100
n       &lt;- 10
m       &lt;- 3
n_dep   &lt;- 1
q_emiss &lt;- 4
gamma   &lt;- matrix(c(0.8, 0.1, 0.1,
                    0.2, 0.7, 0.1,
                    0.2, 0.2, 0.6), ncol = m, byrow = TRUE)
emiss_distr &lt;- list(matrix(c(0.5, 0.5, 0.0, 0.0,
                             0.1, 0.1, 0.8, 0.0,
                             0.0, 0.0, 0.1, 0.9), nrow = m, ncol = q_emiss, byrow = TRUE))
data1 &lt;- sim_mHMM(n_t = n_t, n = n, gen = list(m = m, n_dep = n_dep, q_emiss = q_emiss),
                  gamma = gamma, emiss_distr = emiss_distr, var_gamma = 1, var_emiss = 1)
head(data1$obs)
head(data1$states)

# including a covariate to predict (only) the transition probability matrix gamma
beta      &lt;- rep(list(NULL), 2)
beta[[1]] &lt;- matrix(c(0.5, 1.0,
                     -0.5, 0.5,
                      0.0, 1.0), byrow = TRUE, ncol = 2)
xx_vec      &lt;- rep(list(NULL),2)
xx_vec[[1]] &lt;-  c(rep(0,5), rep(1,5))
data2 &lt;- sim_mHMM(n_t = n_t, n = n, gen = list(m = m, n_dep = n_dep, q_emiss = q_emiss),
                  gamma = gamma, emiss_distr = emiss_distr, beta = beta, xx_vec = xx_vec,
                  var_gamma = 1, var_emiss = 1)


# simulating subject specific transition probability matrices and emission distributions only
n_t &lt;- 0
n &lt;- 5
m &lt;- 3
n_dep   &lt;- 1
q_emiss &lt;- 4
gamma &lt;- matrix(c(0.8, 0.1, 0.1,
                  0.2, 0.7, 0.1,
                  0.2, 0.2, 0.6), ncol = m, byrow = TRUE)
emiss_distr &lt;- list(matrix(c(0.5, 0.5, 0.0, 0.0,
                             0.1, 0.1, 0.8, 0.0,
                             0.0, 0.0, 0.1, 0.9), nrow = m, ncol = q_emiss, byrow = TRUE))
data3 &lt;- sim_mHMM(n_t = n_t, n = n, gen = list(m = m, n_dep = n_dep, q_emiss = q_emiss),
                  gamma = gamma, emiss_distr = emiss_distr, var_gamma = 1, var_emiss = 1)
data3

data4 &lt;- sim_mHMM(n_t = n_t, n = n, gen = list(m = m, n_dep = n_dep, q_emiss = q_emiss),
                  gamma = gamma, emiss_distr = emiss_distr, var_gamma = .5, var_emiss = .5)
data4


## Example on multivariate continuous data
# simulating multivariate continuous data
n_t     &lt;- 100
n       &lt;- 10
m       &lt;- 3
n_dep   &lt;- 2

gamma   &lt;- matrix(c(0.8, 0.1, 0.1,
                    0.2, 0.7, 0.1,
                    0.2, 0.2, 0.6), ncol = m, byrow = TRUE)

emiss_distr &lt;- list(matrix(c( 50, 10,
                              100, 10,
                              150, 10), nrow = m, byrow = TRUE),
                    matrix(c(5, 2,
                             10, 5,
                             20, 3), nrow = m, byrow = TRUE))

data_cont &lt;- sim_mHMM(n_t = n_t, n = n, data_distr = 'continuous',
                      gen = list(m = m, n_dep = n_dep),
                      gamma = gamma, emiss_distr = emiss_distr,
                      var_gamma = .5, var_emiss = c(5^2, 0.2^2))

head(data_cont$states)
head(data_cont$obs)


## Example on multivariate count data without covariates
n_t     &lt;- 200     # Number of observations on the dependent variable
m       &lt;- 3        # Number of hidden states
n_dep   &lt;- 2        # Number of dependent variables
n_subj  &lt;- 30        # Number of subjects

gamma   &lt;- matrix(c(0.9, 0.05, 0.05,
                    0.2, 0.7, 0.1,
                    0.2,0.3, 0.5), ncol = m, byrow = TRUE)

emiss_distr &lt;- list(matrix(c(20,
                             10,
                             5), nrow = m, byrow = TRUE),
                    matrix(c(50,
                             3,
                             20), nrow = m, byrow = TRUE))

# Define between subject variance to use on the simulating function:
# here, the variance is varied over states within the dependent variable.
var_emiss &lt;- list(matrix(c(5.0, 3.0, 1.5), nrow = m),
                  matrix(c(5.0, 5.0, 5.0), nrow = m))

# Simulate count data:
data_count &lt;- sim_mHMM(n_t = n_t,
                       n = n_subj,
                       data_distr = "count",
                       gen = list(m = m, n_dep = n_dep),
                       gamma = gamma,
                       emiss_distr = emiss_distr,
                       var_gamma = 0.1,
                       var_emiss = var_emiss,
                       return_ind_par = TRUE)


## Example on multivariate count data with covariates
# Simulate data with one covariate for each count dependent variable

n_t     &lt;- 200     # Number of observations on the dependent variable
m       &lt;- 3        # Number of hidden states
n_dep   &lt;- 3        # Number of dependent variables
n_subj  &lt;- 30        # Number of subjects

gamma   &lt;- matrix(c(0.9, 0.05, 0.05,
                    0.2, 0.7, 0.1,
                    0.2,0.3, 0.5), ncol = m, byrow = TRUE)

emiss_distr &lt;- list(matrix(c(20,
                             10,
                             5), nrow = m, byrow = TRUE),
                    matrix(c(15,
                             2,
                             5), nrow = m, byrow = TRUE),
                    matrix(c(50,
                             3,
                             20), nrow = m, byrow = TRUE))

# Since we have covariates, we specify inputs in the log scale:
emiss_distr_log &lt;- lapply(emiss_distr, function(e) log(e))

# Define list of vectors of covariate values
set.seed(42)
xx_vec &lt;- c(list(NULL),rep(list(rnorm(n_subj,mean = 0, sd = 0.1)),3))

# Define object beta with regression coefficients for the three dependent variables
beta      &lt;- rep(list(NULL), n_dep+1)
beta[[2]] &lt;- matrix(c(1,-1,0), byrow = TRUE, ncol = 1)
beta[[3]] &lt;- matrix(c(2,0,-2), byrow = TRUE, ncol = 1)
beta[[4]] &lt;- matrix(c(-1,3,1), byrow = TRUE, ncol = 1)

# Calculate logvar to use on the simulating function:
logvar &lt;- var_to_logvar(gen = list(m = m, n_dep = n_dep),
                        emiss_mu = emiss_distr,
                        var_emiss =  list(rep(4, m),
                                          rep(2, m),
                                          rep(5, m)),
                        byrow = FALSE)

# Put logvar in the right format:
logvar &lt;- lapply(logvar, function(q) matrix(q, nrow = m))

# Simulate count data:
data_count &lt;- sim_mHMM(n_t = n_t,
                       n = n_subj,
                       data_distr = "count",
                       gen = list(m = m, n_dep = n_dep),
                       gamma = gamma,
                       emiss_distr = emiss_distr_log,
                       xx_vec = xx_vec,
                       beta = beta,
                       var_gamma = 0.1,
                       var_emiss = logvar,
                       return_ind_par = TRUE,
                       log_scale = TRUE)

head(data_count$states)
head(data_count$obs)
</code></pre>


</div>