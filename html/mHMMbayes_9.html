<div class="container">

<table style="width: 100%;"><tr>
<td>pd_RW_emiss_cat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Proposal distribution settings RW Metropolis sampler for mHMM categorical emission distribution(s)</h2>

<h3>Description</h3>

<p><code>pd_RW_emiss_cat</code> provides a framework to manually specify the
settings of the proposal distribution of the random walk (RW) Metropolis
sampler of categorical emission distribution(s) of the multilevel hidden Markov
model, and creates on object of the class <code>mHMM_pdRW_emiss</code>. The RW
metropolis sampler is used for sampling the subject level parameter estimates
relating to the emission distributions of the dependent variables <code>k</code>,
that is, the Multinomial logistic regression intercepts.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pd_RW_emiss_cat(gen, emiss_int_mle0, emiss_scalar, emiss_w)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>gen</code></td>
<td>
<p>List containing the following elements denoting the general model
properties:
</p>

<ul>
<li>
<p><code>m</code>: numeric vector with length 1 denoting the number
of hidden states
</p>
</li>
<li>
<p><code>n_dep</code>: numeric vector with length 1 denoting the
number of dependent variables
</p>
</li>
<li>
<p><code>q_emiss</code>: only to be specified if the data represents
categorical data. Numeric vector with length <code>n_dep</code> denoting the
number of observed categories for the categorical emission distribution
for each of the dependent variables.</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>emiss_int_mle0</code></td>
<td>
<p>A list containing <code>n_dep</code> elements corresponding
to each of the dependent variables <code>k</code>, where each element is a matrix
with <code>m</code> rows and <code>q_emiss[k]</code> - 1 columns denoting the starting
values for the maximum likelihood (ML) estimates of the Multinomial logit
regression intercepts of the emission distribution(s). ML parameters to be
estimated are based on the pooled data (data over all subjects).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>emiss_scalar</code></td>
<td>
<p>A list containing <code>n_dep</code> elements
corresponding to each of the dependent variables, where each element is a
numeric vector with length 1 denoting the scale factor <code>s</code>. That is,
the scale of the proposal distribution is composed of a covariance matrix
Sigma, which is then tuned by multiplying it by a scaling factor <code>s</code>^2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>emiss_w</code></td>
<td>
<p>A list containing <code>n_dep</code> elements corresponding
to each of the dependent variables, where each element is a numeric vector
with length 1 denoting the weight for the overall log likelihood (i.e., log
likelihood based on the pooled data over all subjects) in the fractional
likelihood.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When no manual values for the settings of the proposal distribution of the
random walk (RW) Metropolis sampler are specified at all (that is, the
function <code>pd_RW_emiss_cat</code> is not used), all elements in
<code>emiss_int_mle0</code> set to 0, <code>emiss_scalar</code> set to 2.93 /
sqrt(<code>q_emiss[k]</code> - 1), and <code>emiss_w</code> set to 0.1. See the section
<em>Scaling the proposal distribution of the RW Metropolis sampler</em> in
<code>vignette("estimation-mhmm")</code> for details.
</p>
<p>Within the function <code>mHMM</code>, the acceptance rate of the RW metropolis
sampler relating to the emission distribution(s) can be tracked using the
output parameter <code>emiss_naccept</code>. An acceptance rate of about 23% is
considered optimal when many parameters are being updated at once (Gelman,
Carlin, Stern &amp; Rubin, 2014).
</p>


<h3>Value</h3>

<p><code>pd_RW_emiss_cat</code> returns an object of class
<code>mHMM_pdRW_emiss</code>, containing settings of the proposal distribution of
the random walk (RW) Metropolis sampler on the categorical emission
distribution(s) of the multilevel hidden Markov model. The object is
specifically created and formatted for use by the function <code>mHMM</code>, and
checked for correct input dimensions. The object contains the following
components:
</p>

<dl>
<dt><code>gen</code></dt>
<dd>
<p>A list containing the elements <code>m</code>, <code>n_dep</code>,
and <code>q_emiss</code>, used for checking equivalent general model properties
specified under <code>pd_RW_emiss_cat</code> and <code>mHMM</code>.</p>
</dd>
<dt><code>emiss_int_mle0</code></dt>
<dd>
<p>A list containing <code>n_dep</code> elements, where
each element is a matrix  containing the starting values for the maximum
likelihood (ML) estimates of the Multinomial logit regression intercepts of
the emission distribution(s).</p>
</dd>
<dt><code>emiss_scalar</code></dt>
<dd>
<p>A list containing <code>n_dep</code> elements denoting
the scale factor <code>s</code> of the proposal distribution.</p>
</dd>
<dt><code>emiss_w</code></dt>
<dd>
<p>A list containing <code>n_dep</code> elements denoting
denoting the weight for the overall log likelihood in the fractional
likelihood.</p>
</dd>
</dl>
<h3>References</h3>

<p>Gelman A, Carlin JB, Stern HS, Rubin DB (2014).
<em>Bayesian Data Analysis vol. 2</em>.
Taylor &amp; Francis.
</p>
<p>Rossi PE, Allenby GM, McCulloch R (2012).
<em>Bayesian statistics and marketing</em>.
John Wiley &amp; Sons.
</p>


<h3>Examples</h3>

<pre><code class="language-R">###### Example using package example data, see ?nonverbal
# specifying general model properties:
m &lt;- 3
n_dep &lt;- 4
q_emiss &lt;- c(3, 2, 3, 2)

# specifying manual values for RW metropolis sampler on emission distributions
emiss_int_mle0 &lt;- list(matrix(c( 2,  0,
                                -2, -2,
                                 0, -1), byrow = TRUE, nrow = m, ncol = q_emiss[1] - 1),
                       matrix(c( 2,
                                 2,
                                 2), byrow = TRUE, nrow = m, ncol = q_emiss[2] - 1),
                       matrix(c(-2, -2,
                                 2,  0,
                                 0, -1), byrow = TRUE, nrow = m, ncol = q_emiss[3] - 1),
                       matrix(c( 2,
                                 2,
                                 2), byrow = TRUE, nrow = m, ncol = q_emiss[4] - 1))
emiss_scalar &lt;- list(c(2), c(3), c(2), c(3))
emiss_w &lt;- rep(list(c(0.2)), n_dep)
manual_emiss_sampler &lt;- pd_RW_emiss_cat(gen = list(m = m, n_dep = n_dep, q_emiss = q_emiss),
                                        emiss_int_mle0 = emiss_int_mle0,
                                        emiss_scalar = emiss_scalar,
                                        emiss_w = emiss_w)

# specifying starting values
start_TM &lt;- diag(.7, m)
start_TM[lower.tri(start_TM) | upper.tri(start_TM)] &lt;- .1
start_EM &lt;- list(matrix(c(0.05, 0.90, 0.05,
                          0.90, 0.05, 0.05,
                          0.55, 0.45, 0.05), byrow = TRUE,
                        nrow = m, ncol = q_emiss[1]), # vocalizing patient
                 matrix(c(0.1, 0.9,
                          0.1, 0.9,
                          0.1, 0.9), byrow = TRUE, nrow = m,
                        ncol = q_emiss[2]), # looking patient
                 matrix(c(0.90, 0.05, 0.05,
                          0.05, 0.90, 0.05,
                          0.55, 0.45, 0.05), byrow = TRUE,
                        nrow = m, ncol = q_emiss[3]), # vocalizing therapist
                 matrix(c(0.1, 0.9,
                          0.1, 0.9,
                          0.1, 0.9), byrow = TRUE, nrow = m,
                        ncol = q_emiss[4])) # looking therapist

# Note that for reasons of running time, J is set at a ridiculous low value.
# One would typically use a number of iterations J of at least 1000,
# and a burn_in of 200.

out_3st_RWemiss &lt;- mHMM(s_data = nonverbal,
                         gen = list(m = m, n_dep = n_dep, q_emiss = q_emiss),
                         start_val = c(list(start_TM), start_EM),
                         emiss_sampler = manual_emiss_sampler,
                         mcmc = list(J = 11, burn_in = 5))

out_3st_RWemiss
summary(out_3st_RWemiss)

# checking acceptance rate (for illustrative purposes, in the example,
# J is too low for getting a fair indication)
div_J &lt;- function(x, J) x / J
J_it &lt;- 11 - 1 # accept/reject starts at iteration 2 of MCMC algorithm
RW_emiss_accept &lt;- sapply(out_3st_RWemiss$emiss_naccept, div_J, J_it, simplify = FALSE)

# average acceptance rate over all subjects per parameter
# rows represent each of the n_dep dependent variables, columns represent the m states
t(sapply(RW_emiss_accept, apply, MARGIN = 2, mean))




</code></pre>


</div>