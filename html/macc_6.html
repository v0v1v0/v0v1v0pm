<div class="container">

<table style="width: 100%;"><tr>
<td>sim.data.multi</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> Generate two/three-level simulation data
</h2>

<h3>Description</h3>

<p> This function generates a two/three-level dataset with given parameters.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sim.data.multi(Z.list, N, K = 1, Theta, Sigma, 
    Psi = diag(rep(1, 3)), Lambda = diag(rep(1, 3)))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Z.list</code></td>
<td>
<p> a list of data. When <code>K = 1</code> (a two-level dataset), each list is a vector containing the treatment/exposure assignment of the trials for each subject; When <code>K &gt; 1</code> (a three-level dataset), each list is a list of length <code>K</code>, and each contains a vector of treatment/exposure assignment.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p> an integer, indicates the number of subjects.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p> an integer, indicates the number of sessions of each subject. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Theta</code></td>
<td>
<p> a 2 by 2 matrix, containing the population level model coefficients.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma</code></td>
<td>
<p> a 2 by 2 matrix, is the covariance matrix of the model errors in the single-level model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Psi</code></td>
<td>
<p> the covariance matrix of the random effects in the mixed effects model of the model coefficients. This is used only when <code>K &gt; 1</code>. Default is a 3-dimensional identity matrix.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Lambda</code></td>
<td>
<p> the covariance matrix of the model errors in the mixed effects model if <code>K &gt; 1</code> or the linear model if <code>K = 1</code> of the model coefficients.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p> When <code>K &gt; 1</code> (three-level data), for the <code class="reqn">n_{ik}</code> trials in each session of each subject, the single level mediation model is
</p>
<p style="text-align: center;"><code class="reqn">M_{ik}=Z_{ik}A_{ik}+E_{1ik},</code>
</p>

<p style="text-align: center;"><code class="reqn">R_{ik}=Z_{ik}C_{ik}+M_{ik}B_{ik}+E_{2ik},</code>
</p>

<p>where <code class="reqn">Z_{ik}</code>, <code class="reqn">M_{ik}</code>, <code class="reqn">R_{ik}</code>, <code class="reqn">E_{1ik}</code>, and <code class="reqn">E_{2ik}</code> are vectors of length <code class="reqn">n_{ik}</code>. <code>Sigma</code> is the covariance matrix of <code class="reqn">(E_{1ik},E_{2ik})</code> (for simplicity, <code>Sigma</code> is the same across sessions and subjects). For coefficients <code class="reqn">A_{ik}</code>, <code class="reqn">B_{ik}</code> and <code class="reqn">C_{ik}</code>, we assume a mixed effects model. The random effects are from a trivariate normal distribution with mean zero and covariance <code>Psi</code>; and the model errors are from a trivariate normal distribution with mean zero and covariance <code>Lambda</code>. For the fixed effects <code class="reqn">A</code>, <code class="reqn">B</code> and <code class="reqn">C</code>, the values are specified in <code>Theta</code> with <code>Theta[1,1] = A</code>, <code>Theta[1,2] = C</code> and <code>Theta[2,2] = B</code>.
</p>
<p>When <code>K = 1</code> (two-level data), the single-level model coefficients <code class="reqn">A_{i}</code>, <code class="reqn">B_{i}</code> and <code class="reqn">C_{i}</code> are assumed to follow a trivariate linear regression model, where the population level coefficients are specified in <code>Theta</code> and the model errors are from a trivariate normal distribution with mean zero and covariance <code>Lambda</code>. 
</p>
<p>See Section 5.2 of the reference for details.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a list of data. When <code>K = 1</code>, each list is a contains a dataframe; when <code>K &gt; 1</code>, each list is a list of length <code>K</code>, and within each list is a dataframe.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A</code></td>
<td>
<p>the value of <code class="reqn">A</code>s. When <code>K = 1</code>, it is a vector of length <code>N</code>; when <code>K &gt; 1</code>, it is a <code>N</code> by <code>K</code> matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>the value of <code class="reqn">B</code>s. When <code>K = 1</code>, it is a vector of length <code>N</code>; when <code>K &gt; 1</code>, it is a <code>N</code> by <code>K</code> matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C</code></td>
<td>
<p>the value of <code class="reqn">C</code>s. When <code>K = 1</code>, it is a vector of length <code>N</code>; when <code>K &gt; 1</code>, it is a <code>N</code> by <code>K</code> matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>a character indicates the type of the dataset. When <code>K = 1</code>, <code>type = twolevel</code>; when <code>K &gt; 1</code>, <code>type = multilevel</code></p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p> Yi Zhao, Brown University, <a href="mailto:yi_zhao@brown.edu">yi_zhao@brown.edu</a>;
Xi Luo, Brown University, <a href="mailto:xi.rossi.luo@gmail.com">xi.rossi.luo@gmail.com</a>
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2014). <em>Estimating Mediation Effects under Correlated Errors with an Application to fMRI.</em> arXiv preprint arXiv:1410.7217.
</p>


<h3>Examples</h3>

<pre><code class="language-R">   ###################################################
    # Generate a two-level dataset

    # covariance matrix of errors
    delta&lt;-0.5
    Sigma&lt;-matrix(c(1,2*delta,2*delta,4),2,2)

    # model coefficients
    A0&lt;-0.5
    B0&lt;--1
    C0&lt;-0.5

    Theta&lt;-matrix(c(A0,0,C0,B0),2,2)

    # number of subjects, and trials of each
    set.seed(2000)
    N&lt;-50
    K&lt;-1
    n&lt;-matrix(NA,N,K)
    for(i in 1:N)
    {
      n0&lt;-rpois(1,100)
      n[i,]&lt;-rpois(K,n0)
    }

    # treatment assignment list
    set.seed(100000)
    Z.list&lt;-list()
    for(i in 1:N)
    {
      Z.list[[i]]&lt;-rbinom(n[i,1],size=1,prob=0.5)
    }

    # Lambda
    rho.AB=rho.AC=rho.BC&lt;-0
    Lambda&lt;-matrix(0,3,3)
    lambda2.alpha=lambda2.beta=lambda2.gamma&lt;-0.5
    Lambda[1,2]=Lambda[2,1]&lt;-rho.AB*sqrt(lambda2.alpha*lambda2.beta)
    Lambda[1,3]=Lambda[3,1]&lt;-rho.AC*sqrt(lambda2.alpha*lambda2.gamma)
    Lambda[2,3]=Lambda[3,2]&lt;-rho.BC*sqrt(lambda2.beta*lambda2.gamma)
    diag(Lambda)&lt;-c(lambda2.alpha,lambda2.beta,lambda2.gamma)

    # Data
    set.seed(5000)
    re.dat&lt;-sim.data.multi(Z.list=Z.list,N=N,K=K,Theta=Theta,Sigma=Sigma,Lambda=Lambda)
    data2&lt;-re.dat$data
    ###################################################

    ###################################################
    # Generate a three-level dataset

    # covariance matrix of errors
    delta&lt;-0.5
    Sigma&lt;-matrix(c(1,2*delta,2*delta,4),2,2)

    # model coefficients
    A0&lt;-0.5
    B0&lt;--1
    C0&lt;-0.5

    Theta&lt;-matrix(c(A0,0,C0,B0),2,2)

    # number of subjects, and trials of each
    set.seed(2000)
    N&lt;-50
    K&lt;-4
    n&lt;-matrix(NA,N,K)
    for(i in 1:N)
    {
      n0&lt;-rpois(1,100)
      n[i,]&lt;-rpois(K,n0)
    }

    # treatment assignment list
    set.seed(100000)
    Z.list&lt;-list()
    for(i in 1:N)
    {
      Z.list[[i]]&lt;-list()
      for(j in 1:K)
      {
        Z.list[[i]][[j]]&lt;-rbinom(n[i,j],size=1,prob=0.5)
      }
    }

    # Psi and Lambda
    sigma2.alpha=sigma2.beta=sigma2.gamma&lt;-0.5
    theta2.alpha=theta2.beta=theta2.gamma&lt;-0.5
    Psi&lt;-diag(c(sigma2.alpha,sigma2.beta,sigma2.gamma))
    Lambda&lt;-diag(c(theta2.alpha,theta2.beta,theta2.gamma))

    # Data
    set.seed(5000)
    re.dat&lt;-sim.data.multi(Z.list,N,K,Theta,Sigma,Psi,Lambda)
    data3&lt;-re.dat$data
    ###################################################
</code></pre>


</div>