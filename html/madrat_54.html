<div class="container">

<table style="width: 100%;"><tr>
<td>toolAggregate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>toolAggregate</h2>

<h3>Description</h3>

<p>(Dis-)aggregates a magclass object from one resolution to another based on a
relation matrix or mapping
</p>


<h3>Usage</h3>

<pre><code class="language-R">toolAggregate(
  x,
  rel,
  weight = NULL,
  from = NULL,
  to = NULL,
  dim = 1,
  wdim = NULL,
  partrel = FALSE,
  negative_weight = "warn",
  mixed_aggregation = FALSE,
  verbosity = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>magclass object that should be (dis-)aggregated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rel</code></td>
<td>
<p>relation matrix, mapping or file containing a mapping in a format
supported by <code>toolGetMapping</code> (currently csv, rds or rda).
A mapping object consists of any number of columns, where one column contains
all the elements in x. These elements are mapped to the corresponding values
in another column, as described below (see parameter 'from').
It is possible to not set <code>rel</code> as long as <code>to</code> is set and <code>dim</code>
is chosen appropriately. In that case the relation mapping is extracted from
the dimnames of the corresponding dimension, e.g. if your data contains a
spatial subdimension "country" you can aggregate to countries via
<code>toolAggregate(x, to = "country", dim = 1)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight</code></td>
<td>
<p>magclass object containing weights which should be considered
for a weighted aggregation. The provided weight should only contain positive
values, but does not need to be normalized (any positive number&gt;=0 is allowed).
Please see the "details" section below for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>from</code></td>
<td>
<p>Name of source column to be used in rel if it is a
mapping (if not set the first column matching the data will be used).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to</code></td>
<td>
<p>Name of the target column to be used in rel if it is a
mapping (if not set the column following column <code>from</code> will be used
If column <code>from</code> is the last column, the column before <code>from is
used</code>). If data should be aggregated based on more than one column these
columns can be specified via "+", e.g. "region+global" if the data should
be aggregated to column regional as well as column global.
If rel is missing <code>to</code> refers to the aggregation target dimension name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dim</code></td>
<td>
<p>Specifying the dimension of the magclass object that should be
(dis-)aggregated. Either specified as an integer
(1=spatial,2=temporal,3=data) or if you want to specify a sub dimension
specified by name of that dimension or position within the given dimension
(e.g. 3.2 means the 2nd data dimension, 3.8 means the 8th data dimension).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wdim</code></td>
<td>
<p>Specifying the according weight dimension as chosen with dim
for the aggregation object. If set to NULL the function will try to
automatically detect the dimension.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>partrel</code></td>
<td>
<p>If set to TRUE allows that the relation matrix does contain
less entries than x and vice versa. These values without relation are lost
in the output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>negative_weight</code></td>
<td>
<p>Describes how a negative weight should be treated. "allow"
means that it just should be accepted (dangerous), "warn" returns a warning and
"stop" will throw an error in case of negative values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mixed_aggregation</code></td>
<td>
<p>boolean which allows for mixed aggregation (weighted
mean mixed with summations). If set to TRUE weight columns filled with NA
will lead to summation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbosity</code></td>
<td>
<p>Verbosity level of messages coming from the function: -1 = error,
0 = warning, 1 = note, 2 = additional information, &gt;2 = no message</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Basically toolAggregate is doing nothing more than a normal matrix
multiplication which is taking into account the 3 dimensional structure of
MAgPIE objects. So, you can provide any kind of relation matrix you would
like. However, for easier usability it is also possible to provide weights
for a weighted (dis-)aggregation as a MAgPIE object. In this case rel must
be a 1-0-matrix or a mapping between both resolutions. The weight
needs to be provided in the higher spatial aggregation, meaning for
aggregation the spatial resolution of your input data and in the case of
disaggregation the spatial resolution of your output data. The temporal and
data dimension must be either identical to the resolution of the data set
that should be (dis-)aggregated or 1. If the temporal and/or data dimension
is 1 this means that the same transformation matrix is applied for all years
and/or all data columns. In the case that a column should be just summed up
instead of being calculated as a weighted average you either do not provide
any weight (then all columns are just summed up) or your set this specific
weighting column to NA and mixed_aggregation to TRUE.
</p>


<h3>Value</h3>

<p>the aggregated data in magclass format
</p>


<h3>Author(s)</h3>

<p>Jan Philipp Dietrich, Ulrich Kreidenweis
</p>


<h3>See Also</h3>

<p><code>calcOutput</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# create example mapping
p &lt;- magclass::maxample("pop")
mapping &lt;- data.frame(from = magclass::getItems(p, dim = 1.1),
  region = rep(c("REG1", "REG2"), 5),
  global = "GLO")
mapping

# run aggregation
toolAggregate(p, mapping)
# weighted aggregation
toolAggregate(p, mapping, weight = p)
# combined aggregation across two columns
toolAggregate(p, mapping, to = "region+global")

</code></pre>


</div>