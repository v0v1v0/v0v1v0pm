<div class="container">

<table style="width: 100%;"><tr>
<td>testDynamicalModel</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Test dynamic system model specification</h2>

<h3>Description</h3>

<p>Given functions for the ODE and its gradients (with respect to the system components and parameters), verify the correctness of the gradients using numerical differentiation.
</p>


<h3>Usage</h3>

<pre><code class="language-R">testDynamicalModel(modelODE, modelDx, modelDtheta, modelName, x, theta, tvec)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>modelODE</code></td>
<td>
<p>function that computes the ODEs, specified with the form <code>f(theta, x, tvec)</code>. See examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modelDx</code></td>
<td>
<p>function that computes the gradients of the ODEs with respect to the system components. See examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modelDtheta</code></td>
<td>
<p>function that computes the gradients of the ODEs with respect to the parameters <code class="reqn">\theta</code>. See examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modelName</code></td>
<td>
<p>string giving a name for the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>data matrix of system values, one column for each component, at which to test the gradients</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>vector of parameter values for <code class="reqn">\theta</code>, at which to test the gradients</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tvec</code></td>
<td>
<p>vector of time points corresponding to the rows of <code>x</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Calls <code>test_that</code> to test equality of the analytic and numeric gradients.
</p>


<h3>Value</h3>

<p>A list with elements <code>testDx</code> and <code>testDtheta</code>, each with value <code>TRUE</code> if the corresponding gradient check passed and <code>FALSE</code> if not.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># ODE system and gradients for Fitzhugh-Nagumo equations: fnmodelODE, fnmodelDx, fnmodelDtheta

# Example of incorrect gradient with respect to parameters theta
fnmodelDthetaWrong &lt;- function(theta, x, tvec) {
  resultDtheta &lt;- array(0, c(nrow(x), length(theta), ncol(x)))
  
  V = x[, 1]
  R = x[, 2]
  
  resultDtheta[, 3, 1] = V - V^3 / 3.0 - R
  
  resultDtheta[, 1, 2] =  1.0 / theta[3] 
  resultDtheta[, 2, 2] = -R / theta[3]
  resultDtheta[, 3, 2] = 1.0 / (theta[3]^2) * (V - theta[1] + theta[2] * R)
  
  resultDtheta
}

# Sample data for testing gradient correctness
data(FNdat)
 
# Correct gradients
testDynamicalModel(fnmodelODE, fnmodelDx, fnmodelDtheta, 
    "FN equations", FNdat[, c("V", "R")], c(.5, .6, 2), FNdat$time)
    
# Incorrect theta gradient (test fails)
testDynamicalModel(fnmodelODE, fnmodelDx, fnmodelDthetaWrong, 
    "FN equations", FNdat[, c("V", "R")], c(.5, .6, 2), FNdat$time)
    

</code></pre>


</div>