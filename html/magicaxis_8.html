<div class="container">

<table style="width: 100%;"><tr>
<td>magcutout</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Image Cutout Utility
</h2>

<h3>Description</h3>

<p>Function to subset raw images/matrices.
</p>


<h3>Usage</h3>

<pre><code class="language-R">magcutout(image, loc = dim(image)/2, box = c(100, 100), shiftloc = FALSE, paddim = TRUE,
  padval = NA, plot = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>image</code></td>
<td>

<p>Numeric matrix; required, the image we want to cutout. If <span class="option">image</span> is a path to an <code>fst</code> format file then the cutout can be done on disk directly.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loc</code></td>
<td>

<p>Numeric vector; the [x,y] location where we want to cutout the image.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>box</code></td>
<td>

<p>Numeric vector; the dimensions of the box to cut out from <span class="option">image</span> centred on <span class="option">loc</span>. For <code>magcutout</code> the <span class="option">box</span> unit is always pixels.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shiftloc</code></td>
<td>

<p>Logical; should the cutout centre shift from <span class="option">loc</span> away from the <span class="option">image</span> edge if the desired <span class="option">box</span> size extends beyond the edge of the <span class="option">image</span>?
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>paddim</code></td>
<td>

<p>Logical; should the cutout dimensions be padded with with value of <span class="option">padval</span> for data outside the <span class="option">image</span> boundary (TRUE)? If FALSE the dimensions will truncate when the edge of the input <span class="option">image</span> has been reached.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>padval</code></td>
<td>

<p>Numeric scalar; the value to use for padding if <span class="option">paddim</span>=TRUE.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>

<p>Logical; should a <code>magimage</code> plot of the output be generated?
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Dots are parsed to <code>magimage</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is on a level trivial, since it is easy to subset matrices and therefore images within R. However <code>magcutout</code> tracks important properties of the subset region that makes it easy to track its location with respect to the original matrix/image. Also, it allows direct plotting of the resultant cutout with the most appropriate image functions. In many cases these functions will be used purely for their plotting side effects.
</p>
<p>The <span class="option">shiftloc</span> and <span class="option">paddim</span> control the behaviour of the function in the non-trivial case when the desired box size extendeds beyond the edge of the image. If <span class="option">shiftloc</span> is FALSE (the default behaviour), the cutout is guaranteed to be centred on the pixel specified by <span class="option">loc</span>. Then, if <span class="option">paddim</span> is FALSE, the cutout extends only as far as possible until it reaches the edge of the image; otherwise if <span class="option">paddim</span> is TRUE the cutout image is padded with NAs in regions outside the supplied <span class="option">image</span> (the default behaviour). If <span class="option">shiftloc</span> is TRUE, the centre of the cutout will be shifted. In this case, if <span class="option">paddim</span> is FALSE, the cutout will extend at most half of the supplied <span class="option">box</span> size from the given <span class="option">loc</span>; otherwise if <span class="option">paddim</span> is TRUE the cutout will be expanded until it reaches the desired <span class="option">box</span> size or spans the entire image.
</p>
<p>Note that if <span class="option">shiftloc</span> is TRUE and <span class="option">paddim</span> is FALSE, the cutout can be larger than <span class="option">box</span>; otherwise, the cutout is guaranteed to be no larger than the specified <span class="option">box</span> size.
</p>


<h3>Value</h3>

<p>A list containing:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>image</code></td>
<td>
<p>Numeric matrix; the cutout region of interst centred around <span class="option">loc</span>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loc</code></td>
<td>
<p>The new <span class="option">loc</span> vector that tranforms the input <span class="option">loc</span> x and y location to the new <span class="option">cutim</span> coordinates. This is in ProFit coordinates, so these values can be used when, e.g., constructing a ProFit modellist structure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loc.orig</code></td>
<td>
<p>The original location is provided by the input <span class="option">loc</span>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loc.diff</code></td>
<td>
<p>The x and y offsets of the cutout compared to the original image, where <span class="option">loc</span> + <span class="option">loc.diff</span> = <span class="option">loc.orig</span> exactly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xsel</code></td>
<td>
<p>Integer vector; the extracted x pixels from the original <span class="option">image</span> that form <span class="option">cutim</span>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ysel</code></td>
<td>
<p>Integer vector; the extracted y pixels from the original <span class="option">image</span> that form <span class="option">cutim</span>.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>By R convention the bottom-left part of the bottom-left pixel when plotting the image matrix is c(0,0) and the top-right part of the bottom-left pixel is c(1,1), i.e. the mid-point of pixels are half integer values in x and y. This differs to the FITS convention of pixel mid points being integer values. As such the R [x,y] = FITS [x-0.5,y-0.5]. This rarely matters too much in practice, but for accurate overlays you will want to get it right (see Examples).
</p>
<p>It is ambiguous what the desired outcome is in some cutting scenarios, e.g. what should be returned if a 3x3 cutout is requested at the "centre" of a 8x8 image? For this reason, and to avoid unexpected results due to numerical precision, you should only cut out even pixel dimensions if integer pixel coordinates are provided, and odd pixel dimensions if half-integer pixel coordinates are provided. Regardless, the <span class="option">loc</span> and <span class="option">loc.orig</span> outputs will always help you locate the absolute coordinates of your desired cut out centre in both the cut out and the original image coordinate system.
</p>


<h3>Author(s)</h3>

<p>Aaron Robotham &amp; Dan Taranu
</p>


<h3>Examples</h3>

<pre><code class="language-R">temp=matrix(1:121,11)

#The central value is at:

temp[6,6]

print(magcutout(temp, dim(temp)/2, box=c(3,3))$image)

#Given we cutout around the centre of the central pixel [5.5,5.5], the new centre
#relative to the cutout image output should be at [1.5,1.5]:

print(magcutout(temp, dim(temp)/2, box=c(3,3))$loc.orig)
print(magcutout(temp, dim(temp)/2, box=c(3,3))$loc)
</code></pre>


</div>