<div class="container">

<table style="width: 100%;"><tr>
<td>mail_merge</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Merges data into an email and send.</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt="[Experimental]"></a>
</p>
<p>Merges columns from a data frame into a markdown document using the
<code>glue::glue_data()</code> function. The markdown can contain a yaml header for
subject and cc line.
</p>
<p>Note that only 'gmail' is supported at the moment, via gmailr::gm_send_message.
</p>
<p>Before using <code>mail_merge()</code>, you must be authenticated to the gmail service.
Use <code>gmailr::gm_auth()</code> to authenticate prior to starting the mail merge.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mail_merge(
  data,
  message,
  to_col = "email",
  send = c("preview", "draft", "immediately"),
  confirm = FALSE,
  sleep_preview = 1,
  sleep_send = 0.1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame or <code>tibble</code> with all the columns that should be
glued into the message. Substitution is performed using
<code>glue::glue_data()</code>'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>message</code></td>
<td>
<p>A list with components <code>yaml</code> and <code>body</code>.  You can use
<code>mm_read_message()</code> or <code>mm_read_message_googledoc()</code> to construct a
message in this format.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to_col</code></td>
<td>
<p>The name of the column in <code>data</code> that contains the email
address to send the message to.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>send</code></td>
<td>
<p>A character string, one of:
</p>

<ul>
<li>
<p> "preview" : displays message in viewer without sending mail
</p>
</li>
<li>
<p> "draft : writes message into "drafts" folder on gmail
</p>
</li>
<li>
<p> "immediately" : sends email
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>confirm</code></td>
<td>
<p>If <code>TRUE</code> sends email without additional confirmation.
If <code>FALSE</code> asks for confirmation before sending.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sleep_preview</code></td>
<td>
<p>If <code>send == "preview"</code> the number of seconds to sleep
between each preview. See also preview_mailmerge</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sleep_send</code></td>
<td>
<p>If <code>send == "immediately"</code> the number of seconds to sleep between
each email send (to prevent gmail API 500 errors).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a list for every message, consisting of:
</p>

<ul>
<li> <p><code>msg</code>: The message in <code>mime</code> format
</p>
</li>
<li> <p><code>id</code>: The <code>gmailr</code> response id
</p>
</li>
<li> <p><code>type</code>: preview, draft or sent
</p>
</li>
<li> <p><code>success</code>: TRUE if the message was sent successfully
</p>
</li>
</ul>
<h3>See Also</h3>

<p>preview_mailmerge
</p>


<h3>Examples</h3>

<pre><code class="language-R">## ---- input-data --------------------------------------------------------

dat &lt;-  data.frame(
  email      = c("friend@example.com", "foe@example.com"),
  first_name = c("friend", "foe"),
  thing      = c("something good", "something bad"),
  stringsAsFactors = FALSE
)

## ---- markdown-message --------------------------------------------------

msg &lt;- '
---
subject: "**Hello, {first_name}**"
---

Hi, **{first_name}**

I am writing to tell you about **{thing}**.

{if (first_name == "friend") "Regards" else ""}


Me
'


## ---- mail-merge --------------------------------------------------------

dat %&gt;% 
  mail_merge(msg)

if (interactive()) {
  dat %&gt;%
    mail_merge(msg) %&gt;%
    print()
}

## ---- display shiny gadget ----------------------------------------------

if (interactive()) {
  dat %&gt;%
    mail_merge(msg) %&gt;%
    preview_mailmerge()
}
</code></pre>


</div>