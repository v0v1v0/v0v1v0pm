<div class="container">

<table style="width: 100%;"><tr>
<td>merge_processed_spectra</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Merge multiple processed spectra and peaks</h2>

<h3>Description</h3>

<p>Aggregate multiple processed spectra, their associated peaks and metadata into a feature matrix and a concatenated metadata table.
</p>


<h3>Usage</h3>

<pre><code class="language-R">merge_processed_spectra(
  processed_spectra,
  remove_peakless_spectra = TRUE,
  interpolate_missing = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>processed_spectra</code></td>
<td>
<p>A list of the processed spectra and associated peaks and metadata in two possible formats:
</p>

<ul>
<li>
<p> A list of <strong>in-memory objects</strong> (named <code>spectra</code>, <code>peaks</code>, <code>metadata</code>) produced by process_spectra. Named lists will have names dropped, see Note.
</p>
</li>
<li> <p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> A list of <strong>paths</strong> to RDS files produced by process_spectra when using the <code>rds_prefix</code> option.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>remove_peakless_spectra</code></td>
<td>
<p>A logical indicating whether to discard the spectra without detected peaks.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interpolate_missing</code></td>
<td>
<p>A logical indicating if intensity values for missing peaks should be interpolated from the processed spectra signal or left NA which would then be converted to 0.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <em>n</em>×<em>p</em> matrix, with <em>n</em> spectra as rows and <em>p</em> features as columns that are the peaks found in all the processed spectra.
</p>


<h3>Note</h3>

<p>When aggregating multiple runs of processed spectra, if a named list is
provided, note that the names will be dropped, to prevent further downstream
issues when these names were being appended to the rownames of the matrix
thus preventing downstream metadata merge.
</p>


<h3>See Also</h3>

<p>process_spectra, the "Value" section in <a href="https://rdrr.io/cran/MALDIquant/man/intensityMatrix-functions.html"><code>MALDIquant::intensityMatrix</code></a>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Get an example directory of six Bruker MALDI Biotyper spectra
directory_biotyper_spectra &lt;- system.file(
  "toy-species-spectra",
  package = "maldipickr"
)
# Import the six spectra
spectra_list &lt;- import_biotyper_spectra(directory_biotyper_spectra)
# Transform the spectra signals according to Strejcek et al. (2018)
processed &lt;- process_spectra(spectra_list)
# Merge the spectra to produce the feature matrix
fm &lt;- merge_processed_spectra(list(processed))
# The feature matrix has 6 spectra as rows and
#  35 peaks as columns
dim(fm)
# Notice the difference when the interpolation is turned off
fm_no_interpolation &lt;- merge_processed_spectra(
  list(processed),
  interpolate_missing = FALSE
)
sum(fm == 0) # 0
sum(fm_no_interpolation == 0) # 68

# Multiple runs can be aggregated using list()
# Merge the spectra to produce the feature matrix
fm_all &lt;- merge_processed_spectra(list(processed, processed, processed))
# The feature matrix has 3×6=18 spectra as rows and
#  35 peaks as columns
dim(fm_all)

# If using a list, names will be dropped and are not propagated to the matrix.
## Not run: 
fm_all &lt;- merge_processed_spectra(
 list("A" = processed, "B" = processed, "C" = processed))
any(grepl("A|B|C", rownames(fm_all))) # FALSE
 
## End(Not run)

</code></pre>


</div>