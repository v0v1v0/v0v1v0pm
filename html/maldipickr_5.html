<div class="container">

<table style="width: 100%;"><tr>
<td>delineate_with_similarity</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Delineate clusters from a similarity matrix</h2>

<h3>Description</h3>

<p>From a matrix of spectra similarity (e.g., with the cosine metric,
or Pearson product moment), infer the species clusters based on a
threshold <strong>above</strong> (or <strong>equal to</strong>) which spectra are considered alike.
</p>


<h3>Usage</h3>

<pre><code class="language-R">delineate_with_similarity(sim_matrix, threshold, method = "complete")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sim_matrix</code></td>
<td>
<p>A <code class="reqn">n \times n</code> similarity matrix, with <code class="reqn">n</code> the number of spectra. Columns should be named as the rows.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p>A numeric value indicating the minimal similarity between two spectra. Adjust accordingly to the similarity metric used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>The method of hierarchical clustering to use. The default and recommended method is "complete", but any methods from stats::hclust are valid.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The similarity matrix is converted to a distance matrix by subtracting the value one. This approach works for cosine similarity and positive correlations that have an upper bound of 1. Clusters are then delineated using hierarchical clustering. The default method of hierarchical clustering is the complete linkage (also known as farthest neighbor clustering) to ensure that the within-group minimum similarity of each cluster respects the threshold. See the Details section of stats::hclust for others valid methods to use.
</p>


<h3>Value</h3>

<p>A tibble of <code class="reqn">n</code> rows for each spectra and 3 columns:
</p>

<ul>
<li> <p><code>name</code>: the rownames of the similarity matrix indicating the spectra names
</p>
</li>
<li> <p><code>membership</code>: integers stating the cluster number to which the spectra belong to. It starts from 1 to <code class="reqn">c</code>, the total number of clusters.
</p>
</li>
<li> <p><code>cluster_size</code>: integers indicating the total number of spectra in the corresponding cluster.
</p>
</li>
</ul>
<h3>See Also</h3>

<p>For similarity metrics: <a href="https://rdrr.io/cran/coop/man/cosine.html"><code>coop::tcosine</code></a>, <a href="https://rdrr.io/r/stats/cor.html"><code>stats::cor</code></a>, <a href="https://rdrr.io/cran/Hmisc/man/rcorr.html"><code>Hmisc::rcorr</code></a>. For using taxonomic identifications for clusters : delineate_with_identification. For further analyses: set_reference_spectra.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Toy similarity matrix between the six example spectra of
#  three species. The cosine metric is used and a value of
#  zero indicates dissimilar spectra and a value of one
#  indicates identical spectra.
cosine_similarity &lt;- matrix(
  c(
    1, 0.79, 0.77, 0.99, 0.98, 0.98,
    0.79, 1, 0.98, 0.79, 0.8, 0.8,
    0.77, 0.98, 1, 0.77, 0.77, 0.77,
    0.99, 0.79, 0.77, 1, 1, 0.99,
    0.98, 0.8, 0.77, 1, 1, 1,
    0.98, 0.8, 0.77, 0.99, 1, 1
  ),
  nrow = 6,
  dimnames = list(
    c(
      "species1_G2", "species2_E11", "species2_E12",
      "species3_F7", "species3_F8", "species3_F9"
    ),
    c(
      "species1_G2", "species2_E11", "species2_E12",
      "species3_F7", "species3_F8", "species3_F9"
    )
  )
)
# Delineate clusters based on a 0.92 threshold applied
#  to the similarity matrix
delineate_with_similarity(cosine_similarity, threshold = 0.92)
</code></pre>


</div>