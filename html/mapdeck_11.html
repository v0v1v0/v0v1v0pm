<div class="container">

<table style="width: 100%;"><tr>
<td>add_grid</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add Grid</h2>

<h3>Description</h3>

<p>The Grid Layer renders a grid heatmap based on an array of points.
It takes the constant size all each cell, projects points into cells.
The color and height of the cell is scaled by number of points it contains.
</p>


<h3>Usage</h3>

<pre><code class="language-R">add_grid(
  map,
  data = get_map_data(map),
  lon = NULL,
  lat = NULL,
  polyline = NULL,
  cell_size = 1000,
  extruded = TRUE,
  elevation = NULL,
  elevation_function = c("sum", "mean", "min", "max"),
  colour = NULL,
  colour_function = c("sum", "mean", "min", "max"),
  elevation_scale = 1,
  colour_range = NULL,
  legend = FALSE,
  legend_options = NULL,
  auto_highlight = FALSE,
  highlight_colour = "#AAFFFFFF",
  layer_id = NULL,
  update_view = TRUE,
  focus_layer = FALSE,
  digits = 6,
  transitions = NULL,
  brush_radius = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>map</code></td>
<td>
<p>a mapdeck map object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data to be used in the layer. All coordinates are expected to be
EPSG:4326 (WGS 84) coordinate system</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>column containing longitude values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>column containing latitude values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>polyline</code></td>
<td>
<p>optional column of <code>data</code> containing the polylines, if using encoded polylines</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cell_size</code></td>
<td>
<p>size of each cell in meters. Default 1000</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extruded</code></td>
<td>
<p>logical indicating if cells are elevated or not. Default TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>elevation</code></td>
<td>
<p>the height the polygon extrudes from the map. Only available if neither
<code>stroke_colour</code> or <code>stroke_width</code> are supplied. Default 0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>elevation_function</code></td>
<td>
<p>one of 'min', 'mean', 'max', 'sum'.
IF supplied it specifies how the elevation values are calcualted. Defaults to sum.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colour</code></td>
<td>
<p>column containing numeric values to colour by.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colour_function</code></td>
<td>
<p>one of 'min', 'mean', 'max', 'sum'.
If supplied it specifies how the colour values are calculated. Defaults to sum.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>elevation_scale</code></td>
<td>
<p>elevation multiplier.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colour_range</code></td>
<td>
<p>vector of 6 hex colours</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend</code></td>
<td>
<p>either a logical indiciating if the legend(s) should be displayed, or
a named list indicating which colour attributes should be included in the legend.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend_options</code></td>
<td>
<p>A list of options for controlling the legend.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>auto_highlight</code></td>
<td>
<p>logical indicating if the shape under the mouse should auto-highlight</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>highlight_colour</code></td>
<td>
<p>hex string colour to use for highlighting. Must contain the alpha component.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>layer_id</code></td>
<td>
<p>single value specifying an id for the layer. Use this value to
distinguish between shape layers of the same type. Layers with the same id are likely
to conflict and not plot correctly</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>update_view</code></td>
<td>
<p>logical indicating if the map should update the bounds to include this layer</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>focus_layer</code></td>
<td>
<p>logical indicating if the map should update the bounds to only include this layer</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>number of digits for rounding coordinates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transitions</code></td>
<td>
<p>list specifying the duration of transitions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>brush_radius</code></td>
<td>
<p>radius of the brush in metres. Default NULL. If supplied,
the arcs will only show if the origin or destination are within the radius of the mouse.
If NULL, all arcs are displayed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p><code>clear_legend</code> and <code>clear_view</code> arguments passed to 'clear_()' functions</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>add_grid</code> supports POINT and MULTIPOINT sf objects
</p>


<h3>data</h3>

<p>If the <code>data</code> is a simple feature object, the geometry column is automatically
detected. If the sf object contains more than one geometry column and you want to use a specific one,
you'll need to set the active geometry using <code>sf::st_geometry( x ) &lt;- "your_column" </code>,
where <code>"your_column"</code> is the name of the column you're activating. See <code>?sf::st_geometry</code>
</p>


<h3>See Also</h3>

<p>add_hexagon
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## You need a valid access token from Mapbox
key &lt;- 'abc'
set_token( key )

df &lt;- read.csv(paste0(
'https://raw.githubusercontent.com/uber-common/deck.gl-data/master/',
'examples/3d-heatmap/heatmap-data.csv'
))

df &lt;- df[ !is.na(df$lng ), ]

mapdeck( style = mapdeck_style("dark"), pitch = 45 ) %&gt;%
add_grid(
  data = df
  , lat = "lat"
  , lon = "lng"
  , cell_size = 5000
  , elevation_scale = 50
  , layer_id = "grid_layer"
  , auto_highlight = TRUE
)

## using sf object
library(sfheaders)
sf &lt;- sfheaders::sf_point( df, x = "lng", y = "lat")

mapdeck( style = mapdeck_style("dark"), pitch = 45 ) %&gt;%
add_grid(
  data = sf
  , cell_size = 5000
  , elevation_scale = 50
  , layer_id = "grid_layer"
  , auto_highlight = TRUE
)

## using colour and elevation functions, and legends
df$val &lt;- sample(1:10, size = nrow(df), replace = TRUE)

mapdeck( style = mapdeck_style("dark"), pitch = 45) %&gt;%
add_grid(
	data = df
	, lat = "lat"
	, lon = "lng"
	, layer_id = "hex_layer"
	, elevation_scale = 100
	, legend = TRUE
	, colour_function = "max"
	, colour = "val"
)

mapdeck( style = mapdeck_style("dark"), pitch = 45) %&gt;%
add_grid(
	data = df
	, lat = "lat"
	, lon = "lng"
	, layer_id = "hex_layer"
	, elevation_scale = 10
	, legend = TRUE
	, elevation_function = "mean"
	, elevation = "val"
)



</code></pre>


</div>