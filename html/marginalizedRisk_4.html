<div class="container">

<table style="width: 100%;"><tr>
<td>marginalized.risk</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Compute Maringalized Risk
</h2>

<h3>Description</h3>

<p>Computes risk of disease as a function of marker s by marginalizedizing over a covariate vector Z.
</p>


<h3>Usage</h3>

<pre><code class="language-R">
marginalized.risk(fit.risk, marker.name, data, categorical.s, weights =
                 rep(1, nrow(data)), t = NULL, ss = NULL, verbose =
                 FALSE, t.end = NULL)
                 
marginalized.risk.cont(fit.risk, marker.name, data, 
    weights = rep(1, nrow(data)), t=NULL, ss = NULL, verbose = FALSE)

marginalized.risk.cont.2(fit.risk, marker.name, data, 
  weights=rep(1, nrow(data)), t, ss, marker.name.2, s.2, verbose=FALSE) 

marginalized.risk.cat(fit.risk, marker.name, data, weights = rep(1,
                 nrow(data)), t = NULL, verbose = FALSE, t.end = NULL)

</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fit.risk</code></td>
<td>

<p>A regression object where the outcome is risk of disease, e.g. y~Z+marker. Need to support predict(fit.risk)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>marker.name</code></td>
<td>

<p>string
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>marker.name.2</code></td>
<td>

<p>string
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>A data frame containing the phase 2 data
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ss</code></td>
<td>

<p>A vector of marker values
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s.2</code></td>
<td>

<p>s.2
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>

<p>Inverse prob sampling weight, optional
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>

<p>If fit.risk is Cox regression, t is the time at which distribution function will be assessed
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t.end</code></td>
<td>

<p>t.end
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>categorical.s</code></td>
<td>

<p>TRUE if the marker is categorical, FALSE otherwise
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>

<p>Boolean
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See the vignette file for more details.
</p>


<h3>Value</h3>

<p>If ss is not NULL, a vector of probabilities are returned. If ss is NULL, a matrix of two columns are returned, where the first column is the marker value and the second column is the probabilties.
</p>


<h3>Examples</h3>

<pre><code class="language-R">

#### suppose wt.loss is the marker of interest

if(requireNamespace("survival")) {

library(survival)

dat=subset(lung, !is.na(wt.loss) &amp; !is.na(ph.ecog))

f1=Surv(time, status) ~ wt.loss + ph.ecog + age + sex

fit.risk = coxph(f1, data=dat)
     
ss=quantile(dat$wt.loss, seq(.05,.95,by=0.01))
t0=1000
prob = marginalized.risk(fit.risk, "wt.loss", dat, categorical.s=FALSE, t = t0, ss=ss)

plot(ss, prob, type="l", xlab="Weight loss", ylab=paste0("Probability of survival at day ", t0))

}


## Not run: 

#### Efron bootstrap to get confidence band

# store the current rng state 
save.seed &lt;- try(get(".Random.seed", .GlobalEnv), silent=TRUE) 
if (class(save.seed)=="try-error") {set.seed(1); save.seed &lt;- get(".Random.seed", .GlobalEnv) }      

B=10 # bootstrap replicates, 1000 is good
numCores=1 # multiple cores can speed things up
library(doParallel)
out=mclapply(1:B, mc.cores = numCores, FUN=function(seed) {   
    set.seed(seed)    
    # a simple resampling scheme here. needs to be adapted to the sampling scheme
    dat.tmp=dat[sample(row(dat), replace=TRUE),]        
    fit.risk = coxph(f1, data=dat)
    marginalized.risk(fit.risk, "wt.loss", dat.tmp, categorical.s=FALSE, t = t0, ss=ss)
})
res=do.call(cbind, out)

# restore rng state 
assign(".Random.seed", save.seed, .GlobalEnv)    

# quantile bootstrap CI
ci.band=t(apply(res, 1, function(x) quantile(x, c(.025,.975))))

plot(ss, prob, type="l", xlab="Weight loss", ylab=paste0("Probability of survival at day ", t0), 
    ylim=range(ci.band))
lines(ss, ci.band[,1], lty=2)
lines(ss, ci.band[,2], lty=2)


## End(Not run)

</code></pre>


</div>