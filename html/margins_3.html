<div class="container">

<table style="width: 100%;"><tr>
<td>cplot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Conditional predicted value and average marginal effect plots for models</h2>

<h3>Description</h3>

<p>Draw one or more conditional effects plots reflecting predictions or marginal effects from a model, conditional on a covariate. Currently methods exist for “lm”, “glm”, “loess” class models.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cplot(object, ...)

## Default S3 method:
cplot(
  object,
  x = attributes(terms(object))[["term.labels"]][1L],
  dx = x,
  what = c("prediction", "effect"),
  data = prediction::find_data(object),
  type = c("response", "link"),
  vcov = stats::vcov(object),
  at,
  n = 25L,
  xvals = prediction::seq_range(data[[x]], n = n),
  level = 0.95,
  draw = TRUE,
  xlab = x,
  ylab = if (match.arg(what) == "prediction") paste0("Predicted value") else
    paste0("Marginal effect of ", dx),
  xlim = NULL,
  ylim = NULL,
  lwd = 1L,
  col = "black",
  lty = 1L,
  se.type = c("shade", "lines", "none"),
  se.col = "black",
  se.fill = grDevices::gray(0.5, 0.5),
  se.lwd = lwd,
  se.lty = if (match.arg(se.type) == "lines") 1L else 0L,
  factor.lty = 0L,
  factor.pch = 19L,
  factor.col = se.col,
  factor.fill = factor.col,
  factor.cex = 1L,
  xaxs = "i",
  yaxs = xaxs,
  las = 1L,
  scatter = FALSE,
  scatter.pch = 19L,
  scatter.col = se.col,
  scatter.bg = scatter.col,
  scatter.cex = 0.5,
  rug = TRUE,
  rug.col = col,
  rug.size = -0.02,
  ...
)

## S3 method for class 'clm'
cplot(
  object,
  x = attributes(terms(object))[["term.labels"]][1L],
  dx = x,
  what = c("prediction", "classprediction", "stackedprediction", "effect"),
  data = prediction::find_data(object),
  type = c("response", "link"),
  vcov = stats::vcov(object),
  at,
  n = 25L,
  xvals = seq_range(data[[x]], n = n),
  level = 0.95,
  draw = TRUE,
  xlab = x,
  ylab = if (match.arg(what) == "effect") paste0("Marginal effect of ", dx) else
    paste0("Predicted value"),
  xlim = NULL,
  ylim = if (match.arg(what) %in% c("prediction", "stackedprediction")) c(0, 1.04) else
    NULL,
  lwd = 1L,
  col = "black",
  lty = 1L,
  factor.lty = 1L,
  factor.pch = 19L,
  factor.col = col,
  factor.fill = factor.col,
  factor.cex = 1L,
  xaxs = "i",
  yaxs = xaxs,
  las = 1L,
  scatter = FALSE,
  scatter.pch = 19L,
  scatter.col = factor.col,
  scatter.bg = scatter.col,
  scatter.cex = 0.5,
  rug = TRUE,
  rug.col = col,
  rug.size = -0.02,
  ...
)

## S3 method for class 'glm'
cplot(
  object,
  x = attributes(terms(object))[["term.labels"]][1L],
  dx = x,
  what = c("prediction", "effect"),
  data = prediction::find_data(object),
  type = c("response", "link"),
  vcov = stats::vcov(object),
  at,
  n = 25L,
  xvals = prediction::seq_range(data[[x]], n = n),
  level = 0.95,
  draw = TRUE,
  xlab = x,
  ylab = if (match.arg(what) == "prediction") paste0("Predicted value") else
    paste0("Marginal effect of ", dx),
  xlim = NULL,
  ylim = NULL,
  lwd = 1L,
  col = "black",
  lty = 1L,
  se.type = c("shade", "lines", "none"),
  se.col = "black",
  se.fill = grDevices::gray(0.5, 0.5),
  se.lwd = lwd,
  se.lty = if (match.arg(se.type) == "lines") 1L else 0L,
  factor.lty = 0L,
  factor.pch = 19L,
  factor.col = se.col,
  factor.fill = factor.col,
  factor.cex = 1L,
  xaxs = "i",
  yaxs = xaxs,
  las = 1L,
  scatter = FALSE,
  scatter.pch = 19L,
  scatter.col = se.col,
  scatter.bg = scatter.col,
  scatter.cex = 0.5,
  rug = TRUE,
  rug.col = col,
  rug.size = -0.02,
  ...
)

## S3 method for class 'lm'
cplot(
  object,
  x = attributes(terms(object))[["term.labels"]][1L],
  dx = x,
  what = c("prediction", "effect"),
  data = prediction::find_data(object),
  type = c("response", "link"),
  vcov = stats::vcov(object),
  at,
  n = 25L,
  xvals = prediction::seq_range(data[[x]], n = n),
  level = 0.95,
  draw = TRUE,
  xlab = x,
  ylab = if (match.arg(what) == "prediction") paste0("Predicted value") else
    paste0("Marginal effect of ", dx),
  xlim = NULL,
  ylim = NULL,
  lwd = 1L,
  col = "black",
  lty = 1L,
  se.type = c("shade", "lines", "none"),
  se.col = "black",
  se.fill = grDevices::gray(0.5, 0.5),
  se.lwd = lwd,
  se.lty = if (match.arg(se.type) == "lines") 1L else 0L,
  factor.lty = 0L,
  factor.pch = 19L,
  factor.col = se.col,
  factor.fill = factor.col,
  factor.cex = 1L,
  xaxs = "i",
  yaxs = xaxs,
  las = 1L,
  scatter = FALSE,
  scatter.pch = 19L,
  scatter.col = se.col,
  scatter.bg = scatter.col,
  scatter.cex = 0.5,
  rug = TRUE,
  rug.col = col,
  rug.size = -0.02,
  ...
)

## S3 method for class 'loess'
cplot(
  object,
  x = attributes(terms(object))[["term.labels"]][1L],
  dx = x,
  what = c("prediction", "effect"),
  data = prediction::find_data(object),
  type = c("response", "link"),
  vcov = stats::vcov(object),
  at,
  n = 25L,
  xvals = prediction::seq_range(data[[x]], n = n),
  level = 0.95,
  draw = TRUE,
  xlab = x,
  ylab = if (match.arg(what) == "prediction") paste0("Predicted value") else
    paste0("Marginal effect of ", dx),
  xlim = NULL,
  ylim = NULL,
  lwd = 1L,
  col = "black",
  lty = 1L,
  se.type = c("shade", "lines", "none"),
  se.col = "black",
  se.fill = grDevices::gray(0.5, 0.5),
  se.lwd = lwd,
  se.lty = if (match.arg(se.type) == "lines") 1L else 0L,
  factor.lty = 0L,
  factor.pch = 19L,
  factor.col = se.col,
  factor.fill = factor.col,
  factor.cex = 1L,
  xaxs = "i",
  yaxs = xaxs,
  las = 1L,
  scatter = FALSE,
  scatter.pch = 19L,
  scatter.col = se.col,
  scatter.bg = scatter.col,
  scatter.cex = 0.5,
  rug = TRUE,
  rug.col = col,
  rug.size = -0.02,
  ...
)

## S3 method for class 'polr'
cplot(
  object,
  x = attributes(terms(object))[["term.labels"]][1L],
  dx = x,
  what = c("prediction", "classprediction", "stackedprediction", "effect"),
  data = prediction::find_data(object),
  type = c("response", "link"),
  vcov = stats::vcov(object),
  at,
  n = 25L,
  xvals = seq_range(data[[x]], n = n),
  level = 0.95,
  draw = TRUE,
  xlab = x,
  ylab = if (match.arg(what) == "effect") paste0("Marginal effect of ", dx) else
    paste0("Predicted value"),
  xlim = NULL,
  ylim = if (match.arg(what) %in% c("prediction", "stackedprediction")) c(0, 1.04) else
    NULL,
  lwd = 1L,
  col = "black",
  lty = 1L,
  factor.lty = 1L,
  factor.pch = 19L,
  factor.col = col,
  factor.fill = factor.col,
  factor.cex = 1L,
  xaxs = "i",
  yaxs = xaxs,
  las = 1L,
  scatter = FALSE,
  scatter.pch = 19L,
  scatter.col = factor.col,
  scatter.bg = scatter.col,
  scatter.cex = 0.5,
  rug = TRUE,
  rug.col = col,
  rug.size = -0.02,
  ...
)

## S3 method for class 'multinom'
cplot(
  object,
  x = attributes(terms(object))[["term.labels"]][1L],
  dx = x,
  what = c("prediction", "classprediction", "stackedprediction", "effect"),
  data = prediction::find_data(object),
  type = c("response", "link"),
  vcov = stats::vcov(object),
  at,
  n = 25L,
  xvals = seq_range(data[[x]], n = n),
  level = 0.95,
  draw = TRUE,
  xlab = x,
  ylab = if (match.arg(what) == "effect") paste0("Marginal effect of ", dx) else
    paste0("Predicted value"),
  xlim = NULL,
  ylim = if (match.arg(what) %in% c("prediction", "stackedprediction")) c(0, 1.04) else
    NULL,
  lwd = 1L,
  col = "black",
  lty = 1L,
  factor.lty = 1L,
  factor.pch = 19L,
  factor.col = col,
  factor.fill = factor.col,
  factor.cex = 1L,
  xaxs = "i",
  yaxs = xaxs,
  las = 1L,
  scatter = FALSE,
  scatter.pch = 19L,
  scatter.col = factor.col,
  scatter.bg = scatter.col,
  scatter.cex = 0.5,
  rug = TRUE,
  rug.col = col,
  rug.size = -0.02,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>A model object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to <code>plot</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A character string specifying the name of variable to use as the x-axis dimension in the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dx</code></td>
<td>
<p>If <code>what = "effect"</code>, the variable whose conditional marginal effect should be displayed. By default it is <code>x</code> (so the plot displays the marginal effect of <code>x</code> across values of <code>x</code>); ignored otherwise. If <code>dx</code> is a factor with more than 2 levels, an error will be issued.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>what</code></td>
<td>
<p>A character string specifying whether to draw a “prediction” (fitted values from the model, calculated using <code>predict</code>) or an “effect” (average marginal effect of <code>dx</code> conditional on <code>x</code>, using <code>margins</code>). Methods for classes other than “lm” or “glm” may provided additional options (e.g., <code>cplot.polr()</code> provides “stackedprediction” and “class” alternatives).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame to override the default value offered in <code>object[["model"]]</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>A character string specifying whether to calculate predictions on the response scale (default) or link (only relevant for non-linear models).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vcov</code></td>
<td>
<p>A matrix containing the variance-covariance matrix for estimated model coefficients, or a function to perform the estimation with <code>model</code> as its only argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>at</code></td>
<td>
<p>Currently ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>An integer specifying the number of points across <code>x</code> at which to calculate the predicted value or marginal effect, when <code>x</code> is numeric. Ignored otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xvals</code></td>
<td>
<p>A numeric vector of values at which to calculate predictions or marginal effects, if <code>x</code> is numeric. By default, it is calculated from the data using <code>seq_range</code>. If <code>x</code> is a factor, this is ignored, as is <code>n</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>The confidence level required (used to draw uncertainty bounds).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draw</code></td>
<td>
<p>A logical (default <code>TRUE</code>), specifying whether to draw the plot. If <code>FALSE</code>, the data used in drawing are returned as a list of data.frames. This might be useful if you want to plot using an alternative plotting package (e.g., ggplot2). Also, if set to value “add”, then the resulting data is added to the existing plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>A character string specifying the value of <code>xlab</code> in <code>plot</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>A character string specifying the value of <code>ylab</code> in <code>plot</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim</code></td>
<td>
<p>A two-element numeric vector specifying the x-axis limits. Set automatically if missing.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>A two-element numeric vector specifying the y-axis limits. Set automatically if missing.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwd</code></td>
<td>
<p>An integer specifying the width of the prediction or marginal effect line. See <code>lines</code>. If <code>x</code> is a factor variable in the model, this is used to set the line width of the error bars.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>A character string specifying the color of the prediction or marginal effect line. If <code>x</code> is a factor variable in the model, this is used to set the color of the error bars.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lty</code></td>
<td>
<p>An integer specifying the “line type” of the prediction or marginal effect line. See <code>par</code>. If <code>x</code> is a factor variable in the model, this is used to set the line type of the error bars.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.type</code></td>
<td>
<p>A character string specifying whether to draw the confidence interval as “lines” (the default, using <code>lines</code>) or a “shade” (using <code>polygon</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.col</code></td>
<td>
<p>If <code>se.type = "lines"</code>, a character string specifying the color of the confidence interval lines. If <code>se.type = "shade"</code>, the color of the shaded region border.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.fill</code></td>
<td>
<p>If <code>se.type = "shade"</code>, the color of the shaded region. Ignored otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.lwd</code></td>
<td>
<p>If <code>se.type = "lines"</code>, the width of the confidence interval lines. See <code>lines</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.lty</code></td>
<td>
<p>If <code>se.type = "lines"</code>, an integer specifying the “line type” of the confidence interval lines; if <code>se.type = "shade"</code>, the line type of the shaded polygon border. See <code>par</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factor.lty</code></td>
<td>
<p>If <code>x</code> is a factor variable in the model, this is used to set the line type of an optional line connecting predictions across factor levels. If <code>factor.lty = 0L</code> (the default), no line is drawn.. See <code>par</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factor.pch</code></td>
<td>
<p>If <code>x</code> is a factor variable in the model, the shape to use when drawing points. See <code>points</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factor.col</code></td>
<td>
<p>If <code>x</code> is a factor variable in the model, the color to use for the border of the points. See <code>points</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factor.fill</code></td>
<td>
<p>If <code>x</code> is a factor variable in the model, the color to use for the fill of the points. See <code>points</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factor.cex</code></td>
<td>
<p>If <code>x</code> is a factor variable in the model, the “expansion factor” to use for the point size. See <code>points</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xaxs</code></td>
<td>
<p>A character string specifying <code>xaxs</code>. See <code>par</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yaxs</code></td>
<td>
<p>A character string specifying <code>xaxs</code>. See <code>par</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>las</code></td>
<td>
<p>An integer string specifying <code>las</code>. See <code>par</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scatter</code></td>
<td>
<p>A logical indicating whether to plot the observed data in <code>data</code> as a scatterplot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scatter.pch</code></td>
<td>
<p>If <code>scatter = TRUE</code>, an integer specifying a shape to use for plotting the data. See <code>points</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scatter.col</code></td>
<td>
<p>If <code>scatter = TRUE</code>, a character string specifying a color to use for plotting the data. See <code>points</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scatter.bg</code></td>
<td>
<p>If <code>scatter = TRUE</code>, a character string specifying a color to use for plotting the data. See <code>points</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scatter.cex</code></td>
<td>
<p>If <code>scatter = TRUE</code>, an integer specifying the size of the points. See <code>points</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rug</code></td>
<td>
<p>A logical specifying whether to include an x-axis “rug” (see <code>rug</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rug.col</code></td>
<td>
<p>A character string specifying <code>col</code> to <code>rug</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rug.size</code></td>
<td>
<p>A numeric value specifying <code>ticksize</code> to <code>rug</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Note that when <code>what = "prediction"</code>, the plots show predictions holding values of the data at their mean or mode, whereas when <code>what = "effect"</code> average marginal effects (i.e., at observed values) are shown.
</p>
<p>When examining generalized linear models (e.g., logistic regression models), confidence intervals for predictions can fall outside of the response scale (again, for logistic regression this means confidence intervals can exceed the (0,1) bounds). This is consistent with the behavior of <code>predict</code> but may not be desired. The examples (below) show ways of constraining confidence intervals to these bounds.
</p>
<p>The overall aesthetic is somewhat similar to to the output produced by the <code>marginalModelPlot()</code> function in the <b><a href="https://cran.r-project.org/package=car">car</a></b> package.
</p>


<h3>Value</h3>

<p>A tidy data frame containing the data used to draw the plot. Use <code>draw = FALSE</code> to simply generate the data structure for use elsewhere.
</p>


<h3>See Also</h3>

<p><code>plot.margins</code>, <code>persp.lm</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
require('datasets')
# prediction from several angles
m &lt;- lm(Sepal.Length ~ Sepal.Width, data = iris)
cplot(m)

# more complex model
m &lt;- lm(Sepal.Length ~ Sepal.Width * Petal.Width * I(Petal.Width ^ 2), 
        data = head(iris, 50))
## marginal effect of 'Petal.Width' across 'Petal.Width'
cplot(m, x = "Petal.Width", what = "effect", n = 10)

# factor independent variables
mtcars[["am"]] &lt;- factor(mtcars[["am"]])
m &lt;- lm(mpg ~ am * wt, data = mtcars)
## predicted values for each factor level
cplot(m, x = "am")
## marginal effect of each factor level across numeric variable
cplot(m, x = "wt", dx = "am", what = "effect")

# marginal effect of 'Petal.Width' across 'Sepal.Width'
## without drawing the plot
## this might be useful for using, e.g., ggplot2 for plotting
tmp &lt;- cplot(m, x = "Sepal.Width", dx = "Petal.Width", 
             what = "effect", n = 10, draw = FALSE)
if (require("ggplot2")) {
  # use ggplot2 instead of base graphics
  ggplot(tmp, aes(x = Petal.Width, y = "effect")) + 
         geom_line(lwd = 2) + 
         geom_line(aes(y = effect + 1.96*se.effect)) + 
         geom_line(aes(y = effect - 1.96*se.effect))
}

# a non-linear model
m &lt;- glm(am ~ wt*drat, data = mtcars, family = binomial)
cplot(m, x = "wt") # prediction (response scale)
cplot(m, x = "wt") # prediction (link scale)
if (require("ggplot2")) {
  # prediction (response scale, constrained to [0,1])
  cplotdat &lt;- cplot(m, x = "wt", type = "link", draw = FALSE)
  ggplot(cplotdat, aes(x = xvals, y = plogis(yvals))) + 
         geom_line(lwd = 1.5) + 
         geom_line(aes(y = plogis(upper))) + 
         geom_line(aes(y = plotis(lower)))
}

# effects on linear predictor and outcome
cplot(m, x = "drat", dx = "wt", what = "effect", type = "link")
cplot(m, x = "drat", dx = "wt", what = "effect", type = "response")

# plot conditional predictions across a third factor
local({
  iris$long &lt;- rbinom(nrow(iris), 1, 0.6)
  x &lt;- glm(long ~ Sepal.Width*Species, data = iris)
  cplot(x, x = "Sepal.Width", data = iris[iris$Species == "setosa", ], 
        ylim = c(0,1), col = "red", se.fill = rgb(1,0,0,.5), xlim = c(2,4.5))
  cplot(x, x = "Sepal.Width", data = iris[iris$Species == "versicolor", ], 
        draw = "add", col = "blue", se.fill = rgb(0,1,0,.5))
  cplot(x, x = "Sepal.Width", data = iris[iris$Species == "virginica", ], 
        draw = "add", col = "green", se.fill = rgb(0,0,1,.5))
})

# ordinal outcome
if (require("MASS")) {
  # x is a factor variable
  house.plr &lt;- polr(Sat ~ Infl + Type + Cont, weights = Freq, 
                    data = housing)
  ## predicted probabilities
  cplot(house.plr)
  ## cumulative predicted probabilities
  cplot(house.plr, what = "stacked")
  ## ggplot2 example
  if (require("ggplot2")) {
    ggplot(cplot(house.plr), aes(x = xvals, y = yvals, group = level)) + 
      geom_line(aes(color = level))
  }

  # x is continuous
  cyl.plr &lt;- polr(factor(cyl) ~ wt, data = mtcars)
  cplot(cyl.plr, col = c("red", "purple", "blue"), what = "stacked")
  cplot(cyl.plr, what = "class")
}


## End(Not run)
</code></pre>


</div>