<div class="container">

<table style="width: 100%;"><tr>
<td>mscjs_tmb</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fitting function for Multistate CJS models with TMB</h2>

<h3>Description</h3>

<p>A function for computing MLEs for a Multi-state Cormack-Jolly-Seber open
population capture-recapture model for processed dataframe <code>x</code> with
user specified formulas in <code>parameters</code> that create list of design
matrices <code>dml</code>. This function can be called directly but is most easily
called from <code>crm</code> that sets up needed arguments.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mscjs_tmb(
  x,
  ddl,
  fullddl,
  dml,
  model_data = NULL,
  parameters,
  accumulate = TRUE,
  initial = NULL,
  method,
  hessian = FALSE,
  debug = FALSE,
  chunk_size = 1e+07,
  refit,
  itnmax = NULL,
  control = NULL,
  scale,
  re = FALSE,
  compile = FALSE,
  extra.args = "",
  clean = TRUE,
  getreals = FALSE,
  useHess = FALSE,
  savef = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>processed dataframe created by process.data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ddl</code></td>
<td>
<p>list of simplified dataframes for design data; created by call to
<code>make.design.data</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fullddl</code></td>
<td>
<p>list of complete dataframes for design data; created by call to
<code>make.design.data</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dml</code></td>
<td>
<p>list of design matrices created by <code>create.dm</code> from
formula and design data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_data</code></td>
<td>
<p>a list of all the relevant data for fitting the model including
imat, S.dm,p.dm,Psi.dm,S.fixed,p.fixed,Psi.fixed and time.intervals. It is used to save values
and avoid accumulation again if the model was re-rerun with an additional call to cjs when
using autoscale or re-starting with initial values.  It is stored with returned model object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameters</code></td>
<td>
<p>equivalent to <code>model.parameters</code> in <code>crm</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>accumulate</code></td>
<td>
<p>if TRUE will accumulate capture histories with common
value and with a common design matrix all parameters to speed up execution</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial</code></td>
<td>
<p>list of initial values for parameters if desired; if each is a named vector
from previous run it will match to columns with same name</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>method to use for optimization; see <code>optim</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hessian</code></td>
<td>
<p>if TRUE will compute and return the hessian</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>debug</code></td>
<td>
<p>if TRUE will print out information for each iteration</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chunk_size</code></td>
<td>
<p>specifies amount of memory to use in accumulating capture
histories; amount used is 8*chunk_size/1e6 MB (default 80MB)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refit</code></td>
<td>
<p>non-zero entry to refit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>itnmax</code></td>
<td>
<p>maximum number of iterations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>control string for optimization functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>vector of scale values for parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>re</code></td>
<td>
<p>if TRUE creates random effect model admbcjsre.tpl and runs admb optimizer</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compile</code></td>
<td>
<p>if TRUE forces re-compilation of tpl file</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extra.args</code></td>
<td>
<p>optional character string that is passed to tmb</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clean</code></td>
<td>
<p>if TRUE, deletes the dll and recompiles</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>getreals</code></td>
<td>
<p>if TRUE, compute real values and std errors for TMB models; may want to set as FALSE until model selection is complete</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useHess</code></td>
<td>
<p>if TRUE, the TMB hessian function is used for optimization; using hessian is typically slower with many parameters but can result in a better solution</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>savef</code></td>
<td>
<p>if TRUE, save the makeAdFun result from TMB to report real values and matrices</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>not currently used</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>It is easiest to call <code>mscjs_tmb</code> through the function <code>crm</code>.
Details are explained there.
</p>


<h3>Value</h3>

<p>The resulting value of the function is a list with the class of
crm,cjs such that the generic functions print and coef can be used.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>named vector of parameter estimates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lnl</code></td>
<td>
<p>-2*log
likelihood</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AIC</code></td>
<td>
<p>lnl + 2* number of parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>convergence</code></td>
<td>
<p>result from <code>optim</code>; if 0 <code>optim</code> thinks it
converged</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>count</code></td>
<td>
<p><code>optim</code> results of number of function
evaluations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reals</code></td>
<td>
<p>dataframe of data and real S and p estimates for
each animal-occasion excluding those that occurred before release</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vcv</code></td>
<td>
<p>var-cov matrix of betas if hessian=TRUE was set</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Jeff Laak
</p>


<h3>References</h3>

<p>Ford, J. H., M. V. Bravington, and J. Robbins. 2012. Incorporating individual variability into mark-recapture models. Methods in Ecology and Evolution 3:1047-1054.
</p>


</div>