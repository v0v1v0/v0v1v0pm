<div class="container">

<table style="width: 100%;"><tr>
<td>estimaterates_f</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Estimate substitution rate matrix.
</h2>

<h3>Description</h3>

<p>Beta version of code; still in development. More or less identical to <code>estimaterates</code>. Here, some entries of the substitution rate matrix can be specified by the user to be held fixed during the parameter estimation.</p>


<h3>Usage</h3>

<pre><code class="language-R">estimaterates_f(usertree = NULL, userphyl = NULL, matchtipstodata = FALSE,
              unobserved = NULL, alphabet = NULL, modelmat = NULL, 
              bgtype = "listofnodes", bg = NULL, partition = NULL, 
              ratevar = FALSE, nocat = 4, reversible = FALSE, numhessian = TRUE, 
              rootprob = NULL, rpvec = NULL, init = 0.9, lowli = 0.001, upli = 100, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>usertree</code></td>
<td>

<p>Rooted binary tree of class "phylo". Read in Newick tree using read.tree() from package ape before passing this argument. The branch lengths must be in expected substitutions per site (but see lowli and upli arguments). Trees estimated using MrBayes and BEAST, for instance, yield branch lengths using that scale. If an unrooted tree is available, look into the “root" and “midpoint.root" functions from the APE and phytools packages, respectively.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>userphyl</code></td>
<td>

<p>A matrix or data frame of phyletic patterns. Rows represent the discrete character patterns and columns represent the taxa. These data can be numeric or character (but not both). 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>matchtipstodata</code></td>
<td>

<p>The default is FALSE, which means that the user must ensure that the ordering of the taxa in the data matrix must match the internal ordering of tip labels of the tree. Set to TRUE, if the column names of the data matrix, i.e., the taxa names, are all present, with the same spelling and notation in the tip labels of the tree provided, in which case, the restriction on ordering is not necessary.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unobserved</code></td>
<td>

<p>A matrix of unobserved phyletic patterns, representing possible sampling or acquisition bias. Each row should be a unique phyletic pattern.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alphabet</code></td>
<td>

<p>The set of discrete characters used. May be integer only or character only.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modelmat</code></td>
<td>

<p>Accepts the same arguments as <code>estimaterates</code>.  Here, some entries of the substitution rate matrix can be specified by the user to be held fixed during the parameter estimation. A square matrix can be input that consists of integer values denoting the indices of the substitution rates to be estimated and entries with decimal values (that are not equivalent to an integer in R, i.e., something other than, for example, 1.0, 2.0, etc.) to be held fixed. See example.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bgtype</code></td>
<td>

<p>Use this to group branches hypothesized to follow the same rates (but differ from other branches). If clade-specific insertion and deletion rates are required to be estimated, use argument option "ancestornodes". If, on the other hand, a group of branches (not in a clade) are hypothesized to follow the same rates, use argument option "listofnodes".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bg</code></td>
<td>

<p>A vector of nodes should be provided if the "ancestornodes" option was chosen for argument "bgtype". If, on the other hand, "listofnodes" was chosen, a list should be provided with each element of the list being a vector of nodes that limit the branches that follow the same rates. See examples and vignette.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>partition</code></td>
<td>

<p>A list of vectors (of sites) subject to different evolutionary constraints. For example, supplying list(c(1:2500), c(2501:5000)) means that sites 1 through 2500 follow their own substitution rates distinct from sites 2501 through 5000. These sites correspond to the rows of the data supplied in userphyl. Partition models can be fitted with a common (or unique) gamma distribution for rate variation over all partitions, and/or common root probabilities can be estimated over all partitions.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratevar</code></td>
<td>

<p>Default option is FALSE. Specifying "discgamma" implements the discrete gamma approximation model of Yang, 1994. Even if a partition of sites is specified, this option uses the same <code class="reqn">\alpha</code> parameter for the gamma distribution over all partitions. Specifying "partitionspecificgamma" implements the discrete gamma approximation model in each partition separately.
The number of categories can be specified using the "nocat" argument. See examples and vignette.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nocat</code></td>
<td>

<p>The number of categories for the discrete gamma approximation. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reversible</code></td>
<td>

<p>This option forces a model to be reversible, i.e., the flow from state 'a' to 'b' is the same as the flow from state 'b' to 'a'. Only symmetric transition matrices can be specified in modelmat with this option. Inspired by the DiscML package.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numhessian</code></td>
<td>

<p>Set to FALSE if standard errors are not required. This speeds up the algorithm. Default is TRUE. Although the function being used to calculate these errors is reliable, it is rare but possible that the errors are not calculated (due to approximation-associated issues while calculating the Hessian). In this case, try bootstrapping with numhessian=FALSE.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rootprob</code></td>
<td>

<p>Four options are available: "equal", "stationary", "maxlik", and "user". 
</p>

<ul>
<li>
<p> Option "equal" means that all the discrete characters are given equal weight at the root. 
</p>
</li>
<li>
<p> Using "stationary" means that the discrete characters are weighted at the root by the stationary frequencies implied by the substitution rate matrix. Note that these can differ based on the partition. In the case that the "bgtype" argument is also provided, an average of the stationary frequencies of all branch groupings is used.
</p>
</li>
<li>
<p> If "maxlik" is supplied, then the root frequencies are also estimated. These do not differ based on the partition.
</p>
</li>
<li>
<p> If "user" is supplied here, a vector of root frequency parameters can be provided to argument "rpvec".
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rpvec</code></td>
<td>

<p>If option "user" is specified for argument "rootprob", supply a vector of the same length as that provided to argument "alphabet", representing the root frequency parameters.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init     </code></td>
<td>
	
<p>Initial value for the rates. The default value is 0.9.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lowli</code></td>
<td>

<p>For finer control of the boundaries of the optimization problem. The default value is 0.001. This usually suffices if the branch lengths are in expected substitutions per site. However, if branch lengths are in different units, this should be changed accordingly. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upli</code></td>
<td>

<p>For finer control of the boundaries of the optimization problem. The default value is 100. This usually suffices if the branch lengths are in expected substitutions per site. However, if branch lengths are in different units, this should be changed accordingly. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Passing other arguments to the optimization algorithm "nlminb". For example, control = list(trace = 5) will print progress at every 5th iteration.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See vignette for detailed examples.
</p>


<h3>Value</h3>

<p>All arguments used while calling the estimaterates function are attached in a list. The following components are also returned in the same list:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call        </code></td>
<td>
<p>Function call used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conv        </code></td>
<td>
<p>A vector of convergence indicators for the model run. 0 denotes successful convergence.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time        </code></td>
<td>
<p>Time taken in seconds.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tree        </code></td>
<td>
<p>The phylogenetic tree used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bg          </code></td>
<td>
<p>List of group of nodes that capture branches that follow unique substitution rates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>results     </code></td>
<td>
<p>List of results including the parameter estimates for each unique entry of modelmat (excluding zeros), standard errors, number of parameters fit, and AIC and BIC values. Furthermore, details from the optimization routine applied are also available. Use ...$results$wop$parsep.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_red    </code></td>
<td>
<p>Unique phyletic patterns observed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w           </code></td>
<td>
<p>List of number of times each gene phyletic pattern was observed.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>Experimental function
</p>


<h3>Author(s)</h3>

<p>Utkarsh J. Dang and G. Brian Golding
</p>
<p><a href="mailto:utkarshdang@cunet.carleton.ca">utkarshdang@cunet.carleton.ca</a>
</p>


<h3>References</h3>

<p>Paradis, E., Claude, J. &amp; Strimmer, K. 2004. APE: analyses of phylogenetics and evolution in R language. Bioinformatics 20: 289-290. R package version 3.2.
</p>
<p>Tane Kim and Weilong Hao 2014. DiscML: An R package for estimating evolutionary rates of discrete characters using maximum likelihood. R package version 1.0.1. 
</p>


<h3>Examples</h3>

<pre><code class="language-R">##############

rm(list=ls())
set.seed(1) #set seed
library(markophylo)
tree1 &lt;- ape::rtree(4, br = runif(6, 0.01, 0.3)) #generate a random 4-taxa tree (6 branches) 
bf &lt;- c(0.33, 0.33, 0.34) #vector of equal root frequencies
gf &lt;- 5000 #number of character patterns to be simulated
rootseq &lt;- sample(1:3, gf, replace = TRUE, prob = bf) #simulate the MRCA sequence (1s and 2s).
par1 &lt;- 1.5 
par2 &lt;- 3   
par3 &lt;- 5
Q_sim &lt;- matrix(c(NA, 0.6, par2, par1, NA, 0.8, par2, par3, NA), 3, 3) 
#generated substitution rate matrix
diag(Q_sim) &lt;- -rowSums(Q_sim, na.rm = TRUE)
print(Q_sim)
#simulate data using the geiger package and Q_sim
data_sim &lt;- sapply(1:gf, FUN = function(X) geiger::sim.char(tree1, 
Q_sim, model = "discrete", root = rootseq[X])) 
simulateddat &lt;- list(data = t(data_sim), Q = Q_sim, tree = tree1)

model1 &lt;- markophylo::estimaterates_f(usertree = simulateddat$tree, 
userphyl = simulateddat$data, alphabet = c(1, 2, 3), rootprob = "equal", 
modelmat = matrix(c(NA, 0.6, 2, 1, NA, 0.8, 2, 3, NA), 3, 3))

</code></pre>


</div>