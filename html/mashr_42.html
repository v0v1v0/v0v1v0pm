<div class="container">

<table style="width: 100%;"><tr>
<td>mash_estimate_corr_em</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit mash model and estimate residual correlations using EM algorithm</h2>

<h3>Description</h3>

<p>Estimates a residual correlation matrix from data using an ad hoc EM
algorithm.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mash_estimate_corr_em(
  data,
  Ulist,
  init,
  max_iter = 30,
  tol = 1,
  est_cor = TRUE,
  track_fit = FALSE,
  prior = c("nullbiased", "uniform"),
  details = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a mash data object, eg as created by <code>mash_set_data</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ulist</code></td>
<td>
<p>a list of covariance matrices to use</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init</code></td>
<td>
<p>the initial value for the residual correlation. If it is
not given, we use result from
<code>estimate_null_correlation_simple</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_iter</code></td>
<td>
<p>maximum number of iterations to perform</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>convergence tolerance</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est_cor</code></td>
<td>
<p>whether to estimate correlation matrix (TRUE) or the
covariance matrix (FALSE)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>track_fit</code></td>
<td>
<p>add an attribute <code>trace</code> to output that saves
current values of all iterations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior</code></td>
<td>
<p>indicates what penalty to use on the likelihood, if any</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>details</code></td>
<td>
<p>whether to return details of the model, if it is
TRUE, the mash model, the number of iterations and the value of
objective functions will be returned</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other parameters pass to <code>mash</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Returns the estimated residual correlation matrix among conditions.
We estimate the residual correlation matrix using an ad hoc em algorithm.
The update in the ad hoc M step is not guaranteed to increase the likelihood,
therefore, the EM algorithm is stopped before the likelihood drops.
The residual correlation matrix V is estimated using the posterior
second moment of the noise.
</p>
<p>Warning: This method could take some time.  The
<code>estimate_null_correlation_simple</code> gives a quick
approximation for the null correlation matrix.
</p>


<h3>Value</h3>

<p>the estimated correlation matrix and the
fitted mash model <br></p>
<table>
<tr style="vertical-align: top;">
<td><code>V</code></td>
<td>
<p>estimated residual correlation matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mash.model</code></td>
<td>
<p>fitted mash model</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">simdata = simple_sims(100,5,1)
m.1by1 = mash_1by1(mash_set_data(simdata$Bhat,simdata$Shat))
strong.subset = get_significant_results(m.1by1,0.05)
random.subset = sample(1:nrow(simdata$Bhat),20)
data.strong = mash_set_data(simdata$Bhat[strong.subset,], simdata$Shat[strong.subset,])
data.tmp = mash_set_data(simdata$Bhat[random.subset,], simdata$Shat[random.subset,])
U_pca = cov_pca(data.strong, 3)
U_ed = cov_ed(data.strong, U_pca)
Vhat = mash_estimate_corr_em(data.tmp, U_ed)
</code></pre>


</div>