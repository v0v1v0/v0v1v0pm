<div class="container">

<table style="width: 100%;"><tr>
<td>rematchSchools</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Repeat School Match Only</h2>

<h3>Description</h3>

<p>After <code>matchMulti</code> has been called, repeats the school match (with
possibly different parameters) without repeating the more computationally
intensive student match.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rematchSchools(
  match.out,
  students,
  school.fb = NULL,
  verbose = FALSE,
  keep.target = NULL,
  school.penalty = NULL,
  tol = 0.001
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>match.out</code></td>
<td>
<p>an object returned by a call to <code>matchMulti</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>students</code></td>
<td>
<p>a dataframe containing student and school covariates, with a
different row for each student.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>school.fb</code></td>
<td>
<p>an optional list of character vectors, each containing a
subset of the column names of <code>students</code>.  Each element of the list
should contain all the names in previous elements (producing a nested
structure).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical value indicating whether detailed output should be
printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep.target</code></td>
<td>
<p>an optional numeric value specifying the number of
treated schools desired in the final match.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>school.penalty</code></td>
<td>
<p>an optional numeric value, treated as the cost (to the
objective function in the underlying optimization problem) of excluding a
treated school.  If it is set lower, more schools will be excluded.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>a numeric tolerance value for comparing distances.  It may need
to be raised above the default when matching with many levels of refined
balance.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>school.fb</code> argument encodes a refined covariate balance
constraint: the matching algorithm optimally balances the interaction of the
variables in the first list element, then attempts to further balance the
interaction in the second element, and so on.  As such variables should be
added in order of priority for balance.
</p>
<p>The <code>keep.target</code> and <code>school.penalty</code> parameters allow optimal
subset matching within the school match. When the <code>keep.target</code>
argument is specified, the school match is repeated for different values of
the <code>school.penalty</code> parameter in a form of binary search until an
optimal match is obtained with the desired number of treated schools or a
stopping rule is reached.  The <code>tol</code> parameter controls the stopping
rule; smaller values provide a stronger guarantee of obtaining the exact
number of treated schools desired but may lead to greater computational
costs.
</p>
<p>It is not recommended that users specify the <code>school.penalty</code> parameter
directly in most cases.  Instead the <code>keep.target</code> parameter provides
an easier way to consider excluding schools.
</p>


<h3>Author(s)</h3>

<p>Luke Keele, Penn State University, <a href="mailto:ljk20@psu.edu">ljk20@psu.edu</a>
</p>
<p>Sam Pimentel, University of California, Berkeley, <a href="mailto:spi@berkeley.edu">spi@berkeley.edu</a>
</p>


<h3>References</h3>

<p>Rosenbaum, Paul R. (2002). <em>Observational Studies</em>.
Springer-Verlag.
</p>
<p>Rosenbaum, Paul R. (2010). <em>Design of Observational Studies</em>.
Springer-Verlag.
</p>
<p>Rosenbaum, Paul R. (2012) "Optimal Matching of an Optimally Chosen Subset in
Observational Studies."  Journal of Computational and Graphical Statistics,
21.1, 57-71.
</p>


<h3>See Also</h3>

<p><code>matchMulti</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 
# Load Catholic school data
data(catholic_schools)

student.cov &lt;- c('minority','female','ses')
school.cov &lt;- c('minority_mean','female_mean', 'ses_mean', 'size', 'acad')

#Match schools but not students within schools
match.simple &lt;- matchMulti(catholic_schools, treatment = 'sector',
school.id = 'school', match.students = FALSE)

#Check balance after matching - this checks both student and school balance
balanceMulti(match.simple, student.cov = student.cov, school.cov = school.cov)

#now rematch excluding 2 schools
match.trimmed &lt;- rematchSchools(match.simple, catholic_schools, keep.target = 13)
match.trimmed$dropped$schools.t

## End(Not run)

</code></pre>


</div>