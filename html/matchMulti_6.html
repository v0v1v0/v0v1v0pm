<div class="container">

<table style="width: 100%;"><tr>
<td>buildCaliper</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Construct propensity score caliper</h2>

<h3>Description</h3>

<p>Fits a propensity score for an individual-level or group-level treatment,
computes a caliper for the propensity score (based on a fractional number of
standard deviations provided by the user), and creates a matrix containing
information about which treated-control pairings are excluded by the
caliper.
</p>


<h3>Usage</h3>

<pre><code class="language-R">buildCaliper(data, treatment, ps.vars, group.id = NULL, caliper = 0.2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame containing the treatment variable, the variables to
be used in fitting the propensity score and (if treatment is at the group
level) a group ID.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>treatment</code></td>
<td>
<p>Name of the treatment indicator.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ps.vars</code></td>
<td>
<p>Vector of names of variables to use in fitting the propensity
score.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group.id</code></td>
<td>
<p>Name of group ID variable, if applicable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>caliper</code></td>
<td>
<p>Desired size of caliper, in number of standard deviations of
the fitted propensity score.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>treatment</code> variable should be binary with 1 indicating treated
units and 0 indicating controls.  When <code>group.id</code> is <code>NULL</code>,
treatment is assumed to be at the individual level and the propensity score
is fitted using the matrix <code>data</code>.  When a group ID is specified, data
frame <code>data</code> is first aggregated into groups, with variables in
<code>ps.vars</code> replaced by their within-group means, and the propensity
score is fitted on the group matrix.
</p>


<h3>Value</h3>

<p>A matrix with <code>nrow</code> equal to the number of treated individuals
or groups and <code>ncol</code> equal to the number of control individuals, with
<code>0</code> entries indicating pairings permitted by the caliper and <code>Inf</code>
entries indicating forbidden pairings.
</p>


<h3>Author(s)</h3>

<p>Luke Keele, Penn State University, <a href="mailto:ljk20@psu.edu">ljk20@psu.edu</a>
</p>
<p>Sam Pimentel, University of California, Berkeley, <a href="mailto:spi@berkeley.edu">spi@berkeley.edu</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
	## Not run: 
# Load Catholic school data
data(catholic_schools)

student.cov &lt;- c('minority','female','ses','mathach')

# Check balance student balance before matching
balanceTable(catholic_schools[c(student.cov,'sector')],  treatment = 'sector')

#fit a propensity score caliper on mean values of student covariates within schools
school.caliper &lt;- buildCaliper(data = catholic_schools, treatment = 'sector',
	ps.vars = student.cov, group.id = 'school')

#Match schools but not students within schools
match.simple &lt;- matchMulti(catholic_schools, treatment = 'sector', 
	school.caliper = school.caliper, school.id = 'school', match.students = FALSE)

#Check balance after matching - this checks both student and school balance
balanceMulti(match.simple, student.cov = student.cov)

## End(Not run)

</code></pre>


</div>