<div class="container">

<table style="width: 100%;"><tr>
<td>hatinv_byname</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Hatize and invert a vector</h2>

<h3>Description</h3>

<p>When dividing rows or columns of a matrix by elements of a vector,
the vector elements are placed on the diagonal of a new matrix,
the diagonal matrix is inverted, and
the result is pre- or post-multiplied into the matrix.
This function performs the hatizing and inverting of vector <code>v</code> in one step
and takes advantage of computational efficiencies to achieve the desired result.
The computational shortcut is apparent when one observes that the matrix produced by hatizing and inverting
a vector is a diagonal matrix whose non-zero elements are the numerical inverses of the individual elements of <code>v</code>.
So this function first inverts each element of <code>v</code> then places the inverted elements on the diagonal of a diagonal matrix.
</p>


<h3>Usage</h3>

<pre><code class="language-R">hatinv_byname(v, keep = NULL, inf_becomes = .Machine$double.xmax)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>v</code></td>
<td>
<p>The vector to be hatized and inverted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep</code></td>
<td>
<p>See <code>hatize_byname()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inf_becomes</code></td>
<td>
<p>A value to be substitute for any <code>Inf</code> produced by the inversion process.
Default is <code>.Machine$double.xmax</code>.
Another reasonable value is <code>Inf</code>.
Set to <code>NULL</code> to disable substitution.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Note that this function gives the same result as <code>invert_byname(hatize_byname(v))</code>,
except that <code>invert_byname(hatize_byname(v))</code> fails due to a singular matrix error
when any of the elements of <code>v</code> are zero.
This function will give <code>inf_becomes</code> on the diagonal of the result for each zero element of <code>v</code>,
arguably a better answer.
The sign of <code>Inf</code> is preserved in the substitution.
The default value of <code>inf_becomes</code> is <code>.Machine$double.xmax</code>.
Set <code>inf_becomes</code> to <code>NULL</code> to disable this behavior.
</p>
<p>The default behavior is helpful for cases when the result of <code>hatinv_byname()</code> is later multiplied by <code>0</code>
to obtain <code>0</code>.
Multiplying <code>Inf</code> by <code>0</code> gives <code>NaN</code> which would effectively end the stream of calculations.
</p>


<h3>Value</h3>

<p>a square diagonal matrix with inverted elements of <code>v</code> on the diagonal
</p>


<h3>Examples</h3>

<pre><code class="language-R">v &lt;- matrix(1:10, ncol = 1, dimnames = list(c(paste0("i", 1:10)), c("c1"))) %&gt;%
  setrowtype("Industries") %&gt;% setcoltype(NA)
r &lt;- matrix(1:5, nrow = 1, dimnames = list(c("r1"), c(paste0("c", 1:5)))) %&gt;%
  setrowtype(NA) %&gt;% setcoltype("Commodities")
hatinv_byname(v, keep = "rownames")
hatinv_byname(r, keep = "colnames")
# This function also works with lists.
hatinv_byname(list(v, v), keep = "rownames")
# Watch out for 0 values
v2 &lt;- matrix(0:1, ncol = 1, dimnames = list(c(paste0("i", 0:1)), c("p1"))) %&gt;%
  setrowtype("Industries") %&gt;% setcoltype(NA)
# Produces singular matrix error
## Not run: v2 %&gt;% hatize_byname() %&gt;% invert_byname
# Handles 0 values well
hatinv_byname(v2, keep = "rownames")
hatinv_byname(v2, inf_becomes = 42, keep = "rownames")
hatinv_byname(v2, inf_becomes = NA, keep = "rownames")
# Deals with 1x1 matrices well, if the `keep` argument is set.
m &lt;- matrix(42, nrow = 1, ncol = 1, dimnames = list("r1", "c1")) %&gt;% 
  setrowtype("Product -&gt; Industry") %&gt;% 
  setcoltype("Industry -&gt; Product")
m %&gt;% 
  hatinv_byname(keep = "rownames")
m %&gt;% 
  hatinv_byname(keep = "colnames")
</code></pre>


</div>