<div class="container">

<table style="width: 100%;"><tr>
<td>gen</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a model component object for a generic random effects component in the linear predictor</h2>

<h3>Description</h3>

<p>This function is intended to be used on the right hand side of the <code>formula</code> argument to
<code>create_sampler</code> or <code>generate_data</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">gen(
  formula = ~1,
  factor = NULL,
  remove.redundant = FALSE,
  drop.empty.levels = FALSE,
  X = NULL,
  var = NULL,
  prior = NULL,
  Q0 = NULL,
  PX = NULL,
  GMRFmats = NULL,
  priorA = NULL,
  Leroux = FALSE,
  R0 = NULL,
  RA = NULL,
  constr = NULL,
  S0 = NULL,
  SA = NULL,
  formula.gl = NULL,
  a = 1000,
  name = "",
  sparse = NULL,
  control = gen_control(),
  debug = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a model formula specifying the effects that vary over the levels of
the factor variable(s) specified by argument <code>factor</code>. Defaults to <code>~1</code>,
corresponding to random intercepts. If <code>X</code> is specified <code>formula</code> is ignored.
Variable names are looked up in the data frame passed as <code>data</code> argument to
<code>create_sampler</code> or <code>generate_data</code>, or in <code>environment(formula)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factor</code></td>
<td>
<p>a formula with factors by which the effects specified in the <code>formula</code>
argument vary. Often only one such factor is needed but multiple factors are allowed so that
interaction terms can be modeled conveniently. The formula must take the form
<code> ~ f1(fac1, ...) * f2(fac2, ...) ...</code>, where
<code>fac1, fac2</code> are factor variables and <code>f1, f2</code> determine the
correlation structure assumed between levels of each factor, and the <code>...</code> indicate
that for some correlation types further arguments can be passed. Correlation structures
currently supported include <code>iid</code> for independent identically distributed effects,
<code>RW1</code> and <code>RW2</code> for random walks of first or second order over the factor levels,
<code>AR1</code> for first-order autoregressive effects, <code>season</code> for seasonal effects,
<code>spatial</code> for spatial (CAR) effects and <code>custom</code> for supplying a custom
precision matrix corresponding to the levels of the factor. For further details about
the correlation structures, and further arguments that can be passed, see
<code>correlation</code>. Argument <code>factor</code> is ignored if <code>X</code> is specified.
The factor variables are looked up in the data frame passed as <code>data</code> argument to
<code>create_sampler</code> or <code>generate_data</code>, or in <code>environment(formula)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>remove.redundant</code></td>
<td>
<p>whether redundant columns should be removed from the model matrix
associated with <code>formula</code>. Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drop.empty.levels</code></td>
<td>
<p>whether to remove factor levels without observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>A (possibly sparse) design matrix. This can be used instead of <code>formula</code> and <code>factor</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var</code></td>
<td>
<p>the (co)variance structure among the varying effects defined by <code>formula</code>
over the levels of the factors defined by <code>factor</code>.
The default is <code>"unstructured"</code>, meaning that a full covariance matrix
parameterization is used. For uncorrelated effects with unequal variances use
<code>var="diagonal"</code>. For uncorrelated effects with equal variances use <code>var="scalar"</code>.
In the case of a single varying effect there is no difference between these choices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior</code></td>
<td>
<p>the prior specification for the variance parameters of the random effects.
These can currently be specified by a call to <code>pr_invwishart</code> in case
<code>var="unstructured"</code> or by a call to <code>pr_invchisq</code> otherwise.
See the documentation of those prior specification functions for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Q0</code></td>
<td>
<p>precision matrix associated with <code>formula</code>. This can only be used in
combination with <code>var="scalar"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PX</code></td>
<td>
<p>whether parameter expansion should be used. Default is <code>TRUE</code>, which
applies parameter expansion with default options. The only exception is that for
gamma sampling distributions the default is <code>FALSE</code>, i.e. no parameter expansion.
Alternative options can be specified
by supplying a list with one or more of the following components:
</p>

<dl>
<dt>prior</dt>
<dd>
<p>prior for the multiplicative expansion parameter. Defaults to a
normal prior with mean 0 and standard deviation 1, unless the sampling
distribution is gamma in which case the default is a Multivariate Log
inverse Gamma prior. The default parameters can be changed using functions
<code>pr_normal</code> or <code>pr_MLiG</code>.</p>
</dd>
<dt>vector</dt>
<dd>
<p>whether a redundant multiplicative expansion parameter is used for each varying effect
specified by <code>formula</code>. The default is <code>TRUE</code> except when <code>var="scalar"</code>.
If <code>FALSE</code> a single redundant multiplicative parameter is used.</p>
</dd>
<dt>data.scale</dt>
<dd>
<p>whether the data level scale is used as a variance factor for the expansion
parameters. Default is <code>TRUE</code>.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>GMRFmats</code></td>
<td>
<p>list of incidence/precision/constraint matrices. This can be specified
as an alternative to <code>factor</code>. It should be a list such as that returned
by <code>compute_GMRF_matrices</code>. Can be used together with argument <code>X</code>
as a flexible alternative to <code>formula</code> and <code>factor</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorA</code></td>
<td>
<p>prior distribution for scale factors at the variance scale associated with <code>QA</code>.
In case of IGMRF models the scale factors correspond to the innovations.
The default <code>NULL</code> means not to use any local scale factors.
A prior can currently be specified using <code>pr_invchisq</code> or <code>pr_exp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Leroux</code></td>
<td>
<p>this option alters the precision matrix determined by <code>factor</code> by taking a
weighted average of it with the identity matrix. If <code>TRUE</code> the model gains an additional parameter,
the 'Leroux' parameter, being the weight of the original, structured, precision matrix in the weighted
average. By default a uniform prior for the weight and a uniform Metropolis-Hastings proposal density
are employed. This default can be changed by supplying a list with elements a, b, and a.star, b.star,
implying a beta(a, b) prior and a beta(a.star, b.star) independence proposal density. A third option is
to supply a single number between 0 and 1, which is then used as a fixed value for the Leroux parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R0</code></td>
<td>
<p>an optional equality restriction matrix acting on the coefficients defined by <code>formula</code>, for each
level defined by <code>factor</code>. If c is the number of restrictions, <code>R0</code> is a
q0 x c matrix where q0 is the number of columns of the design matrix derived
from <code>formula</code>. Together with <code>RA</code> it defines the set of equality constraints
to be imposed on the vector of coefficients. Only allowed in combination with <code>var="scalar"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RA</code></td>
<td>
<p>an optional equality restriction matrix acting on the coefficients defined by <code>factor</code>,
for each effect defined by <code>formula</code>. If c is the number of restrictions, <code>RA</code> is a
l x c matrix where l is the number of levels defined by <code>factor</code>.
Together with <code>R0</code> this defines the set of equality constraints to be imposed on the vector
of coefficients.
If <code>constr=TRUE</code>, additional constraints are imposed, corresponding to the
null-vectors of the singular precision matrix in case of an intrinsic Gaussian Markov Random Field.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constr</code></td>
<td>
<p>whether constraints corresponding to the null-vectors of the precision matrix
are to be imposed on the vector of coefficients. By default this is <code>TRUE</code> for
improper or intrinsic GMRF model components, i.e. components with a singular precision matrix
such as random walks or CAR spatial components.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S0</code></td>
<td>
<p>an optional inequality restriction matrix acting on the coefficients defined by <code>formula</code>, for each
level defined by <code>factor</code>. If c is the number of restrictions, <code>S0</code> is a
q0 x c matrix where q0 is the number of columns of the design matrix derived
from <code>formula</code>. Together with <code>SA</code> it defines the set of inequality constraints
to be imposed on the vector of coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SA</code></td>
<td>
<p>an optional inequality restriction matrix acting on the coefficients defined by <code>factor</code>,
for each effect defined by <code>formula</code>. If c is the number of restrictions, <code>SA</code> is a
l x c matrix where l is the number of levels defined by <code>factor</code>.
Together with <code>S0</code> this defines the set of constraints to be imposed on the vector
of coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula.gl</code></td>
<td>
<p>a formula of the form <code>~ glreg(...)</code> for group-level predictors
around which the random effect component is hierarchically centered.
See <code>glreg</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p>only used in case the effects are MLiG distributed, such as is
assumed in case of a gamma sampling distribution, or for
gaussian variance modelling. In those cases <code>a</code> controls how close
the effects' prior is to a normal prior, see <code>pr_MLiG</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>
<p>the name of the model component. This name is used in the output of the MCMC simulation
function <code>MCMCsim</code>. By default the name will be 'gen' with the number of the model term attached.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sparse</code></td>
<td>
<p>whether the model matrix associated with <code>formula</code> should be sparse.
The default is based on a simple heuristic based on storage size.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>a list with further computational options. These options can
be specified using function <code>gen_control</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>debug</code></td>
<td>
<p>if <code>TRUE</code> a breakpoint is set at the beginning of the posterior
draw function associated with this model component. Mainly intended for developers.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object with precomputed quantities and functions for sampling from
prior or conditional posterior distributions for this model component. Intended
for internal use by other package functions.
</p>


<h3>References</h3>

<p>J. Besag and C. Kooperberg (1995).
On Conditional and Intrinsic Autoregression.
Biometrika 82(4), 733-746.
</p>
<p>C.M. Carvalho, N.G. Polson and J.G. Scott (2010).
The horseshoe estimator for sparse signals.
Biometrika 97(2), 465-480.
</p>
<p>L. Fahrmeir, T. Kneib and S. Lang (2004).
Penalized Structured Additive Regression for Space-Time Data:
a Bayesian Perspective.
Statistica Sinica 14, 731-761.
</p>
<p>A. Gelman (2006).
Prior distributions for variance parameters in hierarchical models.
Bayesian Analysis 1(3), 515-533.
</p>
<p>A. Gelman, D.A. Van Dyk, Z. Huang and W.J. Boscardin (2008).
Using Redundant Parameterizations to Fit Hierarchical Models.
Journal of Computational and Graphical Statistics 17(1), 95-122.
</p>
<p>B. Leroux, X. Lei and N. Breslow (1999).
Estimation of Disease Rates in Small Areas: A New Mixed Model for Spatial Dependence.
In M. Halloran and D. Berry (Eds.), Statistical Models in Epidemiology,
the Environment and Clinical Trials, 135-178.
</p>
<p>T. Park and G. Casella (2008).
The Bayesian Lasso.
Journal of the American Statistical Association 103(482), 681-686.
</p>
<p>H. Rue and L. Held (2005).
Gaussian Markov Random Fields.
Chapman &amp; Hall/CRC.
</p>


</div>