<div class="container">

<table style="width: 100%;"><tr>
<td>mcreg</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Comparison of Two Measurement Methods Using Regression Analysis</h2>

<h3>Description</h3>

<p><code>mcreg</code> is used to compare two measurement methods by means of regression analysis.
Available methods comprise ordinary and weighted linear regression,
Deming and weighted Deming regression and Passing-Bablok regression. Point estimates of regression
parameters are computed together with their standard errors and confidence intervals.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mcreg(
  x,
  y = NULL,
  error.ratio = 1,
  alpha = 0.05,
  mref.name = NULL,
  mtest.name = NULL,
  sample.names = NULL,
  method.reg = c("PaBa", "LinReg", "WLinReg", "Deming", "WDeming", "PaBaLarge", "PBequi",
    "TS", "MDeming", "MMDeming", "NgMMDeming", "PiMMDeming"),
  method.ci = c("bootstrap", "jackknife", "analytical", "nestedbootstrap"),
  method.bootstrap.ci = c("quantile", "Student", "BCa", "tBoot"),
  nsamples = 999,
  nnested = 25,
  rng.seed = NULL,
  rng.kind = "Mersenne-Twister",
  iter.max = 30,
  threshold = 1e-06,
  na.rm = FALSE,
  NBins = 1e+06,
  kM = 1.345,
  tauMM = 4.685,
  priorSlope = 1,
  priorIntercept = 0,
  bdPoint = 0.5,
  slope.measure = c("radian", "tangent"),
  methodlarge = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>measurement values of reference method, or two column matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>measurement values of test method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>error.ratio</code></td>
<td>
<p>ratio between squared measurement errors of reference and 
test method, necessary for Deming regression (Default 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>value specifying the 100(1-alpha)% confidence level for confidence intervals (Default is 0.05).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mref.name</code></td>
<td>
<p>name of reference method (Default "Method1").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mtest.name</code></td>
<td>
<p>name of test Method (Default "Method2").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample.names</code></td>
<td>
<p>names of cases (Default "S##").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method.reg</code></td>
<td>
<p>regression method.  It is possible to choose between five regression methods: 
<code>"LinReg"</code> - ordinary least square regression.<br><code>"WLinReg"</code> - weighted ordinary least square regression.<br><code>"Deming"</code> - Deming regression.<br><code>"WDeming"</code> - weighted Deming regression.<br><code>"MDeming"</code> - Huber M-Deming regression.<br><code>"MMDeming"</code> - Huber MM-Deming regression.<br><code>"NgMMDeming"</code> - new generation MM-Deming regression.<br><code>"PiMMDeming"</code> - Prior informed MM-Deming regression.<br><code>"TS"</code> - Theil-Sen regression.<br><code>"PBequi"</code> - equivariant Passing-Bablok regression.<br><code>"PaBa"</code> - Passing-Bablok regression.<br><code>"PaBaLarge"</code> - approximative Passing-Bablok regression for large datasets, operating on <code>NBins</code> classes of constant slope angle which each slope
is classified to instead of building the complete triangular matrix of all N*N/2 slopes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method.ci</code></td>
<td>
<p>method of confidence interval calculation. The function 
contains four basic methods for calculation of confidence intervals for regression coefficients.
<code>"analytical"</code> - with parametric method.<br><code>"jackknife"</code> - with leave one out resampling.<br><code>"bootstrap"</code> - with ordinary non-parametric bootstrap resampling.<br><code>"nested bootstrap"</code> - with ordinary non-parametric bootstrap resampling.<br></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method.bootstrap.ci</code></td>
<td>
<p>bootstrap based confidence interval estimation method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsamples</code></td>
<td>
<p>number of bootstrap samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nnested</code></td>
<td>
<p>number of nested bootstrap samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rng.seed</code></td>
<td>
<p>integer number that sets the random number generator seed for bootstrap sampling. If set to NULL currently in the R session used RNG setting will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rng.kind</code></td>
<td>
<p>type of random number generator for bootstrap sampling. Only used when rng.seed is specified, see set.seed for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter.max</code></td>
<td>
<p>maximum number of iterations for weighted Deming iterative algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p>numerical tolerance for weighted Deming iterative algorithm convergence.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>remove measurement pairs that contain missing values (Default is FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NBins</code></td>
<td>
<p>number of bins used when 'reg.method="PaBaLarge"' to classify each slope in one of 'NBins' bins covering the range of all slopes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kM</code></td>
<td>
<p>Huber's k for the M weighting, default kM = 1.345</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tauMM</code></td>
<td>
<p>Tukey's tau for bisquare redescending weighting function, default tauMM = 4,685</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorSlope</code></td>
<td>
<p>starting slope value for PiMMDeming, default priorSlope = 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorIntercept</code></td>
<td>
<p>starting intercept value for PiMMDeming, default priorIntercept = 0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bdPoint</code></td>
<td>
<p>Proportion of data points selected for the highly robust M regression used for the determination of the starting parameters. Default 0.5</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>slope.measure</code></td>
<td>
<p>angular measure of pairwise slopes used for exact PaBa regression (see below for details).<br><code>"radian"</code> - for data sets with even sample numbers median slope is calculated as average of two central slope angles.<br><code>"tangent"</code> - for data sets with even sample numbers median slope is calculated as average of two central slopes (tan(angle)).<br></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>methodlarge</code></td>
<td>
<p>Boolean. This parameter applies only to regmethod="PBequi" and "TS".
If TRUE, a quasilinear algorithm is used. 
If FALSE, a quadratic algorithm is used which is faster for less than several hundred data pairs.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The regression analysis yields regression coefficients 'Intercept' and 'Slope' of the regression
<code class="reqn">Testmethod = Intercept + Slope * Referencemethod</code>. There are methods for computing the systematical
bias between reference and test method at a decision point Xc, <code class="reqn">Bias(Xc) = Intercept + (Slope-1) * Xc</code>,
accompanied by its corresponding standard error and confidence interval. One can use plotting
method <code>plotBias</code> for a comprehensive view of the systematical bias.
</p>
<p>Weighted regression for heteroscedastic data is available for linear and Deming regression and
implemented as a data point weighting with the inverted squared value of the reference method.
Therefore calculation of weighted regression (linear and Deming) is available only for positive values (&gt;0).
Passing-Bablok regression is only available for non-negative values (&gt;=0).
</p>
<p>Confidence intervals for regression parameters and bias estimates are calculated
either by using analytical methods or by means of resampling methods ("jackknife", "bootstrap", "nested bootstrap").
An analytical method is available for all types of regression except for weighted Deming.
For Passing-Bablok regression the option "analytical" calculates confidence intervals for the regression parameters
according to the non-parametric approach given in the original reference.
</p>
<p>The "jackknife" (or leave one out resampling) method was suggested by Linnet for
calculating confidence intervals of regression parameters
of Deming and weighted Deming regression. It is possible to calculate jackknife confidence
intervals for all types of regression. Note that we do not recommend this method for Passing-Bablok
since it has a tendency of underestimating the variability
(jackknife is known to yield incorrect estimates for errors of quantiles).
</p>
<p>The bootstrap method requires additionally choosing a value for <code>method.bootstrap.ci</code>.
If bootstrap is the method of choice, "BCa", t-bootstrap ("tBoot") and simple "quantile" confidence intervals are recommended
(See Efron B. and Tibshirani R.J.(1993),Carpenter J., Bithell J. (2000)).
The "nestedbootstrap" method can be very time-consuming but is necessary for calculating t-bootstrap
confidence intervals for weighted Deming or Passing-Bablok regression. For these regression methods there are no analytical
solutions for computing standard errors, which therefore have to be obtained by nested bootstrapping.
</p>
<p>Note that estimating resampling based confidence intervals for Passingâ€“Bablok regressions can take very long time 
for larger data sets due to the high computational complexity of the algorithm. To mitigate this drawback
an adaption of the Passing-Bablok algorithm has been implemented (<code>"PaBaLarge"</code>), which yields approximative results. This approach
does not build the complete upper triangular matrix of all 'n*(n-1)/2' slopes. It subdivides the range of slopes into
'NBins' classes, and sorts each slope into one of these bins. The remaining steps are the same as for the exact <code>"PaBa"</code>
algorithm, except that these are performed on the binned slopes instead of operating on the matrix of slopes.
</p>
<p>Our implementation of exact Passing-Bablok regression (<code>"PaBa"</code>) provides two alternative metrics for regression slopes which
can result in different regression estimates.
As a robust regression method PaBa is essentially invariant to the parameterization of regression slopes,
however in the case of an even number of all pairwise slopes the two central slopes are averaged to estimate the final regression slope.
In this situation using an angle based metric (<code>slope.measure="radian"</code>) will result in
a regression estimate that is geometrically centered between the two central slopes, whereas the tangent measure (<code>slope.measure="tangent"</code>)
proposed in Passing and Bablok (1983) will be geometrically biased towards a higher slope. See below for a pathological example.
Note that the difference between the two measures is negligible for data sets with reasonable sample size (N&gt;20) and correlation.   
</p>
<p>Equivariant Passing-Bablok regression as proposed by Bablok et al. (1988) (see also Dufey 2020) is not bound to slopes near 1
and therefore not only applicable for method comparison but also for method transformation, i.e., when two methods yield results on a different scale. 
Like ordinary Passing-Bablok regression, the method is robust. 
This method should be preferred over the older "PaBa" and "PaBalarge" algorithms. 
Both slope measures "radian" and "tangent" are
available as are methods for the determination of confidence intervals -analytical and bootstrap.
By default (methodlarge=TRUE),  a modified algorithm (Dillencourt et al., 1992) is used which scales quasilinearly and requires little memory.
Alternatively (methodlarge=F), a simpler implementation which scales quadratically and is more memory intensive may be called. 
While point estimates coincide for both implementations, analytic confidence intervals differ slightly. 
Same holds true for the Theil-Sen estimator, which is a robust alternative to linear regression.
Like linear regression, it assumes that x-values are error free.
</p>


<h3>Value</h3>

<p>"MCResult" object containing regression results. The function <code>getCoefficients</code> or
<code>printSummary</code> can be used to obtain or print a summary of the results.
The function <code>getData</code> allows to see the original data.
An S4 object of class "MCResult" containing at least the following slots: 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>measurement data in wide format, one pair of observations per sample. Includes samples ID, 
reference measurement, test measurement.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>para</code></td>
<td>
<p>numeric matrix with estimates for slope and intercept, corresponding standard deviations and confidence intervals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mnames</code></td>
<td>
<p>character vector of length two containing names of analytical methods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regmeth</code></td>
<td>
<p>type of regression type used for parameter estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cimeth</code></td>
<td>
<p>method used for calculation of confidence intervals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>error.ratio</code></td>
<td>
<p>ratio between squared measurement errors of reference  and test method, necessary for Deming regression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>confidence level using for calculation of confidence intervals.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Ekaterina Manuilova <a href="mailto:ekaterina.manuilova@roche.com">ekaterina.manuilova@roche.com</a>, Andre Schuetzenmeister <a href="mailto:andre.schuetzenmeister@roche.com">andre.schuetzenmeister@roche.com</a>, Fabian Model <a href="mailto:fabian.model@roche.com">fabian.model@roche.com</a>, Sergej Potapov <a href="mailto:sergej.potapov@roche.com">sergej.potapov@roche.com</a>, Florian Dufey <a href="mailto:florian.dufey@roche.com">florian.dufey@roche.com</a>, Jakob Raymaekers <a href="mailto:jakob.raymaekers@kuleuven.be">jakob.raymaekers@kuleuven.be</a>
</p>


<h3>References</h3>

<p>Bland, J. M., Altman, D. G. (1986) 
Statistical methods for assessing agreement between two methods of clinical measurement. 
<em>Lancet</em>, <b>i:</b> 307â€“310.
</p>
<p>Linnet, K. (1993)
Evaluation of Regression Procedures for Methods Comparison Studies.
<em>CLIN. CHEM.</em> <b>39/3</b>, 424â€“432.
</p>
<p>Linnet, K. (1990)
Estimation of the Linear Relationship between the Measurements of two Methods with Proportional Errors.
<em>Statistics in Medicine</em>, Vol. <b>9</b>, 1463â€“1473.
</p>
<p>Neter, J., Wassermann, W., Kunter, M. (1985)
<em>Applied Statistical Models.</em> 
Richard D. Irwing, INC.
</p>
<p>Looney, S. W. (2010) 
Statistical Methods for Assessing Biomarkers.
<em>Methods in Molecular Biology</em>, vol. <b>184</b>: <em>Biostatistical Methods</em>. Human Press INC.
</p>
<p>Passing, H., Bablok, W. (1983) 
A new biometrical procedure for testing the equality of measurements from two different analytical methods. 
Application of linear regression procedures for method comparison studies in clinical chemistry, Part I. 
<em>J Clin Chem Clin Biochem</em>.  Nov; <b>21(11)</b>:709â€“20.
</p>
<p>Bablok, W., Passing, H., Bender, R., &amp; Schneider, B. (1988)
A general regression procedure for method transformation. Application of linear regression procedures for method 
comparison studies in clinical chemistry, Part III. 
<em>Clinical Chemistry and Laboratory Medicine</em>, <b>26(11)</b>: 783â€“790.
</p>
<p>Dillencourt, M. B., Mount, D. M., &amp; Netanyahu, N. S. (1992) 
A randomized algorithm for slope selection. 
<em>International Journal of Computational Geometry &amp; Applications</em>, <b>2(01)</b>: 1â€“27.
</p>
<p>Dufey, F. (2020) 
Derivation of Passing-Bablok regression from Kendall's tau. 
<em>The International Journal of Biostatistics</em>, <b>16(2)</b>: 20190157. 
https://doi.org/10.1515/ijb-2019-0157
</p>
<p>Raymaekers, J.,  Dufey, F. (2022)
Equivariant Passing-Bablok regression in quasilinear time. 
<em>arXiv preprint arXiv:2202.08060</em>.
https://doi.org/10.48550/arXiv.2202.08060
</p>
<p>Efron, B., Tibshirani, R.J. (1993)
<em>An Introduction to the Bootstrap</em>. Chapman and Hall.
</p>
<p>Carpenter, J., Bithell, J. (2000)
Bootstrap confidence intervals: when, which, what? A practical guide for medical statisticians.
<em>Stat Med</em>, <b>19 (9)</b>, 1141â€“1164.
</p>
<p><em>CLSI EP9-A2</em>. Method Comparison and Bias Estimation Using Patient Samples; Approved Guideline.
</p>


<h3>See Also</h3>

<p><code>plotDifference</code>, <code>plot.mcr</code>, <code>getResiduals</code>, <code>plotResiduals</code>, <code>calcResponse</code>, <code>calcBias</code>, <code>plotBias</code>, <code>compareFit</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library("mcrPioda")
data(creatinine,package="mcrPioda")
x &lt;- creatinine$serum.crea
y &lt;- creatinine$plasma.crea
# Deming regression fit.
# The confidence intercals for regression coefficients
# are calculated with analytical method
model1&lt;- mcreg(x,y,error.ratio=1,method.reg="Deming", method.ci="analytical",
               mref.name = "serum.crea", mtest.name = "plasma.crea", na.rm=TRUE)
# Results
printSummary(model1)
getCoefficients(model1)
plot(model1)
# Deming regression fit.
# The confidence intervals for regression coefficients
# are calculated with bootstrap (BCa) method
model2&lt;- mcreg(x,y,error.ratio=1,method.reg="Deming",
               method.ci="bootstrap", method.bootstrap.ci = "BCa",
               mref.name = "serum.crea", mtest.name = "plasma.crea", na.rm=TRUE)
compareFit(model1, model2) 

## Pathological example of Passing-Bablok regression where measure for slope angle matters  
x1 &lt;- 1:10; y1 &lt;- 0.5*x1; x &lt;- c(x1,y1); y &lt;- c(y1,x1) 
m1 &lt;- mcreg(x,y,method.reg="PaBa",method.ci="analytical",slope.measure="radian",
            mref.name="X",mtest.name="Y")
m2 &lt;- mcreg(x,y,method.reg="PaBa",method.ci="analytical",slope.measure="tangent",
            mref.name="X",mtest.name="Y")
plot(m1, add.legend=FALSE,identity=FALSE,
     main="Radian vs. tangent slope measures in Passing-Bablok regression\n(pathological example)",
     ci.area=FALSE,add.cor=FALSE)
plot(m2, ci.area=FALSE,reg.col="darkgreen",reg.lty=2,identity=FALSE,add.legend=FALSE,
     draw.points=FALSE,add=TRUE,add.cor=FALSE)
includeLegend(place="topleft",models=list(m1,m2),model.names=c("PaBa Radian","PaBa Tangent"),
              colors=c("darkblue","darkgreen"),lty=c(1,2),design="1",digits=2)
</code></pre>


</div>