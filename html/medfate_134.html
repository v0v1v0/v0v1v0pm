<div class="container">

<table style="width: 100%;"><tr>
<td>hydrology_soilWaterBalance</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Soil water balance</h2>

<h3>Description</h3>

<p>Function <code>hydrology_soilWaterBalance</code> estimates water balance of soil layers given water inputs/outputs, including the simulation of water movement within the soil.
</p>


<h3>Usage</h3>

<pre><code class="language-R">hydrology_soilWaterBalance(
  soil,
  soilFunctions,
  rainfallInput,
  rainfallIntensity,
  snowmelt,
  sourceSink,
  runon = 0,
  lateralFlows = NULL,
  waterTableDepth = NA_real_,
  infiltrationMode = "GreenAmpt1911",
  infiltrationCorrection = 5,
  soilDomains = "buckets",
  nsteps = 24L,
  max_nsubsteps = 3600L,
  modifySoil = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>soil</code></td>
<td>
<p>Object of class <code>soil</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>soilFunctions</code></td>
<td>
<p>Soil water retention curve and conductivity functions, either 'SX' (for Saxton) or 'VG' (for Van Genuchten).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rainfallInput</code></td>
<td>
<p>Amount of water from rainfall event (after excluding interception), in mm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rainfallIntensity</code></td>
<td>
<p>Rainfall intensity, in mm/h.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>snowmelt</code></td>
<td>
<p>Amount of water originated from snow melt, in mm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sourceSink</code></td>
<td>
<p>Local source/sink term for each soil layer (from soil evaporation or plant transpiration/redistribution)
as mm/day.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>runon</code></td>
<td>
<p>Surface water amount running on the target area from upslope (in mm).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lateralFlows</code></td>
<td>
<p>Lateral source/sink terms for each soil layer (interflow/to from adjacent locations) as mm/day.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>waterTableDepth</code></td>
<td>
<p>Water table depth (in mm). When not missing, capillarity rise will be allowed if lower than total soil depth.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>infiltrationMode</code></td>
<td>
<p>Infiltration model, either "GreenAmpt1911" or "Boughton1989"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>infiltrationCorrection</code></td>
<td>
<p>Correction for saturated conductivity, to account for increased infiltration due to macropore presence</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>soilDomains</code></td>
<td>
<p>Either "buckets" (multi-bucket domain), "single" (for single-domain Richards) or "dual" (for dual-permeability model).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsteps</code></td>
<td>
<p>Number of time steps per day</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_nsubsteps</code></td>
<td>
<p>Maximum number of substeps per time step</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modifySoil</code></td>
<td>
<p>Boolean flag to indicate that the input <code>soil</code> object should be modified during the simulation.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The multi-bucket model adds/substracts water to each layer and if content is above field capacity the excess percolates to the layer below.
If there is still an excess for the bottom layer, the model will progressively fill upper layers (generating saturation excess if the first layer 
becomes saturated). Every day the some layers are over field capacity, the model simulates deep drainage.
</p>
<p>The single-domain model simulates water flows by solving Richards's equation using the predictor-corrector method, as described in 
Bonan et al. (2019).
</p>
<p>The dual-permeability model is an implementation of the model MACRO 5.0 (Jarvis et al. 1991; Larsbo et al. 2005).
</p>
<p>Both the multi-bucket and the single-domain model can apply a correction to the infiltration rate to account for macroporosity in infiltration. In the
dual-permeability model extra infiltration through macropores is simulated explicitly.
</p>


<h3>Value</h3>

<p>Returns a named vector with different elements, depending on <code>soilDomains</code>. 
</p>
<p>If <code>soilDomains == "buckets"</code>:
</p>

<ul>
<li>
<p><code>Snowmelt</code>: Snowmelt input (mm).
</p>
</li>
<li>
<p><code>Source/sinks</code>: Sum of source/sink input across layers (mm).
</p>
</li>
<li>
<p><code>Infiltration</code>: Water infiltrated into the soil (mm).
</p>
</li>
<li>
<p><code>InfiltrationExcess</code>: Excess infiltration in the topmost layer (mm) leading to an increase in runoff.
</p>
</li>
<li>
<p><code>SaturationExcess</code>: Excess saturation in the topmost layer (mm) leading to an increase in runoff.
</p>
</li>
<li>
<p><code>Runoff</code>: Surface runoff generated by saturation excess or infiltration excess (mm).
</p>
</li>
<li>
<p><code>DeepDrainage</code>: Water draining from the bottom layer (mm). This quantity is corrected to close the water balance.
</p>
</li>
<li>
<p><code>CapillarityRise</code>: Water entering the soil via capillarity rise (mm) from the water table, if <code>waterTableDepth</code> is supplied.
</p>
</li>
</ul>
<p>If <code>soilDomains == "single"</code> the named vector contains the following additional elements:
</p>

<ul>
<li>
<p><code>Correction</code>: Amount of water (mm) added to deep drainage to correct the water balance.
</p>
</li>
<li>
<p><code>VolumeChange</code>: Change in soil water volume (mm).
</p>
</li>
<li>
<p><code>Substep</code>: Time step of the moisture solving (seconds).
</p>
</li>
</ul>
<p>If <code>soilDomains == "dual"</code> the named vector contains the following additional elements:
</p>

<ul>
<li>
<p><code>Lateral flows</code>: Sum of water circulating between micropores and macropores, positive when filling micropores (mm).
</p>
</li>
<li>
<p><code>InfiltrationMatrix</code>: Water infiltrated into the soil matrix (mm).
</p>
</li>
<li>
<p><code>InfiltrationMacropores</code>: Water infiltrated into the soil macropore domain (mm).
</p>
</li>
<li>
<p><code>InfiltrationExcessMatrix/InfiltrationExcessMacropores</code>: Excess infiltration in the topmost layer (mm) leading to an increase in runoff.
</p>
</li>
<li>
<p><code>SaturationExcessMatrix/SaturationExcessMacropores</code>: Excess saturation in the topmost layer (mm) leading to an increase in runoff.
</p>
</li>
<li>
<p><code>DrainageMatrix</code>: Water draining from the bottom layer of the matrix domain (mm). This quantity is corrected to close water balance in the micropore domain.
</p>
</li>
<li>
<p><code>DrainageMacropores</code>: Water draining from the bottom layer of the macropore domain (mm). This quantity is corrected to close the water balance in the macropore domain.
</p>
</li>
<li>
<p><code>CorrectionMatrix</code>: Amount of water (mm) added to deep drainage of soil matrix to correct the water balance.
</p>
</li>
<li>
<p><code>CorrectionMacropores</code>: Amount of water (mm) added to deep drainage of macropores to correct the water balance.
</p>
</li>
<li>
<p><code>MatrixVolumeChange</code>: Change in soil water volume in the soil matrix domain (mm).
</p>
</li>
<li>
<p><code>MacroporeVolumeChange</code>: Change in soil water volume in the macropore domain (mm).
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, CREAF
</p>
<p>María González Sanchís, UPV-CTFC
</p>


<h3>References</h3>

<p>Bonan, G. (2019). Climate change and terrestrial ecosystem modeling. Cambridge University Press, Cambridge, UK. 
</p>
<p>Jarvis, N.J., Jansson, P‐E., Dik, P.E. &amp; Messing, I. (1991). Modelling water and solute transport in macroporous soil. I. Model description and sensitivity analysis. Journal of Soil Science, 42, 59–70. 
</p>
<p>Larsbo, M., Roulier, S., Stenemo, F., Kasteel, R. &amp; Jarvis, N. (2005). An Improved Dual‐Permeability Model of Water Flow and Solute Transport in the Vadose Zone. Vadose Zone Journal, 4, 398–406.
</p>


<h3>See Also</h3>

<p><code>spwb</code>, <code>hydrology_waterInputs</code>, <code>hydrology_infiltration</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Define soil parameters
spar &lt;- defaultSoilParams(4)

# Initializes soil hydraulic parameters
examplesoil &lt;- soil(spar)

# Water balance in a multi-bucket model
hydrology_soilWaterBalance(examplesoil, "VG", 10, 5, 0, c(-1,-1,-1,-1), 
                           soilDomains = "buckets", modifySoil = FALSE)
                           
# Water balance in a single-domain model (Richards equation)
hydrology_soilWaterBalance(examplesoil, "VG", 10, 5, 0, c(-1,-1,-1,-1), 
                           soilDomains = "single", modifySoil = FALSE)
                    
# Water balance in a dual-permeability model (MACRO)
hydrology_soilWaterBalance(examplesoil, "VG", 10, 5, 0, c(-1,-1,-1,-1), 
                           soilDomains = "dual", modifySoil = FALSE)
  
</code></pre>


</div>