<div class="container">

<table style="width: 100%;"><tr>
<td>memgoodness</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Goodness of fit of the mem</h2>

<h3>Description</h3>

<p>Function <code>memgoodness</code> calculates different indicators related to the goodness of the MEM
for detecting the epidemics, using data from the model and using all data in the original dataset.
</p>


<h3>Usage</h3>

<pre><code class="language-R">memgoodness(
  i.data,
  i.seasons = 10,
  i.type.threshold = 5,
  i.level.threshold = 0.95,
  i.tails.threshold = 1,
  i.type.intensity = 6,
  i.level.intensity = c(0.4, 0.9, 0.975),
  i.tails.intensity = 1,
  i.type.curve = 2,
  i.level.curve = 0.95,
  i.type.other = 2,
  i.level.other = 0.95,
  i.method = 2,
  i.param = 2.8,
  i.n.max = -1,
  i.type.boot = "norm",
  i.iter.boot = 10000,
  i.calculation.method = "default",
  i.goodness.method = "cross",
  i.goodness.threshold = NA,
  i.goodness.intensity = NA,
  i.detection.values = seq(1, 5, 0.1),
  i.weeks.above = 1,
  i.output = ".",
  i.graph = F,
  i.prefix = "",
  i.min.seasons = 6
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>i.data</code></td>
<td>
<p>Data frame of input data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.seasons</code></td>
<td>
<p>Maximum number of seasons to use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.type.threshold</code></td>
<td>
<p>Type of confidence interval to calculate the threshold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.level.threshold</code></td>
<td>
<p>Level of confidence interval to calculate the threshold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.tails.threshold</code></td>
<td>
<p>Tails for the confidence interval to calculate the threshold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.type.intensity</code></td>
<td>
<p>Type of confidence interval to calculate the intensity thresholds.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.level.intensity</code></td>
<td>
<p>Levels of confidence interval to calculate the intensity thresholds.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.tails.intensity</code></td>
<td>
<p>Tails for the confidence interval to calculate the threshold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.type.curve</code></td>
<td>
<p>Type of confidence interval to calculate the modelled curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.level.curve</code></td>
<td>
<p>Level of confidence interval to calculate the modelled curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.type.other</code></td>
<td>
<p>Type of confidence interval to calculate length, start and percentages.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.level.other</code></td>
<td>
<p>Level of confidence interval to calculate length, start and percentages.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.method</code></td>
<td>
<p>Method to calculate the optimal timing of the epidemic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.param</code></td>
<td>
<p>Parameter to calculate the optimal timing of the epidemic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.n.max</code></td>
<td>
<p>Number of pre-epidemic values used to calculate the threshold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.type.boot</code></td>
<td>
<p>Type of bootstrap technique.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.iter.boot</code></td>
<td>
<p>Number of bootstrap iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.calculation.method</code></td>
<td>
<p>method of determining true/false positives and true/false negatives.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.goodness.method</code></td>
<td>
<p>method to calculate goodness.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.goodness.threshold</code></td>
<td>
<p>pre/post epidemic thresholds for threshold goodness method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.goodness.intensity</code></td>
<td>
<p>intensitie thresholds (medium, high, very high) for threshold goodness method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.detection.values</code></td>
<td>
<p>values to use in the i.param value of <code>memtiming</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.weeks.above</code></td>
<td>
<p>number of weeks over the threshold to give the alert.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.output</code></td>
<td>
<p>output directory for graphs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.graph</code></td>
<td>
<p>whether the graphs must be written or not.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.prefix</code></td>
<td>
<p>prefix used for naming graphs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i.min.seasons</code></td>
<td>
<p>minimum number of seasons to perform goodness, default=6.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The indicators calculated are sensitivity, specificity, positive predictive value, negative
predictive value, percent agreement and the Matthews correlation coefficient.
</p>
<p>How goodness is calculated:
</p>
<p>MEM calculates goodness indicators in an iterative process. In each iteration:
</p>

<ol>
<li>
<p> For one particular season the timing is calculated to determine which weeks are inside
the pre, post and epidemic periods. This is used as the real data: a real positive outcome
(epidemic weeks) and a real negative outcome (pre and post-epidemic weeks).
</p>
</li>
<li>
<p> With a set of seasons, pre-epidemic threshold is calculated. This threshold is compared
with values from the season selected in the first step and see if values are above or below the
threshold. This is used as the observed data: an observed positive outcome (week value above
the threshold), and observed negative outcome (week value below the threshold).
</p>
</li>
<li>
<p> Each week has a real and an observed outcome, so it can be classified in:
</p>

<ul>
<li>
<p> True positives (TP): real positive, observed positive: values of the epidemic period above the threshold.
</p>
</li>
<li>
<p> True negatives (TN): real negative, observed negative: values of the non-epidemic period below the threshold.
</p>
</li>
<li>
<p> False positives (FP): real negative, observed positive: values of the non-epidemic period above the threshold.
</p>
</li>
<li>
<p> False negatives (FN): real positive, observed negative: values of the epidemic period below the threshold.
</p>
</li>
</ul>
</li>
<li>
<p> The process is repeated for each season in the dataset (each iteration a different value
until all seasons have been processed).
</p>
</li>
<li>
<p> All TP, TN, FP and FN are pooled together and sensitivity, specificity, positive predictive value,
negative predictive value, percent agreement and the Matthews correlation coefficient are calculated.
</p>
</li>
</ol>
<p>There are two ways of deciding the set of seasons used to calculate the pre-epidemic threshold in each
iteration and it is determined by the <code>i.goodness.method</code>.
</p>

<ul>
<li>
<p> cross: For each value, the surrounding seasons (after or before the current value) are selected up
to the number of Max. seasons (parameter of the Model box). To calculate the thresholds for season 2010/2011,
data from 2005/2006 to 2009/2010 and from 2011/20012 to 2015/2016 will be taken.
</p>
</li>
<li>
<p> sequential: Only preceding seasons are used (before the current value) up to the number of Max. seasons.
To calculate the thresholds for season 2010/2011, data from 2000/2001 to 2009/2010 are taken.
</p>
</li>
<li>
<p> threshold: The pre/post epidemic and intensity thresholds are fixed values for all the seasons and
are compared with the epidemic as determined by MEM algorithm.
</p>
</li>
</ul>
<p>The <code>i.calculation.method</code> is used to determine when the alert based on the epidemic threshold.
The "default" method sets all values above the threshold as epidemic, and all the values below as non-epidemic.
Pre-epidemic threshold is used for values before the peak, and post-epidemic threshold for values after
the peak.
The "alternative" method sets an epidemic start and epidemic end, all the values in between are epidemic values.
The epidemic start is when <code>i.weeks.above</code> (default=1) consecutive weeks are above the pre-epidemic threshold.
The epidemic end is the first week below the post-epidemic threshold after the epidemic start.
Note that if no post-epidemic threshold is provided, the pre-epidemic value is used instead.
</p>


<h3>Value</h3>

<p><code>memgoodness</code> returns a list.
A list containing at least the following components:
</p>

<ul>
<li>
<p>validity.data data for each value analysed.
</p>
</li>
<li>
<p>results Total weeks, non-missing weeks, true positives, false positives
true negatives, false negatives, sensitivity, specificity .
</p>
</li>
<li>
<p>peaks distribution of the levels of intensity of the peaks.
</p>
</li>
<li>
<p>peaks.data Peak value, week of the peak value, epidemic and intensity thresholds and intensity level of each season analysed.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Jose E. Lozano <a href="mailto:lozalojo@gmail.com">lozalojo@gmail.com</a>
</p>


<h3>References</h3>

<p>Vega T, Lozano JE, Ortiz de Lejarazu R, Gutierrez Perez M. Modelling influenza epidemic - can we
detect the beginning and predict the intensity and duration? Int Congr Ser. 2004 Jun;1263:281-3.
</p>
<p>Vega T, Lozano JE, Meerhoff T, Snacken R, Mott J, Ortiz de Lejarazu R, et al. Influenza surveillance
in Europe: establishing epidemic thresholds by the moving epidemic method. Influenza Other Respir
Viruses. 2013 Jul;7(4):546-58. DOI:10.1111/j.1750-2659.2012.00422.x.
</p>
<p>Vega T, Lozano JE, Meerhoff T, Snacken R, Beaute J, Jorgensen P, et al. Influenza surveillance in
Europe: comparing intensity levels calculated using the moving epidemic method. Influenza Other
Respir Viruses. 2015 Sep;9(5):234-46. DOI:10.1111/irv.12330.
</p>
<p>Lozano JE. lozalojo/mem: Second release of the MEM R library. Zenodo [Internet]. [cited 2017 Feb 1];
Available from: <a href="https://zenodo.org/record/165983">https://zenodo.org/record/165983</a>. DOI:10.5281/zenodo.165983
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Castilla y Leon Influenza Rates data
data(flucyl)
# Goodness of fit
epi.good &lt;- memgoodness(flucyl, i.detection.values = seq(2.6, 2.8, 0.1))
epi.good$results
epi.good$peaks
</code></pre>


</div>