<div class="container">

<table style="width: 100%;"><tr>
<td>REmargins</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate the predicted value for each observation across the distribution
of the random effect terms.</h2>

<h3>Description</h3>

<p><code>REmargins</code> calculates the average predicted value for each row of a
new data frame across the distribution of <code>expectedRank</code> for a
merMod object. This allows the user to make meaningful comparisons about the
influence of random effect terms on the scale of the response variable,
for user-defined inputs, and accounting for the variability in grouping terms.
</p>


<h3>Usage</h3>

<pre><code class="language-R">REmargins(
  merMod,
  newdata = NULL,
  groupFctr = NULL,
  term = NULL,
  breaks = 4,
  .parallel = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>merMod</code></td>
<td>
<p>An object of class merMod</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>a data frame of observations to calculate group-level differences
for</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groupFctr</code></td>
<td>
<p>The name of the grouping factor over which the random
coefficient of interest varies.  This is the variable to the right of the
pipe, <code>|</code>, in the [g]lmer formula. This parameter is optional, if not
specified, it will perform the calculation for the first effect listed
by <code>ranef</code>. If the length is &gt; 1 then the combined effect of all
listed groups will calculated and marginalized over co-occurences of those
groups if desired.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>term</code></td>
<td>
<p>The name of the random coefficient of interest. This is the
variable to the left of the pipe, <code>|</code>, in the [g]lmer formula. Partial
matching is attempted on the intercept term so the following character
strings will all return rankings based on the intercept (<em>provided that
they do not match the name of another random coefficient for that factor</em>):
<code>c("(Intercept)", "Int", "intercep", ...)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breaks</code></td>
<td>
<p>an integer representing the number of bins to divide the group
effects into, the default is 3.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.parallel, </code></td>
<td>
<p>logical should parallel computation be used, default is TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments to pass to <code>predictInterval</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function simulates the
</p>
<p>The function predicts the response at every level in the random effect term
specified by the user. Then, the expected rank of each group level is binned
to the number of bins specified by the user. Finally, a weighted mean of the
fitted value for all observations in each bin of the expected ranks is
calculated using the inverse of the variance as the weight â€“ so that less
precise estimates are downweighted in the calculation of the mean for the bin.
Finally, a standard error for the bin mean is calculated.
</p>


<h3>Value</h3>

<p>A data.frame with all unique combinations of the number of cases, rows
in the newdata element:
</p>

<dl>
<dt>...</dt>
<dd>
<p>The columns of the original data taken from <code>newdata</code></p>
</dd>
<dt>case</dt>
<dd>
<p>The row number of the observation from newdata. Each row in newdata will be
repeated for all unique levels of the grouping_var, term, and breaks.</p>
</dd>
<dt>grouping_var</dt>
<dd>
<p>The grouping variable the random effect is being marginalized over.</p>
</dd>
<dt>term</dt>
<dd>
<p>The term for the grouping variable the random effect is being marginalized over.</p>
</dd>
<dt>breaks</dt>
<dd>
<p>The ntile of the effect size for <code>grouping_var</code> and <code>term</code></p>
</dd>
<dt>original_group_level</dt>
<dd>
<p>The original grouping value for this <code>case</code></p>
</dd>
<dt>fit_combined</dt>
<dd>
<p>The predicted value from <code>predictInterval</code> for this case simulated
at the Nth ntile of the expected rank distribution of <code>grouping_var</code> and <code>term</code></p>
</dd>
<dt>upr_combined</dt>
<dd>
<p>The upper bound of the predicted value.</p>
</dd>
<dt>lwr_combined</dt>
<dd>
<p>The lower bound of the predicted value.</p>
</dd>
<dt>fit_XX</dt>
<dd>
<p>For each grouping term in newdata the predicted value is decomposed into its
fit components via predictInterval and these are all returned here</p>
</dd>
<dt>upr_XX</dt>
<dd>
<p>The upper bound for the effect of each grouping term</p>
</dd>
<dt>lwr_XX</dt>
<dd>
<p>The lower bound for the effect of each grouping term</p>
</dd>
<dt>fit_fixed</dt>
<dd>
<p>The predicted fit with all the grouping terms set to 0 (average)</p>
</dd>
<dt>upr_fixed</dt>
<dd>
<p>The upper bound fit with all the grouping terms set to 0 (average)</p>
</dd>
<dt>lwr_fixed</dt>
<dd>
<p>The lower bound fit with all the grouping terms set to 0 (average)</p>
</dd>
</dl>
<h3>References</h3>

<p>Gatz, DF and Smith, L. The Standard Error of a Weighted Mean Concentration.
I. Bootstrapping vs other methods. <em>Atmospheric Environment</em>.
1995;11(2)1185-1193. Available at
<a href="https://www.sciencedirect.com/science/article/pii/135223109400210C">https://www.sciencedirect.com/science/article/pii/135223109400210C</a>
</p>
<p>Cochran, WG. 1977. Sampling Techniques (3rd Edition). Wiley, New York.
</p>


<h3>See Also</h3>

<p><code>expectedRank</code>, <code>predictInterval</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
fm1 &lt;- lmer(Reaction ~ Days + (Days | Subject), sleepstudy)
mfx &lt;- REmargins(merMod = fm1, newdata = sleepstudy[1:10,])

# You can also pass additional arguments to predictInterval through REimpact
 g1 &lt;- lmer(y ~ lectage + studage + (1|d) + (1|s), data=InstEval)
 margin_df &lt;- REmargins(g1, newdata = InstEval[20:25, ], groupFctr = c("s"),
                        breaks = 4)
 margin_df &lt;- REmargins(g1, newdata = InstEval[20:25, ], groupFctr = c("d"),
                         breaks = 3)

</code></pre>


</div>