<div class="container">

<table style="width: 100%;"><tr>
<td>bkp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Draw block plots from block plot objects
</h2>

<h3>Description</h3>

<p><code>bkp</code> draws block plots based on block plot objects generated by <code>blockplot</code> and its methods. 
It is normally called from within <code>blockplot</code> but can be invoked directly.
</p>


<h3>Usage</h3>

<pre><code class="language-R">	bkp(x, labels = x$labels, xlim = NULL, ylim = NULL, 
            main = NULL, xlab = NULL, ylab = "Frequency", 
            square = FALSE, add = FALSE, offset = 0, 
            grp.spacing = 2, grp.at = NA, 
            fill = NA, border = NULL, density = NULL, angle = 45, 
            lty = 1, lwd = 2, label.col = 1, cex = NA, adj = c(0.5, 0.4), 
            uline = 2, uline.lwd = lwd, uline.lty = 1, 
            uline.col = if (!is.null(border)) border else par("fg"), 
            grp.labs = FALSE, grp.pos = 1, glab.control = list(), 
            axes = c(TRUE, FALSE), asp = NA, frame.plot = any(axes), 
            drop.unused = TRUE, unused.label="[Missing]", ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p> An R object. For the default method, a vector of values for which the blockplot is desired. 
For the formula method, a valid formula, such as <code>y ~ grp</code> (see Details).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p>Labels for data points, passed to <code>text</code>; in principle of any type acceptable to <code>text</code>. 
Labels are placed inside boxes so should be short for readability.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim</code></td>
<td>
<p> Limits <code>(x1, x2)</code> for the horizontal (<code class="reqn">x</code>) range of the plot. The default is the range of <code>breaks</code>, after computation if necessary.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p> limits for the vertical range of the plot. Will be overridden if <code>square=TRUE</code> (see below).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>Main title for the plot, passed to <code>plot</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab, ylab</code></td>
<td>
<p> x- and y-axis labels for the plot. As usual, either can be expressions (see <code>plotmath</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>square</code></td>
<td>
<p> Logical: If <code>square=TRUE</code>, the aspect ratio is set (via <code>asp</code>) to make the individual 
blocks appear square when rendered. Note that this generally overrides <code>ylim</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add</code></td>
<td>
<p> Logical: If <code>TRUE</code>, the plot will be added to an existing plot.  
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>Numeric scalar value. Vertical offset for the plot, in units of block height.  
<code>offset</code> is added to the vertical position of the boxplot and any subplots. <code>offset</code> can be 
considered as a number of vertical block heights to raise (or lower, if negative) the plot. 
This, with <code>add</code>, is useful for adding further groups manually to an existing plot. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grp.spacing</code></td>
<td>
<p>Numeric scalar, giving the minimum vertical spacing (in units of block height) between subplots when 
there is more than one group.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grp.at</code></td>
<td>
<p>Optional vector specifying explicit vertical locations for subplot 
baselines (including the first group). The default (<code>grp.at=NA</code>) is 
to use <code>grp.spacing</code>. If specified, <code>grp.at</code> overrides <code>grp.spacing</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fill</code></td>
<td>
<p>Fill colour for the rectangles (“blocks”) making up the plot. 
Recycled to length <code>length(x)</code>. Passed to <code>rect</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>border</code></td>
<td>
<p>Border colour for the rectangles (“blocks”) making up the plot. 
Recycled to length <code>length(x)</code>. Passed to <code>rect</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>density</code></td>
<td>
<p>Shading line density for (“blocks”) making up the plot. Recycled 
to length <code>length(x)</code>. Passed to <code>rect</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>angle</code></td>
<td>
<p>Shading line angle for (“blocks”) making up the plot. Recycled 
to length <code>length(x)</code>. Passed to <code>rect</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lty</code></td>
<td>
<p>Border line type for (“blocks”) making up the plot. Recycled 
to length <code>length(x)</code>. Passed to <code>rect</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwd</code></td>
<td>
<p>Border line width for (“blocks”) making up the plot. Recycled 
to length <code>length(x)</code>. Passed to <code>rect</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label.col</code></td>
<td>
<p>Colour used for text labels in each (“block”) making up the plot. 
Recycled to length <code>length(x)</code>. Passed to <code>text</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex</code></td>
<td>
<p>Size of text labels in each (“block”) making up the plot. 
Recycled to length <code>length(x)</code> and passed to <code>text</code>. The 
default is to fit text inside each block automatically.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adj</code></td>
<td>
<p>Vector of two values giving text location adjustment for all block labels.
Passed to <code>text</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uline</code></td>
<td>
<p>Specification for the distance by which the baseline for each subplot 
extends beyond the data range for the group. See ‘Graphical elements’ 
for details. The default is two units either side. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uline.lwd</code></td>
<td>
<p>Scalar: Line width for the subplot baseline(s). 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uline.lty</code></td>
<td>
<p>Scalar: Line type for the subplot baseline(s). 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uline.col</code></td>
<td>
<p>Scalar: Line colour for the subplot baseline(s). 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grp.labs</code></td>
<td>
<p> Logical, determining whether group labels are plotted, or 
a vector of labels. See ‘Details’.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grp.pos</code></td>
<td>
<p>Specification for the position of group labels. Follows <code>pos</code> in 
<code>text</code>. See ‘Details’.  
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>glab.control</code></td>
<td>
<p>List of arguments to be passed to <code>text</code> 
when drawing group labels.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>axes</code></td>
<td>
<p>Logical, indicating whether axes are drawn. Can be a vector 
of two logicals, specifying horizontal and vertical axes 
respectively. See ‘Graphical elements’ for details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>asp</code></td>
<td>
<p>Aspect ratio, passed to <code>plot</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>frame.plot</code></td>
<td>
<p>Logical, controlling whether a frame (box) is drawn round the plot.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drop.unused</code></td>
<td>
<p>Logical specification for the treatment of empty groups. If <code>TRUE</code>,
groups (identified by levels in <code>x$groups</code>) that contain no non-missing
values will be omitted from the plot. If <code>FALSE</code>, a space is created
for the missing subplot but no subplot is generated. If <code>grp.labels</code>
requires group labelling, the group label is drawn in the space with 
<code>unused.label</code> appended.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unused.label</code></td>
<td>
<p>Character string appended to missing group labels.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further parameters passed to <code>plot</code>
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>bkp</code> provides considerable control of graphical elements. The main 
elements, and the arguments controlling their location and appearance, are:
</p>

<dl>
<dt>General appearance</dt>
<dd>
<p>A block plot of a single group of data has the general 
appearance of a histogram. However, instead of vertical bars (of possibly 
variable width) indicating the number of data points within the bin interval,
each bin is a stack of rectangles, each corresponding to a single data point
and with an optional label identifying the datum.
</p>
<p>Block plots of this kind are useful for data sets of modest size; typically 10-100
per group, as individual labels quickly become hard to identify in larger data sets.
</p>
<p>By default, <code>blockplot</code> produces one such plot for a set of data. If 
a series of such plots is needed, this can be accommodated either by using
<code>blockplot</code> with <code>add=TRUE</code> to build up a plot manually, setting
<code>xlim</code>, <code>ylim</code> and <code>breaks</code> to accommodate all the required 
groups. Alternatively, a grouping factor can be provided (via argument 
<code>groups</code>) which will produce a series of subplots, laid out automatically.
The use of <code>groups</code> and the corresponding layout options are detailed below
(see “Groups”).
</p>
<p>The vertical position of a single block plot within the figure 
can be set using <code>offset</code>, which sets the baseline height, 
in units of block height, from the figure origin. This is useful for 
separating several groups that are added manually; just set <code>offset</code>
appropriately for each separate plot. Note that setting <code>offset</code>
has no effect on the automatic <code>ylim</code> setting, which means that 
<code>ylim</code> must be set manually to accommodate the vertical offset.
</p>
</dd>
<dt>Blocks</dt>
<dd>
<p>Each individual rectangle (“block” in the plot corresponds to
a single data point. In this implementation, blocks appear in rank order
from left to right <em>and</em> from bottom to top; that is, data are placed in 
vertical bins as in a normal histogram but, in addition, the vertical ordering of 
blocks corresponds to the data order within each bin, with blocks at the 
bottom corresponding to lower values.  
</p>
<p>Blocks are always 1 unit high, so the total vertical height of each bin corresponds
directly to frequency (not density) in a histogram. The block width is the interval 
between <code>breaks</code>, which must be equispaced.
</p>
<p>By default, the apparent aspect ratio for blocks depends primarily on 
<code>xlim</code> and <code>ylim</code> and the height and width of the plotting device. 
However, setting <code>square=TRUE</code> will cause the plot aspect ration (<code>asp</code>)
to be set such that the bocks appear square in the current plot window.
</p>
<p>Fill colour, border colour and style, fill effects and text colour of individual 
blocks can all be controlled using <code>fill</code>, <code>border</code>, 
<code>density</code>, <code>angle</code>, <code>lty</code>, <code>lwd</code> and <code>label.col</code>, 
as the relevant arguments can be vectors of length <code>length(x)</code>. This 
allows conditional formatting, for example to identify
a particular data point or some secondary grouping variable.
</p>
</dd>
<dt>Subplot baseline</dt>
<dd>
<p>The baseline for each subplot is controlled by <code>uline</code>,
as follows:
</p>

<dl>
<dt>
<code>TRUE</code>:</dt>
<dd>
<p> The line extends the full width of the plot;</p>
</dd>
<dt>
<code>FALSE</code>:</dt>
<dd>
<p> No baseline is drawn;</p>
</dd>
<dt>numeric:</dt>
<dd>
<p> If numeric (as for the default), <code>uline</code> specifies 
the distance that the baseline extends beyond each end of the data, 
in units of block width. <code>uline</code> can be length 2 numeric vector,
which specifies the baseline extension on the left and right sides 
respectively.</p>
</dd>
</dl>
<p>Colour, line type, and line width for the subplot baseline(s) can be controlled
with <code>uline.col</code>, <code>uline.lty</code>, and <code>uline.lwd</code> respectively. 
</p>
</dd>
<dt>Axes</dt>
<dd>
<p> Axes can be controlled with the <code>axes</code> argument, which 
controls whether or not axes are drawn. If a vector of two logical 
values (as for the default), <code>axes</code> specifies drawing for horizontal 
and vertical axes respectively.
</p>
<p>The horizontal axis is normally continuous for the plot. If a 
vertical (frequency) axis is requested (either by <code>axes=TRUE</code> or,
for example, by <code>axes=c(TRUE, TRUE)</code>, a vertical axis is drawn
for each subplot, starting at zero at the baseline and terminating 
at the highest vertical value in the subplot. Vertical axes, 
restarting at 0 at the next subplot baseline, are drawn if 
there is more than one group.
</p>
</dd>
<dt>Groups</dt>
<dd>
<p><code>blockplot</code> provides a simple grouping mechanism to display
separate subplots for different groups of data on the same figure. The 
default method provides for a grouping variable specified via <code>groups</code>.
The formula method provides a somewhat more flexible interface, allowing 
specification of more than one grouping variable. Like <code>boxplot</code>,
if there is more than one goruping variable in the formula, subplots are drawn 
for each (non-empty) level of the interaction term. 
</p>
<p>Subplots for different groups are arranged vertically. Vertical position can be
specified explicitly via <code>grp.at</code> or, more simply, by setting 
<code>grp.spacing</code>. The latter sets <code>grp.at</code> to equal vertical
spacing such that the smallest vertical gap is <code>grp.spacing</code>.
Both <code>grp.at</code> and <code>grp.spacing</code> are in units of block height;
that is, <code>grpspacing=2</code> (the default) means that the smallest vertical 
gap is equivalent to two blocks. 
</p>
</dd>
<dt>Group labels</dt>
<dd>
<p>Labels can be added to each subplot. These are controlled by <code>grp.labs</code> ..
<code>grp.labs</code> provides the specification for group labels, and can be a single logical or 
a vector of labels. Effects of <code>grp.labs</code> are as follows:
</p>

<ul>
<li>
<p><code>FALSE</code> (The default): No group labels are drawn. 
</p>
</li>
<li>
<p><code>TRUE</code> Labels are taken as <code>levels(groups)</code>, 
and set to <code>"1"</code> if there is only one group.
</p>
</li>
<li>
<p>Vector If a character vector (or expression) is provided, 
these are used as labels for the groups plotted. 
</p>
<p>WARNING: If missing values in <code>x</code> cause group levels to be 
dropped, those groups will not be plotted. <code>grp.labs</code> must
have the same length as the number of groups plotted. An error
is generated if the length of <code>labels</code> differs from the number
of groups actually plotted.
</p>
</li>
</ul>
<p><code>grp.pos</code> specifies the general positioning of group labels 
relative to each subplot. <code>grp.pos</code> follows <code>pos</code> in <code>text</code>:
Values of <code>1</code>, <code>2</code>, <code>3</code> and <code>4</code>, respectively 
indicate positions below, to the left of, above and to the right of the plot.
</p>
<p>The detailed positioning of group labels is automatic; the four positions 
specified by <code>grp.pos</code> correspond approximately to the midpoints of the 
corresponding edge of each plot, where the ‘edges’ are the baseline, 
leftmost block, topmost block and rightmost block. Labels are placed a short 
distance outward from these edges. Labels are justified according to position;
<code>grp.pos</code> is re-used as the default <code>pos</code> argument to <code>text</code>.
</p>
<p>Further control of group label position is available via <code>grp.control</code>, 
which is a list (empty by default) of arguments passed to <code>text</code>.
Ths can include arguments such as <code>pos</code> and <code>adj</code>, as well as 
appearance elements such as <code>col</code>, <code>cex</code> etc.
</p>
</dd>
</dl>
<h3>Value</h3>

<p><code>bxp</code> returns the original object <code>x</code> with additional elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>grp.at</code></td>
<td>
<p>The vertical coordinated for the subplot baselines.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blockwidth</code></td>
<td>
<p>The width of the blocks in the plot.
</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Stephen L R Ellison <a href="mailto:s.ellison@lgcgroup.com">s.ellison@lgcgroup.com</a>.
</p>


<h3>References</h3>

<p>ISO 5725-2:1994 <em>Accuracy (trueness and precision) of measurement methods 
and results – Part 2: Basic method for the determination of repeatability 
and reproducibility of a standard measurement method.</em> ISO, Geneva, 1994.
</p>


<h3>See Also</h3>

<p>For constructing breaks and grouping:
<code>blockplot</code> 
</p>
<p>For graphical elements:
<code>text</code>, <code>rect</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
#A simple blockplot
set.seed(55)
x&lt;-rnorm(48, 15)
b &lt;- blockplot(x)

#Aspect ratio control for square blocks
bkp(b, square=TRUE)

# Specifying groups 
grp &lt;- gl(3, 16)
bg &lt;- blockplot(x~grp)

# Add vertical axes ( axes=TRUE asks for horizontal and vertical axes)
bkp(bg, axes=TRUE ) 

#Axes both left and right
par(mar=c(5,4,4,4)+0.1)
bkp(bg, axes=c(TRUE, TRUE, FALSE, TRUE) ) 
		#Note that axes[3] is FALSE to suppress top axis
		
# Vectorised colour specification
bkp(bg, square=TRUE, fill=ifelse(1:48 %in% c(15, 23, 24), "gold", "white") )

# Group labelling
bkp(bg, square=TRUE, grp.labs=paste("Level", 1:3), grp.pos=2)

</code></pre>


</div>