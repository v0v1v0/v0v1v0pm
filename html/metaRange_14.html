<div class="container">

<table style="width: 100%;"><tr>
<td>metaRangeSimulation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>metaRangeSimulation object</h2>

<h3>Description</h3>

<p>Creates an simulation object in form of an
R6 class that stores and handles all the individual parts
that are necessary to run a simulation.
</p>


<h3>Value</h3>

<p>A <code style="white-space: pre;">⁠&lt;metaRangeSimulation&gt;⁠</code> object
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>ID</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;string&gt;⁠</code> simulation identification.</p>
</dd>
<dt><code>globals</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;environment&gt;⁠</code> a place to store global variables.</p>
</dd>
<dt><code>environment</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;metaRangeEnvironment&gt;⁠</code> A metaRangeEnvironment
that holds all the environmental values influencing the simulation.</p>
</dd>
<dt><code>number_time_steps</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;integer&gt;⁠</code> number of time steps in the simulation.</p>
</dd>
<dt><code>time_step_layer</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;integer&gt;⁠</code> vector of layer IDs
that describe which environmental layer to use at each time step.</p>
</dd>
<dt><code>current_time_step</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;integer&gt;⁠</code> current time step.</p>
</dd>
<dt><code>queue</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;metaRangePriorityQueue&gt;⁠</code> manages the order in which the processes should be executed.</p>
</dd>
<dt><code>processes</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;list&gt;⁠</code> of global (simulation level) <code style="white-space: pre;">⁠&lt;metaRangeProcess&gt;⁠</code> (es).</p>
</dd>
<dt><code>seed</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;integer&gt;⁠</code> seed for the random number generator.</p>
</dd>
</dl>
</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-metaRangeSimulation-new"><code>metaRangeSimulation$new()</code></a>
</p>
</li>
<li> <p><a href="#method-metaRangeSimulation-add_globals"><code>metaRangeSimulation$add_globals()</code></a>
</p>
</li>
<li> <p><a href="#method-metaRangeSimulation-set_time_layer_mapping"><code>metaRangeSimulation$set_time_layer_mapping()</code></a>
</p>
</li>
<li> <p><a href="#method-metaRangeSimulation-get_current_time_step"><code>metaRangeSimulation$get_current_time_step()</code></a>
</p>
</li>
<li> <p><a href="#method-metaRangeSimulation-add_species"><code>metaRangeSimulation$add_species()</code></a>
</p>
</li>
<li> <p><a href="#method-metaRangeSimulation-species_names"><code>metaRangeSimulation$species_names()</code></a>
</p>
</li>
<li> <p><a href="#method-metaRangeSimulation-add_process"><code>metaRangeSimulation$add_process()</code></a>
</p>
</li>
<li> <p><a href="#method-metaRangeSimulation-add_traits"><code>metaRangeSimulation$add_traits()</code></a>
</p>
</li>
<li> <p><a href="#method-metaRangeSimulation-exit"><code>metaRangeSimulation$exit()</code></a>
</p>
</li>
<li> <p><a href="#method-metaRangeSimulation-begin"><code>metaRangeSimulation$begin()</code></a>
</p>
</li>
<li> <p><a href="#method-metaRangeSimulation-print"><code>metaRangeSimulation$print()</code></a>
</p>
</li>
<li> <p><a href="#method-metaRangeSimulation-summary"><code>metaRangeSimulation$summary()</code></a>
</p>
</li>
</ul>
<hr>
<a id="method-metaRangeSimulation-new"></a>



<h4>Method <code>new()</code>
</h4>

<p>Creates a new metaRangeSimulation object.
</p>


<h5>Usage</h5>

<div class="r"><pre>metaRangeSimulation$new(source_environment, ID = NULL, seed = NULL)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>source_environment</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;SpatRasterDataset&gt;⁠</code> created by <code>terra::sds()</code> that represents the environment.
The individual data sets represent different environmental variables
(e.g. temperature or habitat availability) and the different layer of the data sets
represent the different timesteps of the simulation.
The function metaRangeSimulation<code style="white-space: pre;">⁠$set_time_layer_mapping()⁠</code> can be used
to extend/ shorten the simulation timesteps and set the mapping between each time step and a corresponding
environmental layer. This can be used e.g. to repeat the first (few) layer as a burn-in period.
The number of layers must be the same for all data sets.</p>
</dd>
<dt><code>ID</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;string&gt;⁠</code> optional simulation identification string.
Will be set automatically if none is specified.</p>
</dd>
<dt><code>seed</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;integer&gt;⁠</code> optional seed for the random number generator.
Will be set automatically if none is specified.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>A <code style="white-space: pre;">⁠&lt;metaRangeSimulation&gt;⁠</code> object.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim
</pre>
</div>


<hr>
<a id="method-metaRangeSimulation-add_globals"></a>



<h4>Method <code>add_globals()</code>
</h4>

<p>Add global variables to the simulation
</p>


<h5>Usage</h5>

<div class="r"><pre>metaRangeSimulation$add_globals(...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>...</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;any&gt;⁠</code> the variables to add.
Variables to add to the simulation. They will be saved and accessible
through the 'globals' field.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p><code style="white-space: pre;">⁠&lt;invisible self&gt;⁠</code>
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_globals(a = 1, b = 2)
sim$globals$a
#&gt; [1] 1
</pre>
</div>


<hr>
<a id="method-metaRangeSimulation-set_time_layer_mapping"></a>



<h4>Method <code>set_time_layer_mapping()</code>
</h4>

<p>Set the time layer of the simulation.
</p>


<h5>Usage</h5>

<div class="r"><pre>metaRangeSimulation$set_time_layer_mapping(x)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>x</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;integer&gt;⁠</code> vector of layer indices
that describe which environmental layer to use at each time step.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p><code style="white-space: pre;">⁠&lt;invisible self&gt;⁠</code>
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2, nlyr = 4))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$set_time_layer_mapping(1:2)
stopifnot(identical(sim$time_step_layer, 1:2))
</pre>
</div>


<hr>
<a id="method-metaRangeSimulation-get_current_time_step"></a>



<h4>Method <code>get_current_time_step()</code>
</h4>

<p>Get current time step
</p>


<h5>Usage</h5>

<div class="r"><pre>metaRangeSimulation$get_current_time_step()</pre></div>



<h5>Returns</h5>

<p><code style="white-space: pre;">⁠&lt;integer&gt;⁠</code> the current time step
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$get_current_time_step()
#&gt; [1] 1
</pre>
</div>


<hr>
<a id="method-metaRangeSimulation-add_species"></a>



<h4>Method <code>add_species()</code>
</h4>

<p>Adds new species to the simulation
</p>


<h5>Usage</h5>

<div class="r"><pre>metaRangeSimulation$add_species(names)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>names</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;character&gt;⁠</code> names of the species to add.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p><code style="white-space: pre;">⁠&lt;invisible boolean&gt;⁠</code> <code>TRUE</code> on success <code>FALSE</code> on failure.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_species(c("species_1", "species_2"))
sim$species_1
</pre>
</div>


<hr>
<a id="method-metaRangeSimulation-species_names"></a>



<h4>Method <code>species_names()</code>
</h4>

<p>Returns the names of all species in the simulation.
</p>


<h5>Usage</h5>

<div class="r"><pre>metaRangeSimulation$species_names()</pre></div>



<h5>Returns</h5>

<p><code style="white-space: pre;">⁠&lt;character&gt;⁠</code> vector of species names
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_species("species_1")
sim$add_species("species_2")
sim$species_names()
#&gt; [1] "species_1" "species_2"
</pre>
</div>


<hr>
<a id="method-metaRangeSimulation-add_process"></a>



<h4>Method <code>add_process()</code>
</h4>

<p>Adds a process to the simulation.
</p>


<h5>Usage</h5>

<div class="r"><pre>metaRangeSimulation$add_process(
  species = NULL,
  process_name,
  process_fun,
  execution_priority,
  queue = TRUE
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>species</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;character&gt;⁠</code> Names of the species that the process should be added to.
If <code>NULL</code> the process will be added to the simulation object itself.</p>
</dd>
<dt><code>process_name</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;string&gt;⁠</code> Name of the process to add.</p>
</dd>
<dt><code>process_fun</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;named function&gt;⁠</code> The function to call when the process gets executed.</p>
</dd>
<dt><code>execution_priority</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;positive integer&gt;⁠</code> When this process should run within each time step.
1 == highest priority i.e. this function will be the executed first.</p>
</dd>
<dt><code>queue</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;boolean&gt;⁠</code> If <code>TRUE</code> the process will be added to the process execution queue directly.
If <code>FALSE</code> the process will be added to the simulation but not to the queue,
which means that in order to execute the process, it has to be added manually
via the metaRangePriorityQueue<code style="white-space: pre;">⁠$enqueue()⁠</code> method.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p><code style="white-space: pre;">⁠&lt;invisible self&gt;⁠</code>.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_species("species_1")
sim$add_process("species_1", "species_process_1", function() {message("process_1")}, 1)
sim$species_1$processes$species_process_1
sim$add_process(species = NULL, "global_process_2", function() {message("process_2")}, 2)
sim$processes$global_process_2
</pre>
</div>


<hr>
<a id="method-metaRangeSimulation-add_traits"></a>



<h4>Method <code>add_traits()</code>
</h4>

<p>Adds traits to a species.
</p>


<h5>Usage</h5>

<div class="r"><pre>metaRangeSimulation$add_traits(species, population_level = TRUE, ...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>species</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;character&gt;⁠</code> Names of the species that the traits should be added to.</p>
</dd>
<dt><code>population_level</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;boolean&gt;⁠</code> If <code>TRUE</code> the traits will be added at the population level
(i.e. as a matrix with same dimensions (nrow/ncol) as the environment with one value for each population).
This means that the traits either need to be single values that will be extended
to such a matrix via <code>base::matrix()</code> or they already need to be a matrix with these dimension.
If <code>FALSE</code> the traits will be added without any conversion and may have any type and dimension.</p>
</dd>
<dt><code>...</code></dt>
<dd>
<p><code style="white-space: pre;">⁠&lt;atomic&gt;⁠</code> (see <code>base::is.atomic()</code>) The named traits to be added.
Named means: <code>Name = value</code> e.g. <code>a = 1</code>.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p><code style="white-space: pre;">⁠&lt;invisible self&gt;⁠</code>.
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_species("species_1")
sim$add_traits("species_1", population_level = TRUE, a = 1)
sim$add_traits("species_1", population_level = FALSE, b = 2, c = "c")
sim$species_1$traits$a
#&gt;      [,1] [,2]
#&gt; [1,]    1    1
#&gt; [2,]    1    1
sim$species_1$traits$b
#&gt; [1] 2
sim$species_1$traits$c
#&gt; [1] "c"
</pre>
</div>


<hr>
<a id="method-metaRangeSimulation-exit"></a>



<h4>Method <code>exit()</code>
</h4>

<p>When called, will end the simulation (prematurely) once the current process is finished.
Useful to e.g. end the simulation safely (i.e. without an error) when no species is alive anymore
and there would be no benefit to continue the execution until the last time step.
</p>


<h5>Usage</h5>

<div class="r"><pre>metaRangeSimulation$exit()</pre></div>



<h5>Returns</h5>

<p><code style="white-space: pre;">⁠invisible NULL⁠</code>
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2, nlyr = 4))
names(sim_env) &lt;- "env_var_name"
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_species("species_1")
sim$add_process("species_1", "species_process_1", function() {self$sim$exit()}, 1)
sim$begin()
</pre>
</div>


<hr>
<a id="method-metaRangeSimulation-begin"></a>



<h4>Method <code>begin()</code>
</h4>

<p>Begins the simulation
</p>


<h5>Usage</h5>

<div class="r"><pre>metaRangeSimulation$begin()</pre></div>



<h5>Returns</h5>

<p><code style="white-space: pre;">⁠&lt;invisible self&gt;⁠</code> The finished simulation
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2, nlyr = 4))
names(sim_env) &lt;- "env_var_name"
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_process(
     species = NULL,
     "timestep_counter",
     function() {
         message("timestep: ", self$get_current_time_step())
     },
     1
)
sim$begin()
</pre>
</div>


<hr>
<a id="method-metaRangeSimulation-print"></a>



<h4>Method <code>print()</code>
</h4>

<p>Prints information about the simulation to the console
</p>


<h5>Usage</h5>

<div class="r"><pre>metaRangeSimulation$print()</pre></div>



<h5>Returns</h5>

<p><code style="white-space: pre;">⁠&lt;invisible self&gt;⁠</code>
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$print()
</pre>
</div>


<hr>
<a id="method-metaRangeSimulation-summary"></a>



<h4>Method <code>summary()</code>
</h4>

<p>Summarizes information about the simulation and outputs
it to the console
</p>


<h5>Usage</h5>

<div class="r"><pre>metaRangeSimulation$summary()</pre></div>



<h5>Returns</h5>

<p><code style="white-space: pre;">⁠&lt;invisible self&gt;⁠</code>
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre>sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$summary()
</pre>
</div>




<h3>Examples</h3>

<pre><code class="language-R">
## ------------------------------------------------
## Method `metaRangeSimulation$new`
## ------------------------------------------------

sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim

## ------------------------------------------------
## Method `metaRangeSimulation$add_globals`
## ------------------------------------------------

sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_globals(a = 1, b = 2)
sim$globals$a
#&gt; [1] 1

## ------------------------------------------------
## Method `metaRangeSimulation$set_time_layer_mapping`
## ------------------------------------------------

sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2, nlyr = 4))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$set_time_layer_mapping(1:2)
stopifnot(identical(sim$time_step_layer, 1:2))

## ------------------------------------------------
## Method `metaRangeSimulation$get_current_time_step`
## ------------------------------------------------

sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$get_current_time_step()
#&gt; [1] 1

## ------------------------------------------------
## Method `metaRangeSimulation$add_species`
## ------------------------------------------------

sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_species(c("species_1", "species_2"))
sim$species_1

## ------------------------------------------------
## Method `metaRangeSimulation$species_names`
## ------------------------------------------------

sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_species("species_1")
sim$add_species("species_2")
sim$species_names()
#&gt; [1] "species_1" "species_2"

## ------------------------------------------------
## Method `metaRangeSimulation$add_process`
## ------------------------------------------------

sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_species("species_1")
sim$add_process("species_1", "species_process_1", function() {message("process_1")}, 1)
sim$species_1$processes$species_process_1
sim$add_process(species = NULL, "global_process_2", function() {message("process_2")}, 2)
sim$processes$global_process_2

## ------------------------------------------------
## Method `metaRangeSimulation$add_traits`
## ------------------------------------------------

sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_species("species_1")
sim$add_traits("species_1", population_level = TRUE, a = 1)
sim$add_traits("species_1", population_level = FALSE, b = 2, c = "c")
sim$species_1$traits$a
#&gt;      [,1] [,2]
#&gt; [1,]    1    1
#&gt; [2,]    1    1
sim$species_1$traits$b
#&gt; [1] 2
sim$species_1$traits$c
#&gt; [1] "c"

## ------------------------------------------------
## Method `metaRangeSimulation$exit`
## ------------------------------------------------

sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2, nlyr = 4))
names(sim_env) &lt;- "env_var_name"
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_species("species_1")
sim$add_process("species_1", "species_process_1", function() {self$sim$exit()}, 1)
sim$begin()

## ------------------------------------------------
## Method `metaRangeSimulation$begin`
## ------------------------------------------------

sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2, nlyr = 4))
names(sim_env) &lt;- "env_var_name"
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$add_process(
     species = NULL,
     "timestep_counter",
     function() {
         message("timestep: ", self$get_current_time_step())
     },
     1
)
sim$begin()

## ------------------------------------------------
## Method `metaRangeSimulation$print`
## ------------------------------------------------

sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$print()

## ------------------------------------------------
## Method `metaRangeSimulation$summary`
## ------------------------------------------------

sim_env &lt;- terra::sds(terra::rast(vals = 1, nrow = 2, ncol = 2))
sim &lt;- metaRangeSimulation$new(source_environment = sim_env)
sim$summary()
</code></pre>


</div>