<div class="container">

<table style="width: 100%;"><tr>
<td>wls</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Conduct a Correlation/Covariance Structure Analysis with WLS
</h2>

<h3>Description</h3>

<p>It fits a correlation or covariance structure with
weighted least squares (WLS) estimation method where the inverse of the asymptotic covariance matrix is
used as the weight matrix. <code>tssem2</code> conducts the second stage
analysis of the two-stage structural equation modeling (TSSEM). <code>tssem2</code> is a wrapper of <code>wls</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">wls(Cov, aCov, n, RAM=NULL, Amatrix=NULL, Smatrix=NULL, Fmatrix=NULL,
    diag.constraints=FALSE, cor.analysis=TRUE, intervals.type=c("z","LB"),
    mx.algebras=NULL, mxModel.Args=NULL, subset.variables=NULL, model.name=NULL,
    suppressWarnings=TRUE, silent=TRUE, run=TRUE, ...)
tssem2(tssem1.obj, RAM=NULL, Amatrix=NULL, Smatrix=NULL, Fmatrix=NULL,
       diag.constraints=FALSE, intervals.type=c("z", "LB"), mx.algebras=NULL,
       mxModel.Args=NULL, subset.variables=NULL, model.name=NULL, suppressWarnings=TRUE,
       silent=TRUE, run=TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>tssem1.obj</code></td>
<td>
<p>An object of either class
<code>tssem1FEM</code>, class <code>tssem1FEM.cluster</code> or class
<code>tssem1REM</code> returned from <code>tssem1()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Cov</code></td>
<td>
<p>A <code class="reqn">p</code> x <code class="reqn">p</code> sample correlation/covariance matrix
where <code class="reqn">p</code> is the number of variables.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aCov</code></td>
<td>
<p>A <code class="reqn">p*</code> x <code class="reqn">p*</code> asymptotic sampling covariance
matrix of either <code>vechs</code> <code>(Cov)</code> or
<code>vech</code> <code>(Cov)</code> where <code class="reqn">p* = p(p-1)/2 </code> for correlation matrix and <code class="reqn">p* = p(p+1)/2 </code> for covariance matrix.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Sample size.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RAM</code></td>
<td>
<p>A RAM object including a list of matrices of the model
returned from <code>lavaan2RAM</code>.  
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Amatrix</code></td>
<td>
<p>If <code>RAM</code> is not specified, an <code>Amatrix</code> is
required. An asymmetric matrix in the RAM specification with
<code>MxMatrix-class</code>. If it is <code>NULL</code>, a matrix
of zero will be created. If it is a matrix, it will be converted into <code>MxMatrix-class</code> by the <code>as.mxMatrix</code> function.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Smatrix</code></td>
<td>
<p>If <code>RAM</code> is not specified, an <code>Smatrix</code> is
required. A symmetric matrix in the RAM specification with
<code>MxMatrix-class</code>. If it is a matrix, it will be converted into <code>MxMatrix-class</code> by the <code>as.mxMatrix</code> function.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Fmatrix</code></td>
<td>
<p>A filter matrix in the RAM specification with
<code>MxMatrix-class</code>. If it is <code>NULL</code> (the default), an
identity matrix with the same dimensions of <code>Cov</code> will be
created. If it is a matrix, it will be converted into <code>MxMatrix-class</code> by the <code>as.mxMatrix</code> function. It is not required when there is no latent variable.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>diag.constraints</code></td>
<td>
<p>Logical. This argument is ignored when
<code>cor.analysis=FALSE</code>. If
<code>diag.constraints=TRUE</code>, the diagonals of the model implied matrix would be constrained at 1 by nonlinear constraints. The drawback is that standard
error will not be generated. Parametric bootstrap is used to
estimate the standard error by drawing samples from <code class="reqn">\mathcal{N}(vech(Cov), asyCov)</code> for covariance analysis and <code class="reqn">\mathcal{N}(vechs(Cov), asyCov)</code> for
correlation analysis while asyCov is treated as fixed. This process
is computationally intensive. A better approach is to request likelihood-based
confidence intervals (CIs) by specifying <code>intervals.type="LB"</code>. 
If <code>diag.constraints=FALSE</code> and <code>cor.analysis=TRUE</code>, the diagonals are automatically constrained as ones by
treating the error variances as computed values rather than as
parameters. Since the error variances are not parameters, they are not reported. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cor.analysis</code></td>
<td>
<p>Logical. Analysis of correlation or covariance structure. If <code>cor.analysis=TRUE</code>, <code>vechs</code> is used to vectorize <code>S</code>; otherwise, <code>vech</code> is used to vectorize <code>S</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intervals.type</code></td>
<td>
<p>Either <code>z</code> (default if missing) or
<code>LB</code>. If it is <code>z</code>, it calculates the 95% Wald CIs based on the z statistic. If it is <code>LB</code>, it
calculates the 95% likelihood-based CIs on the
parameter estimates. Please note that the z values and their
associated p values are based on the z statistic. They are not
related to the likelihood-based CIs.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mx.algebras</code></td>
<td>
<p>A list of <code>mxMatrix</code> or  <code>mxAlgebra</code> objects on the <code>Amatrix</code>,
<code>Smatrix</code>, and <code>Fmatrx</code>. It can be used to define new functions
of parameters and their LBCIs. For example, if the regression
coefficients to calculate an indirect effect are stored in A[1,2] and
A[1,3], we may define
<code>list(ind=mxAlgebra(Amatrix[1,2]*Amatrix[1,3], name="ind"))</code>
See the examples in <code>Becker92</code> and
<code>Hunter83</code>. It should be noted that Fmatrix,
Amatrix, Smatrix, Iden (a <code class="reqn">p</code> x <code class="reqn">p</code> identity matrix), sampleS (sample correlation
or covariance matrix), impliedS1, impliedS (model implied
correlation or covariance matrix), vecS, invAcov, obj, One, select
and constraint and Ematrix (computed error variances when
<code>diag.constraints=FALSE</code>) have been defined internally. You
should not create new matrices using these names.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mxModel.Args</code></td>
<td>
<p>A list of arguments passed to
<code>mxModel</code>. These include, for example, additional
<code>mxMatrix</code> and <code>mxConstraint</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model.name</code></td>
<td>
<p>A string for the model name in
<code>mxModel</code>. If it is missing, the default is
"TSSEM2 (or WLS) Analysis of Correlation Structure" for <code>cor.analysis=TRUE</code> and
"TSSEM2 (or WLS) Analysis of Covariance Structure" for <code>cor.analysis=FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset.variables</code></td>
<td>
<p>An optional character vector of variable names to select variables in the analysis. For example, there are 10
variables in <code>Cov</code>, say, x1 to x10. We may use
<code>c("x1", "x2", "x3")</code> to select three variables in the analysis. Please note that this argument does not reorder the
data. That is, <code>c("x3", "x2", "x1")</code> is the same as
<code>c("x1", "x2", "x3")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>suppressWarnings</code></td>
<td>
<p>Logical. If <code>TRUE</code>, warnings are
suppressed. The argument to be passed to <code>mxRun</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silent</code></td>
<td>
<p>Logical. An argument to be passed to <code>mxRun</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run</code></td>
<td>
<p>Logical. If <code>FALSE</code>, only return the mx model without
running the analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments to be passed to <code>mxRun</code>.
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>wls</code> with a list of
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>The matched call</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Cov</code></td>
<td>
<p>Input data of either a covariance or correlation matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>asyCov</code></td>
<td>
<p>The asymptotic covariance matrix of the input data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>noObservedStat</code></td>
<td>
<p>Number of observed statistics</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Sample size</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cor.analysis</code></td>
<td>
<p>logical</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>noConstraints</code></td>
<td>
<p>Number of constraints imposed on S</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>indepModelChisq</code></td>
<td>
<p>Chi-square statistic of the independent model
returned by <code>.indepwlsChisq</code> </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>indepModelDf</code></td>
<td>
<p>Degrees of freedom of the independent model returned
by <code>.indepwlsChisq</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mx.fit</code></td>
<td>
<p>A fitted object returned from
<code>mxRun</code></p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>If the input is a list of <code>tssem1.obj</code>, it returns a list of
results for each cluster.
</p>


<h3>Author(s)</h3>

<p>Mike W.-L. Cheung &lt;mikewlcheung@nus.edu.sg&gt;
</p>


<h3>References</h3>

<p>Bentler, P.M., &amp; Savalei, V. (2010). Analysis of correlation structures: current status and open problems. In Kolenikov, S., Thombs, L., &amp; Steinley, D. (Eds.). <em>Recent Methodological Developments in Social Science Statistics</em> (pp. 1-36). Hoboken, NJ: Wiley. 
</p>
<p>Cheung, M. W.-L. (2010). Fixed-effects meta-analyses as multiple-group structural equation models. <em>Structural Equation Modeling</em>, <b>17</b>, 481-509.
</p>
<p>Cheung, M. W.-L. (2014). Fixed- and random-effects meta-analytic structural equation modeling: Examples and analyses in R. <em>Behavior Research Methods</em>, <b>46</b>, 29-40.
</p>
<p>Cheung, M. W.-L., &amp; Chan, W. (2005). Meta-analytic structural equation modeling: A two-stage approach. <em>Psychological Methods</em>, <b>10</b>, 40-64.
</p>
<p>Cheung, M. W.-L., &amp; Chan, W. (2009). A two-stage approach to synthesizing covariance matrices in meta-analytic structural equation modeling. <em>Structural Equation Modeling</em>, <b>16</b>, 28-53.
</p>
<p>Joreskog, K. G., Sorbom, D., Du Toit, S., &amp; Du Toit,
M. (1999). <em>LISREL 8: New Statistical Features.</em> Chicago: Scientific Software International.
</p>
<p>McArdle, J. J., &amp; MacDonald, R. P. (1984). Some algebraic properties of the Reticular Action Model for moment structures. <em>British Journal of Mathematical and Statistical Psychology</em>, <b>37</b>, 234-251. 
</p>


<h3>See Also</h3>

 <p><code>tssem1</code>,
<code>Becker92</code>, <code>Digman97</code>,
<code>Hunter83</code>, <code>issp89</code>, <code>issp05</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
#### Analysis of correlation structure
R1.labels &lt;- c("a1", "a2", "a3", "a4")

R1 &lt;- matrix(c(1.00, 0.22, 0.24, 0.18,
               0.22, 1.00, 0.30, 0.22,
               0.24, 0.30, 1.00, 0.24,
               0.18, 0.22, 0.24, 1.00), ncol=4, nrow=4,
               dimnames=list(R1.labels, R1.labels))
n &lt;- 1000
acovR1 &lt;- asyCov(R1, n)

#### One-factor CFA model using lavaan specification
model1 &lt;- "f =~ a1 + a2 + a3 + a4"

RAM1 &lt;- lavaan2RAM(model1, obs.variables=R1.labels)

wls.fit1a &lt;- wls(Cov=R1, aCov=acovR1, n=n, RAM=RAM1,
                 cor.analysis=TRUE, intervals="LB")
summary(wls.fit1a)

## One-factor CFA model using RAM specification
(A1 &lt;- cbind(matrix(0, nrow=5, ncol=4),
             matrix(c("0.2*a1","0.2*a2","0.2*a3","0.2*a4",0),
             ncol=1)))

(S1 &lt;- Diag(c("0.2*e1","0.2*e2","0.2*e3","0.2*e4",1)))

## The first 4 variables are observed while the last one is latent.
(F1 &lt;- create.Fmatrix(c(1,1,1,1,0), name="F1"))

wls.fit1b &lt;- wls(Cov=R1, aCov=acovR1, n=n, Fmatrix=F1, Smatrix=S1, Amatrix=A1,
                 cor.analysis=TRUE, intervals="LB")
summary(wls.fit1b)

## Select 3 variables to analyze
model2 &lt;- "f =~ a1 + a2 + a3"

RAM2 &lt;- lavaan2RAM(model2, obs.variables=R1.labels[-4])

wls.fit1c &lt;- wls(Cov=R1, aCov=acovR1, n=n, RAM=RAM2,
                 cor.analysis=TRUE, subset.variables=c("a1", "a2", "a3"))
summary(wls.fit1c)

#### Multiple regression analysis using lavaan specification
R2.labels &lt;- c("y", "x1", "x2")

R2 &lt;- matrix(c(1.00, 0.22, 0.24, 
               0.22, 1.00, 0.30, 
               0.24, 0.30, 1.00), ncol=3, nrow=3,
               dimnames=list(R2.labels, R2.labels))
acovR2 &lt;- asyCov(R2, n)

model3 &lt;- "y ~ x1 + x2
           ## Variances of x1 and x2 are 1
           x1 ~~ 1*x1
           x2 ~~ 1*x2
           ## x1 and x2 are correlated
           x1 ~~ x2"

RAM3 &lt;- lavaan2RAM(model3, obs.variables=R2.labels)

wls.fit2a &lt;- wls(Cov=R2, aCov=acovR2, n=n, RAM=RAM3,
                 cor.analysis=TRUE, intervals="z")
summary(wls.fit2a)


#### Multiple regression analysis using RAM specification

## A2: Regression coefficents
#    y x1 x2
# y  F T  T 
# x1 F F  F 
# x2 F F  F 
(A2 &lt;- mxMatrix("Full", ncol=3, nrow=3, byrow=TRUE,
               free=c(FALSE, rep(TRUE, 2), rep(FALSE, 6)), name="A2"))

## S2: Covariance matrix of free parameters
#    y x1 x2
# y  T F  F 
# x1 F F  F 
# x2 F T  F
(S2 &lt;- mxMatrix("Symm", ncol=3, nrow=3, values=c(0.2,0,0,1,0.2,1),
                labels=c("Var_y", NA, NA, NA, "Cov_x1_x2", NA),
                free=c(TRUE,FALSE,FALSE,FALSE,TRUE,FALSE), name="S2"))

## F may be ignored as there is no latent variable.
wls.fit2b &lt;- wls(Cov=R2, aCov=acovR2, n=n, Amatrix=A2, Smatrix=S2,
                 cor.analysis=TRUE, intervals="LB")
summary(wls.fit2b)


#### Analysis of covariance structure using lavaan specification
R3.labels=c("a1", "a2", "a3", "a4")

R3 &lt;- matrix(c(1.50, 0.22, 0.24, 0.18,
               0.22, 1.60, 0.30, 0.22,
               0.24, 0.30, 1.80, 0.24,
               0.18, 0.22, 0.24, 1.30), ncol=4, nrow=4,
               dimnames=list(R3.labels, R3.labels))
n &lt;- 1000
acovS3 &lt;- asyCov(R3, n, cor.analysis=FALSE)

model3 &lt;- "f =~ a1 + a2 + a3 + a4"

RAM3 &lt;- lavaan2RAM(model3, obs.variables=R3.labels)

wls.fit3a &lt;- wls(Cov=R3, aCov=acovS3, n=n, RAM=RAM3,
                 cor.analysis=FALSE)
summary(wls.fit3a)

#### Analysis of covariance structure using RAM specification
(A3 &lt;- cbind(matrix(0, nrow=5, ncol=4),
             matrix(c("0.2*a1","0.2*a2","0.2*a3","0.2*a4",0),ncol=1)))

(S3 &lt;- Diag(c("0.2*e1","0.2*e2","0.2*e3","0.2*e4",1)))

F3 &lt;- c(TRUE,TRUE,TRUE,TRUE,FALSE)
(F3 &lt;- create.Fmatrix(F3, name="F3", as.mxMatrix=FALSE))

wls.fit3b &lt;- wls(Cov=R3, aCov=acovS3, n=n, Amatrix=A3, Smatrix=S3,
                Fmatrix=F3, cor.analysis=FALSE)
summary(wls.fit3b)

</code></pre>


</div>