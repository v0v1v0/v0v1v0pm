<div class="container">

<table style="width: 100%;"><tr>
<td>anova.rma</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Likelihood Ratio and Wald-Type Tests for 'rma' Objects</h2>

<h3>Description</h3>

<p>For two (nested) models of class <code>"rma.uni"</code> or <code>"rma.mv"</code>, the function provides a full versus reduced model comparison in terms of model fit statistics and a likelihood ratio test. When a single model is specified, a Wald-type test of one or more model coefficients or linear combinations thereof is carried out. <script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script></p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'rma'
anova(object, object2, btt, X, att, Z, rhs, digits, refit=FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>an object of class <code>"rma.uni"</code> or <code>"rma.mv"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object2</code></td>
<td>
<p>an (optional) object of class <code>"rma.uni"</code> or <code>"rma.mv"</code>. Only relevant when conducting a model comparison and likelihood ratio test. See ‘Details’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>btt</code></td>
<td>
<p>optional vector of indices (or list thereof) to specify which coefficients should be included in the Wald-type test. Can also be a string to <code>grep</code> for. See ‘Details’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>optional numeric vector or matrix to specify one or more linear combinations of the coefficients in the model that should be tested. See ‘Details’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>att</code></td>
<td>
<p>optional vector of indices (or list thereof) to specify which scale coefficients should be included in the Wald-type test. Can also be a string to <code>grep</code> for. See ‘Details’. Only relevant for location-scale models (see <code>rma.uni</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p>optional numeric vector or matrix to specify one or more linear combinations of the scale coefficients in the model that should be tested. See ‘Details’. Only relevant for location-scale models (see <code>rma.uni</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rhs</code></td>
<td>
<p>optional scalar or vector of values for the right-hand side of the null hypothesis when testing a set of coefficients (via <code>btt</code> or <code>att</code>) or linear combinations thereof (via <code>X</code> or <code>Z</code>). If unspecified, this defaults to a vector of zeros of the appropriate length. See ‘Details’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>optional integer to specify the number of decimal places to which the printed results should be rounded. If unspecified, the default is to take the value from the object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refit</code></td>
<td>
<p>logical to indicate whether models fitted with REML estimation and differing in their fixed effects should be refitted with ML estimation when conducting a likelihood ratio test (the default is <code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other arguments.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function can be used in three different ways:
</p>

<ol>
<li>
<p> When a single model is specified (via argument <code>object</code>), the function provides a Wald-type test of one or more model coefficients, that is, \[\mbox{H}_0{:}\; \beta_{j \in \texttt{btt}} = 0,\] where \(\beta_{j \in \texttt{btt}}\) is the set of coefficients to be tested (by default whether the set of coefficients is significantly different from zero, but one can specify a different value under the null hypothesis via argument <code>rhs</code>).
</p>
<p>In particular, for equal- or random-effects models (i.e., models without moderators), this is just the test of the single coefficient of the model (i.e., \(\mbox{H}_0{:}\; \theta = 0\) or \(\mbox{H}_0{:}\; \mu = 0\)). For models including moderators, an omnibus test of all model coefficients is conducted that excludes the intercept (the first coefficient) if it is included in the model. If no intercept is included in the model, then the omnibus test includes all coefficients in the model including the first.
</p>
<p>Alternatively, one can manually specify the indices of the coefficients to test via the <code>btt</code> (‘betas to test’) argument. For example, with <code>btt=c(3,4)</code>, only the third and fourth coefficients from the model are included in the test (if an intercept is included in the model, then it corresponds to the first coefficient in the model). Instead of specifying the coefficient numbers, one can specify a string for <code>btt</code>. In that case, <code>grep</code> will be used to search for all coefficient names that match the string (and hence, one can use regular expressions to fine-tune the search for matching strings). Using the <code>btt</code> argument, one can for example select all coefficients corresponding to a particular factor to test if the factor as a whole is significant. One can also specify a list of indices/strings, in which case tests of all list elements will be conducted. See ‘Examples’.
</p>
<p>For location-scale models fitted with the <code>rma.uni</code> function, one can use the <code>att</code> argument in an analogous manner to specify the indices of the scale coefficients to test (i.e., \(\mbox{H}_0{:}\; \alpha_{j \in \texttt{att}} = 0\), where \(\alpha_{j \in \texttt{att}}\) is the set of coefficients to be tested).
</p>
</li>
<li>
<p> When a single model is specified (via argument <code>object</code>), one can use the <code>X</code> argument\(^1\) to specify a linear combination of the coefficients in the model that should be tested using a Wald-type test, that is, \[\mbox{H}_0{:}\; X \beta = 0,\] where <code>X</code> is a (row) vector of the same length as there are coefficients in the model (by default whether the linear combination is significantly different from zero, but one can specify a different value under the null hypothesis via argument <code>rhs</code>). If a matrix of linear combinations is specified, each row defines a particular linear combination to be tested (if <code>rhs</code> is used, then it should either be a scalar or of the same length as the number of combinations to be tested). If the matrix is of full rank, an omnibus Wald-type test of all linear combinations is also provided. Linear combinations can also be obtained with the <code>predict</code> function, which provides corresponding confidence intervals.
</p>
<p>For location-scale models fitted with the <code>rma.uni</code> function, one can use the <code>Z</code> argument in an analogous manner to specify one or multiple linear combinations of the scale coefficients in the model that should be tested (i.e., \(\mbox{H}_0{:}\; Z \alpha = 0\)).
</p>
</li>
<li>
<p> When specifying two models for comparison (via arguments <code>object</code> and <code>object2</code>), the function provides a likelihood ratio test (LRT) comparing the two models. The two models must be based on the same set of data, must be of the same class, and should be nested for the LRT to make sense. Also, LRTs are not meaningful when using REML estimation and the two models differ in terms of their fixed effects (setting <code>refit=TRUE</code> automatically refits the two models using ML estimation). Also, the theory underlying LRTs is only really applicable when comparing models that were fitted with ML/REML estimation, so if some other estimation was used to fit the two models, the results should be treated with caution.
</p>
</li>
</ol>
<p>———
</p>
<p>\(^1\) This argument used to be called <code>L</code>, but was renamed to <code>X</code> (but using <code>L</code> in place of <code>X</code> still works).
</p>


<h3>Value</h3>

<p>An object of class <code>"anova.rma"</code>. When a single model is specified (without any further arguments or together with the <code>btt</code> or <code>att</code> argument), the object is a list containing the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>QM</code></td>
<td>
<p>test statistic of the Wald-type test of the model coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>QMdf</code></td>
<td>
<p>corresponding degrees of freedom.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>QMp</code></td>
<td>
<p>corresponding p-value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>btt</code></td>
<td>
<p>indices of the coefficients tested by the Wald-type test.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>number of outcomes included in the analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>number of coefficients in the model (including the intercept).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>number of coefficients included in the Wald-type test.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>some additional elements/values.</p>
</td>
</tr>
</table>
<p>When <code>btt</code> or <code>att</code> was a list, then the object is a list of class <code>"list.anova.rma"</code>, where each element is an <code>"anova.rma"</code> object as described above.
</p>
<p>When argument <code>X</code> is used, the object is a list containing the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>QM</code></td>
<td>
<p>test statistic of the omnibus Wald-type test of all linear combinations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>QMdf</code></td>
<td>
<p>corresponding degrees of freedom.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>QMp</code></td>
<td>
<p>corresponding p-value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hyp</code></td>
<td>
<p>description of the linear combinations tested.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xb</code></td>
<td>
<p>values of the linear combinations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>standard errors of the linear combinations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zval</code></td>
<td>
<p>test statistics of the linear combinations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pval</code></td>
<td>
<p>corresponding p-values.</p>
</td>
</tr>
</table>
<p>When two models are specified, the object is a list containing the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>fit.stats.f</code></td>
<td>
<p>log-likelihood, deviance, AIC, BIC, and AICc for the full model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit.stats.r</code></td>
<td>
<p>log-likelihood, deviance, AIC, BIC, and AICc for the reduced model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parms.f</code></td>
<td>
<p>number of parameters in the full model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parms.r</code></td>
<td>
<p>number of parameters in the reduced model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LRT</code></td>
<td>
<p>likelihood ratio test statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pval</code></td>
<td>
<p>corresponding p-value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>QE.f</code></td>
<td>
<p>test statistic of the test for (residual) heterogeneity from the full model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>QE.r</code></td>
<td>
<p>test statistic of the test for (residual) heterogeneity from the reduced model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau2.f</code></td>
<td>
<p>estimated \(\tau^2\) value from the full model. <code>NA</code> for <code>"rma.mv"</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau2.r</code></td>
<td>
<p>estimated \(\tau^2\) value from the reduced model. <code>NA</code> for <code>"rma.mv"</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R2</code></td>
<td>
<p>amount (in percent) of the heterogeneity in the reduced model that is accounted for in the full model (<code>NA</code> for <code>"rma.mv"</code> objects). This can be regarded as a pseudo \(R^2\) statistic (Raudenbush, 2009). Note that the value may not be very accurate unless \(k\) is large (Lopez-Lopez et al., 2014).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>some additional elements/values.</p>
</td>
</tr>
</table>
<p>The results are formatted and printed with the <code>print</code> function. To format the results as a data frame, one can use the <code>as.data.frame</code> function.
</p>


<h3>Note</h3>

<p>The function can also be used to conduct a likelihood ratio test (LRT) for the amount of (residual) heterogeneity in random- and mixed-effects models. The full model should then be fitted with either <code>method="ML"</code> or <code>method="REML"</code> and the reduced model with <code>method="EE"</code> (or with <code>tau2=0</code>). The p-value for the test is based on a chi-square distribution with 1 degree of freedom, but actually needs to be adjusted for the fact that the parameter (i.e., \(\tau^2\)) falls on the boundary of the parameter space under the null hypothesis (see Viechtbauer, 2007, for more details).
</p>
<p>LRTs for variance components in more complex models (as fitted with the <code>rma.mv</code> function) can also be conducted in this manner (see ‘Examples’).
</p>


<h3>Author(s)</h3>

<p>Wolfgang Viechtbauer <a href="mailto:wvb@metafor-project.org">wvb@metafor-project.org</a> <a href="https://www.metafor-project.org">https://www.metafor-project.org</a>
</p>


<h3>References</h3>

<p>Hardy, R. J., &amp; Thompson, S. G. (1996). A likelihood approach to meta-analysis with random effects. <em>Statistics in Medicine</em>, <b>15</b>(6), 619–629. <code style="white-space: pre;">⁠https://doi.org/10.1002/(sici)1097-0258(19960330)15:6%3C619::aid-sim188%3E3.0.co;2-a⁠</code>
</p>
<p>Huizenga, H. M., Visser, I., &amp; Dolan, C. V. (2011). Testing overall and moderator effects in random effects meta-regression. <em>British Journal of Mathematical and Statistical Psychology</em>, <b>64</b>(1), 1–19. <code style="white-space: pre;">⁠https://doi.org/10.1348/000711010X522687⁠</code>
</p>
<p>López-López, J. A., Marín-Martínez, F., Sánchez-Meca, J., Van den Noortgate, W., &amp; Viechtbauer, W. (2014). Estimation of the predictive power of the model in mixed-effects meta-regression: A simulation study. <em>British Journal of Mathematical and Statistical Psychology</em>, <b>67</b>(1), 30–48. <code style="white-space: pre;">⁠https://doi.org/10.1111/bmsp.12002⁠</code>
</p>
<p>Raudenbush, S. W. (2009). Analyzing effect sizes: Random effects models. In H. Cooper, L. V. Hedges, &amp; J. C. Valentine (Eds.), <em>The handbook of research synthesis and meta-analysis</em> (2nd ed., pp. 295–315). New York: Russell Sage Foundation.
</p>
<p>Viechtbauer, W. (2007). Hypothesis tests for population heterogeneity in meta-analysis. <em>British Journal of Mathematical and Statistical Psychology</em>, <b>60</b>(1), 29–60. <code style="white-space: pre;">⁠https://doi.org/10.1348/000711005X64042⁠</code>
</p>
<p>Viechtbauer, W. (2010). Conducting meta-analyses in R with the metafor package. <em>Journal of Statistical Software</em>, <b>36</b>(3), 1–48. <code style="white-space: pre;">⁠https://doi.org/10.18637/jss.v036.i03⁠</code>
</p>
<p>Viechtbauer, W., &amp; López-López, J. A. (2022). Location-scale models for meta-analysis. <em>Research Synthesis Methods</em>. <b>13</b>(6), 697–715. <code style="white-space: pre;">⁠https://doi.org/10.1002/jrsm.1562⁠</code>
</p>


<h3>See Also</h3>

<p><code>rma.uni</code> and <code>rma.mv</code> for functions to fit models for which likelihood ratio and Wald-type tests can be conducted.
</p>
<p><code>print</code> for the print method and <code>as.data.frame</code> for the method to format the results as a data frame.
</p>


<h3>Examples</h3>

<pre><code class="language-R">### calculate log risk ratios and corresponding sampling variances
dat &lt;- escalc(measure="RR", ai=tpos, bi=tneg, ci=cpos, di=cneg, data=dat.bcg)

### fit random-effects model
res1 &lt;- rma(yi, vi, data=dat, method="ML")
res1

### fit mixed-effects model with two moderators (absolute latitude and publication year)
res2 &lt;- rma(yi, vi, mods = ~ ablat + year, data=dat, method="ML")
res2

### Wald-type test of the two moderators
anova(res2)

### alternative way of specifying the same test
anova(res2, X=rbind(c(0,1,0), c(0,0,1)))

### corresponding likelihood ratio test
anova(res1, res2)

### Wald-type test of a linear combination
anova(res2, X=c(1,35,1970))

### use predict() to obtain the same linear combination (with its CI)
predict(res2, newmods=c(35,1970))

### mixed-effects model with three moderators
res3 &lt;- rma(yi, vi, mods = ~ ablat + year + alloc, data=dat, method="ML")
res3

### Wald-type test of the 'alloc' factor
anova(res3, btt=4:5)

### instead of specifying the coefficient numbers, grep for "alloc"
anova(res3, btt="alloc")

### specify a list for the 'btt' argument
anova(res3, btt=list(2,3,4:5))

############################################################################

### an example of doing LRTs of variance components in more complex models
dat &lt;- dat.konstantopoulos2011
res &lt;- rma.mv(yi, vi, random = ~ 1 | district/school, data=dat)

### likelihood ratio test of the district-level variance component
res0 &lt;- rma.mv(yi, vi, random = ~ 1 | district/school, data=dat, sigma2=c(0,NA))
anova(res, res0)

### likelihood ratio test of the school-level variance component
res0 &lt;- rma.mv(yi, vi, random = ~ 1 | district/school, data=dat, sigma2=c(NA,0))
anova(res, res0)

### likelihood ratio test of both variance components simultaneously
res0 &lt;- rma.mv(yi, vi, data=dat)
anova(res, res0)

############################################################################

### an example illustrating a workflow involving cluster-robust inference
dat &lt;- dat.assink2016

### assume that the effect sizes within studies are correlated with rho=0.6
V &lt;- vcalc(vi, cluster=study, obs=esid, data=dat, rho=0.6)

### fit multilevel model using this approximate V matrix
res &lt;- rma.mv(yi, V, random = ~ 1 | study/esid, data=dat)
res

### likelihood ratio tests of the two variance components
res0 &lt;- rma.mv(yi, V, random = ~ 1 | study/esid, data=dat, sigma2=c(0,NA))
anova(res, res0)
res0 &lt;- rma.mv(yi, V, random = ~ 1 | study/esid, data=dat, sigma2=c(NA,0))
anova(res, res0)

### use cluster-robust methods for inferences about the fixed effects
sav &lt;- robust(res, cluster=study, clubSandwich=TRUE)
sav

### examine if 'deltype' is a potential moderator
res &lt;- rma.mv(yi, V, mods = ~ deltype, random = ~ 1 | study/esid, data=dat)
sav &lt;- robust(res, cluster=study, clubSandwich=TRUE)
sav

### note: the (denominator) dfs for the omnibus F-test are very low, so the results
### of this test may not be trustworthy; consider using cluster wild bootstrapping
## Not run: 
library(wildmeta)
Wald_test_cwb(res, constraints=constrain_zero(2:3), R=1000, seed=1234)

## End(Not run)
</code></pre>


</div>