<div class="container">

<table style="width: 100%;"><tr>
<td>metapred</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generalized Stepwise Regression for Prediction Models in Clustered Data</h2>

<h3>Description</h3>

<p>Generalized stepwise regression for obtaining a prediction model that is validated 
with (stepwise) internal-external cross-validation, in or to obtain adequate 
performance across data sets. Requires data from individuals in multiple studies.
</p>


<h3>Usage</h3>

<pre><code class="language-R">metapred(
  data,
  strata,
  formula,
  estFUN = "glm",
  scope = NULL,
  retest = FALSE,
  max.steps = 1000,
  center = FALSE,
  recal.int = FALSE,
  cvFUN = NULL,
  cv.k = NULL,
  metaFUN = NULL,
  meta.method = NULL,
  predFUN = NULL,
  perfFUN = NULL,
  genFUN = NULL,
  selFUN = "which.min",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data.frame containing the data. Note that <code>metapred</code> removes observations with missing data <em>listwise</em>
for all variables in <code>formula</code> and <code>scope</code>, to ensure that the same data is used in each model in each step. The
outcome variable should be <code>numeric</code> or coercible to numeric by as.numeric().</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata</code></td>
<td>
<p>Character to specify the name of the strata (e.g. studies or clusters) variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p><code>formula</code> of the first model to be evaluated. <code>metapred</code> will start at <code>formula</code> and update it
using terms of <code>scope</code>. Defaults to full main effects model, where the first column in <code>data</code> is assumed to be
the outcome and all remaining columns (except <code>strata</code>) predictors. See formula for formulas in general.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estFUN</code></td>
<td>
<p>Function for estimating the model in the first stage. Currently "lm", "glm" and "logistfirth" are supported.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scope</code></td>
<td>
<p><code>formula</code>. The difference between <code>formula</code> and <code>scope</code> defines the range of models examined in the 
stepwise search. Defaults to NULL, which leads to the intercept-only model. If <code>scope</code> is not nested in <code>formula</code>, 
this implies backwards selection will be applied (default). If <code>scope</code> is nested in <code>formula</code>, this implies forward 
selection will be applied. If equal, no stepwise selection is applied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>retest</code></td>
<td>
<p>Logical. Should added (removed) terms be retested for removal (addition)? <code>TRUE</code> implies bi-directional 
stepwise search.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.steps</code></td>
<td>
<p>Integer. Maximum number of steps (additions or removals of terms) to take. Defaults to 1000, which is
essentially as many as it takes. 0 implies no stepwise selection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>center</code></td>
<td>
<p>logical. Should numeric predictors be centered around the cluster mean?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recal.int</code></td>
<td>
<p>Logical. Should the intercept be recalibrated in each validation?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cvFUN</code></td>
<td>
<p>Cross-validation method, on the study (i.e. cluster or stratum) level. "l1o" for leave-one-out cross-validation 
(default). "bootstrap" for bootstrap. Or "fixed", for one or more data sets which are only used for validation. A user written 
function may be supplied as well.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cv.k</code></td>
<td>
<p>Parameter for cvFUN. For <code>cvFUN="bootstrap"</code>, this is the number of bootstraps. For <code>cvFUN="fixed"</code>, 
this is a vector of the indices of the (sorted) data sets. Not used for <code>cvFUN="l1o"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metaFUN</code></td>
<td>
<p>Function for computing the meta-analytic coefficient estimates in two-stage MA. 
By default, rma.uni, from the metafor package is used. Default settings are univariate random effects, 
estimated with "DL". Method can be passed trough the <code>meta.method</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>meta.method</code></td>
<td>
<p>Name of method for meta-analysis. Default is "DL". For more options see rma.uni.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predFUN</code></td>
<td>
<p>Function for predicting new values. Defaults to the predicted probability of the outcome, using the link 
function of <code>glm()</code> or <code>lm()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perfFUN</code></td>
<td>
<p>Function for computing the performance of the prediction models. Default: mean squared error 
(<code>perfFUN="mse"</code>).Other options are <code>"var.e"</code> (variance of prediction error), <code>"auc"</code> (area under the curve),
<code>"cal.int"</code> (calibration intercept), and <code>"cal.slope"</code> (multiplicative calibration slope) and <code>"cal.add.slope"</code>
(additive calibration slope).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>genFUN</code></td>
<td>
<p>Function or <code>list</code> of named functions for computing generalizability of the performance. 
Default: (absolute) mean (<code>genFUN="abs.mean"</code>). Choose <code>coef.var</code> for the coefficient of variation. If a <code>list</code>,
only the first is used for model selection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>selFUN</code></td>
<td>
<p>Function for selecting the best method. Default: lowest value for <code>genFUN</code>. Should be set to
"which.max" if high values for <code>genFUN</code> indicate a good model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>To pass arguments to estFUN (e.g. family = "binomial"), or to other FUNctions.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Use subset.metapred to obtain an individual prediction model from a <code>metapred</code> object.
</p>
<p>Note that <code>formula.changes</code> is currently unordered; it does not represent the order of changes in the stepwise 
procedure.
</p>
<p><code>metapred</code> is still under development, use with care.
</p>


<h3>Value</h3>

<p>A list of class <code>metapred</code>, containing the final model in <code>global.model</code>, and the stepwise
tree of estimates of the coefficients, performance measures, generalizability measures in <code>stepwise</code>.
</p>


<h3>Author(s)</h3>

<p>Valentijn de Jong &lt;Valentijn.M.T.de.Jong@gmail.com&gt;
</p>


<h3>References</h3>

<p>Debray TPA, Moons KGM, Ahmed I, Koffijberg H, Riley RD. A framework for developing, implementing, 
and evaluating clinical prediction models in an individual participant data meta-analysis. 
<em>Stat Med</em>. 2013;32(18):3158-80.
</p>
<p>de Jong VMT, Moons KGM, Eijkemans MJC, Riley RD, Debray TPA. Developing more generalizable prediction models from pooled 
studies and large clustered data sets. <em>Stat Med</em>. 2021;40(15):3533â€“59.
</p>
<p>Riley RD, Tierney JF, Stewart LA. Individual participant data meta-analysis: a handbook for healthcare research. 
Hoboken, NJ: Wiley; 2021. ISBN: 978-1-119-33372-2.
</p>
<p>Schmid CH, Stijnen T, White IR. Handbook of meta-analysis. First edition. Boca Raton: Taylor and Francis; 2020. ISBN: 978-1-315-11940-3.
</p>


<h3>See Also</h3>

<p><code>forest.metapred</code>  for generating a forest plot of prediction model performance
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(DVTipd)

## Not run: 
# Explore heterogeneity in intercept and assocation of 'ddimdich'
glmer(dvt ~ 0 + cluster + (ddimdich|study), family = binomial(), data = DVTipd)

## End(Not run)

# Scope
f &lt;- dvt ~ histdvt + ddimdich + sex + notraum

# Internal-external cross-validation of a pre-specified model 'f'
fit &lt;- metapred(DVTipd, strata = "study", formula = f, scope = f, family = binomial)
fit

# Let's try to simplify model 'f' in order to improve its external validity
metapred(DVTipd, strata = "study", formula = f, family = binomial)

# We can also try to build a generalizable model from scratch

## Not run: 
# Some additional examples:
metapred(DVTipd, strata = "study", formula = dvt ~ 1, scope = f, family = binomial) # Forwards
metapred(DVTipd, strata = "study", formula = f, scope = f, family = binomial) # no selection
metapred(DVTipd, strata = "study", formula = f, max.steps = 0, family = binomial) # no selection
metapred(DVTipd, strata = "study", formula = f, recal.int = TRUE, family = binomial)
metapred(DVTipd, strata = "study", formula = f, meta.method = "REML", family = binomial)

## End(Not run)
# By default, metapred assumes the first column is the outcome.
newdat &lt;- data.frame(dvt=0, histdvt=0, ddimdich=0, sex=1, notraum=0)
fitted &lt;- predict(fit, newdata = newdat)

</code></pre>


</div>