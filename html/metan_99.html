<div class="container">

<table style="width: 100%;"><tr>
<td>gamem_met</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Genotype-environment analysis by mixed-effect models</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="../help/figures/lifecycle-stable.svg" alt="[Stable]"></a>
</p>
<p>Genotype analysis in multi-environment trials using mixed-effect or
random-effect models.
</p>
<p>The nature of the effects in the model is chosen with the argument
<code>random</code>. By default, the experimental design considered in each
environment is a randomized complete block design. If <code>block</code> is
informed, a resolvable alpha-lattice design (Patterson and Williams, 1976) is
implemented. The following six models can be fitted depending on the values
of <code>random</code> and <code>block</code> arguments.
</p>

<ul>
<li> <p><strong>Model 1:</strong> <code>block = NULL</code> and <code>random = "gen"</code> (The
default option). This model considers a Randomized Complete Block Design in
each environment assuming genotype and genotype-environment interaction as
random effects. Environments and blocks nested within environments are
assumed to fixed factors.
</p>
</li>
<li> <p><strong>Model 2:</strong> <code>block = NULL</code> and <code>random = "env"</code>. This
model considers a Randomized Complete Block Design in each environment
treating environment, genotype-environment interaction, and blocks nested
within environments as random factors. Genotypes are assumed to be fixed
factors.
</p>
</li>
<li> <p><strong>Model 3:</strong> <code>block = NULL</code> and <code>random = "all"</code>. This
model considers a Randomized Complete Block Design in each environment
assuming a random-effect model, i.e., all effects (genotypes, environments,
genotype-vs-environment interaction and blocks nested within environments)
are assumed to be random factors.
</p>
</li>
<li> <p><strong>Model 4:</strong> <code>block</code> is not <code>NULL</code> and <code>random =   "gen"</code>. This model considers an alpha-lattice design in each environment
assuming genotype, genotype-environment interaction, and incomplete blocks
nested within complete replicates as random to make use of inter-block
information (Mohring et al., 2015). Complete replicates nested within
environments and environments are assumed to be fixed factors.
</p>
</li>
<li> <p><strong>Model 5:</strong> <code>block</code> is not <code>NULL</code> and <code>random =   "env"</code>. This model considers an alpha-lattice design in each environment
assuming genotype as fixed. All other sources of variation (environment,
genotype-environment interaction, complete replicates nested within
environments, and incomplete blocks nested within replicates) are assumed
to be random factors.
</p>
</li>
<li> <p><strong>Model 6:</strong> <code>block</code> is not <code>NULL</code> and <code>random =   "all"</code>. This model considers an alpha-lattice design in each environment
assuming all effects, except the intercept, as random factors.
</p>
</li>
</ul>
<h3>Usage</h3>

<pre><code class="language-R">gamem_met(
  .data,
  env,
  gen,
  rep,
  resp,
  block = NULL,
  by = NULL,
  random = "gen",
  prob = 0.05,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>.data</code></td>
<td>
<p>The dataset containing the columns related to Environments,
Genotypes, replication/block and response variable(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>env</code></td>
<td>
<p>The name of the column that contains the levels of the
environments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gen</code></td>
<td>
<p>The name of the column that contains the levels of the genotypes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rep</code></td>
<td>
<p>The name of the column that contains the levels of the
replications/blocks.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resp</code></td>
<td>
<p>The response variable(s). To analyze multiple variables in a
single procedure a vector of variables may be used. For example <code>resp = c(var1, var2, var3)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>block</code></td>
<td>
<p>Defaults to <code>NULL</code>. In this case, a randomized complete
block design is considered. If block is informed, then an alpha-lattice
design is employed considering block as random to make use of inter-block
information, whereas the complete replicate effect is always taken as
fixed, as no inter-replicate information was to be recovered (Mohring et
al., 2015).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p>One variable (factor) to compute the function by. It is a shortcut
to <code>dplyr::group_by()</code>.This is especially useful, for example,
when the researcher want to analyze environments within mega-environments.
In this case, an object of class waasb_grouped is returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random</code></td>
<td>
<p>The effects of the model assumed to be random. Defaults to
<code>random = "gen"</code>. See <strong>Details</strong> to see the random effects
assumed depending on the experimental design of the trials.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prob</code></td>
<td>
<p>The probability for estimating confidence interval for BLUP's
prediction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical argument. If <code>verbose = FALSE</code> the code will run
silently.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>waasb</code> with the following items for each
variable:
</p>

<ul>
<li> <p><strong>fixed</strong> Test for fixed effects.
</p>
</li>
<li> <p><strong>random</strong> Variance components for random effects.
</p>
</li>
<li> <p><strong>LRT</strong> The Likelihood Ratio Test for the random effects.
</p>
</li>
<li> <p><strong>BLUPgen</strong> The random effects and estimated BLUPS for genotypes (If
<code>random = "gen"</code> or <code>random = "all"</code>)
</p>
</li>
<li> <p><strong>BLUPenv</strong> The random effects and estimated BLUPS for environments,
(If <code>random = "env"</code> or <code>random = "all"</code>).
</p>
</li>
<li> <p><strong>BLUPint</strong> The random effects and estimated BLUPS of all genotypes in
all environments.
</p>
</li>
<li> <p><strong>MeansGxE</strong> The phenotypic means of genotypes in the environments.
</p>
</li>
<li> <p><strong>modellme</strong> The mixed-effect model of class <code>lmerMod</code>.
</p>
</li>
<li> <p><strong>residuals</strong> The residuals of the mixed-effect model.
</p>
</li>
<li> <p><strong>model_lm</strong> The fixed-effect model of class <code>lm</code>.
</p>
</li>
<li> <p><strong>residuals_lm</strong> The residuals of the fixed-effect model.
</p>
</li>
<li> <p><strong>Details</strong> A list summarizing the results. The following information
are shown: <code>Nenv</code>, the number of environments in the analysis;
<code>Ngen</code> the number of genotypes in the analysis; <code>Mean</code> the grand
mean; <code>SE</code> the standard error of the mean; <code>SD</code> the standard
deviation. <code>CV</code> the coefficient of variation of the phenotypic means,
estimating WAASB, <code>Min</code> the minimum value observed (returning the
genotype and environment), <code>Max</code> the maximum value observed (returning
the genotype and environment); <code>MinENV</code> the environment with the lower
mean, <code>MaxENV</code> the environment with the larger mean observed,
<code>MinGEN</code> the genotype with the lower mean, <code>MaxGEN</code> the genotype
with the larger.
</p>
</li>
<li> <p><strong>ESTIMATES</strong> A tibble with the genetic parameters (if <code>random = "gen"</code> or <code>random = "all"</code>) with the following columns: <code style="white-space: pre;">⁠Phenotypic variance⁠</code> the phenotypic variance; <code>Heritability</code> the broad-sense
heritability; <code>GEr2</code> the coefficient of determination of the interaction
effects; <code>h2mg</code> the heritability on the mean basis;
<code>Accuracy</code> the selective accuracy; <code>rge</code> the genotype-environment
correlation; <code>CVg</code> the genotypic coefficient of variation; <code>CVr</code>
the residual coefficient of variation; <code style="white-space: pre;">⁠CV ratio⁠</code> the ratio between
genotypic and residual coefficient of variation.
</p>
</li>
<li> <p><strong>formula</strong> The formula used to fit the mixed-model.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Tiago Olivoto <a href="mailto:tiagoolivoto@gmail.com">tiagoolivoto@gmail.com</a>
</p>


<h3>References</h3>

<p>Olivoto, T., A.D.C. L\'ucio, J.A.G. da silva, V.S. Marchioro, V.Q. de
Souza, and E. Jost. 2019. Mean performance and stability in multi-environment
trials I: Combining features of AMMI and BLUP techniques. Agron. J.
111:2949-2960.
<a href="https://doi.org/10.2134/agronj2019.03.0220">doi:10.2134/agronj2019.03.0220</a>
</p>
<p>Mohring, J., E. Williams, and H.-P. Piepho. 2015. Inter-block information: to
recover or not to recover it? TAG. Theor. Appl. Genet. 128:1541-54.
<a href="https://doi.org/10.1007/s00122-015-2530-0">doi:10.1007/s00122-015-2530-0</a>
</p>
<p>Patterson, H.D., and E.R. Williams. 1976. A new class of resolvable
incomplete block designs. Biometrika 63:83-92.
</p>


<h3>See Also</h3>

<p><code>mtsi()</code> <code>waas()</code>
<code>get_model_data()</code> <code>plot_scores()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(metan)
#===============================================================#
# Example 1: Analyzing all numeric variables assuming genotypes #
# as random effects                                             #
#===============================================================#
model &lt;- gamem_met(data_ge,
                  env = ENV,
                  gen = GEN,
                  rep = REP,
                  resp = everything())
# Distribution of random effects (first variable)
plot(model, type = "re")

# Genetic parameters
get_model_data(model, "genpar")



#===============================================================#
# Example 2: Unbalanced trials                                  #
# assuming all factors as random effects                        #
#===============================================================#
un_data &lt;- data_ge %&gt;%
             remove_rows(1:3) %&gt;%
             droplevels()

model2 &lt;- gamem_met(un_data,
                   env = ENV,
                   gen = GEN,
                   rep = REP,
                   random = "all",
                   resp = GY)
get_model_data(model2)


</code></pre>


</div>