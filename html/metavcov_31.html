<div class="container">

<table style="width: 100%;"><tr>
<td>r.vcov</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Computing Variance-Covariance Matrices for Correlation Coefficients</h2>

<h3>Description</h3>

<p>The function <code>r.vcov</code> computes variance-covariance matrix for multivariate meta-analysis when the effect size is measured by correlation coefficient.
</p>


<h3>Usage</h3>

<pre><code class="language-R">r.vcov(n, corflat, zscore = FALSE, name = NULL, method = "average", na.impute = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n </code></td>
<td>
<p> A <code class="reqn">N</code>-dimensional vector containing sample sizes from <code class="reqn">N</code> studies.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corflat </code></td>
<td>
<p> A <code class="reqn">N \times p</code> matrix or data frame storing <code class="reqn">p</code> correlation coefficients from each of the <code class="reqn">N</code> studies.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zscore </code></td>
<td>
<p> Whether the correlation coefficients in <code>corflat</code> are already transformed into Fisher's <code class="reqn">z</code> scores.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name </code></td>
<td>
<p> A <code class="reqn">p</code>-dimensional vector containing names for the <code class="reqn">p</code> correlation coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method </code></td>
<td>
<p> Method <code>"average"</code> computes variance and covariances with mean correlation coefficients that are sample-size weighted from all the <code class="reqn">N</code> studies (missing values are omitted); method <code>"each"</code> computes variance and covariances with each of the corresponding correlation coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.impute </code></td>
<td>
<p> Missing values can be imputed by a numeric value, such as zero by setting <code>na.impute = 0</code>. With the default setting <code>na.impute = NA</code>, missing values are not imputed. If specifying <code>na.impute = "average"</code>, missing values are imputed by mean correlation coefficients that are sample-size weighted from the complete records. </p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>How to arrange correlation coefficients of each study from matrix to vector is in Cooper et al book page 385 to 386. Details for average method are in book of Cooper et al page 388. Let <code class="reqn">r_{ist}</code> denote the sample correlation coefficient that describes the relationship between variables <code class="reqn">s</code> and <code class="reqn">t</code> in study <code class="reqn">i</code>. We can calculate its variance as
<code class="reqn">var({{r}_{ist}})={{(1-\rho_{ist}^{2})}^{2}}/{{n}_{i}},</code> and the covariance between two correlation coefficients is
<code class="reqn">
	cov({{r}_{ist}},{{r}_{iuv}})=[.5{{\rho }_{ist}}{{\rho }_{iuv}}({{\rho }}_{isu}^{2}+{{\rho }}_{isv}^{2}+{{\rho }}_{itu}^{2}+{{\rho }}_{itv}^{2})+{{\rho }_{isu}}{{\rho }_{itv}}+{{\rho }_{isv}}{{\rho }_{itu}} \nonumber \\
	 -({{\rho }_{ist}}{{\rho }_{isu}}{{\rho }_{isv}}+{{\rho }_{its}}{{\rho }_{itu}}{{\rho }_{itv}}+{{\rho }_{ius}}{{\rho }_{iut}}{{\rho }_{iuv}}+{{\rho }_{ivs}}{{\rho }_{ivt}}{{\rho }_{ivu}})]/{{n}_{i}},
</code>
where <code class="reqn">\rho_{i..}</code> represents the population value. In practice, <code class="reqn">\rho_{i..}</code> can be substituted by the observed sample correlation or sample-size weighted mean correlation coefficients from all studies.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>r </code></td>
<td>
<p> A <code class="reqn">N \times p</code> data frame that contains the input argument <code>corflat</code> with column names and imputed values according to the input argument <code>na.impute</code>. If the input argument <code>zscore=TRUE</code>, <code>r</code> is transformed from Fisher's <code class="reqn">z</code> score in <code>corflat</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>list.rvcov </code></td>
<td>
<p> A <code class="reqn">N</code>-dimensional list of <code class="reqn">p(p+1)/2 \times p(p+1)/2</code> matrices of computed variance-covariance matrices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>matrix.rvcov </code></td>
<td>
<p> A <code class="reqn">N \times p(p+1)/2</code> matrix whose rows are computed variance-covariance vectors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ef </code></td>
<td>
<p> A <code class="reqn">N \times p</code> data frame that contains Fisher's <code class="reqn">z</code> transformed correlation coefficients from the input argument <code>corflat</code> with column names and imputed values according to the input argument <code>na.impute</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>list.vcov </code></td>
<td>
<p> A list in the same format of <code>list.rvcov</code> for Fisher's <code class="reqn">z</code> transformed correlation coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>matrix.vcov </code></td>
<td>
<p> A matrix <code>matrix.rvcov</code> for Fisher's <code class="reqn">z</code> transformed correlation coefficients.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Min Lu
</p>


<h3>References</h3>

<p>Lu, M. (2023). Computing within-study covariances, data visualization, and missing data solutions for multivariate meta-analysis with metavcov. <em>Frontiers in Psychology</em>, 14:1185012.
</p>


<h3>Examples</h3>

<pre><code class="language-R">##############################################################
# A simple example:
# Checking the example in Harris Cooper et al.'s book page 388
##############################################################
r &lt;- matrix(c(-0.074, -0.127, 0.324, 0.523, -0.416, -0.414), 1)
n &lt;- 142
computvcov &lt;- r.vcov(n = n, corflat = r,
                     name = paste("C", c("st", "su", "sv", "tu", "tv", "uv"), sep = ""),
                     method = "each")
round(computvcov$list.rvcov[[1]], 4)
round(computvcov$ef, 4)
round(computvcov$list.vcov[[1]], 4)
round(computvcov$matrix.vcov, 4)
######################################################
# Example: Craft2003 data
# Preparing covariances for multivariate meta-analysis
######################################################
data(Craft2003)
# extract correlation from the dataset (craft)
corflat &lt;- subset(Craft2003, select=C1:C6)
# transform correlations to z and compute variance-covariance matrix.
computvcov &lt;- r.vcov(n = Craft2003$N, corflat = corflat, method = "average")
# name transformed z scores as y
y &lt;- computvcov$ef
# name variance-covariance matrix of trnasformed z scores as S
S &lt;- computvcov$matrix.vcov
S[1, ]
## fixed-effect model
MMA_FE &lt;- summary(metafixed(y = y, Slist = computvcov$list.vcov))
#######################################################################
# Running random-effects model using package "mixmeta" or "metaSEM"
#######################################################################
# Restricted maximum likelihood (REML) estimator from the mixmeta package
#library(mixmeta)
#mvmeta_RE &lt;- summary(mixmeta(cbind(C1, C2, C3, C4, C5, C6) ~ 1,
#                           S = S, data = y, method = "reml"))
#mvmeta_RE

# maximum likelihood estimators from the metaSEM package
# library(metaSEM)
# metaSEM_RE &lt;- summary(meta(y = y, v = S))
# metaSEM_RE
##############################################################
# Plotting the result:
##############################################################
obj &lt;- MMA_FE
# obj &lt;- mvmeta_RE
# obj &lt;- metaSEM_RE
# pdf("CI.pdf", width = 4, height = 7)
plotCI(y = computvcov$ef, v = computvcov$list.vcov,
        name.y = NULL, name.study = Craft2003$ID,
        y.all = obj$coefficients[,1],
        y.all.se = obj$coefficients[,2])
# dev.off()
</code></pre>


</div>