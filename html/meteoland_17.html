<div class="container">

<table style="width: 100%;"><tr>
<td>interpolation_cross_validation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calibration and validation of interpolation procedures</h2>

<h3>Description</h3>

<p>Calibration and validation of interpolation procedures
</p>


<h3>Usage</h3>

<pre><code class="language-R">interpolation_cross_validation(
  interpolator,
  stations = NULL,
  verbose = getOption("meteoland_verbosity", TRUE)
)

interpolator_calibration(
  interpolator,
  stations = NULL,
  update_interpolation_params = FALSE,
  variable = "MinTemperature",
  N_seq = seq(5, 30, by = 5),
  alpha_seq = seq(0.25, 10, by = 0.25),
  verbose = getOption("meteoland_verbosity", TRUE)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>interpolator</code></td>
<td>
<p>A meteoland interpolator object, as created by
<code>create_meteo_interpolator</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stations</code></td>
<td>
<p>A vector with the stations (numeric for station indexes or
character for stations id) to be used to calculate <code>"MAE"</code>. All
stations with data are included in the training set but predictive
<code>"MAE"</code> are calculated for the stations subset indicated in
<code>stations</code> param only. If <code>NULL</code> all stations are used in the
predictive <code>"MAE"</code> calculation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical indicating if the function must show messages and info.
Default value checks <code>"meteoland_verbosity"</code> option and if not set, defaults
to TRUE. It can be turned off for the function with FALSE, or session wide with
<code>options(meteoland_verbosity = FALSE)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>update_interpolation_params</code></td>
<td>
<p>Logical indicating if the interpolator
object must be updated with the calculated parameters. Default to FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variable</code></td>
<td>
<p>A string indicating the meteorological variable for which
interpolation parameters <code>"N"</code> and <code>"alpha"</code> will be calibrated.
Accepted values are:
</p>

<ul>
<li>
<p><code>MinTemperature</code> (kernel for minimum temperature)
</p>
</li>
<li>
<p><code>MaxTemperature</code> (kernel for maximum temperature)
</p>
</li>
<li>
<p><code>DewTemperature</code> (kernel for dew-temperature (i.e. relative humidity))
</p>
</li>
<li>
<p><code>Precipitation</code> (to calibrate the same
kernel for both precipitation events and regression of precipitation amounts;
not recommended)
</p>
</li>
<li>
<p><code>PrecipitationAmount</code> (kernel for regression of precipitation amounts)
</p>
</li>
<li>
<p><code>PrecipitationEvent</code> (kernel for precipitation events)
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N_seq</code></td>
<td>
<p>Numeric vector with <code>"N"</code> values to be tested</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha_seq</code></td>
<td>
<p>Numeric vector with <code>"alpha"</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Function <code>interpolator_calibration</code> determines optimal interpolation
parameters <code>"N"</code> and <code>"alpha"</code> for a given meteorological
variable. Optimization is done by minimizing mean absolute error ("MAE")
(Thornton <em>et al.</em> 1997). Function
<code>interpolation_cross_validation</code> calculates average mean absolute
errors ("MAE") for the prediction period of the interpolator object. In both
calibration and cross validation procedures, predictions for each
meteorological station are made using a <em>leave-one-out</em> procedure (i.e.
after excluding the station from the predictive set).
</p>


<h3>Value</h3>

<p><code>interpolation_cross_validation</code> returns a list with the
following items
</p>

<ul>
<li>
<p>errors: Data frame with each combination of station and date with
observed variables, predicated variables and the total error
(predicted - observed) calculated for each variable
</p>
</li>
<li>
<p>station_stats: Data frame with error and bias statistics aggregated by
station
</p>
</li>
<li>
<p>dates_stats: Data frame with error and bias statistics aggregated by
date
</p>
</li>
<li>
<p>r2: correlation indexes between observed and predicted values for each
meteorological variable
</p>
</li>
</ul>
<p>If <code>update_interpolation_params</code> is FALSE (default),
<code>interpolator_calibration</code> returns a list with the following items
</p>
 <ul>
<li>
<p>MAE: A numeric matrix with the mean absolute error values,
averaged across stations, for each combination of parameters <code>"N"</code> and
<code>"alpha"</code> </p>
</li>
<li>
<p>minMAE: Minimum MAE value </p>
</li>
<li>
<p>N: Value of parameter
<code>"N"</code> corresponding to the minimum MAE </p>
</li>
<li>
<p>alpha: Value of parameter
<code>"alpha"</code> corresponding the the minimum MAE </p>
</li>
<li>
<p>observed: matrix with
observed values (meteorological measured values) </p>
</li>
<li>
<p>predicted: matrix with
interpolated values for the optimum parameter combination </p>
</li>
</ul>
<p> If
<code>update_interpolation_params</code> is FALSE, <code>interpolator_calibration</code>
returns the interpolator provided with the parameters updated
</p>


<h3>Functions</h3>


<ul><li> <p><code>interpolation_cross_validation()</code>: 
</p>
</li></ul>
<h3>Author(s)</h3>

<p>Miquel De Cáceres Ainsa, EMF-CREAF
</p>
<p>Victor Granda García, EMF-CREAF
</p>


<h3>References</h3>

<p>Thornton, P.E., Running, S.W., 1999. An improved algorithm for
estimating incident daily solar radiation from measurements of temperature,
humidity, and precipitation. Agric. For. Meteorol. 93, 211–228.
doi:10.1016/S0168-1923(98)00126-9.
</p>
<p>De Caceres M, Martin-StPaul N, Turco M, Cabon A, Granda V (2018) Estimating
daily meteorological data and downscaling climate models over landscapes.
Environmental Modelling and Software 108: 186-196.
</p>


<h3>Examples</h3>

<pre><code class="language-R">

# example interpolator
data("meteoland_interpolator_example")

# As the cross validation for all stations can be time consuming, we are
# gonna use only for the first 5 stations of the 198
cv &lt;- interpolation_cross_validation(meteoland_interpolator_example, stations = 1:5)

# Inspect the results
cv$errors
cv$station_stats
cv$dates_stats
cv$r2




# example interpolator
data("meteoland_interpolator_example")

# As the calibration for all stations can be time consuming, we are gonna
# interpolate only for the first 5 stations of the 198 and only a handful
# of parameter combinations
calibration &lt;- interpolator_calibration(
  meteoland_interpolator_example,
  stations = 1:5,
  variable = "MaxTemperature",
  N_seq = seq(10, 20, by = 5),
  alpha_seq = seq(8, 9, by = 0.25)
)

# we can update the interpolator params directly:
updated_interpolator &lt;- interpolator_calibration(
  meteoland_interpolator_example,
  stations = 1:5,
  update_interpolation_params = TRUE,
  variable = "MaxTemperature",
  N_seq = seq(10, 20, by = 5),
  alpha_seq = seq(8, 9, by = 0.25)
)


# check the new interpolator have the parameters updated
get_interpolation_params(updated_interpolator)$N_MaxTemperature
get_interpolation_params(updated_interpolator)$alpha_MaxTemperature


</code></pre>


</div>