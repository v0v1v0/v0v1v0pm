<div class="container">

<table style="width: 100%;"><tr>
<td>smith.penult.fn</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Smith's third penultimate approximation</h2>

<h3>Description</h3>

<p>This function returns the density and distribution functions
of the 3rd penultimate approximation for extremes of Smith (1987). It requires
knowledge of the exact constants <code class="reqn">\epsilon</code> and <code class="reqn">\rho</code> described in the paper.
</p>


<h3>Usage</h3>

<pre><code class="language-R">smith.penult.fn(
  loc,
  scale,
  shape,
  eps,
  rho = NULL,
  method = c("bm", "pot"),
  mdaGumbel = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>loc</code></td>
<td>
<p>location parameter returned by <code>smith.penult</code> or threshold vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>scale parameter returned by <code>smith.penult</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shape</code></td>
<td>
<p>shape parameter returned by <code>smith.penult</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps</code></td>
<td>
<p>parameter vector, see <strong>Details</strong>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>second-order parameter, model dependent</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>one of <code>pot</code> for the generalized Pareto or <code>bm</code> for the generalized extreme value distribution</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mdaGumbel</code></td>
<td>
<p>logical indicating whether the function <code class="reqn">H_{\rho}</code> should be replaced by <code class="reqn">x^3/6</code>; see <strong>Details</strong>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional parameters, currently ignored. These are used for backward compatibility due to a change in the names of the arguments.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Let <code class="reqn">F</code>, <code class="reqn">f</code> denote respectively the distribution and density functions and define the function <code class="reqn">\phi(x)</code>  as
</p>
<p style="text-align: center;"><code class="reqn">\phi(x)=-\frac{F(x)\log F(x)}{f(x)}</code>
</p>

<p>for block maxima.
The sequence <code>loc</code> corresponds to <code class="reqn">b_n</code> otherwise, defined as the solution of <code class="reqn">F(b_n)=\exp(-1/n)</code>.
</p>
<p>The <code>scale</code> is given by <code class="reqn">a_n=\phi(b_n)</code>, the <code>shape</code> as <code class="reqn">\gamma_n=\phi'(b_n)</code>. These are returned by a call to smith.penult.
</p>
<p>For threshold exceedances, <code class="reqn">b_n</code> is replaced by the sequence of thresholds <code class="reqn">u</code> and we
take instead <code class="reqn">\phi(x)</code> to be the reciprocal hazard function <code class="reqn">\phi(x)=(1-F(x))/f(x)</code>.
</p>
<p>In cases where the distribution function is in the maximum domain of
attraction of the Gumbel distribution, <code class="reqn">\rho</code> is possibly undetermined and
<code class="reqn">\epsilon</code> can be equal to <code class="reqn">\phi(b_n)\phi''(b_n)</code>.
</p>
<p>For distributions in the maximum domain of
attraction of the Gumbel distribution and that are class N, it is also possible to abstract from the <code class="reqn">\rho</code> parameter by substituting the function <code class="reqn">H_{\rho}</code> by <code class="reqn">x^3/6</code> without affecting the rate of convergence. This can be done by setting <code>mdaGumbel=TRUE</code> in the function call.
</p>


<h3>Warning</h3>

<p>The third penultimate approximation does not yield a valid distribution function over the whole range of the original distribution, but is rather valid in a neighborhood of the true support of the distribution of maxima/threshold exceedance.
The function handles the most standard failure (decreasing distribution function and negative densities), but any oscillatory behaviour will not necessarily be captured.
This is inherent to the method and can be resolved by ‘not’ evaluating the functions <code class="reqn">F</code> and <code class="reqn">f</code> at the faulty points.
</p>


<h3>References</h3>

<p>Smith, R.L. (1987). Approximations in extreme value theory. <em>Technical report 205</em>, Center for Stochastic Process, University of North Carolina, 1–34.
</p>


<h3>Examples</h3>

<pre><code class="language-R">#Normal maxima example from Smith (1987)
m &lt;- 100 #block of size 100
p &lt;- smith.penult(family='norm',
   ddensF=function(x){-x*dnorm(x)}, method='bm', m=m, returnList=FALSE)
approx &lt;- smith.penult.fn(loc=p[1], scale=p[2], shape=p[3],
   eps=p[3]^2+p[3]+p[2]^2, mdaGumbel=TRUE, method='bm')
x &lt;- seq(0.5,6,by=0.001)
#First penultimate approximation
plot(x, exp(m*pnorm(x, log.p=TRUE)),type='l', ylab='CDF',
main='Distribution of the maxima of\n 100 standard normal variates')
lines(x, mev::pgev(x,loc=p[1], scale=p[2], shape=0),col=2)
lines(x, mev::pgev(x,loc=p[1], scale=p[2], shape=p[3]),col=3)
lines(x, approx$F(x),col=4)
legend(x='bottomright',lty=c(1,1,1,1),col=c(1,2,3,4),
   legend=c('Exact','1st approx.','2nd approx.','3rd approx'),bty='n')
plot(x, m*dnorm(x)*exp((m-1)*pnorm(x,log.p=TRUE)),type='l', ylab='Density',
main='Distribution of the maxima of\n 100 standard normal variates')
lines(x, mev::dgev(x,loc=p[1], scale=p[2], shape=0),col=2)
lines(x, mev::dgev(x,loc=p[1], scale=p[2], shape=p[3]),col=3)
lines(x, approx$f(x),col=4)
legend(x='topright',lty=c(1,1,1,1),col=c(1,2,3,4),
 legend=c('Exact','1st approx.','2nd approx.','3rd approx'),bty='n')

#Threshold exceedances
par &lt;- smith.penult(family = "norm", ddensF=function(x){-x*dnorm(x)},
method='pot', u=4, returnList=FALSE)
approx &lt;- smith.penult.fn(loc=par[1], scale=par[2], shape=par[3],
 eps=par[3]^2+par[3]+par[2]^2, mdaGumbel=TRUE, method='pot')
x &lt;- seq(4.01,7,by=0.01)
#Distribution function
plot(x, 1-(1-pnorm(x))/(1-pnorm(par[1])),type='l', ylab='Conditional CDF',
main='Exceedances over 4\n for standard normal variates')
lines(x, mev::pgp(x, loc=par[1], scale=par[2], shape=0),col=2)
lines(x, mev::pgp(x, loc=par[1], scale=par[2], shape=par[3]),col=3)
lines(x, approx$F(x),col=4)
#Density
plot(x, dnorm(x)/(1-pnorm(par[1])),type='l', ylab='Conditional density',
main='Exceedances over 4\n for standard normal variates')
lines(x, dgp(x, loc=par[1], scale=par[2], shape=0),col=2)
lines(x, dgp(x, loc=par[1], scale=par[2], shape=par[3]),col=3)
lines(x, approx$f(x),col=4)
</code></pre>


</div>