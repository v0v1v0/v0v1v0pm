<div class="container">

<table style="width: 100%;"><tr>
<td>W.diag</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Wadsworth's univariate and bivariate exponential threshold diagnostics</h2>

<h3>Description</h3>

<p>Function to produce diagnostic plots and test statistics for the
threshold diagnostics exploiting structure of maximum likelihood estimators
based on the non-homogeneous Poisson process likelihood
</p>


<h3>Usage</h3>

<pre><code class="language-R">W.diag(
  xdat,
  model = c("nhpp", "exp", "invexp"),
  u = NULL,
  k,
  q1 = 0,
  q2 = 1,
  par = NULL,
  M = NULL,
  nbs = 1000,
  alpha = 0.05,
  plots = c("LRT", "WN", "PS"),
  UseQuantiles = FALSE,
  changepar = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>xdat</code></td>
<td>
<p>a numeric vector of data to be fitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>string specifying whether the univariate or bivariate diagnostic should be used. Either <code>nhpp</code>
for the univariate model, <code>exp</code> (<code>invexp</code>) for the bivariate exponential model with rate (inverse rate) parametrization. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>optional; vector of candidate thresholds.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>number of thresholds to consider (if <code>u</code> unspecified).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q1</code></td>
<td>
<p>lowest quantile for the threshold sequence.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q2</code></td>
<td>
<p>upper quantile limit for the threshold sequence (<code>q2</code> itself is not used as a threshold,
but rather the uppermost threshold will be at the <code class="reqn">(q_2-1/k): q2-1/k</code> quantile).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par</code></td>
<td>
<p>parameters of the NHPP likelihood. If <code>missing</code>, the <code>fit.pp</code> routine will be run to obtain values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M</code></td>
<td>
<p>number of superpositions or 'blocks' / 'years' the process corresponds to (can affect the optimization)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbs</code></td>
<td>
<p>number of simulations used to assess the null distribution of the LRT, and produce the p-value</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>significance level of the LRT</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plots</code></td>
<td>
<p>vector of strings indicating which plots to produce; <code>LRT</code>= likelihood ratio test, <code>WN</code> = white noise, <code>PS</code> = parameter stability. Use <code>NULL</code> if you do not want plots to be produced</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>UseQuantiles</code></td>
<td>
<p>logical; use quantiles as the thresholds in the plot?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>changepar</code></td>
<td>
<p>logical; if <code>TRUE</code>, the graphical parameters (via a call to <code>par</code>) are modified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional parameters passed to <code>plot</code>, overriding defaults including</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function is a wrapper for the univariate (non-homogeneous Poisson process model) and bivariate exponential dependence model.
For the latter, the user can select either the rate or inverse rate parameter  (the inverse rate parametrization  works better for uniformity
of the p-value distribution under the <code>LR</code> test.
</p>
<p>There are two options for the bivariate diagnostic: either provide pairwise minimum of marginally
exponentially distributed margins or provide a <code>n</code> times 2 matrix with the original data, which
is transformed to exponential margins using the empirical distribution function.
</p>


<h3>Value</h3>

<p>plots of the requested diagnostics and an invisible list with components
</p>

<ul>
<li> <p><code>MLE</code>: maximum likelihood estimates from all thresholds
</p>
</li>
<li> <p><code>Cov</code>: joint asymptotic covariance matrix for <code class="reqn">\xi</code>, <code class="reqn">\eta</code> or <code class="reqn">1/\eta</code>.
</p>
</li>
<li> <p><code>WN</code>: values of the white noise process
</p>
</li>
<li> <p><code>LRT</code>: values of the likelihood ratio test statistic vs threshold
</p>
</li>
<li> <p><code>pval</code>: <em>P</em>-value of the likelihood ratio test
</p>
</li>
<li> <p><code>k</code>: final number of thresholds used
</p>
</li>
<li> <p><code>thresh</code>: threshold selected by the likelihood ratio procedure
</p>
</li>
<li> <p><code>qthresh</code>: quantile level of threshold selected by the likelihood ratio procedure
</p>
</li>
<li> <p><code>cthresh</code>: vector of candidate thresholds
</p>
</li>
<li> <p><code>qcthresh</code>: quantile level of candidate thresholds
</p>
</li>
<li> <p><code>mle.u</code>: maximum likelihood estimates for the selected threshold
</p>
</li>
<li> <p><code>model</code>: model fitted
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Jennifer L. Wadsworth
</p>


<h3>References</h3>

<p>Wadsworth, J.L. (2016). Exploiting Structure of Maximum Likelihood Estimators for Extreme Value Threshold Selection, <em>Technometrics</em>, <b>58</b>(1), 116-126, <code>http://dx.doi.org/10.1080/00401706.2014.998345</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
set.seed(123)
# Parameter stability only
W.diag(xdat = abs(rnorm(5000)), model = 'nhpp',
       k = 30, q1 = 0, plots = "PS")
W.diag(rexp(1000), model = 'nhpp', k = 20, q1 = 0)
xbvn &lt;- mvrnorm(n = 6000,
                mu = rep(0, 2),
                Sigma = cbind(c(1, 0.7), c(0.7, 1)))
# Transform margins to exponential manually
xbvn.exp &lt;- -log(1 - pnorm(xbvn))
#rate parametrization
W.diag(xdat = apply(xbvn.exp, 1, min), model = 'exp',
       k = 30, q1 = 0)
W.diag(xdat = xbvn, model = 'exp', k = 30, q1 = 0)
#inverse rate parametrization
W.diag(xdat = apply(xbvn.exp, 1, min), model = 'invexp',
       k = 30, q1 = 0)

## End(Not run)
</code></pre>


</div>