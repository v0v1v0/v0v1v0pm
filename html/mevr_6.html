<div class="container">

<table style="width: 100%;"><tr>
<td>fsmev</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fitting the simplified Metastatistical Extreme Value Distribution (SMEV)</h2>

<h3>Description</h3>

<p>Fit the SMEV distribution to rainfall observations with different estimation methods.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fsmev(
  data,
  threshold = 0,
  method = c("pwm", "mle", "ls"),
  censor = FALSE,
  censor_opts = list(),
  sd = FALSE,
  sd.method = "boot",
  R = 502
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>The data to which the SMEV should be fitted to. <code>data</code> must be a data.frame with two columns. 
The first column must contain dates of class <code>Date</code>, the second or last column must contain the rainfall 
values corresponding to datums in the rows. No negative values are allowed. NA values are removed with a warning.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p>A numeric that is used to define wet days as values &gt; threshold. 
<code class="reqn">data &lt;= threshold</code> is set to NA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Character string describing the method that is used to estimate the 
Weibull parameters c and w. Possible options are probability weighted moments (<code>method='pwm'</code>), 
maximum likelihood (<code>method='mle'</code>) or least squares (<code>method='ls'</code>). 
The <code>default</code> is <code>pwm</code>. (see details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censor</code></td>
<td>
<p>If <code>censor=TRUE</code>, the data series will be left-censored to assure that the observed maxima
are samples from a weibull tail. Defaults to <code>censor=FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censor_opts</code></td>
<td>
<p>An empty list which can be populated with components <code>thresholds</code>, <code>mon</code>, <code>nrtrials</code> and <code>R</code>. 
They give the range of quantiles used as left-censoring threshold, the month with which the block starts, 
the number of trials used to achieve a weibull fit to the left-censored sample, and the number of synthetic samples 
used for the test statistics, respectively. See also <code>weibull_tail_test</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sd</code></td>
<td>
<p>If <code>sd=TRUE</code>, confidence intervals of the SMEV distribution are calculated (see details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sd.method</code></td>
<td>
<p>Currently only a non parametric bootstrap technique can be used to calculate SMEV confidence intervals with <code>sd.method='boot'</code>. The default is <code>sd=FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>The number of samples drawn from the SMEV distribution to calculate the confidence intervals with <code>sd.method='boot'</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The SMEV was introduced by (Marra et al., 2019) as a simplified version of the MEVD 
(Marani and Ignaccolo, 2015) with the assumption of a stationary parent Weibull distribution 
as 
</p>
<p style="text-align: center;"><code class="reqn">F = [1 - exp(-x/C)^w]^n</code>
</p>

<p>for <code class="reqn">w &gt; 0</code> and <code class="reqn">C &gt; 0</code> being the Weibull shape and scale parameter and 
<code class="reqn">n &gt; 0</code> being the mean number of wet days over all years. 
Wet days are defined as rainfall events &gt; threshold. As it was shown by 
e.g. Schellander et al., 2019, probability weighted moments should be preferred over 
maximum likelihood for the estimation of the Weibull parameters w and C. Therefore 
<code>method = 'pwm'</code> is the default.
</p>
<p>Confidence intervals of the SMEV distribution can be calculated using a non parametric 
bootstrap technique. Note that this very slow. 
</p>
<p>This function returns the parameters of the fitted SMEV distribution as well as some 
additional fitting results and input parameters useful for further analysis.
</p>


<h3>Value</h3>

<p>A list of class <code>mevr</code> with components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>c</code></td>
<td>
<p> Single value of the Weibull scale parameter of the SMEV.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p> Single value of the Weibull shape parameter of the SMEV.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p> Mean number of wet events, averaged over all years. Wet events are defined as rainfall &gt; <code>threshold</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>params</code></td>
<td>
<p> A named vector of the fitted parameters. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxima</code></td>
<td>
<p> Maximum values corresponding to each year.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>std</code></td>
<td>
<p> Standard error of fitted parameters (if <code>sd=TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varcov</code></td>
<td>
<p> Covariance matrix of fitted parameters (if <code>sd=TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
 <p><code class="reqn">data &gt;= threshold</code> used to fit the SMEV and additional components which may be useful for further analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>years</code></td>
<td>
<p> Vector of years as YYYY.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>
<p> The chosen threshold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p> Method used to fit the MEVD. Note that <code>method</code> is set to <code>censored lsreg</code> when the data is left-censored
and the weibull tail test is not rejected.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p> The type of distribution ("SMEV")</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Harald Schellander, Alexander Lieb
</p>


<h3>References</h3>

<p>Marra, F. et al. (2019) 'A simplified MEV formulation to model extremes emerging from multiple nonstationary underlying processes', Advances in Water Resources. Elsevier Ltd, 127(April), pp. 280-290. doi: 10.1016/j.advwatres.2019.04.002.
</p>


<h3>See Also</h3>

<p><code>fmev</code>, <code>ftmev</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(dailyrainfall)

fit &lt;- fsmev(dailyrainfall)
fit
plot(fit)

# left censor data prior to fitting
set.seed(123)
sample_dates &lt;- seq.Date(from = as.Date("2000-01-01"), to = as.Date("2020-12-31"), by = 1)
sample_data &lt;- data.frame(dates = sample_dates, val = sample(rnorm(length(sample_dates))))
d &lt;- sample_data |&gt;
  filter(val &gt;= 0 &amp; !is.na(val))

fit &lt;- fsmev(d)
fit_c &lt;- fsmev(d, 
               censor = TRUE, 
               censor_opts = list(thresholds = c(seq(0.5, 0.9, 0.1), 0.95),
                                  mon = 1,
                                  nrtrials = 2,
                                  R = 100))

rp &lt;- 2:100
rl &lt;- return.levels.mev(fit, return.periods = rp)
rl_c &lt;- return.levels.mev(fit_c, return.periods = rp)
plot(sort(pp.weibull(fit$maxima)), sort(fit$maxima))
lines(rl$rp, rl$rl)
lines(rl_c$rp, rl_c$rl, col = "red")


</code></pre>


</div>