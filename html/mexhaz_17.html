<div class="container">

<table style="width: 100%;"><tr>
<td>riskfunc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Computation of hazard ratio and risk ratio estimates based on a mexhaz
model</h2>

<h3>Description</h3>

<p>Function for computing hazard ratio and risk ratio (ratio
of cumulative probabilities of failure) estimates from a model fitted
with the <code>mexhaz</code> function. Corresponding confidence intervals
are based on the Delta Method or Monte Carlo simulation (based on the
assumption of multivariate normality of the model parameter
estimates). This function allows the computation of estimates at one
time point for several vectors of covariates or for one vector of
covariates at several time points.  When the model includes a random effect, three types of
predictions can be made: (i) marginal predictions (obtained by
integration over the random effect distribution), (ii) cluster-specific
posterior predictions for an existing cluster, or (iii) conditional
predictions for a given quantile of the random effect distribution (by
default, for the median value, that is, 0).</p>


<h3>Usage</h3>

<pre><code class="language-R">riskfunc(object, time.pts, data, data.0, marginal = TRUE, quant.rdm = 0.5,
cluster = NULL, quant.rdm.0 = 0.5, cluster.0 = NULL, type = c("hr", "rr"),
conf.int = c("delta", "simul"), level = 0.95, nb.sim = 10000, seed = NULL,
dataset = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>an object of class <code>mexhaz</code>, corresponding to a
hazard-based regression model fitted with the <code>mexhaz</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time.pts</code></td>
<td>
<p>a vector of numerical values representing the time
points at which predictions are requested. Time values greater than
the maximum follow-up time on which the model estimation was based
are discarded.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a <code>data.frame</code> containing the values of the
covariates of the population for which hazard ratios or risk ratios
are to be calculated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data.0</code></td>
<td>
<p>a <code>data.frame</code> containing the values of the
covariates of the reference population. Each row of <code>data.0</code> is
used as the reference for the corresponding row of <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>marginal</code></td>
<td>
<p>logical value controlling the type of predictions
returned by the function when the model includes a random
intercept. When <code>TRUE</code>, marginal predictions are computed. The
marginal survival is obtained by integrating the predicted survival
over the distribution of the random effect. When <code>FALSE</code>
(default value), conditional predictions depending on the value of
the <code>cluster</code> argument are calculated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quant.rdm</code></td>
<td>
<p>numerical value (between 0 and 1) specifying the
quantile of the random effect distribution that should be used when
requesting conditional predictions. The default value is set to 0.5
(corresponding to the median, that is a value of the random effect
of 0). This argument is ignored if the model is a fixed effect
model, when the <code>marginal</code> argument is set to <code>TRUE</code>, or
the <code>cluster</code> argument is not <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster</code></td>
<td>
<p>a single value corresponding to the name of the cluster for
which posterior predictions should be calculated. These predictions
are obtained by integrating over the cluster-specific posterior
distribution of the random effect and thus require the original
dataset. The dataset can either be provided as part of the
<code>mexhaz</code> object given as argument or by specifying the name of
the dataset in the <code>dataset</code> argument (see below). The
<code>cluster</code> argument is not used if the model is a fixed effect
model. The default value is <code>NULL</code>: this corresponds to
marginal predictions (if <code>marginal</code> is set to <code>TRUE</code>, the preferred
option), or to conditional predictions for a given quantile (by
default, the median) of the distribution of the random
effect (if <code>marginal</code> is set to <code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quant.rdm.0</code></td>
<td>
<p>random effect distribution quantile value to be used with <code>data.0</code> (see
argument <code>quant.rdm</code> for details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster.0</code></td>
<td>
<p>cluster value to be used with <code>data.0</code> (see
argument <code>cluster</code> for details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>argument specifying the type of predictions to be
calculated. Selection can be made between <code>"hr"</code> (hazard ratio)
and <code>"rr"</code> (risk ratio, i.e., ratio of cumulative failure
probabilities).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int</code></td>
<td>
<p>method to be used to compute confidence
limits. Selection can be made between the following options:
<code>"delta"</code> for the Delta Method (default value);
<code>"simul"</code> for Monte Carlo simulations (can be time-consuming,
especially for models using B-splines for the logarithm of the
baseline hazard).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>a number in (0,1) specifying the level of confidence for
computing the confidence intervals of the hazard and the
survival. By default, this argument is set to <code>0.95</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nb.sim</code></td>
<td>
<p>integer value representing the number of simulations
used to estimate the confidence limits for the (excess) hazard
and the (net) survival. This argument is used only if
<code>conf.int</code> is set to <code>"simul"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>argument allowing the user to set a random seed for
simulations (only relevant when <code>conf.int</code> is set to
<code>"simul"</code>). The default value is set to <code>NULL</code> in which case
a random seed is automatically generated inside the function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>original dataset used to fit the <code>mexhaz</code> object
given as argument to the function. This argument is only necessary
if cluster-specific posterior predictions are requested (and if the
dataset is not already provided in the <code>mexhaz</code> object). The
default value is set to <code>NULL</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>resMexhaz</code> that can be used by the function
<code>plot.resMexhaz</code> to produce graphics
of the hazard ratio or risk ratio curve. It contains the following
elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>results</code></td>
<td>
<p>a <code>data.frame</code> consisting of: the time points at
which values have been calculated; the
hazard ratio / risk ratio values with their confidence limits.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>type of results returned by the function. The value is
used by <code>plot.resMexhaz</code> and <code>lines.resMexhaz</code>, and can take
the values <code>"hr"</code> (hazard ratio) or <code>"rr"</code> (risk ratio).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>multiobs</code></td>
<td>
<p>value used by
<code>plot.resMexhaz</code> and <code>lines.resMexhaz</code>, and set to
<code>FALSE</code> when estimates are computed at several time
points for one vector of covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.method</code></td>
<td>
<p>method used to compute confidence limits.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>level of confidence used to compute confidence limits.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Hadrien Charvat, Aurelien Belot
</p>


<h3>References</h3>

<p>Charvat H, Remontet L, Bossard N, Roche L, Dejardin O,
Rachet B, Launoy G, Belot A; CENSUR Working Survival Group. A
multilevel excess hazard model to estimate net survival on
hierarchical data allowing for non-linear and non-proportional effects
of covariates. Stat Med 2016;35:3066-3084 (doi: 10.1002/sim.6881)
</p>
<p>Skrondal A, Rabe-Hesketh S. Prediction in multilevel generalized
linear models. J R Stat Soc A Stat Soc 2009;172(3):659-687 (doi: 10.1111/j.1467-985X.2009.00587.x).
</p>


<h3>See Also</h3>

<p><code>plot.resMexhaz</code>, <code>lines.resMexhaz</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data(simdatn1)

## Fit of a fixed-effect hazard model, with the baseline hazard
## described by a linear B-spline with two knots at 1 and 5 year and with
## effects of age (agecr), deprivation index (depindex) and sex (IsexH)

Mod_bs1_2 &lt;- mexhaz(formula=Surv(time=timesurv,
event=vstat)~agecr+depindex+IsexH, data=simdatn1, base="exp.bs",
degree=1, knots=c(1,5), verbose=0)

## Risk ratio along time for agecr=0.2 compared to agecr=0.1

RR_Modbs1_2 &lt;- riskfunc(Mod_bs1_2, time.pts=seq(0,10,le=101),
data=data.frame(agecr=0.2,depindex=0,IsexH=1),
data.0=data.frame(agecr=0.1,depindex=0,IsexH=1),type="rr",
conf.int="delta")

plot(RR_Modbs1_2)

</code></pre>


</div>