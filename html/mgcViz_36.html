<div class="container">

<table style="width: 100%;"><tr>
<td>l_gridQCheck2D</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Binning and checking QGAM residuals</h2>

<h3>Description</h3>

<p>This layer bins the residuals, r, according to the value of the corresponding
covariates, x1 and x2. Then we calculate the proportion of negative residuals
in each bin, which should not deviate too much from the theoretical proportion (eg 0.5 if
we fit the median). Mainly useful in conjuction with check2D.
</p>


<h3>Usage</h3>

<pre><code class="language-R">l_gridQCheck2D(qu = NULL, bw = c(NA, NA), stand = TRUE, binFun = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>qu</code></td>
<td>
<p>the quantile of interest. Should be in (0, 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bw</code></td>
<td>
<p>numeric vector giving bin width in the vertical and horizontal directions. See the <code>binwidth</code>
arguments in <code>?ggplot2::stat_summary_hex</code>. If left to <code>NA</code>, it will be set to 1/20
of the ranges of x1 and x2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stand</code></td>
<td>
<p>if left to <code>TRUE</code> then the observed proportion of negative residuals <code>p_hat</code> in the i-th cell
is normalized using the standard error <code>se = sqrt(qu(1-qu)/n)</code>, where <code>n</code> is the number of
observation in that cell. That is, if <code>stand=TRUE</code> we plot <code>(p_hat-qu)/se</code> rather than
simply <code>p_hat</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>binFun</code></td>
<td>
<p>the <code>ggplot2</code> function used to perform the binning. By default it
is either ggplot2::stat_summary_2d or ggplot2::stat_summary_hex, depending
on the class of the covariates x1 and x2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>graphical arguments to be passed to <code>ggplot2::stat_summary_hex</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>gamLayer</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(mgcViz);
set.seed(4124)
n &lt;- 4e2 
dat &lt;- data.frame(x = rnorm(n), y = rnorm(n))

# Simulate some data, residuals are heteroscedastic w.r.t. x
dat$ob &lt;- (dat$x)^2 + (dat$y)^2 + (0.2*abs(dat$x) + 1)  * rnorm(n)
b &lt;- qgamV(ob ~ x + s(y), qu = 0.3, data = dat)

# We have a residual pattern along x (increase n above to 
# see the problem more clearly) 
check2D(b, "x", "y") + l_gridQCheck2D(qu = 0.3, bw = c(0.4, 0.4))

# We need a smooth wrt x to make the pattern disappear
## Not run: 
b1 &lt;- qgamV(ob ~ s(x) + s(y), qu = 0.3, data = dat)
 
check2D(b1, "x", "y") + l_gridQCheck2D(qu = 0.3, bw = c(0.4, 0.4))

## End(Not run)

</code></pre>


</div>