<div class="container">

<table style="width: 100%;"><tr>
<td>do.many.wqs</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Performing Many WQS Regressions</h2>

<h3>Description</h3>

<p>Second Stage of Multiple Imputation:  In order to analyze a complete imputed chemical array (<code>X.imputed</code>), _n_ subjects by _C_ chemicals by _K_ imputations) via weighted quantile sum regression, <code>do.many.wqs</code>() repeatedly performs the same WQS analysis on each imputed dataset. It repeatedly executes the <code>estimate.wqs</code>() function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">do.many.wqs(y, X.imputed, Z = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>Outcome: numeric vector or factor. Assumed to be complete, and missing outcomes are ignored. Assumed to follow an exponential family distribution given in <code>family</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X.imputed</code></td>
<td>
<p>Array of complete components with n subjects and C components and K imputations. Must be complete.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p>Any covariates used. Ideally, a numeric matrix, but Z can be a factor, vector or data-frame. Assumed to be complete; observations with missing covariate values are ignored with a warning printed. If none, enter NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to <code>estimate.wqs</code>, but the arguments y, X, Z, and place.bdls.Q1 have no effect.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a list with elements that consist of matrix and list versions of <code>estimate.wqs()</code> output: </p>

<ul>
<li>
<p> call: the function call, processed by <span class="pkg">rlist</span>.
</p>
</li>
<li>
<p> C:  the number of chemicals in mixture, number of columns in X.
</p>
</li>
<li>
<p> n: the sample size.
</p>
</li>
<li>
<p> wqs.imputed.estimates: Array with rows = # of parameters, 2 columns = mean and standard deviation, and 3rd dimension = K.
</p>
</li>
<li>
<p> AIC: The overall fit of WQS models taken as the mean AIC and standard error across all imputation models. Saved as a character element.  Calling wqs.fit allows us to see all models.
</p>
</li>
<li>
<p> train.index: Observations that are selected to train the data in the last WQS model.
</p>
</li>
<li>
<p> q.train: Vector of quantiles used in training data from the last WQS model
</p>
</li>
<li>
<p> train.comparison: A list of data-frames that compares the training and validation dataset for all WQS models.
</p>
</li>
<li>
<p> initial: Matrix with K columns that contains the initial values used for each WQS analysis.
</p>
</li>
<li>
<p> wqs.train.estimates: Data-frame with rows = B. Summarizes statistics from nonlinear regression in the training datasets of all analyses: </p>

<dl>
<dt>beta1</dt>
<dd>
<p>estimate using solnp</p>
</dd>
<dt>beta1_glm, SE_beta1, test_stat, pvalue</dt>
<dd>
<p>estimates of WQS parameter in model using glm2.</p>
</dd>
<dt>convergence</dt>
<dd>
<p>whether or not the samples have converged</p>
</dd>
<dt>weight estimates</dt>
<dd>
<p>estimates of weight for each bootstrap.</p>
</dd>
<dt>imputed</dt>
<dd>
<p>A number indicating the completed dataset used in WQS analysis.</p>
</dd>
</dl>
</li>
<li>
<p> wqs.fit: A list (length = K) of glm2 objects of the WQS model fit to validation data. These are all the WQS estimates for all analyses. See <code>glm2</code>.
</p>
</li>
</ul>
<h3>Note</h3>

<p>Note #1: We only impute the missing values of the components, X. Any missing data in the outcome and covariates are removed and ignored.
</p>
<p>Note #2: No seed is set in this function. Because bootstraps and splitting is random,  a seed should be set before every use.
</p>
<p>Note #3: If there is one imputed dataset, use the <code>estimate.wqs</code> function as <code>do.many.wqs</code> is not necessary.
</p>


<h3>See Also</h3>

<p>Other wqs: 
<code>analyze.individually()</code>,
<code>coef.wqs()</code>,
<code>estimate.wqs.formula()</code>,
<code>estimate.wqs()</code>,
<code>make.quantile.matrix()</code>,
<code>plot.wqs()</code>,
<code>print.wqs()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data("simdata87")
# Create 2 multiple imputed datasets using bootstrapping, but only use first 2 chemicals.
set.seed(23234)
l &lt;- impute.boot(
  X = simdata87$X.bdl[, 1:2], DL = simdata87$DL[1:2],
  Z = simdata87$Z.sim[, 1], K = 2
)
# Perform WQS regression on each imputed dataset
set.seed(50679)
bayes.wqs &lt;- do.many.wqs(
  y = simdata87$y.scenario, X.imputed = l$X.imputed,
  Z = simdata87$Z.sim,
  B = 10, family = "binomial"
)
bayes.wqs$wqs.imputed.estimates



# #' @importFrom scales ordinal
</code></pre>


</div>