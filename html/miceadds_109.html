<div class="container">

<table style="width: 100%;"><tr>
<td>mice_imputation_2l_lmer</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Imputation of a Continuous or a Binary Variable From a Two-Level Regression Model
using <span class="pkg">lme4</span> or <span class="pkg">blme</span>
</h2>

<h3>Description</h3>

<p>The function <code>mice.impute.2l.continuous</code>
imputes values of continuous variables with a linear
mixed effects model using <code>lme4::lmer</code> or
<code>blme::blmer</code>.
The <code>lme4::lmer</code> or
<code>blme::blmer</code> function is also
used for predictive mean matching where the match is based
on predicted values which contain the fixed and (sampled)
random effects. Binary variables can be imputed
from a two-level logistic regression model
fitted with the <code>lme4::glmer</code> or
<code>blme::bglmer</code> function.
See Snijders and Bosker (2012) and Zinn (2013) for details.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mice.impute.2l.continuous(y, ry, x, type, intercept=TRUE,
    groupcenter.slope=FALSE, draw.fixed=TRUE, random.effects.shrinkage=1E-6,
    glmer.warnings=TRUE, blme_use=FALSE, blme_args=NULL, ... )

mice.impute.2l.pmm(y, ry, x, type, intercept=TRUE,
    groupcenter.slope=FALSE, draw.fixed=TRUE, random.effects.shrinkage=1E-6,
    glmer.warnings=TRUE, donors=5, match_sampled_pars=TRUE,
    blme_use=FALSE, blme_args=NULL, ... )

mice.impute.2l.binary(y, ry, x, type, intercept=TRUE,
    groupcenter.slope=FALSE, draw.fixed=TRUE, random.effects.shrinkage=1E-6,
    glmer.warnings=TRUE, blme_use=FALSE, blme_args=NULL, ... )
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>

<p>Incomplete data vector of length <code>n</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ry</code></td>
<td>

<p>Vector of missing data pattern (<code>FALSE</code> – missing,
<code>TRUE</code> – observed)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>Matrix (<code>n</code> x <code>p</code>) of complete predictors.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Type of predictor variable. The cluster identifier
has type <code>-2</code>, fixed effects predictors without a random slope
type <code>1</code> and predictors with fixed effects and random effects
have type <code>2</code>. If the cluster mean should be included for a covariate,
<code>3</code> should be chosen. The specification <code>4</code> includes the cluster mean,
the fixed effect and the random effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>

<p>Optional logical indicating whether the intercept should be included.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groupcenter.slope</code></td>
<td>
<p>Optional logical indicating whether covariates
should be centered around group means</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draw.fixed</code></td>
<td>
<p>Optional logical indicating whether fixed effects
parameter should be randomly drawn</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.effects.shrinkage</code></td>
<td>
<p>Shrinkage parameter for stabilizing the
covariance matrix of random effects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>glmer.warnings</code></td>
<td>
<p>Optional logical indicating whether warnings from
<code>glmer</code> should be displayed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blme_use</code></td>
<td>
<p>Logical indicating whether the <span class="pkg">blme</span>
package should be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blme_args</code></td>
<td>
<p>(Prior) Arguments for <span class="pkg">blme</span>, see
<code>blme::blmer</code> and
<code>blme::bmerDist-class</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>donors</code></td>
<td>
<p>Number of donors used for predictive mean matching</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>match_sampled_pars</code></td>
<td>
<p>Logical indicating whether values of nearest
neighbors should also be sampled in pmm imputation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Further arguments to be passed
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A vector of length <code>nmis=sum(!ry)</code> with imputed values.
</p>


<h3>References</h3>

<p>Snijders, T. A. B., &amp; Bosker, R. J. (2012). <em>Multilevel analysis:
An introduction to basic and advanced multilevel modeling</em>.
Thousand Oaks, CA: Sage.
</p>
<p>Zinn, S. (2013). <em>An imputation model for multilevel binary data</em>.
NEPS Working Paper No 31.
</p>


<h3>See Also</h3>

<p>See <code>mice.impute.ml.lmer</code> for imputation for datasets with more than
two levels (e.g., three-level datasets or cross-classified datasets).
</p>
<p>Variables at a higher level (e.g. at level 2) can be imputed using <code>2lonly</code>
functions, for example the
<code>mice::mice.impute.2lonly.norm</code> function
in the <span class="pkg">mice</span> package or the general <code>mice.impute.2lonly.function</code>
function in the <span class="pkg">miceadds</span> package which using an already defined imputation
method at level 1. If a level-2 variable for 3-level data should be imputed,
then <code>mice.impute.ml.lmer</code> can also be used to impute this variable
with a two-level imputation model in which level 1 corresponds to the original
level-2 units and level 2 corresponds to the original level-3 units.
</p>
<p>See <code>mice::mice.impute.2l.norm</code> and
<code>mice::mice.impute.2l.pan</code> for
imputation functions in the <span class="pkg">mice</span> package under fully conditional
specification for normally distributed variables. The function
<code>mice::mice.impute.2l.norm</code> allows for
residual variances which are allowed to vary across groups while
<code>mice::mice.impute.2l.pan</code> assumes
homogeneous residual variances.
</p>
<p>The <span class="pkg">micemd</span> package provides further imputation methods for the <span class="pkg">mice</span>
package for imputing multilevel data with fully conditional specification. The
function <code>micemd::mice.impute.2l.jomo</code>
has similar functionality like <code>mice::mice.impute.2l.pan</code>
and imputes normally distributed two-level data with a Bayesian MCMC approach,
but relies on the <span class="pkg">jomo</span> package instead of the <span class="pkg">pan</span> package.
The functions <code>mice::mice.impute.2l.lmer</code> and
<code>micemd::mice.impute.2l.glm.norm</code>
have similar functionality like <code>mice.impute.2l.continuous</code>
and imputes normally distributed two-level data. The function
<code>{micemd::mice.impute.2l.glm.bin}</code>
has similar functionality like <code>mice.impute.2l.binary</code>
and imputes binary two-level data.
</p>
<p>The <span class="pkg">hmi</span> package imputes single-level and multilevel data and is also
based on fully conditional specification. The package relies on the
MCMC estimation implemented in the <span class="pkg">MCMCglmm</span> package. The imputation procedure
can be run with the <code>hmi::hmi</code> function.
</p>
<p>See the <span class="pkg">pan</span> (<code>pan::pan</code>)
and the <span class="pkg">jomo</span> (<code>jomo::jomo</code>)
package for joint multilevel imputation. See
<code>mitml::panImpute</code> and
<code>mitml::jomoImpute</code> for
wrapper functions to these packages in the <span class="pkg">mitml</span>
package.
</p>
<p>Imputation by chained equations can also be conducted in blocks of multivariate
conditional distributions since <span class="pkg">mice</span> 3.0.0 (see the <code>blocks</code>
argument in <code>mice::mice</code>). The
<code>mitml::panImpute</code> and
<code>mitml::jomoImpute</code> functions can be used
with <code>mice::mice</code> by specifying imputation
methods <code>"panImpute"</code>
(see <code>mice::mice.impute.panImpute</code>)) and
<code>"jomoImpute"</code>
(see <code>mice::mice.impute.jomoImpute</code>)).
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
#############################################################################
# EXAMPLE 1: Imputation of a binary variable
#############################################################################

#--- simulate missing values
set.seed(976)
G &lt;- 30        # number of groups
n &lt;- 8        # number of persons per group
iccx &lt;- .2    # intra-class correlation X
iccy &lt;- .3    # latent intra-class correlation binary outcome
bx &lt;- .4    # regression coefficient
threshy &lt;- stats::qnorm(.70)  # threshold for y
x &lt;- rep( rnorm( G, sd=sqrt( iccx) ), each=n )  +
            rnorm(G*n, sd=sqrt( 1 - iccx) )
y &lt;- bx * x + rep( rnorm( G, sd=sqrt( iccy) ), each=n )  +
                rnorm(G*n, sd=sqrt( 1 - iccy) )
y &lt;- 1 * ( y &gt; threshy )
dat &lt;- data.frame( group=100+rep(1:G, each=n), x=x, y=y )

#* create some missings
dat1 &lt;- dat
dat1[ seq( 1, G*n, 3 ),"y" ]  &lt;- NA
dat1[ dat1$group==2, "y" ] &lt;- NA

#--- prepare imputation in mice
vars &lt;- colnames(dat1)
V &lt;- length(vars)
#* predictor matrix
predmat &lt;- matrix( 0, nrow=V, ncol=V)
rownames(predmat) &lt;- colnames(predmat) &lt;- vars
predmat["y", ] &lt;- c(-2,2,0)
#* imputation methods
impmeth &lt;- rep("",V)
names(impmeth) &lt;- vars
impmeth["y"] &lt;- "2l.binary"

#** imputation with logistic regression ('2l.binary')
imp1 &lt;- mice::mice( data=as.matrix(dat1), method=impmeth,
                predictorMatrix=predmat, maxit=1, m=5 )

#** imputation with predictive mean matching ('2l.pmm')
impmeth["y"] &lt;- "2l.pmm"
imp2 &lt;- mice::mice( data=as.matrix(dat1), method=impmeth,
                predictorMatrix=predmat, maxit=1, m=5 )

#** imputation with logistic regression using blme package
blme_args &lt;- list( "cov.prior"="invwishart")
imp3 &lt;- mice::mice( data=as.matrix(dat1), method=impmeth,
                predictorMatrix=predmat, maxit=1, m=5,
                blme_use=TRUE, blme_args=blme_args )

## End(Not run)
</code></pre>


</div>