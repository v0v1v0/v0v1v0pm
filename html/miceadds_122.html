<div class="container">

<table style="width: 100%;"><tr>
<td>mice.impute.ml.lmer</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Multilevel Imputation Using <span class="pkg">lme4</span>
</h2>

<h3>Description</h3>

<p>This function is a general imputation function based on the linear mixed effects
model as implemented in <code>lme4::lmer</code>. The imputation model can be hierarchical
or non-hierarchical and can be written in a general form
<code class="reqn">\bold{y}=\bold{X} \bold{\beta} + \sum_{v=1}^V \bold{Z}_v \bold{u}_v</code> for <code class="reqn">V</code>
multivariate random effects. While predictors can be selected by specifying the rows
in the predictor matrix in <code>mice::mice</code> (i.e., modification of <code>type</code>),
the level of random effects can be specified with <code>levels_id</code> and random slopes
can be selected with <code>random_slopes</code>.
</p>
<p>The function <code>mice.impute.ml.lmer</code> allows the imputation of variables at
arbitrary levels. The corresponding level can be specified with <code>levels_id</code>.
All predictor variables are aggregated to the corresponding level of the variable
to be imputed.
</p>
<p>Several strategies for the specification of the design
matrix <code class="reqn">\bold{X}</code> are accommodated. By default, predictors at a lower level
are automatically aggregated to the higher level and included as further
predictors to maintain the multilevel structure in the data (Grund, Luedtke &amp; Robitzsch,
2018; Enders, Mistler &amp; Keller, 2016; argument <code>aggregate_automatically=TRUE</code>). Further,
interactions and quadratic effects can be defined by respective arguments
<code>interactions</code> and <code>quadratics</code>. The dimension
of the matrix of predictors can be reduced by applying partial least squares regression,
see <code>mice.impute.pls</code>.
</p>
<p>The function now only allows continuous data (<code>model="continuous"</code>),
ordinal data (<code>model="pmm"</code>) or
binary data (<code>model="pmm"</code> or <code>model="binary"</code>). Nominal variables with
missing values cannot (yet) be handled.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mice.impute.ml.lmer(y, ry, x, type, levels_id, variables_levels=NULL,
    random_slopes=NULL, aggregate_automatically=TRUE, intercept=TRUE,
    groupcenter.slope=FALSE, draw.fixed=TRUE, random.effects.shrinkage=1e-06,
    glmer.warnings=TRUE, model="continuous", donors=3, match_sampled_pars=FALSE,
    blme_use=FALSE, blme_args=NULL, pls.facs=0, interactions=NULL,
    quadratics=NULL, min.int.cor=0, min.all.cor=0, pls.print.progress=FALSE,
    group_index=NULL, iter_re=0, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>

<p>Incomplete data vector of length <code>n</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ry</code></td>
<td>

<p>Vector of missing data pattern (<code>FALSE</code> – missing,
<code>TRUE</code> – observed)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>Matrix (<code>n</code> <code class="reqn">\times</code> <code>p</code>) of complete predictors.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Predictor variables associated with fixed effects.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>levels_id</code></td>
<td>

<p>Specification of the level identifiers (see Examples)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variables_levels</code></td>
<td>

<p>Specification of the level of variables (see Examples)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random_slopes</code></td>
<td>

<p>Specification of random slopes (see Examples)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggregate_automatically</code></td>
<td>

<p>Logical indicating whether aggregated effects at higher levels are automatically
included.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>

<p>Optional logical indicating whether the intercept should be included.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groupcenter.slope</code></td>
<td>
<p>Optional logical indicating whether covariates
should be centered around group means</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draw.fixed</code></td>
<td>
<p>Optional logical indicating whether fixed effects
parameter should be randomly drawn</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.effects.shrinkage</code></td>
<td>
<p>Shrinkage parameter for stabilizing the
covariance matrix of random effects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>glmer.warnings</code></td>
<td>
<p>Optional logical indicating whether warnings from
<code>glmer</code> should be displayed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>

<p>Type of model. Can be <code>"continuous"</code> for normally distributed data,
<code>"binary"</code> for dichotomous data specifying a logistic mixed effects model
and <code>"pmm"</code> for predictive mean matching.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>donors</code></td>
<td>
<p>Number of donors used for predictive mean matching</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>match_sampled_pars</code></td>
<td>
<p>Logical indicating whether values of nearest
neighbors should also be sampled in pmm imputation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blme_use</code></td>
<td>
<p>Logical indicating whether the <span class="pkg">blme</span>
package should be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blme_args</code></td>
<td>
<p>(Prior) Arguments for <span class="pkg">blme</span>, see
<code>blme::blmer</code> and
<code>blme::bmerDist-class</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pls.facs</code></td>
<td>

<p>Number of factors used in PLS dimension reduction
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interactions</code></td>
<td>

<p>Specification of predictors with interaction effects
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadratics</code></td>
<td>

<p>Specification of predictors with quadratic effects
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.int.cor</code></td>
<td>

<p>Minimum absolute value of correlation with outcome for interaction effects to be retained
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.all.cor</code></td>
<td>

<p>Minimum absolute value of correlation with outcome for predictors to be retained
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pls.print.progress</code></td>
<td>

<p>Logical indicating whether progress of algorithm should be displayed
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group_index</code></td>
<td>
<p>Optional vector for group identifiers (internally used
in <code>mice.impute.bygroup</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter_re</code></td>
<td>
<p>Number of iterations for sampling random effects in random intercept
models for continuous outcomes. Using <code>iter_re&gt;0</code> is necessary for cross-classified
models with not fully balanced designs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Further arguments to be passed
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Vector of imputed values
</p>


<h3>References</h3>

<p>Enders, C. K., Mistler, S. A., &amp; Keller, B. T. (2016). Multilevel multiple imputation:
A review and evaluation of joint modeling and chained equations imputation.
<em>Psychological Methods, 21</em>(2), 222-240.
<a href="https://doi.org/10.1037/met0000063">doi:10.1037/met0000063</a>
</p>
<p>Grund, S., Luedtke, O., &amp; Robitzsch, A. (2018). Multiple imputation of multilevel
data in organizational research. <em>Organizational Research Methods, 21</em>(1), 111-149.
<a href="https://doi.org/10.1177/1094428117703686">doi:10.1177/1094428117703686</a>
</p>


<h3>See Also</h3>

<p>See <code>mice.impute.2l.continuous</code> for two-level imputation in <span class="pkg">mice</span> and
for several links to other packages which enable multilevel imputation.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
#############################################################################
# EXAMPLE 1: Imputation of three-level data with normally distributed residuals
#############################################################################

data(data.ma07, package="miceadds")
dat &lt;- data.ma07

# variables at level 1 (identifier id1): x1 (some missings), x2 (complete)
# variables at level 2 (identifier id2): y1 (some missings), y2 (complete)
# variables at level 3 (identifier id3): z1 (some missings), z2 (complete)

#****************************************************************************
# Imputation model 1

#----- specify levels of variables (only relevent for variables
#      with missing values)
variables_levels &lt;- miceadds:::mice_imputation_create_type_vector( colnames(dat), value="")
 # leave variables at lowest level blank (i.e., "")
variables_levels[ c("y1","y2") ] &lt;- "id2"
variables_levels[ c("z1","z2") ] &lt;- "id3"

#----- specify predictor matrix
predmat &lt;- mice::make.predictorMatrix(data=dat)
predmat[, c("id2", "id3") ] &lt;- 0
# set -2 for cluster identifier for level 3 variable z1
# because "2lonly" function is used
predmat[ "z1", "id3" ] &lt;- -2

#----- specify imputation methods
method &lt;- mice::make.method(data=dat)
method[c("x1","y1")] &lt;- "ml.lmer"
method[c("z1")] &lt;- "2lonly.norm"

#----- specify hierarchical structure of imputation models
levels_id &lt;- list()
#** hierarchical structure for variable x1
levels_id[["x1"]] &lt;- c("id2", "id3")
#** hierarchical structure for variable y1
levels_id[["y1"]] &lt;- c("id3")

#----- specify random slopes
random_slopes &lt;- list()
#** random slopes for variable x1
random_slopes[["x1"]] &lt;- list( "id2"=c("x2"), "id3"=c("y1") )
# if no random slopes should be specified, the corresponding entry can be left empty
# and only a random intercept is used in the imputation model

#----- imputation in mice
imp1 &lt;- mice::mice( dat, maxit=10, m=5, method=method,
            predictorMatrix=predmat, levels_id=levels_id,  random_slopes=random_slopes,
            variables_levels=variables_levels )
summary(imp1)

#****************************************************************************
# Imputation model 2

#----- impute x1 with predictive mean matching and y1 with normally distributed residuals
model &lt;- list(x1="pmm", y1="continuous")

#----- assume only random intercepts
random_slopes &lt;- NULL

#---- create interactions with z2 for all predictors in imputation models for x1 and y1
interactions &lt;- list("x1"="z2", "y1"="z2")

#----- imputation in mice
imp2 &lt;- mice::mice( dat, method=method, predictorMatrix=predmat,
                levels_id=levels_id, random_slopes=random_slopes,
                variables_levels=variables_levels, model=model, interactions=interactions)
summary(imp2)

## End(Not run)
</code></pre>


</div>