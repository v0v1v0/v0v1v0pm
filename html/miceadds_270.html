<div class="container">

<table style="width: 100%;"><tr>
<td>with.miceadds</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Evaluates an Expression for (Nested) Multiply Imputed Datasets
</h2>

<h3>Description</h3>

<p>Evaluates an expression for (nested) multiply imputed datasets. These
functions extend the following functions:
<code>mice::with.mids</code>,
<code>base::with</code>,
<code>base::within.data.frame</code>,
<code>mitools::with.imputationList</code>.
</p>
<p>The <code>withPool</code> functions try to pool estimates (by simple averaging)
obtained by <code>with</code> or a list of results of imputed datasets.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'mids.1chain'
with(data, expr, ...)
## S3 method for class 'datlist'
with(data, expr, fun, ...)

## S3 method for class 'mids.nmi'
with(data, expr, ...)
## S3 method for class 'nested.datlist'
with(data, expr, fun, ...)
## S3 method for class 'NestedImputationList'
with(data, expr, fun, ...)

## S3 method for class 'datlist'
within(data, expr, ...)
## S3 method for class 'imputationList'
within(data, expr, ...)

## S3 method for class 'nested.datlist'
within(data, expr, ...)
## S3 method for class 'NestedImputationList'
within(data, expr, ...)

withPool_MI(x, ...)

withPool_NMI(x, ...)

## S3 method for class 'mira.nmi'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>Object of class <code>mids.1chain</code>, <code>mids.nmi</code>, <code>imputationList</code>
or <code>NestedImputationList</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expr</code></td>
<td>

<p>Expression with a formula object.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>A function taking a data frame argument</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Additional parameters to be passed to <code>expr</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>Object of class <code>mira.nmi</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>List with vectors or matrices as results of an analysis
for (nested) multiply imputed datasets.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>with.mids.1chain</code>: List of class <code>mira</code>.
</p>
<p><code>with.mids.nmi</code>: List of class <code>mira.nmi</code>.
</p>
<p><code>with.datlist</code>: List of class <code>imputationResultList</code>.
</p>
<p><code>with.NestedImputationList</code> or <code>with.nested.datlist</code>: List of class
<code>NestedImputationResultList</code>.
</p>
<p><code>within.imputationList</code>: List of class <code>imputationList</code>.
</p>
<p><code>within.NestedImputationList</code>: List of class
<code>NestedImputationList</code>.
</p>
<p><code>withPool_MI</code> or <code>withPool_NMI</code>: Vector or matrix with
pooled estimates
</p>


<h3>Author(s)</h3>

<p>Slightly modified code of <code>mice::with.mids</code>,
<code>mice::summary.mira</code>,
<code>base::within.data.frame</code>
</p>


<h3>See Also</h3>

<p>See the corresponding functionality in <span class="pkg">base</span>, <span class="pkg">mice</span>,
<span class="pkg">mitools</span> and <span class="pkg">mitml</span> packages:<br><code>mice::with.mids</code>,
<code>mitools::with.imputationList</code>,
<code>mitml::with.mitml.list</code>,
<code>base::with</code>
</p>
<p><code>base::within.data.frame</code>,
<code>mitml::within.mitml.list</code>,
</p>
<p><code>mice::summary.mira</code>,
</p>
<p>Imputation functions in <span class="pkg">miceadds</span>:
<code>mice.1chain</code>, <code>mice.nmi</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
#############################################################################
# EXAMPLE 1: One chain nhanes data | application of 'with' and 'within'
#############################################################################

library(mice)
data(nhanes, package="mice")
set.seed(9090)

# nhanes data in one chain
imp &lt;- miceadds::mice.1chain( nhanes, burnin=5, iter=40, Nimp=4 )
# apply linear regression
res &lt;- with( imp, expr=stats::lm( hyp ~ age + bmi  ) )
summary(res)
# pool results
summary( mice::pool(res))

# calculate some descriptive statistics
res2 &lt;- with( imp, expr=c("M1"=mean(hyp), "SD_age"=stats::sd(age) ) )
# pool estimates
withPool_MI(res2)

# with method for datlist
imp1 &lt;- miceadds::datlist_create(imp)
res2b &lt;- with( imp1, fun=function(data){
                    dfr &lt;- data.frame("M"=colMeans(data),
                             "Q5"=apply( data, 2, stats::quantile, .05 ),
                             "Q95"=apply( data, 2, stats::quantile, .95 ) )
                    return(dfr)
                        } )
withPool_MI(res2b)

# convert mids object into an object of class imputationList
datlist &lt;- miceadds::mids2datlist( imp )
datlist &lt;- mitools::imputationList(datlist)

# define formulas for modification of the data frames in imputationList object
datlist2 &lt;- within( datlist, {
                     age.D3 &lt;- 1*(age==3)
                     hyp_chl &lt;- hyp * chl
                        } )
# look at modified dataset
head( datlist2$imputations[[1]] )

# convert into a datlist
datlist2b &lt;- miceadds::datlist_create( datlist2 )

# apply linear model using expression
mod1a &lt;- with( datlist2, expr=stats::lm( hyp ~ age.D3 ) )
# do the same but now with a function argument
mod1b &lt;- with( datlist2, fun=function(data){
                    stats::lm( data$hyp ~ data$age.D3 )
                        } )
# apply the same model for object datlist2b
mod2a &lt;- with( datlist2b, expr=lm( hyp ~ age.D3 ) )
mod2b &lt;- with( datlist2b, fun=function(data){
                    stats::lm( data$hyp ~ data$age.D3 )
                        } )

mitools::MIcombine(mod1a)
mitools::MIcombine(mod1b)
mitools::MIcombine(mod2a)
mitools::MIcombine(mod2b)

#############################################################################
# EXAMPLE 2: Nested multiple imputation and application of with/within methods
#############################################################################

library(BIFIEsurvey)
data(data.timss2, package="BIFIEsurvey" )
datlist &lt;- data.timss2

# remove first four variables
M &lt;- length(datlist)
for (ll in 1:M){
    datlist[[ll]] &lt;- datlist[[ll]][, -c(1:4) ]
                }

# nested multiple imputation using mice
imp1 &lt;- miceadds::mice.nmi( datlist,  m=4, maxit=3 )
summary(imp1)
# apply linear model and use summary method for all analyses of imputed datasets
res1 &lt;- with( imp1, stats::lm( ASMMAT ~ migrant + female ) )
summary(res1)

# convert mids.nmi object into an object of class NestedImputationList
datlist1 &lt;- miceadds::mids2datlist( imp1 )
datlist1 &lt;- miceadds::NestedImputationList( datlist1 )
# convert into nested.datlist object
datlist1b &lt;- miceadds::nested.datlist_create(datlist1)

# use with function
res1b &lt;- with( datlist1, stats::glm( ASMMAT ~ migrant + female ) )
# apply for nested.datlist
res1c &lt;- with( datlist1b, stats::glm( ASMMAT ~ migrant + female ) )

# use within function for data transformations
datlist2 &lt;- within( datlist1, {
                highsc &lt;- 1*(ASSSCI &gt; 600)
                books_dum &lt;- 1*(books&gt;=3)
                rm(scsci)   # remove variable scsci
                    } )

# include random number in each dataset
N &lt;- attr( datlist1b, "nobs")
datlist3 &lt;- within( datlist1b, {
                rn &lt;- stats::runif( N, 0, .5 )
                    } )

#-- some applications of withPool_NMI
# mean and SD
res3a &lt;- with( imp1, c( "m1"=mean(ASMMAT), "sd1"=stats::sd(ASMMAT) ) )
withPool_NMI(res3a)
# quantiles
vars &lt;- c("ASMMAT", "lang", "scsci")
res3b &lt;- with( datlist1b, fun=function(data){
                dat &lt;- data[,vars]
                res0 &lt;- sapply( vars, FUN=function(vv){
                    stats::quantile( dat[,vv], probs=c(.25, .50, .75) )
                                    } )
                t(res0)
                    } )
withPool_NMI(res3b)

## End(Not run)
</code></pre>


</div>