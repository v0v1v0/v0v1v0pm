<div class="container">

<table style="width: 100%;"><tr>
<td>blastpAllAll</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Making BLAST search all against all genomes</h2>

<h3>Description</h3>

<p>Runs a reciprocal all-against-all BLAST search to look for similarity of proteins
within and across genomes.
</p>


<h3>Usage</h3>

<pre><code class="language-R">blastpAllAll(
  prot.files,
  out.folder,
  e.value = 1,
  job = 1,
  threads = 1,
  start.at = 1,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>prot.files</code></td>
<td>
<p>A vector with FASTA filenames.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>out.folder</code></td>
<td>
<p>The folder where the result files should end up.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e.value</code></td>
<td>
<p>The chosen E-value threshold in BLAST.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>job</code></td>
<td>
<p>An integer to separate multiple jobs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threads</code></td>
<td>
<p>The number of CPU's to use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.at</code></td>
<td>
<p>An integer to specify where in the file-list to start BLASTing.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical, if <code>TRUE</code> some text output is produced to monitor the progress.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A basic step in pangenomics and many other comparative studies is to cluster proteins into
groups or families. One commonly used approach is based on BLASTing. This function uses the
‘<span class="samp">⁠blast+⁠</span>’ software available for free from NCBI (Camacho et al, 2009). More precisely, the blastp
algorithm with the BLOSUM45 scoring matrix and all composition based statistics turned off.
</p>
<p>A vector listing FASTA files of protein sequences is given as input in ‘<span class="samp">⁠prot.files⁠</span>’. These files
must have the genome_id in the first token of every header, and in their filenames as well, i.e. all input
files should first be prepared by <code>panPrep</code> to ensure this. Note that only protein sequences
are considered here. If your coding genes are stored as DNA, please translate them to protein prior to
using this function, see <code>translate</code>.
</p>
<p>In the first version of this package we used reciprocal BLASTing, i.e. we computed both genome A against
B and B against A. This may sometimes produce slightly different results, but in reality this is too
costly compared to its gain, and we now only make one of the above searches. This basically halves the
number of searches. This step is still very time consuming for larger number of genomes. Note that the 
protein files are sorted by the genome_id (part of filename) inside this function. This is to ensure a 
consistent ordering irrespective of how they are enterred.
</p>
<p>For every pair of genomes a result file is produced. If two genomes have genome_id's ‘<span class="samp">⁠GID111⁠</span>’,
and ‘<span class="samp">⁠GID222⁠</span>’ then the result file ‘<span class="samp">⁠GID222_vs_GID111.txt⁠</span>’ will
be found in ‘<span class="samp">⁠out.folder⁠</span>’ after the completion of this search. The last of the two genome_id is always
the first in alphabetical order of the two.
</p>
<p>The ‘<span class="samp">⁠out.folder⁠</span>’ is scanned for already existing result files, and <code>blastpAllAll</code> never
overwrites an existing result file. If a file with the name ‘<span class="samp">⁠GID111_vs_GID222.txt⁠</span>’ already exists in
the ‘<span class="samp">⁠out.folder⁠</span>’, this particular search is skipped. This makes it possible to run multiple jobs in
parallell, writing to the same ‘<span class="samp">⁠out.folder⁠</span>’. It also makes it possible to add new genomes, and only
BLAST the new combinations without repeating previous comparisons. 
</p>
<p>This search can be slow if the genomes contain many proteins and it scales quadratically in the number of
input files. It is best suited for the study of a smaller number of genomes. By
starting multiple R sessions, you can speed up the search by running <code>blastpAllAll</code> from each R
session, using the same ‘<span class="samp">⁠out.folder⁠</span>’ but different integers for the <code>job</code> option. At the same
time you may also want to start the BLASTing at different places in the file-list, by giving larger values
to the argument <code>start.at</code>. This is 1 by default, i.e. the BLASTing starts at the first protein file.
If you are using a multicore computer you can also increase the number of CPUs by increasing <code>threads</code>.
</p>
<p>The result files are tab-separated text files, and can be read into R, but more
commonly they are used as input to <code>bDist</code> to compute distances between sequences for subsequent
clustering.
</p>


<h3>Value</h3>

<p>The function produces a result file for each pair of files listed in ‘<span class="samp">⁠prot.files⁠</span>’.
These result files are located in <code>out.folder</code>. Existing files are never overwritten by
<code>blastpAllAll</code>, if you want to re-compute something, delete the corresponding result files first.
</p>


<h3>Note</h3>

<p>The ‘<span class="samp">⁠blast+⁠</span>’ software must be installed on the system for this function to work, i.e. the command
‘<span class="samp">⁠system("makeblastdb -help")⁠</span>’ must be recognized as valid commands if you
run them in the Console window.
</p>


<h3>Author(s)</h3>

<p>Lars Snipen and Kristian Hovde Liland.
</p>


<h3>References</h3>

<p>Camacho, C., Coulouris, G., Avagyan, V., Ma, N., Papadopoulos, J., Bealer, K., Madden, T.L.
(2009). BLAST+: architecture and applications. BMC Bioinformatics, 10:421.
</p>


<h3>See Also</h3>

<p><code>panPrep</code>, <code>bDist</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# This example requires the external BLAST+ software
# Using protein files in this package
pf &lt;- file.path(path.package("micropan"), "extdata",
                str_c("xmpl_GID", 1:3, ".faa.xz"))

# We need to uncompress them first...
prot.files &lt;- tempfile(fileext = c("_GID1.faa.xz","_GID2.faa.xz","_GID3.faa.xz"))
ok &lt;- file.copy(from = pf, to = prot.files)
prot.files &lt;- unlist(lapply(prot.files, xzuncompress))

# Blasting all versus all
out.dir &lt;- "."
blastpAllAll(prot.files, out.folder = out.dir)

# Reading results, and computing blast.distances
blast.files &lt;- list.files(out.dir, pattern = "GID[0-9]+_vs_GID[0-9]+.txt")
blast.distances &lt;- bDist(file.path(out.dir, blast.files))

# ...and cleaning...
ok &lt;- file.remove(prot.files)
ok &lt;- file.remove(file.path(out.dir, blast.files))

## End(Not run)

</code></pre>


</div>