<div class="container">

<table style="width: 100%;"><tr>
<td>crate_env</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Set a Function's Environment</h2>

<h3>Description</h3>

<p>Useful to represent functions efficiently within <code>repr()</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">crate_env(fun, namespace = "R_GlobalEnv", ..., selfref = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>(<code>function</code>)<br>
Function of which the environment should be set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>namespace</code></td>
<td>
<p>(<code>character(1)</code>)<br>
Name of the namespace, as given by <code>environmentName()</code>,
to be used as the (parent of the) environment of <code>fun</code>. Special values
<code>"R_GlobalEnv"</code> (global environment), <code>"R_BaseEnv"</code> (base environment;
note this one is non-standard within R), <code>"R_EmptyEnv"</code> (empty environment).
The content of the namespace is not modified. Default <code>"R_GlobalEnv"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>(<code>list</code>)<br>
Content of environments within which to place <code>fun</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>selfref</code></td>
<td>
<p>(<code>character(1)</code> | named <code>integer</code> | <code>NULL</code>)<br>
If <code>character(1)</code>: The name of the entry of the first element in <code>...</code> that
refers to the function itself. If a named <code>integer</code>, then the values
indicate the lists in <code>...</code> where the reference to the function should be
placed see examples. Default <code>NULL</code>: No reference to the function itself is
present.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>function</code>: The given <code>fun</code> with changed environment.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
identity2 = crate_env(function(x) x, "base")
identical(identity, identity2)  # TRUE

y = 1
f1 = mlr3misc::crate(function(x) x + y, y, .parent = .GlobalEnv)
f2 = crate_env(function(x) x + y, "R_GlobalEnv", list(y = 1))

# Note identical() does not apply because both contain (equal, but not
# identical) 'y = 1'-environments
all.equal(f1, f2)  # TRUE
f1(10)  # 10 + 1 == 11

factorial1 = mlr3misc::crate(
  function(x) if (x &gt; 0) x * factorial1(x - 1) else 1,
  y, .parent = .GlobalEnv
)
environment(factorial1)$factorial1 = factorial1

factorial2 = crate_env(
  function(x) if (x &gt; 0) x * factorial1(x - 1) else 1,
  "R_GlobalEnv", list(y = 1), selfref = "factorial1")
# putting 'factorial1' into the list (or repeating function(x) ....)
# would *not* work, since we want:
identical(environment(factorial2)$factorial1, factorial2)  # TRUE

all.equal(factorial1, factorial2)  # TRUE

g = crate_env(function(x) x + y + z, "miesmuschel",
  list(y = 1), list(z = 2), selfref = c(X = 1, Y = 2, Z = 2))
g(0)  # 0 + 1 + 2 == 3
identical(environment(g)$X, g)
identical(parent.env(environment(g))$Y, g)
identical(parent.env(environment(g))$Z, g)
identical(
  parent.env(parent.env(environment(g))),
  loadNamespace("miesmuschel")
)
</code></pre>


</div>