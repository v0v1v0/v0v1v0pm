<div class="container">

<table style="width: 100%;"><tr>
<td>ipf3</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Iterative proportional fitting routine for the indirect estimation of origin-destination-migrant type migration flow tables with known origin and destination margins.</h2>

<h3>Description</h3>

<p>The <code>ipf3</code> function finds the maximum likelihood estimates for fitted values in the log-linear model:
</p>
<p style="text-align: center;"><code class="reqn"> \log y_{ijk} = \log \alpha_{i} + \log \beta_{j} + \log \lambda_{k} + \log \gamma_{ik} + \log \kappa_{jk} + \log m_{ijk} </code>
</p>

<p>where <code class="reqn">m_{ijk}</code> is a set of prior estimates for <code class="reqn">y_{ijk}</code> and is no more complex than the matrices being fitted.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ipf3(
  row_tot = NULL,
  col_tot = NULL,
  m = NULL,
  tol = 1e-05,
  maxit = 500,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>row_tot</code></td>
<td>
<p>Vector of origin totals to constrain the sum of the imputed cell rows.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col_tot</code></td>
<td>
<p>Vector of destination totals to constrain the sum of the imputed cell columns.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>Array of auxiliary data. By default set to 1 for all origin-destination-migrant typologies combinations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>Numeric value for the tolerance level used in the parameter estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>
<p>Numeric value for the maximum number of iterations used in the parameter estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical value to indicate the print the parameter estimates at each iteration. By default <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Iterative Proportional Fitting routine set up in a similar manner to Agresti (2002, p.343). The arguments <code>row_tot</code> and <code>col_tot</code> take the row-table and column-table specific known margins.
</p>
<p>The user must ensure that the row and column totals in each table sum to the same value. Care must also be taken to allow the dimension of the auxiliary matrix (<code>m</code>) to equal those provided in the row and column totals.
</p>
<p>Returns a <code>list</code> object with
</p>
<table>
<tr style="vertical-align: top;">
<td><code>mu </code></td>
<td>
<p>Array of indirect estimates of origin-destination matrices by migrant characteristic</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>it </code></td>
<td>
<p>Iteration count</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol </code></td>
<td>
<p>Tolerance level at final iteration</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Guy J. Abel
</p>


<h3>References</h3>

<p>Abel and Cohen (2019) Bilateral international migration flow estimates for 200 countries <em>Scientific Data</em> 6 (1), 1-13
</p>
<p>Azose &amp; Raftery (2019) Estimation of emigration, return migration, and transit migration between all pairs of countries <em>Proceedings of the National Academy of Sciences</em> 116 (1) 116-122
</p>
<p>Abel, G. J. (2013). Estimating Global Migration Flow Tables Using Place of Birth. <em>Demographic Research</em> 28, (18) 505-546
</p>
<p>Agresti, A. (2002). <em>Categorical Data Analysis</em> 2nd edition. Wiley.
</p>


<h3>See Also</h3>

<p><code>ipf3_qi</code>, <code>ipf2</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## create row-table and column-table specific known margins.
dn &lt;- LETTERS[1:4]
P1 &lt;- matrix(c(1000, 100,  10,   0, 
               55,   555,  50,   5, 
               80,    40, 800 , 40, 
               20,    25,  20, 200), 
             nrow = 4, ncol = 4, byrow = TRUE, 
             dimnames = list(pob = dn, por = dn))
P2 &lt;- matrix(c(950, 100,  60,   0, 
                80, 505,  75,   5, 
                90,  30, 800,  40, 
                40,  45,   0, 180), 
             nrow = 4, ncol = 4, byrow = TRUE, 
             dimnames = list(pob = dn, por = dn))
# display with row and col totals
addmargins(P1)
addmargins(P2)

# run ipf
y &lt;- ipf3(row_tot = t(P1), col_tot = P2)
# display with row, col and table totals
round(addmargins(y$mu), 1)
# origin-destination flow table
round(sum_od(y$mu), 1)

## with alternative offset term
dis &lt;- array(c(1, 2, 3, 4, 2, 1, 5, 6, 3, 4, 1, 7, 4, 6, 7, 1), c(4, 4, 4))
y &lt;- ipf3(row_tot = t(P1), col_tot = P2, m = dis)
# display with row, col and table totals
round(addmargins(y$mu), 1)
# origin-destination flow table
round(sum_od(y$mu), 1)
</code></pre>


</div>