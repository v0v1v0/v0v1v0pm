<div class="container">

<table style="width: 100%;"><tr>
<td>mig_chord</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Chord diagram for directional origin-destination data</h2>

<h3>Description</h3>

<p>Adaption of <code>circlize::chordDiagramFromDataFrame()</code> with defaults set to allow for more effective visualisation of directional origin-destination data
</p>


<h3>Usage</h3>

<pre><code class="language-R">mig_chord(
  x,
  lab = NULL,
  lab_bend1 = NULL,
  lab_bend2 = NULL,
  label_size = 1,
  label_nudge = 0,
  label_squeeze = 0,
  axis_size = 0.8,
  axis_breaks = NULL,
  ...,
  no_labels = FALSE,
  no_axis = FALSE,
  clear_circos_par = TRUE,
  zero_margin = TRUE,
  start.degree = 90,
  gap.degree = 4,
  track.margin = c(-0.1, 0.1),
  points.overflow.warning = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data frame with origin in first column, destination in second column and bilateral measure in third column</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lab</code></td>
<td>
<p>Named vector of labels for plot. If <code>NULL</code> will use names from <code>d</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lab_bend1</code></td>
<td>
<p>Named vector of bending labels for plot. Note line breaks do not work with <code>facing = "bending"</code> in circlize.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lab_bend2</code></td>
<td>
<p>Named vector of second row of bending labels for plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label_size</code></td>
<td>
<p>Font size of label text.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label_nudge</code></td>
<td>
<p>Numeric value to nudge labels towards (negative number) or away (positive number) the sector axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label_squeeze</code></td>
<td>
<p>Numeric value to nudge <code>lab_bend1</code> and <code>lab_bend2</code> labels apart (negative number) or together (positive number).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>axis_size</code></td>
<td>
<p>Font size on axis labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>axis_breaks</code></td>
<td>
<p>Numeric value for how often to add axis label breaks. Default not activated, uses default from <code>circlize::circos.axis()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments for <code>circlize::chordDiagramFromDataFrame()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>no_labels</code></td>
<td>
<p>Logical to indicate if to include plot labels. Set to <code>FALSE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>no_axis</code></td>
<td>
<p>Logical to indicate if to include plot axis. Set to <code>FALSE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clear_circos_par</code></td>
<td>
<p>Logical to run <code>circlize::circos.clear()</code>. Set to <code>TRUE</code> by default. Set to <code>FALSE</code> if you wish to add further to the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zero_margin</code></td>
<td>
<p>Set margins of the plotting graphics device to zero. Set to <code>TRUE</code> by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.degree</code></td>
<td>
<p>Argument for <code>circlize::circos.par()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gap.degree</code></td>
<td>
<p>Argument for <code>circlize::chordDiagramFromDataFrame()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>track.margin</code></td>
<td>
<p>Argument for <code>circlize::chordDiagramFromDataFrame()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>points.overflow.warning</code></td>
<td>
<p>Argument for <code>circlize::chordDiagramFromDataFrame()</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Chord diagram based on first three columns of <code>x</code>. The function tweaks the defaults of <code>circlize::chordDiagramFromDataFrame()</code> for easier plotting of directional origin-destination data. Users can override these defaults and pass additional tweaks using any of the <code>circlize::chordDiagramFromDataFrame()</code> arguments.
</p>
<p>The layout of the plots are designed to specifically work on plotting images into PDF devices with widths and heights of 7 inches (the default dimension when using the <code>pdf</code> function). See the end of the examples for converting PDF to PNG images in R. 
</p>
<p>Fitting the sector labels on the page is usually the most time consuming task. Use the different label options, including line breaks, <code>label_nudge</code>, track height in <code>preAllocateTracks</code> and font sizes in <code>label_size</code> and <code>axis_size</code> to find the best fit. If none of the label options produce desirable results, plot your own using <code>circlize::circos.text</code> having set <code>no_labels = TRUE</code> and <code>clear_circos_par = FALSE</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
library(tidyverse)
library(countrycode)
# download Abel and Cohen (2019) estimates
f &lt;- read_csv("https://ndownloader.figshare.com/files/38016762", show_col_types = FALSE)
f

# use dictionary to get region to region flows
d &lt;- f %&gt;%
  mutate(
    orig = countrycode(sourcevar = orig, custom_dict = dict_ims,
                       origin = "iso3c", destination = "region"),
    dest = countrycode(sourcevar = dest, custom_dict = dict_ims,
                       origin = "iso3c", destination = "region")
  ) %&gt;%
  group_by(year0, orig, dest) %&gt;%
  summarise_all(sum) %&gt;%
  ungroup()
d

# 2015-2020 pseudo-Bayesian estimates for plotting
pb &lt;- d %&gt;%
    filter(year0 == 2015) %&gt;%
    mutate(flow = da_pb_closed/1e6) %&gt;%
    select(orig, dest, flow)
pb
    
# pdf(file = "chord.pdf")
mig_chord(x = pb)
# dev.off()
# file.show("chord.pdf")

# pass arguments to circlize::chordDiagramFromDataFrame
# pdf(file = "chord.pdf")
mig_chord(x = pb,
          # order of regions
          order = unique(pb$orig)[c(1, 3, 2, 6, 4, 5)],
          # spacing for labels
          preAllocateTracks = list(track.height = 0.3),
          # colours
          grid.col = c("blue", "royalblue", "navyblue", "skyblue", "cadetblue", "darkblue")
          )
# dev.off()
# file.show("chord.pdf")

# multiple line labels to fit on longer labels
r &lt;- pb %&gt;%
  sum_region() %&gt;%
  mutate(lab = str_wrap_n(string = region, n = 2)) %&gt;%
  separate(col = lab, into = c("lab1", "lab2"), sep = "\n", remove = FALSE, fill = "right")
r

# pdf(file = "chord.pdf")
mig_chord(x = pb,
          lab = r %&gt;%
            select(region, lab) %&gt;%
            deframe(),
          preAllocateTracks = list(track.height = 0.25),
          label_size = 0.8,
          axis_size = 0.7
          )
# dev.off()
# file.show("chord.pdf")

# bending labels
# pdf(file = "chord.pdf")
mig_chord(x = pb,
          lab_bend1 = r %&gt;%
            select(region, lab1) %&gt;%
            deframe(),
          lab_bend2 = r %&gt;%
            select(region, lab2) %&gt;%
            deframe()
          )
# dev.off()
# file.show("chord.pdf")


# convert pdf to image file
# library(magick)
# p &lt;- image_read_pdf("chord.pdf")
# image_write(image = p, path = "chord.png")
# file.show("chord.png")

## End(Not run)
</code></pre>


</div>