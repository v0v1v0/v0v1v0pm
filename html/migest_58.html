<div class="container">

<table style="width: 100%;"><tr>
<td>sum_expand</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Sum bilateral data to include aggregate bilateral totals for origin and destination meta areas</h2>

<h3>Description</h3>

<p>Expand matrix of data frame of migration data to include aggregate sums for corresponding origin and destination meta regions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sum_expand(
  m,
  return_matrix = FALSE,
  guess_order = TRUE,
  area_first = TRUE,
  orig_col = "orig",
  dest_col = "dest",
  flow_col = "flow",
  orig_area_col = "orig_area",
  dest_area_col = "dest_area",
  orig_area = NULL,
  dest_area = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>A <code>matrix</code> or data frame of origin-destination flows. For <code>matrix</code> the first and second dimensions correspond to origin and destination respectively. For a data frame ensure the correct column names are passed to <code>orig_col</code>, <code>dest_col</code> and <code>flow_col</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return_matrix</code></td>
<td>
<p>Logical to return a matrix. Default <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>guess_order</code></td>
<td>
<p>Logical to return a matrix or data frame ordered by origin and destination with area names at the end of each block. Default <code>TRUE</code>. If <code>FALSE</code> returns matrix or data frame based on alphabetical order of origin and destinations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>area_first</code></td>
<td>
<p>Order area sums to be placed before the origin and destination values. Default <code>TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>orig_col</code></td>
<td>
<p>Character string of the origin column name (when <code>m</code> is a data frame rather than a <code>matrix</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dest_col</code></td>
<td>
<p>Character string of the destination column name (when <code>m</code> is a data frame rather than a <code>matrix</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flow_col</code></td>
<td>
<p>Character string of the flow column name (when <code>m</code> is a data frame rather than a <code>matrix</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>orig_area_col</code></td>
<td>
<p>Character string of the origin area column name (when <code>m</code> is a data frame rather than a <code>matrix</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dest_area_col</code></td>
<td>
<p>Character string of the destination area column name (when <code>m</code> is a data frame rather than a <code>matrix</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>orig_area</code></td>
<td>
<p>Vector of labels for the origin areas of each row of <code>m</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dest_area</code></td>
<td>
<p>Vector of labels for the destination areas of each row of <code>m</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <code>tibble</code> or <code>matrix</code> with additional row and columns (for matrices) for aggregate sums for origin and destination meta-regions
</p>


<h3>Examples</h3>

<pre><code class="language-R">##
## from matrix
##
m &lt;- block_matrix(x = 1:16, b = c(2,3,4,2))
m

# requires a vector of origin and destination areas
a &lt;- rep(LETTERS[1:4], times = c(2,3,4,2))
a
sum_expand(m = m, orig_area = a, dest_area = a)

# place area sums after regions
sum_expand(m = m, orig_area = a, dest_area = a, area_first = FALSE)

##
## from large data frame
##
## Not run: 
library(tidyverse)
library(countrycode)

# download Abel and Cohen (2019) estimates
f &lt;- read_csv("https://ndownloader.figshare.com/files/38016762", show_col_types = FALSE)
f

# 1990-1995 flow estimates
f %&gt;%
  filter(year0 == 1990) %&gt;%
  mutate(
    orig_area = countrycode(sourcevar = orig, custom_dict = dict_ims,
                            origin = "iso3c", destination = "region"),
    dest_area = countrycode(sourcevar = dest, custom_dict = dict_ims,
                            origin = "iso3c", destination = "region")
  ) %&gt;%
  sum_expand(flow_col = "da_pb_closed", return_matrix = FALSE)

# by group (period)
f %&gt;%
  mutate(
    orig_area = countrycode(sourcevar = orig, custom_dict = dict_ims,
                            origin = "iso3c", destination = "region"),
    dest_area = countrycode(sourcevar = dest, custom_dict = dict_ims,
                            origin = "iso3c", destination = "region")
  ) %&gt;%
  group_by(year0) %&gt;%
  sum_expand(flow_col = "da_pb_closed", return_matrix = FALSE)

## End(Not run)
</code></pre>


</div>