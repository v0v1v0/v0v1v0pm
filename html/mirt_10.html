<div class="container">

<table style="width: 100%;"><tr>
<td>bfactor</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Full-Information Item Bi-factor and Two-Tier Analysis</h2>

<h3>Description</h3>

<p><code>bfactor</code> fits a confirmatory maximum likelihood two-tier/bifactor/testlet model to
dichotomous and polytomous data under the item response theory paradigm.
The IRT models are fit using a dimensional reduction EM algorithm so that regardless
of the number of specific factors estimated the model only uses the number of
factors in the second-tier structure plus 1. For the bifactor model the maximum
number of dimensions is only 2 since the second-tier only consists of a
ubiquitous unidimensional factor. See <code>mirt</code> for appropriate methods to be used
on the objects returned from the estimation.
</p>


<h3>Usage</h3>

<pre><code class="language-R">bfactor(
  data,
  model,
  model2 = paste0("G = 1-", ncol(data)),
  group = NULL,
  quadpts = NULL,
  invariance = "",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a <code>matrix</code> or <code>data.frame</code> that consists of
numerically ordered data, with missing data coded as <code>NA</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>a numeric vector specifying which factor loads on which
item. For example, if for a 4 item test with two specific factors, the first
specific factor loads on the first two items and the second specific factor
on the last two, then the vector is <code>c(1,1,2,2)</code>. For items that should only load
on the second-tier factors (have no specific component) <code>NA</code> values may
be used as place-holders. These numbers will be translated into a format suitable for
<code>mirt.model()</code>, combined with the definition in <code>model2</code>, with the letter 'S'
added to the respective factor number</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model2</code></td>
<td>
<p>a two-tier model specification object defined by <code>mirt.model()</code> or
a string to be passed to <code>mirt.model</code>. By default
the model will fit a unidimensional model in the second-tier, and therefore be equivalent to
the bifactor model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group</code></td>
<td>
<p>a factor variable indicating group membership used for multiple group analyses</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quadpts</code></td>
<td>
<p>number of quadrature nodes to use after accounting for the reduced number of dimensions.
Scheme is the same as the one used in <code>mirt</code>, however it is in regards to the reduced
dimensions (e.g., a bifactor model has 2 dimensions to be integrated)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>invariance</code></td>
<td>
<p>see <code>multipleGroup</code> for details, however, the specific factor variances
and means will be constrained according to the dimensional reduction algorithm</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments to be passed to the estimation engine. See <code>mirt</code>
for more details and examples</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>bfactor</code> follows the item factor analysis strategy explicated by
Gibbons and Hedeker (1992), Gibbons et al. (2007), and Cai (2010).
Nested models may be compared via an approximate
chi-squared difference test or by a reduction in AIC or BIC (accessible via
<code>anova</code>). See <code>mirt</code> for more details regarding the
IRT estimation approach used in this package.
</p>
<p>The two-tier model has a specific block diagonal covariance structure between the primary and
secondary latent traits. Namely, the secondary latent traits are assumed to be orthogonal to
all traits and have a fixed variance of 1, while the primary traits can be organized to vary
and covary with other primary traits in the model.
</p>
<p style="text-align: center;"><code class="reqn">\Sigma_{two-tier} = \left(\begin{array}{cc} G &amp; 0 \\ 0 &amp; diag(S) \end{array} \right)</code>
</p>

<p>The bifactor model is a special case of the two-tier model when <code class="reqn">G</code> above is a 1x1 matrix,
and therefore only 1 primary factor is being modeled. Evaluation of the numerical integrals
for the two-tier model requires only <code class="reqn">ncol(G) + 1</code> dimensions for integration since the
<code class="reqn">S</code> second order (or 'specific') factors require only 1 integration grid due to the
dimension reduction technique.
</p>
<p>Note: for multiple group two-tier analyses only the second-tier means and variances
should be freed since the specific factors are not treated independently due to the
dimension reduction technique.
</p>


<h3>Value</h3>

<p>function returns an object of class <code>SingleGroupClass</code>
(SingleGroupClass-class) or <code>MultipleGroupClass</code>(MultipleGroupClass-class).
</p>


<h3>Author(s)</h3>

<p>Phil Chalmers <a href="mailto:rphilip.chalmers@gmail.com">rphilip.chalmers@gmail.com</a>
</p>


<h3>References</h3>

<p>Cai, L. (2010). A two-tier full-information item factor analysis model with applications.
<em>Psychometrika, 75</em>, 581-612.
</p>
<p>Chalmers, R., P. (2012). mirt: A Multidimensional Item Response Theory
Package for the R Environment. <em>Journal of Statistical Software, 48</em>(6), 1-29.
<a href="https://doi.org/10.18637/jss.v048.i06">doi:10.18637/jss.v048.i06</a>
</p>
<p>Bradlow, E.T., Wainer, H., &amp; Wang, X. (1999). A Bayesian random effects model for testlets.
<em>Psychometrika, 64</em>, 153-168.
</p>
<p>Gibbons, R. D., &amp; Hedeker, D. R. (1992). Full-information Item Bi-Factor
Analysis. <em>Psychometrika, 57</em>, 423-436.
</p>
<p>Gibbons, R. D., Darrell, R. B., Hedeker, D., Weiss, D. J., Segawa, E., Bhaumik, D. K.,
Kupfer, D. J., Frank, E., Grochocinski, V. J., &amp; Stover, A. (2007).
Full-Information item bifactor analysis of graded response data.
<em>Applied Psychological Measurement, 31</em>, 4-19.
</p>
<p>Wainer, H., Bradlow, E.T., &amp; Wang, X. (2007). Testlet response theory and its applications.
New York, NY: Cambridge University Press.
</p>


<h3>See Also</h3>

<p><code>mirt</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 

### load SAT12 and compute bifactor model with 3 specific factors
data(SAT12)
data &lt;- key2binary(SAT12,
  key = c(1,4,5,2,3,1,2,1,3,1,2,4,2,1,5,3,4,4,1,4,3,3,4,1,3,5,1,3,1,5,4,5))
specific &lt;- c(2,3,2,3,3,2,1,2,1,1,1,3,1,3,1,2,1,1,3,3,1,1,3,1,3,3,1,3,2,3,1,2)
mod1 &lt;- bfactor(data, specific)
summary(mod1)
itemplot(mod1, 18, drop.zeros = TRUE) #drop the zero slopes to allow plotting

### Try with fixed guessing parameters added
guess &lt;- rep(.1,32)
mod2 &lt;- bfactor(data, specific, guess = guess)
coef(mod2)
anova(mod1, mod2)

## don't estimate specific factor for item 32
specific[32] &lt;- NA
mod3 &lt;- bfactor(data, specific)
anova(mod3, mod1)

# same, but declared manually (not run)
#sv &lt;- mod2values(mod1)
#sv$value[220] &lt;- 0 #parameter 220 is the 32 items specific slope
#sv$est[220] &lt;- FALSE
#mod3 &lt;- bfactor(data, specific, pars = sv) #with excellent starting values


#########
# mixed itemtype example

# simulate data
a &lt;- matrix(c(
1,0.5,NA,
1,0.5,NA,
1,0.5,NA,
1,0.5,NA,
1,0.5,NA,
1,0.5,NA,
1,0.5,NA,
1,NA,0.5,
1,NA,0.5,
1,NA,0.5,
1,NA,0.5,
1,NA,0.5,
1,NA,0.5,
1,NA,0.5),ncol=3,byrow=TRUE)

d &lt;- matrix(c(
-1.0,NA,NA,
-1.5,NA,NA,
 1.5,NA,NA,
 0.0,NA,NA,
2.5,1.0,-1,
3.0,2.0,-0.5,
3.0,2.0,-0.5,
3.0,2.0,-0.5,
2.5,1.0,-1,
2.0,0.0,NA,
-1.0,NA,NA,
-1.5,NA,NA,
 1.5,NA,NA,
 0.0,NA,NA),ncol=3,byrow=TRUE)
items &lt;- rep('2PL', 14)
items[5:10] &lt;- 'graded'

sigma &lt;- diag(3)
dataset &lt;- simdata(a,d,2000,itemtype=items,sigma=sigma)
itemstats(dataset)

specific &lt;- c(rep(1,7),rep(2,7))
simmod &lt;- bfactor(dataset, specific)
coef(simmod)

#########
# General testlet response model (Wainer, 2007)

# simulate data
set.seed(1234)
a &lt;- matrix(0, 12, 4)
a[,1] &lt;- rlnorm(12, .2, .3)
ind &lt;- 1
for(i in 1:3){
   a[ind:(ind+3),i+1] &lt;- a[ind:(ind+3),1]
   ind &lt;- ind+4
}
print(a)
d &lt;- rnorm(12, 0, .5)
sigma &lt;- diag(c(1, .5, 1, .5))
dataset &lt;- simdata(a,d,2000,itemtype=rep('2PL', 12),sigma=sigma)
itemstats(dataset)

# estimate by applying constraints and freeing the latent variances
specific &lt;- c(rep(1,4),rep(2,4), rep(3,4))
model &lt;- "G = 1-12
          CONSTRAIN = (1, a1, a2), (2, a1, a2), (3, a1, a2), (4, a1, a2),
            (5, a1, a3), (6, a1, a3), (7, a1, a3), (8, a1, a3),
            (9, a1, a4), (10, a1, a4), (11, a1, a4), (12, a1, a4)
          COV = S1*S1, S2*S2, S3*S3"

simmod &lt;- bfactor(dataset, specific, model)
coef(simmod, simplify=TRUE)

# Constrained testlet model (Bradlow, 1999)
model2 &lt;- "G = 1-12
          CONSTRAIN = (1, a1, a2), (2, a1, a2), (3, a1, a2), (4, a1, a2),
            (5, a1, a3), (6, a1, a3), (7, a1, a3), (8, a1, a3),
            (9, a1, a4), (10, a1, a4), (11, a1, a4), (12, a1, a4),
            (GROUP, COV_22, COV_33, COV_44)
          COV = S1*S1, S2*S2, S3*S3"

simmod2 &lt;- bfactor(dataset, specific, model2)
coef(simmod2, simplify=TRUE)
anova(simmod2, simmod)


#########
# Two-tier model

# simulate data
set.seed(1234)
a &lt;- matrix(c(
  0,1,0.5,NA,NA,
  0,1,0.5,NA,NA,
  0,1,0.5,NA,NA,
  0,1,0.5,NA,NA,
  0,1,0.5,NA,NA,
  0,1,NA,0.5,NA,
  0,1,NA,0.5,NA,
  0,1,NA,0.5,NA,
  1,0,NA,0.5,NA,
  1,0,NA,0.5,NA,
  1,0,NA,0.5,NA,
  1,0,NA,NA,0.5,
  1,0,NA,NA,0.5,
  1,0,NA,NA,0.5,
  1,0,NA,NA,0.5,
  1,0,NA,NA,0.5),ncol=5,byrow=TRUE)

d &lt;- matrix(rnorm(16))
items &lt;- rep('2PL', 16)

sigma &lt;- diag(5)
sigma[1,2] &lt;- sigma[2,1] &lt;- .4
dataset &lt;- simdata(a,d,2000,itemtype=items,sigma=sigma)
itemstats(dataset)

specific &lt;- c(rep(1,5),rep(2,6),rep(3,5))
model &lt;- '
    G1 = 1-8
    G2 = 9-16
    COV = G1*G2'

# quadpts dropped for faster estimation, but not as precise
simmod &lt;- bfactor(dataset, specific, model, quadpts = 9, TOL = 1e-3)
coef(simmod, simplify=TRUE)
summary(simmod)
itemfit(simmod, QMC=TRUE)
M2(simmod, QMC=TRUE)
residuals(simmod, QMC=TRUE)


## End(Not run)

</code></pre>


</div>