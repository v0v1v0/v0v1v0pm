<div class="container">

<table style="width: 100%;"><tr>
<td>missDiag</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Comparing Observed and Imputed Values under MAR and MCAR</h2>

<h3>Description</h3>

<p>Function to compute discrepancy statistics comparing the (reweighted)
density of imputed and observed values. To compute the weights balancing
covariates that are part of the missing data mechanism, the function
relies on either entropy balancing or stable balancing weights.
</p>


<h3>Usage</h3>

<pre><code class="language-R">missDiag(
  original,
  imputed,
  formula = NULL,
  skip_n = 25,
  scale = FALSE,
  adjust = "ebal",
  use_imputed_cov = TRUE,
  convert = c("numeric"),
  categories = 3,
  verbose = 0,
  output_diag = FALSE,
  ebal_param = param_ebal(),
  sbw_param = param_sbw(),
  cobalt_param = param_cobalt()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>original</code></td>
<td>
<p>data frame with missing values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>imputed</code></td>
<td>
<p>an imputed data frame, a list of imputed data frames or
a <code>mids</code> object from the <code>mice::mice()</code> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>two-sided formula with the variables to compute discrepancy
statistics (right-hand side) and variables to balance (left-hand side).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>skip_n</code></td>
<td>
<p>skip variables with fewer than <code>skip_n</code> missing values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>scale the design matrix?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adjust</code></td>
<td>
<p>either 'none', 'sbw' or 'ebal'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_imputed_cov</code></td>
<td>
<p>use imputed covariates?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>convert</code></td>
<td>
<p>vector of variable types to bin before coercion
(ignored if <code>use_imputed_cov=TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>categories</code></td>
<td>
<p>how many bins (ignored if <code>use_imputed_cov=TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>one of three levels (0,1 or 2).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_diag</code></td>
<td>
<p>add covariate balance statistics to output?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ebal_param</code></td>
<td>
<p>list of parameters passed to <code>ebal</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sbw_param</code></td>
<td>
<p>list of parameters passed to <code>sbw</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cobalt_param</code></td>
<td>
<p>list of parameters passed to <code>cobalt</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Let y be a variable with observed and imputed values and let m be
a corresponding indicator if a value in y is observed (0) or imputed (1).
We use X to denote all K covariates and x_k as the k^th covariate.
</p>
<p>By default, <code>missDiag</code> computes discrepancy statistics (balance
statistics) comparing the distribution of observed and imputed values,
ie. comparing f(y|m=1) vs. f(y|m=0). The distribution are expected
to be equal under MCAR.
</p>
<p>If the data are missing at random (MAR), set <code>adjust="ebal"</code>
or <code>adjust="sbw"</code>, to construct weights to balance the
covariate distribution X before computing the discrepancy statistics.
</p>
<p>The left-hand side (lhs) of the <code>formula</code> gives the name of y while the
right-hand side (rhs) defines the covariates X to balance under MAR.
Rhs variables are transformed into a numeric matrix via the
<code>stats::model.matrix()</code> function. Therefore  factor and string variables
are dummy encoded and functional transformations such as <code>log()</code>
are applied.
</p>
<p>To run <code>missDiag</code> on many y variables sequentially, supply a list
of formulas or name all y variables on the lhs separating each variable
with a "|", e.g. <code>y1 | y2 ~ x1 + ... + xK</code>.
</p>
<p>If <code>formula=NULL</code>, <code>missDiag</code> runs on all variables with at
least <code>n_skip</code> missing values in <code>original</code>. Weights are
constructed such that all X covariates are balanced
(if <code>adjust!='none'</code>).
</p>
<p>If <code>use_imputed_cov=FALSE</code>, all imputed values in the covariates X
are deleted, variables are coerced to factor variables with missing
values encoded as one category. Numerical variables are binned by quantiles
before coercion. Use the parameter <code>categories</code> to define the
number of bins. By default only variables of class "numeric" are binned.
Use <code>convert = c("numeric", "integer")</code> to also bin integer
variables before coercion to factor variables.
</p>
<p>To balance the covariates, <code>missDiag</code> computes weights using either
the <code>ebal::ebalance()</code> function or the <code>sbw::sbw()</code> function. These
two packages have to be installed separately by the user.
</p>
<p>To pass parameters to the <code>sbw::sbw()</code> or <code>ebal::ebalance()</code> use the
functions <code>param_sbw()</code> and <code>param_sbw()</code> to generate valid parameter lists
and pass these lists via the parameters <code>sbw_param</code> or
<code>ebal_param</code>.
</p>
<p>To display information about the computations set verbose to the value
1 (some information) or 2 (more information when constructing weights).
</p>
<p>To compute the discrepancy statistics, <code>missDiag</code> relies on the function
<code>cobalt::bal.tab()</code> from the cobalt package. To pass parameters to this
function use <code>param_cobalt()</code> to generate a valid parameter list and
pass this list via the parameter <code>cobalt_param</code>.
</p>


<h3>Value</h3>

<p>A single <code>data.frame</code> with the results for
each imputed dataset and all lhs variables.
</p>
<p>If <code>output_diag=FALSE</code>, the dataset only includes
the discrepancy statistics comparing y's observed values and
imputed values.
</p>
<p>If y is continuous, there will be exactly one row per imputed
dataset. The discrepancy statistics are reported in the
respective columns. For a categorical y cobalt
computes discrepancy statistics for all K categories which means
that there will be K rows for each imputed dataset in the
output. The label for each category is listed in <code>vname</code>.
</p>
<p>If the default settings are adopted, the dataset includes
the following discrepancy statistics for continuous variables:
</p>

<ul>
<li> <p><code>diff_adj</code>: Standardized mean difference
</p>
</li>
<li> <p><code>v_ratio_adj</code>: Variance ratio
</p>
</li>
<li> <p><code>ks_adj</code>: Kolmogorov–Smirnov statistic
</p>
</li>
<li> <p><code>ovl_adj</code>: 1-Overlap coefficient
</p>
</li>
</ul>
<p>No variance ratio is reported for categorical variables.
</p>
<p>If <code>output_diag=TRUE</code>, the dataset also includes
the balance statistics for all K covariates.
</p>
<p>These balance statistics are useful to diagnose if the fitted
weights are successful in balancing the covariate distribution.
</p>
<p>For these diagnostics the column <code>vname</code> lists
the covariate name (for continuous variables) or the
covariate category (for categorical variables).
</p>


<h3>References</h3>

<p>Moritz Marbach. 2021. Choosing Imputation Models.
</p>
<p>José R Zubizarreta. 2015. Stable Weights that Balance Covariates
for Estimation with Incomplete Outcome Data, Journal of the American
Statistical Association, 110(511): 910-922.
</p>
<p>Jens Hainmueller. 2012. Entropy Balancing for Causal Effects: A
Multivariate Reweighting Method to Produce Balanced Samples in
Observational Studies, Political Analysis 20(1): 25–46.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Compare random value imputation 
# with predictive mean imputation 
# under MCAR

diag_rng &lt;- missDiag( 
 original=anes08, 
 imputed=anes08_rng, 
 verbose = 1,
 adjust = 'none',
 formula = time ~ .)

diag_pmm &lt;- missDiag( 
 original=anes08, 
 imputed=anes08_pmm, 
 verbose = 1,
 adjust = 'none',
 formula = time ~ .)

# SMD: 

 mean(diag_pmm$diff_adj)
 mean(diag_rng$diff_adj)

# log(Variance ratio)
 mean(log(diag_pmm$v_ratio_adj))
 mean(log(diag_rng$v_ratio_adj))

# KS
 mean(diag_pmm$ks_adj)
 mean(diag_rng$ks_adj)

# 1-OVL
 mean(diag_pmm$ovl_adj)
 mean(diag_rng$ovl_adj)



</code></pre>


</div>