<div class="container">

<table style="width: 100%;"><tr>
<td>delete_MAR_censoring</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create MAR values using a censoring mechanism</h2>

<h3>Description</h3>

<p>Create missing at random (MAR) values using a censoring mechanism in a data
frame or a matrix
</p>


<h3>Usage</h3>

<pre><code class="language-R">delete_MAR_censoring(
  ds,
  p,
  cols_mis,
  cols_ctrl,
  n_mis_stochastic = FALSE,
  where = "lower",
  sorting = TRUE,
  miss_cols,
  ctrl_cols
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ds</code></td>
<td>
<p>A data frame or matrix in which missing values will be created.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>A numeric vector with length one or equal to length <code>cols_mis</code>;
the probability that a value is missing.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cols_mis</code></td>
<td>
<p>A vector of column names or indices of columns in which
missing values will be created.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cols_ctrl</code></td>
<td>
<p>A vector of column names or indices of columns, which
controls the creation of missing values in <code>cols_mis</code>. Must be of the
same length as <code>cols_mis</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_mis_stochastic</code></td>
<td>
<p>Logical, should the number of missing values be
stochastic? If <code>n_mis_stochastic = TRUE</code>, the number of missing values
for a column with missing values <code>cols_mis[i]</code> is a random variable
with expected value <code>nrow(ds) * p[i]</code>. If <code>n_mis_stochastic =
FALSE</code>, the number of missing values will be deterministic. Normally, the
number of missing values for a column with missing values
<code>cols_mis[i]</code> is <code>round(nrow(ds) * p[i])</code>. Possible deviations
from this value, if any exists, are documented in Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>where</code></td>
<td>
<p>Controls where missing values are created; one of "lower",
"upper" or "both" (see details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sorting</code></td>
<td>
<p>Logical; should sorting be used or a quantile as a threshold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>miss_cols</code></td>
<td>
<p>Deprecated, use <code>cols_mis</code> instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ctrl_cols</code></td>
<td>
<p>Deprecated, use <code>cols_ctrl</code> instead.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function creates missing at random (MAR) values in the columns
specified by the argument <code>cols_mis</code>.
The probability for missing values is controlled by <code>p</code>.
If <code>p</code> is a single number, then the overall probability for a value to
be missing will be <code>p</code> in all columns of <code>cols_mis</code>.
(Internally <code>p</code> will be replicated to a vector of the same length as
<code>cols_mis</code>.
So, all <code>p[i]</code> in the following sections will be equal to the given
single number <code>p</code>.)
Otherwise, <code>p</code> must be of the same length as <code>cols_mis</code>.
In this case, the overall probability for a value to be missing will be
<code>p[i]</code> in the column <code>cols_mis[i]</code>.
The position of the missing values in <code>cols_mis[i]</code> is controlled by
<code>cols_ctrl[i]</code>.
The following procedure is applied for each pair of <code>cols_ctrl[i]</code> and
<code>cols_mis[i]</code> to determine the positions of missing values:
</p>
<p>The default behavior (<code>sorting = TRUE</code>) of this function is to first
sort the column <code>cols_ctrl[i]</code>. Then missing values in
<code>cols_mis[i]</code> are created in the rows with the <code>round(nrow(ds) *
p[i])</code> smallest values. This censors approximately the proportion of
<code>p[i]</code> rows of smallest values in <code>cols_ctrl[i]</code> in
<code>cols_mis[i]</code>. Hence, the name of the function.
</p>
<p>If <code>where = "upper"</code>, instead of the rows with the smallest values, the
rows with the highest values will be selected. For <code>where = "both"</code>, the
one half of the <code>round(nrow(ds) * p[i])</code> rows with missing values will
be the rows with the smallest values and the other half will be the rows with
the highest values. So the censoring rows are dived to the highest and
smallest values of <code>cols_ctrl[i]</code>. For odd <code>round(nrow(ds) * p[i])</code>
one more value is set <code>NA</code> among the smallest values.
</p>
<p>If <code>n_mis_stochastic = TRUE</code> and <code>sorting = TRUE</code> the procedure is
lightly altered. In this case, at first the <code>floor(nrow(ds) * p[i])</code>
rows with the smallest values (<code>where = "lower"</code>) are set NA. If
<code>nrow(ds) * p[i] &gt; floor(nrow(ds) * p[i])</code>, the row with the next
greater value will be set NA with a probability to get expected
<code>nrow(ds) * p[i]</code> missing values. For <code>where = "upper"</code> this
"random" missing value will be the next smallest. For <code>where = "both"</code>
this "random" missing value will be the next greatest of the smallest values.
</p>
<p>If <code>sorting = FALSE</code>, the rows of <code>ds</code> will not be sorted. Instead,
a quantile will be calculated (using <code>quantile</code>). If
<code>where = "lower"</code>, the <code>quantile(ds[, cols_ctrl[i]], p[i])</code> will be
calculated and all rows with values in <code>ds[, cols_ctrl[i]]</code> below this
quantile will have missing values in <code>cols_mis[i]</code>. For <code>where =
"upper"</code>, the <code>quantile(ds[, cols_ctrl[i]], 1 - p[i])</code> will be
calculated and all rows with values above this quantile will have missing
values. For <code>where = "both"</code>, the <code>quantile(ds[, cols_ctrl[i]],
p[i] / 2)</code> and <code>quantile(ds[, cols_ctrl[i]], 1 -  p[i] / 2)</code> will be
calculated. All rows with values in <code>cols_ctrl[i]</code> below the first
quantile or above the second quantile will have missing values in
<code>cols_mis[i]</code>.
</p>
<p>For <code>sorting = FALSE</code> only <code>n_mis_stochastic = FALSE</code> is
implemented at the moment.
</p>
<p>The option <code>sorting = TRUE</code> with <code>n_mis_stochastic = FALSE</code> will
always create exactly <code>round(nrow(ds) * p[i])</code> missing values in
<code>cols_mis[i]</code>. With <code>n_mis_stochastic = TRUE</code>) sorting will result
in <code>floor(nrow(ds) * p[i])</code> or <code>ceiling(nrow(ds) * p[i])</code> missing
values in <code>cols_mis[i]</code>. For <code>sorting = FALSE</code>, the number of
missing values will normally be close to <code>nrow(ds) * p[i]</code>. But for
<code>cols_ctrl</code> with many duplicates the choice <code>sorting = FALSE</code> can
be problematic, because of the calculation of <code>quantile(ds[,
cols_ctrl[i]], p[i])</code> and setting values <code>NA</code> below this threshold (see
examples). So, in most cases <code>sorting = TRUE</code> is recommended.
</p>


<h3>Value</h3>

<p>An object of the same class as <code>ds</code> with missing values.
</p>


<h3>References</h3>

<p>Santos, M. S., Pereira, R. C., Costa, A. F., Soares, J. P.,
Santos, J., &amp; Abreu, P. H. (2019). Generating Synthetic Missing Data: A
Review by Missing Mechanism. <em>IEEE Access</em>, 7, 11651-11667
</p>


<h3>See Also</h3>

<p><code>delete_MNAR_censoring</code>
</p>
<p>Other functions to create MAR: 
<code>delete_MAR_1_to_x()</code>,
<code>delete_MAR_one_group()</code>,
<code>delete_MAR_rank()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">ds &lt;- data.frame(X = 1:20, Y = 101:120)
delete_MAR_censoring(ds, 0.2, "X", "Y")
# many dupplicated values can be problematic for sorting = FALSE:
ds_many_dup &lt;- data.frame(X = 1:20, Y = c(rep(0, 10), rep(1, 10)))
delete_MAR_censoring(ds_many_dup, 0.2, "X", "Y") # 4 NAs as expected
quantile(ds_many_dup$Y, 0.2) # 0
# No value is BELOW 0 in ds_many_dup$Y, so no missing values will be created:
delete_MAR_censoring(ds_many_dup, 0.2, "X", "Y", sorting = FALSE) # No NA!
</code></pre>


</div>