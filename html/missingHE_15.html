<div class="container">

<table style="width: 100%;"><tr>
<td>pattern</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Full Bayesian Models to handle missingness in Economic Evaluations (Pattern Mixture Models)</h2>

<h3>Description</h3>

<p>Full Bayesian cost-effectiveness models to handle missing data in the outcomes under different missingness 
mechanism assumptions, using alternative parametric distributions for the effect and cost variables and a pattern mixture approach to identify the model. 
The analysis is performed using the <code>BUGS</code> language, which is implemented in the software <code>JAGS</code> using the function <code>jags</code>.
The output is stored in an object of class 'missingHE'.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pattern(
  data,
  model.eff,
  model.cost,
  dist_e,
  dist_c,
  Delta_e,
  Delta_c,
  type,
  restriction = "CC",
  prob = c(0.025, 0.975),
  n.chains = 2,
  n.iter = 20000,
  n.burnin = floor(n.iter/2),
  inits = NULL,
  n.thin = 1,
  ppc = FALSE,
  save_model = FALSE,
  prior = "default",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame in which to find the variables supplied in <code>model.eff</code>, <code>model.cost</code> (model formulas for effects and costs).
Among these, effectiveness, cost and treatment indicator (only two arms) variables must always be provided and named 'e', 'c' and 't', respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model.eff</code></td>
<td>
<p>A formula expression in conventional <code>R</code> linear modelling syntax. The response must be a health economic
effectiveness outcome ('e') whose name must correspond to that used in <code>data</code>. Any covariates in the model must be provided on the right-hand side of the formula.
If there are no covariates, <code>1</code> should be specified on the right hand side of the formula. By default, covariates are placed on the "location" parameter of the distribution through a linear model.
Random effects can also be specified for each model parameter. See details for how these can be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model.cost</code></td>
<td>
<p>A formula expression in conventional <code>R</code> linear modelling syntax. The response must be a health economic
cost outcome ('c') whose name must correspond to that used in <code>data</code>. Any covariates in the model must be provided on the right-hand side of the formula.
If there are no covariates, <code>1</code> should be specified on the right hand side of the formula. 
By default, covariates are placed on the "location" parameter of the distribution through a linear model. A joint bivariate distribution for effects and costs can be specified by including 'e' on the right-hand side of the formula for the costs model.
Random effects can also be specified for each model parameter. See details for how these can be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist_e</code></td>
<td>
<p>Distribution assumed for the effects. Current available chocies are: Normal ('norm'), Beta ('beta'), Gamma ('gamma'), Exponential ('exp'),
Weibull ('weibull'), Logistic ('logis'), Poisson ('pois'), Negative Binomial ('nbinom') or Bernoulli ('bern').</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist_c</code></td>
<td>
<p>Distribution assumed for the costs. Current available chocies are: Normal ('norm'), Gamma ('gamma') or LogNormal ('lnorm').</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Delta_e</code></td>
<td>
<p>Range of values for the prior on the sensitivity parameters used to identify the mean of the effects under MNAR. The value must be set to 0 under MAR.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Delta_c</code></td>
<td>
<p>Range of values for the prior on the sensitivity parameters used to identify the mean of the costs under MNAR. The value must be set to 0 under MAR.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Type of missingness mechanism assumed. Choices are Missing At Random (MAR) and Missing Not At Random (MNAR).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>restriction</code></td>
<td>
<p>type of identifying restriction to be imposed to identify the distributions of the missing data in each pattern. 
Available choices are: complete case restrcition ('CC') - default - or available case restriction ('AC').</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prob</code></td>
<td>
<p>A numeric vector of probabilities within the range (0,1), representing the upper and lower
CI sample quantiles to be calculated and returned for the imputed values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.chains</code></td>
<td>
<p>Number of chains.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.iter</code></td>
<td>
<p>Number of iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.burnin</code></td>
<td>
<p>Number of warmup iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inits</code></td>
<td>
<p>A list with elements equal to the number of chains selected; each element of the list is itself a list of starting values for the
<code>JAGS</code> model, or a function creating (possibly random) initial values. If <code>inits</code> is <code>NULL</code>, <code>JAGS</code>
will generate initial values for all the model parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.thin</code></td>
<td>
<p>Thinning interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ppc</code></td>
<td>
<p>Logical. If <code>ppc</code> is <code>TRUE</code>, the estimates of the parameters that can be used to generate replications from the model are saved.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save_model</code></td>
<td>
<p>Logical. If <code>save_model</code> is <code>TRUE</code> a <code>txt</code> file containing the model code is printed
in the current working directory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior</code></td>
<td>
<p>A list containing the hyperprior values provided by the user. Each element of this list must be a vector of length two
containing the user-provided hyperprior values and must be named with the name of the corresponding parameter. For example, the hyperprior
values for the standard deviation effect parameters can be provided using the list <code>prior = list('sigma.prior.e' = c(0, 100))</code>.
For more information about how to provide prior hypervalues for different types of parameters and models see details. 
If <code>prior</code> is set to 'default', the default values will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments that can be provided by the user. Examples are <code>center = TRUE</code> to center all the covariates in the model 
or the additional arguments that can be provided to the function <code>bcea</code> to summarise the health economic evaluation results.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Depending on the distributions specified for the outcome variables in the arguments <code>dist_e</code> and
<code>dist_c</code> and the type of missingness mechanism specified in the argument <code>type</code>, different pattern mixture models
are built and run in the background by the function <code>pattern</code>. The model for the outcomes is fitted in each missingness pattern 
and the parameters indexing the missing data distributions are identified using: the corresponding parameters identified from the observed data
in other patterns (under 'MAR'); or a combination of the parameters identified by the observed data and some sensitivity parameters (under 'MNAR'). 
A simple example can be used to show how pattern mixture models are specified. 
Consider a data set comprising a response variable <code class="reqn">y</code> and a set of centered covariate <code class="reqn">X_j</code>. We denote with <code class="reqn">d_i</code> the patterns' indicator variable for each 
subject in the trial <code class="reqn">i = 1, ..., n</code> such that: <code class="reqn">d_i = 1</code> indicates the completers (both e and c observed), <code class="reqn">d_i = 2</code> and <code class="reqn">d_i = 3</code> indicate that 
only the costs or effects are observed, respectively, while <code class="reqn">d_i = 4</code> indicates that neither of the two outcomes is observed. In general, a different number of patterns 
can be observed between the treatment groups and <code>missingHE</code> accounts for this possibility by modelling a different patterns' indicator variables for each arm. 
For simplicity, in this example, we assume that the same number of patterns is observed in both groups. <code class="reqn">d_i</code> is assigned a multinomial distribution, 
which probabilities are modelled using a Dirichlet prior (by default giving to each pattern the same weight). Next, the model specified in <code>dist_e</code> 
and <code>dist_c</code> is fitted in each pattern. The parameters that cannot be identified by the observed data in each pattern (d = 2, 3, 4), e.g. the means.
<code class="reqn">mu_e[d]</code> and <code>mu_c[d]</code>, can be identified using the parameters estimated from other patterns. Two choices are currently available: the complete cases ('CC') or available cases ('AC').
For example, using the 'CC' restriction, the parameters indexing the distributions of the missing data are identified as: 
</p>
<p style="text-align: center;"><code class="reqn">mu_e[2] = \mu_e[4] = \mu_e[1] + \Delta_e</code>
</p>

<p style="text-align: center;"><code class="reqn">mu_c[3] = \mu_c[4] = \mu_c[1] + \Delta_c</code>
</p>

<p>where
</p>

<ul>
<li> <p><code class="reqn">\mu_e[1]</code> is the effects mean for the completers.
</p>
</li>
<li> <p><code class="reqn">\mu_c[1]</code> is the costs mean for the completers.
</p>
</li>
<li> <p><code class="reqn">\Delta_e</code> is the sensitivity parameters associated with the marginal effects mean.
</p>
</li>
<li> <p><code class="reqn">\Delta_c</code> is the sensitivity parameters associated with the marginal costs mean.
</p>
</li>
</ul>
<p>If the 'AC' restriction is chosen, only the parameters estimated from the observed data in pattern 2 (costs) and pattern 3 (effects) are used to identify those in the other patterns.  
When <code class="reqn">\Delta_e = 0</code> and <code class="reqn">\Delta_c = 0</code> the model assumes a 'MAR' mechanism. When <code class="reqn">\Delta_e != 0</code> and/or <code class="reqn">\Delta_c != 0</code> 'MNAR' departues for the 
effects and/or costs are explored assuming a Uniform prior distributions for the sensitivity parameters. The range of values for these priors is defined based on the
boundaries specified in <code>Delta_e</code> and <code>Delta_c</code> (see Arguments), which must be provided by the user. 
When user-defined hyperprior values are supplied via the argument <code>prior</code> in the function <code>pattern</code>, the elements of this list (see Arguments)
must be vectors of length two containing the user-provided hyperprior values and must take specific names according to the parameters they are associated with. 
Specifically, the names for the parameters indexing the model which are accepted by <strong>missingHE</strong> are the following:
</p>

<ul>
<li>
<p> location parameters <code class="reqn">\alpha_0</code> and <code class="reqn">\beta_0</code>: "mean.prior.e"(effects) and/or "mean.prior.c"(costs)
</p>
</li>
<li>
<p> auxiliary parameters <code class="reqn">\sigma</code>: "sigma.prior.e"(effects) and/or "sigma.prior.c"(costs)
</p>
</li>
<li>
<p> covariate parameters <code class="reqn">\alpha_j</code> and <code class="reqn">\beta_j</code>: "alpha.prior"(effects) and/or "beta.prior"(costs)
</p>
</li>
</ul>
<p>The only exception is the missingness patterns' probability <code class="reqn">\pi</code>, denoted with "patterns.prior", whose hyperprior values must be provided as a list
formed by two elements. These must be vectors of the same length equal to the number of patterns in the control (first element) and intervention (second element) group.
</p>
<p>For each model, random effects can also be specified for each parameter by adding the term + (x | z) to each model formula, 
where x is the fixed regression coefficient for which also the random effects are desired and z is the clustering variable across which 
the random effects are specified (must be the name of a factor variable in the dataset). Multiple random effects can be specified using the 
notation + (x1 + x2 | site) for each covariate that was included in the fixed effects formula. Random intercepts are included by default in the models
if a random effects are specified but they can be removed by adding the term 0 within the random effects formula, e.g. + (0 + x | z).
</p>


<h3>Value</h3>

<p>An object of the class 'missingHE' containing the following elements
</p>

<dl>
<dt>data_set</dt>
<dd>
<p>A list containing the original data set provided in <code>data</code> (see Arguments), the number of observed and missing individuals 
, the total number of individuals by treatment arm and the indicator vectors for the missing values</p>
</dd>
<dt>model_output</dt>
<dd>
<p>A list containing the output of a <code>JAGS</code> model generated from the functions <code>jags</code>, and 
the posterior samples for the main parameters of the model and the imputed values</p>
</dd>
<dt>cea</dt>
<dd>
<p>A list containing the output of the economic evaluation performed using the function <code>bcea</code></p>
</dd>
<dt>type</dt>
<dd>
<p>A character variable that indicate which type of missingness assumption has been used to run the model, 
either <code>MAR</code> or <code>MNAR</code> (see details)</p>
</dd>
<dt>data_format</dt>
<dd>
<p>A character variable that indicate which type of analysis was conducted, either using a <code>wide</code> or <code>longitudinal</code> dataset</p>
</dd>
</dl>
<h3>Author(s)</h3>

<p>Andrea Gabrio
</p>


<h3>References</h3>

<p>Daniels, MJ. Hogan, JW. <em>Missing Data in Longitudinal Studies: strategies for Bayesian modelling and sensitivity analysis</em>, CRC/Chapman Hall.
</p>
<p>Baio, G.(2012). <em>Bayesian Methods in Health Economics</em>. CRC/Chapman Hall, London.
</p>
<p>Gelman, A. Carlin, JB., Stern, HS. Rubin, DB.(2003). <em>Bayesian Data Analysis, 2nd edition</em>, CRC Press.
</p>
<p>Plummer, M. <em>JAGS: A program for analysis of Bayesian graphical models using Gibbs sampling.</em> (2003).
</p>


<h3>See Also</h3>

<p><code>jags</code>, <code>bcea</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Quck example to run using subset of MenSS dataset
MenSS.subset &lt;- MenSS[50:100, ]

# Run the model using the pattern function assuming a SCAR mechanism
# Use only 100 iterations to run a quick check
model.pattern &lt;- pattern(data = MenSS.subset,model.eff = e~1,model.cost = c~1,
   dist_e = "norm", dist_c = "norm",type = "MAR", Delta_e = 0, Delta_c = 0, 
   n.chains = 2, n.iter = 100, ppc = FALSE)

# Print the results of the JAGS model
print(model.pattern)
#

# Use dic information criterion to assess model fit
pic.dic &lt;- pic(model.pattern, criterion = "dic", module = "total")
pic.dic
#

# Extract regression coefficient estimates
coef(model.pattern)
#



# Assess model convergence using graphical tools
# Produce histograms of the posterior samples for the mean effects
diag.hist &lt;- diagnostic(model.pattern, type = "histogram", param = "mu.e")
#

# Compare observed effect data with imputations from the model
# using plots (posteiror means and credible intervals)
p1 &lt;- plot(model.pattern, class = "scatter", outcome = "effects")
#

# Summarise the CEA information from the model
summary(model.pattern)


# Further examples which take longer to run
model.pattern &lt;- pattern(data = MenSS, model.eff = e ~ u.0,model.cost = c ~ e,
   Delta_e = 0, Delta_c = 0, dist_e = "norm", dist_c = "norm",
   type = "MAR", n.chains = 2, n.iter = 500, ppc = FALSE)
#
# Print results for all imputed values
print(model.pattern, value.mis = TRUE)

# Use looic to assess model fit
pic.looic&lt;-pic(model.pattern, criterion = "looic", module = "total")
pic.looic

# Show density plots for all parameters
diag.hist &lt;- diagnostic(model.pattern, type = "denplot", param = "all")

# Plots of imputations for all data
p1 &lt;- plot(model.pattern, class = "scatter", outcome = "all")

# Summarise the CEA results
summary(model.pattern)


#
#
</code></pre>


</div>