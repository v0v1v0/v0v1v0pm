<div class="container">

<table style="width: 100%;"><tr>
<td>check.resid</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Residual Diagnostics</h2>

<h3>Description</h3>

<p>This function performs residual diagnostics for linear models estimated by
using the <code>lm()</code> function for detecting nonlinearity (partial residual or
component-plus-residual plots), nonconstant error variance (predicted values
vs. residuals plot), and non-normality of residuals (Q-Q plot and histogram
with density plot).
</p>


<h3>Usage</h3>

<pre><code class="language-R">check.resid(model, type = c("linear", "homo", "normal"),
            resid = c("unstand", "stand", "student"),
            point.shape = 21, point.fill = "gray80", point.size = 1,
            line1 = TRUE, line2 = TRUE,
            line.type1 = "solid", line.type2 = "dashed",
            line.width1 = 1, line.width2 = 1,
            line.color1 = "#0072B2", line.color2 = "#D55E00",
            bar.width = NULL, bar.n = 30, bar.color = "black",
            bar.fill = "gray95", strip.size = 11,
            label.size = 10, axis.size = 10,
            xlimits = NULL, ylimits = NULL,
            xbreaks = ggplot2::waiver(), ybreaks = ggplot2::waiver(),
            check = TRUE, plot = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>a fitted model of class <code>lm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>a character string specifying the type of the plot, i.e.,
<code>"linear"</code> for partial (component-plus-residual) plots,
<code>"homo"</code> (default) for predicted values vs. residuals
plot, and <code>"normal"</code> for Q-Q plot and histogram with
a density plot. Note that partial plots are not available
for models with interaction terms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resid</code></td>
<td>
<p>a character string specifying the type of residual used for
the partial (component-plus-residual) plots or Q-Q plot and
histogram, i.e., <code>"unstand"</code> for unstandardized residuals
<code>"stand"</code> for standardized residuals, and <code>"student"</code>
for studentized residual. By default, studentized residuals
are used for predicted values vs. residuals plot and unstandardized
residuals are used for Q-Q plot and histogram.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>point.shape</code></td>
<td>
<p>a numeric value for specifying the argument <code>shape</code>
in the <code>geom_point</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>point.fill</code></td>
<td>
<p>a numeric value for specifying the argument <code>fill</code>
in the <code>geom_point</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>point.size</code></td>
<td>
<p>a numeric value for specifying the argument <code>size</code>
in the <code>geom_point</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>line1</code></td>
<td>
<p>logical: if <code>TRUE</code> (default), regression line is drawn
in the partial (component-plus-residual) plots, horizontal
line is drawn in the predicted values vs. residuals plot,
and t-distribution or normal distribution curve is drawn in
the histogram.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>line2</code></td>
<td>
<p>logical: if <code>TRUE</code> (default), Loess smooth line is drawn
in the partial (component-plus-residual) plots, loess smooth
lines are drawn in the predicted values vs. residuals plot,
and density curve is drawn in the histogram.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>line.type1</code></td>
<td>
<p>a character string or numeric value for specifying the argument
<code>linetype</code> in the <code>geom_smooth</code>, <code>geom_hline</code>,
or <code>stat_function</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>line.type2</code></td>
<td>
<p>a character string or numeric value for specifying the argument
<code>linetype</code> in the <code>geom_smooth</code> or <code>geom_density</code>
function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>line.width1</code></td>
<td>
<p>a numeric value for specifying the argument <code>linewidth</code>
in the <code>geom_smooth</code>, <code>geom_hline</code>, or <code>stat_function</code>
function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>line.width2</code></td>
<td>
<p>a numeric value for specifying the argument <code>linewidth</code>
in the <code>geom_smooth</code> or <code>geom_density</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>line.color1</code></td>
<td>
<p>a character string or numeric value for specifying the argument
<code>color</code> in the <code>geom_smooth</code>, <code>geom_hline</code>,
or <code>stat_function</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>line.color2</code></td>
<td>
<p>a character string or numeric value for specifying the argument
<code>color</code> in the <code>geom_smooth</code> or <code>geom_density</code>
function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bar.width</code></td>
<td>
<p>a numeric value for specifying the argument <code>bins</code> in
the <code>geom_bar</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bar.n</code></td>
<td>
<p>a numeric value for specifying the argument <code>bins</code> in
the <code>geom_bar</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bar.color</code></td>
<td>
<p>a character string or numeric value for specifying the argument
<code>color</code> in the <code>geom_bar</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bar.fill</code></td>
<td>
<p>a character string or numeric value for specifying the argument
<code>fill</code> in the <code>geom_bar</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strip.size</code></td>
<td>
<p>a numeric value for specifying the argument <code>size</code> in
the <code>element_text</code> function of the <code>strip.text</code>
argument within the <code>theme</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label.size</code></td>
<td>
<p>a numeric value for specifying the argument <code>size</code> in
the <code>element_text</code> function of the <code>axis.title</code>
argument within the <code>theme</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>axis.size</code></td>
<td>
<p>a numeric value for specifying the argument <code>size</code> in
the <code>element_text</code> function of the <code>axis.text </code>
argument within the <code>theme</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlimits</code></td>
<td>
<p>a numeric value for specifying the argument <code>limits</code>
in the <code>scale_x_continuous</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylimits</code></td>
<td>
<p>a numeric value for specifying the argument <code>limits</code>
in the <code>scale_y_continuous</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xbreaks</code></td>
<td>
<p>a numeric value for specifying the argument <code>breaks </code>
in the <code>scale_x_continuous</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ybreaks</code></td>
<td>
<p>a numeric value for specifying the argument <code>breaks </code>
in the <code>scale_y_continuous</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check</code></td>
<td>
<p>logical: if <code>TRUE</code> (default), argument specification is checked.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>logical: if <code>TRUE</code> (default), a plot is drawn.</p>
</td>
</tr>
</table>
<h3>Details</h3>


<dl>
<dt><strong>Nonlinearity</strong></dt>
<dd>
<p>The violation of the assumption of linearity
implies that the model cannot accurately capture the systematic pattern of the
relationship between the outcome and predictor variables. In other words, the
specified regression surface does not accurately represent the relationship
between the conditional mean values of <code class="reqn">Y</code> and the <code class="reqn">X</code>s. That means
the average error <code class="reqn">E(\varepsilon)</code> is not 0 at every point on the regression
surface (Fox, 2015).
</p>
<p>In multiple regression, plotting the outcome variable <code class="reqn">Y</code> against each predictor
variable <code class="reqn">X</code> can be misleading because it does not reflect the partial
relationship between <code class="reqn">Y</code> and <code class="reqn">X</code> (i.e., statistically controlling for
the other <code class="reqn">X</code>s), but rather the marginal relationship between <code class="reqn">Y</code> and
<code class="reqn">X</code> (i.e., ignoring the other <code class="reqn">X</code>s). Partial residual plots or
component-plus-residual plots should be used to detect nonlinearity in multiple
regression. The partial residual for the <code class="reqn">j</code>th predictor variable is defined
as
</p>
<p style="text-align: center;"><code class="reqn">e_i^{(j)} = b_jX_{ij} + e_i</code>
</p>

<p>The linear component of the partial relationship between <code class="reqn">Y</code> and <code class="reqn">X_j</code>
is added back to the least-squares residuals, which may include an unmodeled
nonlinear component. Then, the partial residual <code class="reqn">e_i^{(j)}</code> is plotted
against the predictor variable <code class="reqn">X_j</code>. Nonlinearity may become apparent when
a non-parametric regression smoother is applied.
</p>
<p>By default, the function plots
each predictor against the partial residuals, and draws the linear regression
and the loess smooth line to the partial residual plots.</p>
</dd>
<dt><strong>Nonconstant Error Variance</strong></dt>
<dd>
<p>The violation of the assumption of
constant error variance, often referred to as heteroscedasticity, implies that
the variance of the outcome variable around the regression surface is not the
same at every point on the regression surface (Fox, 2015).
</p>
<p>Plotting residuals against the outcome variable <code class="reqn">Y</code> instead of the predicted
values <code class="reqn">\hat{Y}</code> is not recommended because <code class="reqn">Y = \hat{Y} + e</code>. Consequently,
the linear correlation between the outcome variable <code class="reqn">Y</code> and the residuals
<code class="reqn">e</code> is <code class="reqn">\sqrt{1 - R^2}</code> where <code class="reqn">R</code> is the multiple correlation coefficient.
In contrast, plotting residuals against the predicted values <code class="reqn">\hat{Y}</code> is
much easier to examine for evidence of nonconstant error variance as the correlation
between <code class="reqn">\hat{Y}</code> and <code class="reqn">e</code> is 0. Note that the least-squares residuals
generally have unequal variance <code class="reqn">Var(e_i) = \sigma^2 / (1 - h_i)</code> where
<code class="reqn">h</code> is the leverage of observation <code class="reqn">i</code>, even if errors have constant
variance <code class="reqn">\sigma^2</code>. The studentized residuals <code class="reqn">e^*_i</code>, however, have
a constant variance under the assumption of the regression model. Residuals
are studentized by dividing them by <code class="reqn">\sigma^2_i(\sqrt{(1 - h_i)}</code> where
<code class="reqn">\sigma^2_i</code> is the estimate of <code class="reqn">\sigma^2</code> obtained after deleting the
<code class="reqn">i</code>th observation, and <code class="reqn">h_i</code> is the leverage of observation <code class="reqn">i</code>
(Meuleman et al, 2015).
</p>
<p>By default, the function plots the predicted values
against the studentized residuals. It also draws a horizontal line at 0, a
loess smooth lines for all residuals as well as separate loess smooth lines
for positive and negative residuals.</p>
</dd>
<dt><strong>Non-normality of Residuals</strong></dt>
<dd>
<p>Statistical inference under the
violation of the assumption of normally distributed errors is approximately
valid in all but small samples. However, the efficiency of least squares is
not robust because the least-squares estimator is the most efficient and
unbiased estimator only when the errors are normally distributed. For instance,
when error distributions have heavy tails, the least-squares estimator becomes
much less efficient compared to robust estimators. In addition, error distributions with
heavy-tails result in outliers and compromise the interpretation of conditional
means because the mean is not an accurate measure of central tendency in a highly
skewed distribution. Moreover, a multimodal error distribution suggests the omission
of one or more discrete explanatory variables that naturally divide the data
into groups (Fox, 2016).
</p>
<p>By default, the function plots a Q-Q plot of the unstandardized residuals, and
a histogram of the unstandardized residuals and a density plot. Note that
studentized residuals follow a <code class="reqn">t</code>-distribution with <code class="reqn">n - k - 2</code> degrees
of freedom where <code class="reqn">n</code> is the sample size and <code class="reqn">k</code> is the number of predictors.
However, the normal and <code class="reqn">t</code>-distribution are nearly identical unless the
sample size is small. Moreover, even if the model is correct, the studentized
residuals are not an independent random sample from <code class="reqn">t_{n - k - 2}</code>. Residuals
are correlated with each other depending on the configuration of the predictor
values. The correlation is generally negligible unless the sample size is small.</p>
</dd>
</dl>
<h3>Value</h3>

<p>Returns an object of class <code>misty.object</code>, which is a list with following
entries:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>function call</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>type of analysis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>model specified in <code>model</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotdat</code></td>
<td>
<p>data frame used for the plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>args</code></td>
<td>
<p>specification of function arguments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>ggplot2 object for plotting the residuals</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Takuya Yanagida <a href="mailto:takuya.yanagida@univie.ac.at">takuya.yanagida@univie.ac.at</a>
</p>


<h3>References</h3>

<p>Fox, J. (2016). <em>Applied regression analysis and generalized linear models</em>
(3rd ed.). Sage Publications, Inc.
</p>
<p>Meuleman, B., Loosveldt, G., &amp; Emonds, V. (2015). Regression analysis: Assumptions
and diagnostics. In H. Best &amp; C. Wolf (Eds.), <em>The SAGE handbook of regression analysis and causal inference (pp. 83-110)</em>.
Sage.
</p>


<h3>See Also</h3>

<p><code>check.collin</code>, <code>check.outlier</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
#-------------------------------------------------------------------------------
# Residual diagnostics for a linear model

mod &lt;- lm(Ozone ~ Solar.R + Wind + Temp, data = airquality)

# Example 1: Partial (component-plus-residual) plots
check.resid(mod, type = "linear")

# Example 2: Predicted values vs. residuals plot
check.resid(mod, type = "homo")

# Example 3: Q-Q plot and histogram with density plot
check.resid(mod, type = "normal")

#-------------------------------------------------------------------------------
# Extract data and ggplot2 object

object &lt;- check.resid(mod, type = "linear", plot = FALSE)

# Data frame
object$plotdat

# ggplot object
object$plot

## End(Not run)
</code></pre>


</div>