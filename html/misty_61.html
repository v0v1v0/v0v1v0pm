<div class="container">

<table style="width: 100%;"><tr>
<td>lagged</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create Lagged Variables</h2>

<h3>Description</h3>

<p>This function computes lagged values of variables by a specified number of
observations. By default, the function returns lag-1 values of the vector,
matrix, or data frame specified in the first argument.
</p>


<h3>Usage</h3>

<pre><code class="language-R">lagged(..., data = NULL, id = NULL, obs = NULL, day = NULL, lag = 1, time = NULL,
       units = c("secs", "mins", "hours", "days", "weeks"), append = TRUE,
       name = ".lag", name.td = ".td", as.na = NULL, check = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>a vector for computing a lagged values for a variable, matrix
or data frame for computing lagged values for more than one
variable. Note that the subject ID variable (<code>id</code>),
observation number variable (<code>obs</code>), day number variable
(<code>day</code>), and the date and time variable (<code>time</code>) are
excluded from <code>...</code> when specifying the argument the
using the names of the variables. Alternatively, an expression
indicating the variable names in <code>data</code>. Note that the
operators <code>.</code>, <code>+</code>, <code>-</code>, <code>~</code>, <code>:</code>,
<code>::</code>, and <code>!</code> can also be used to select variables,
see 'Details' in the <code>df.subset</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame when specifying one or more variables in the
argument <code>...</code>. Note that the argument is <code>NULL</code>
when specifying a vector, matrix, or data frame for the argument
<code>...</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>either a character string indicating the variable name of the
subject ID variable in '...' or a vector representing the
subject IDs, see 'Details'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs</code></td>
<td>
<p>either a character string indicating the variable name of the
observation number variable in '...' or a vector representing
the observations. Note that duplicated values within the same
subject ID are not allowed, see 'Details'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>day</code></td>
<td>
<p>either a character string indicating the variable name of the
day number variable in '...' or a vector representing the days,
see 'Details'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lag</code></td>
<td>
<p>a numeric value specifying the lag, e.g. <code>lag = 1</code> (default)
returns lag-1 values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>a variable of class <code>POSIXct</code> or <code>POSIXlt</code> representing
the date and time of the observation used to compute time
differences between observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>units</code></td>
<td>
<p>a character string indicating the units in which the time
difference is represented, i.e., <code>"secs"</code> for seconds,
<code>"mins"</code> (default) for minutes, <code>"hours"</code> for hours,
<code>"days"</code> for days, and <code>"weeks"</code> for weeks.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>append</code></td>
<td>
<p>logical: if <code>TRUE</code> (default), lagged variable(s) are
appended to the data frame specified in the argument <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>
<p>a character string or character vector indicating the names of
the lagged variables. By default, lagged variables are named
with the ending <code>".lag"</code> resulting in e.g. <code>"x1.lag"</code>
and <code>"x2.lag"</code> when specifying two variables. Variable
names can also be specified using a character vector matching
the number of variables specified in <code>...</code>, e.g.
<code>name = c("lag.x1", "lag.x2")</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name.td</code></td>
<td>
<p>a character string or character vector indicating the names of
the time difference variables when specifying a date and time
variables for the argument <code>time</code>. By default, time
difference variables are named with the ending <code>".td"</code>
resulting in e.g. <code>"x1.td"</code> and <code>"x2.td"</code> when
specifying two variables. Variable names can also be specified
using a character vector matching the number of variables
specified in <code>...</code>, e.g. <code>name = c("td.x1", "td.x2")</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as.na</code></td>
<td>
<p>a numeric vector indicating user-defined missing values, i.e.
these values are converted to <code>NA</code> before conducting the
analysis. Note that <code>as.na()</code> function is only applied to
the argument <code>x</code>, but not to <code>cluster</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check</code></td>
<td>
<p>logical: if <code>TRUE</code> (default), argument specification is
checked.</p>
</td>
</tr>
</table>
<h3>Details</h3>


<p>The function is used to create lagged version of the variable(s) specified via
the <code>...</code> argument:
</p>
<dl>
<dt><strong>Optional argument <code>id</code></strong></dt>
<dd>
<p>If the <code>id</code> argument is not specified
<code>i.e., id = NULL</code>, all observations are assumed to come from the same
subject.  If the dataset includes multiple subjects, then this variable needs
to be specified so that observations are not lagged across subjects</p>
</dd>
<dt><strong>Optional argument <code>day</code></strong></dt>
<dd>
<p>If the <code>day</code> argument is not specified
<code>i.e., day = NULL</code>, values of the variable to be lagged are allowed to be
lagged across days in case there are multiple observation days.</p>
</dd>
<dt><strong>Optional argument <code>obs</code></strong></dt>
<dd>
<p>If the <code>obs</code> argument is not specified
<code>i.e., obs = NULL</code>, consecutive observations from the same subjects are
assumed to be one lag apart.</p>
</dd>
</dl>
<h3>Value</h3>

<p>Returns a numeric vector or data frame with the same length or same number of
rows as <code>...</code> containing the lagged variable(s).
</p>


<h3>Note</h3>

<p>This function is a based on the <code>lagvar()</code> function in the <span class="pkg">esmpack</span>
package by Wolfgang Viechtbauer and Mihail Constantin (2023).
</p>


<h3>Author(s)</h3>

<p>Takuya Yanagida <a href="mailto:takuya.yanagida@univie.ac.at">takuya.yanagida@univie.ac.at</a>
</p>


<h3>References</h3>

<p>Viechtbauer W, Constantin M (2023). <em>esmpack: Functions that facilitate
preparation and management of ESM/EMA data</em>. R package version 0.1-20.
</p>


<h3>See Also</h3>

<p><code>center</code>, <code>rec</code>, <code>coding</code>, <code>item.reverse</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">dat &lt;- data.frame(subject = rep(1:2, each = 6),
                   day = rep(1:2, each = 3),
                   obs = rep(1:6, times = 2),
                   time = as.POSIXct(c("2024-01-01 09:01:00", "2024-01-01 12:05:00",
                                       "2024-01-01 15:14:00", "2024-01-02 09:03:00",
                                       "2024-01-02 12:21:00", "2024-01-02 15:03:00",
                                       "2024-01-01 09:02:00", "2024-01-01 12:09:00",
                                       "2024-01-01 15:06:00", "2024-01-02 09:02:00",
                                       "2024-01-02 12:15:00", "2024-01-02 15:06:00")),
                    pos = c(6, 7, 5, 8, NA, 7, 4, NA, 5, 4, 5, 3),
                    neg = c(2, 3, 2, 5, 3, 4, 6, 4, 6, 4, NA, 8))

# Example 1a: Lagged variable for 'pos'
lagged(dat$pos, id = dat$subject, day = dat$day)

# Example 1b: Alternative specification
lagged(dat[, c("pos", "subject", "day")], id = "subject", day = "day")

# Example 1c: Alternative specification using the 'data' argument
lagged(pos, data = dat, id = "subject", day = "day")

# Example 2a: Lagged variable for 'pos' and 'neg'
lagged(dat[, c("pos", "neg")], id = dat$subject, day = dat$day)

# Example 2b: Alternative specification using the 'data' argument
lagged(pos, neg, data = dat, id = "subject", day = "day")

# Example 3: Lag-2 variables for 'pos' and 'neg'
lagged(pos, neg, data = dat, id = "subject", day = "day", lag = 2)

# Example 4: Lagged variable and time difference variable
lagged(pos, neg, data = dat, id = "subject", day = "day", time = "time")

# Example 5: Lagged variables and time difference variables,
# name variables
lagged(pos, neg, data = dat, id = "subject", day = "day", time = "time",
       name = c("p.lag1", "n.lag1"), name.td = c("p.diff", "n.diff"))

# Example 6: NA observations excluded from the data frame
dat.excl &lt;- dat[!is.na(dat$pos), ]

# Number of observation not taken into account, i.e.,
# - observation 4 used as lagged value for observation 6 for subject 1
# - observation 1 used as lagged value for observation 3 for subject 2
lagged(pos, data = dat.excl, id = "subject", day = "day")

# Number of observation taken into account by specifying the 'ob' argument
lagged(pos, data = dat.excl, id = "subject", day = "day", obs = "obs")
</code></pre>


</div>