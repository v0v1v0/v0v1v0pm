<div class="container">

<table style="width: 100%;"><tr>
<td>multilevel.icc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Intraclass Correlation Coefficient, ICC(1) and ICC(2)</h2>

<h3>Description</h3>

<p>This function computes the intraclass correlation coefficient ICC(1), i.e.,
proportion of the total variance explained by the grouping structure, and ICC(2),
i.e., reliability of aggregated variables in a two-level and three-level model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">multilevel.icc(..., data = NULL, cluster, type = c("1a", "1b", "2"),
               method = c("aov", "lme4", "nlme"), REML = TRUE,
               as.na = NULL, check = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>a numeric vector, matrix, or data frame. Alternatively, an
expression indicating the variable names in <code>data</code>. Note
that the operators <code>.</code>, <code>+</code>, <code>-</code>, <code>~</code>,
<code>:</code>, <code>::</code>, and <code>!</code> can also be used to select
variables, see 'Details' in the <code>df.subset</code>
function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame when specifying one or more variables in the
argument <code>...</code>. Note that the argument is <code>NULL</code>
when specifying a numeric vector, matrix, or data frame for
the argument <code>...</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster</code></td>
<td>
<p>a character string indicating the name of the cluster
variable in <code>...</code> or <code>data</code> for two-level data,
a character vector indicating the names of the cluster
variables in <code>...</code> for three-level data, or a vector
or data frame representing the nested grouping structure
(i.e., group or cluster variables). Alternatively, a
character string or character vector indicating the variable
name(s) of the cluster variable(s) in <code>data</code>. Note that
the cluster variable at Level 3 come first in a three-level
model, i.e., <code>cluster = c("level3", "level2")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>a character string indicating the type of intraclass correlation
coefficient, i.e., <code>type = "1a"</code> (default) for ICC(1) and
<code>type = "2"</code> for ICC(2) when specifying a two-level model
(i.e., one cluster variable), and <code>type = "1a"</code> (default)
for ICC(1) representing the proportion of variance at Level 2
and Level 3, <code>type = "1b"</code> representing an estimate
of the expected correlation between two randomly chosen elements
in the same group, and <code>type = "2"</code> for ICC(2) when
specifying a three-level model (i.e., two cluster variables). See 'Details'
for the formula used in this function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>a character string indicating the method used to estimate
intraclass correlation coefficients, i.e., <code>method = "aov"</code>
ICC estimated using the <code>aov</code> function, <code>method = "lme4"</code>
(default) ICC estimated using the <code>lmer</code> function in the
<span class="pkg">lme4</span> package, <code>method = "nlme"</code> ICC estimated using
the <code>lme</code> function in the <span class="pkg">nlme</span> package. Note that
if the lme4 or nlme package is needed when estimating ICCs in
a three-level model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>REML</code></td>
<td>
<p>logical: if <code>TRUE</code> (default), restricted maximum likelihood
is used to estimate the null model when using the <code>lmer</code>
function in the <span class="pkg">lme4</span> package or the <code>lme</code> function
in the <span class="pkg">nlme</span> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as.na</code></td>
<td>
<p>a numeric vector indicating user-defined missing values,
i.e. these values are converted to <code>NA</code> before conducting
the analysis. Note that <code>as.na()</code> function is only applied
to <code>x</code> but not to <code>cluster</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check</code></td>
<td>
<p>logical: if <code>TRUE</code> (default), argument specification is
checked.</p>
</td>
</tr>
</table>
<h3>Details</h3>


<dl>
<dt><strong>Two-Level Model</strong></dt>
<dd>
<p>In a two-level model, the intraclass
correlation coefficients are computed in the random intercept-only model:
</p>
<p style="text-align: center;"><code class="reqn">Y_{ij} = \gamma_{00} + u_{0j} + r_{ij}</code>
</p>

<p>where the variance in <code class="reqn">Y</code> is decomposed into two independent components:
<code class="reqn">\sigma^2_{u_{0}}</code>, which represents the variance at Level 2, and
<code class="reqn">\sigma^2_{r}</code>, which represents the variance at Level 1 (Hox et al.,
2018). These two variances sum up to the total variance and are referred to
as variance components. The intraclass correlation coefficient, ICC(1)
<code class="reqn">\rho</code> requested by <code>type = "1a"</code> represents the proportion of the
total variance explained by the grouping structure and is defined by the equation
</p>
<p style="text-align: center;"><code class="reqn">\rho = \frac{\sigma^2_{u_{0}}}{\sigma^2_{u_{0}} + \sigma^2_{r}}</code>
</p>

<p>The intraclass correlation coefficient, ICC(2) <code class="reqn">\lambda_j</code> requested by
<code>type = "2"</code> represents the reliability of aggregated variables and is
defined by the equation
</p>
<p style="text-align: center;"><code class="reqn">\lambda_j = \frac{\sigma^2_{u_{0}}}{\sigma^2_{u_{0}} + \frac{\sigma^2_{r}}{n_j}} = \frac{n_j\rho}{1 + (n_j - 1)\rho}</code>
</p>

<p>where <code class="reqn">n_j</code> is the average group size (Snijders &amp; Bosker, 2012).
</p>
</dd>
<dt><strong>Three-Level Model</strong></dt>
<dd>
<p>In a three-level model, the intraclass
correlation coefficients are computed in the random intercept-only model:
</p>
<p style="text-align: center;"><code class="reqn">Y_{ijk} = \gamma_{000} + v_{0k} + u_{0jk} + r_{ijk}</code>
</p>

<p>where the variance in <code class="reqn">Y</code> is decomposed into three independent components:
<code class="reqn">\sigma^2_{v_{0}}</code>, which represents the variance at Level 3,
<code class="reqn">\sigma^2_{u_{0}}</code>, which represents the variance at Level 2, and
<code class="reqn">\sigma^2_{r}</code>, which represents the variance at Level 1 (Hox et al.,
2018). There are two ways to compute the intraclass correlation coefficient
in a three-level model. The first method requested by <code>type = "1a"</code>
represents the proportion of variance at Level 2 and Level 3 and should be
used if we are interested in a decomposition of the variance across levels.
The intraclass correlation coefficient, ICC(1) <code class="reqn">\rho_{L2}</code> at Level 2 is
defined as:
</p>
<p style="text-align: center;"><code class="reqn">\rho_{L2} = \frac{\sigma^2_{u_{0}}}{\sigma^2_{v_{0}} + \sigma^2_{u_{0}} + \sigma^2_{r}}</code>
</p>

<p>The ICC(1) <code class="reqn">\rho_{L3}</code> at Level 3 is defined as:
</p>
<p style="text-align: center;"><code class="reqn">\rho_{L3} = \frac{\sigma^2_{v_{0}}}{\sigma^2_{v_{0}} + \sigma^2_{u_{0}} + \sigma^2_{r}}</code>
</p>

<p>The second method requested by <code>type = "1b"</code> represents the expected
correlation between two randomly chosen elements in the same group. The
intraclass correlation coefficient, ICC(1) <code class="reqn">\rho_{L2}</code> at Level 2 is
defined as:
</p>
<p style="text-align: center;"><code class="reqn">\rho_{L2} = \frac{\sigma^2_{v_{0}} + \sigma^2_{u_{0}}}{\sigma^2_{v_{0}} + \sigma^2_{u_{0}} + \sigma^2_{r}}</code>
</p>

<p>The ICC(1) <code class="reqn">\rho_L3</code> at Level 3 is defined as:
</p>
<p style="text-align: center;"><code class="reqn">\rho_{L3} = \frac{\sigma^2_{v_{0}}}{\sigma^2_{v_{0}} + \sigma^2_{u_{0}} + \sigma^2_{r}}</code>
</p>

<p>Note that both formula are correct, but express different aspects of the data,
which happen to coincide when there are only two levels (Hox et al., 2018).
</p>
<p>The intraclass correlation coefficients, ICC(2) requested by <code>type = "2"</code>
represent the reliability of aggregated variables at Level 2 and Level 3.
The ICC(2) <code class="reqn">\lambda_j</code> at Level 2 is defined as:
</p>
<p style="text-align: center;"><code class="reqn">\lambda_j = \frac{\sigma^2_{u_{0}}}{\sigma^2_{u_{0}} + \frac{\sigma^2_{r}}{n_j}}</code>
</p>

<p>The ICC(2) <code class="reqn">\lambda_k</code> at Level 3 is defined as:
</p>
<p style="text-align: center;"><code class="reqn">\lambda_k = \frac{\sigma^2_{v_{0}}}{\frac{{\sigma^2_{v_{0}} + \sigma^2_{u_{0}}}}{n_{j}} + \frac{\sigma^2_{r}}{n_k \cdot n_j}}</code>
</p>

<p>where <code class="reqn">n_j</code> is the average group size at Level 2 and <code class="reqn">n_j</code> is the average group size at Level 3 (Hox et al., 2018).</p>
</dd>
</dl>
<h3>Value</h3>

<p>Returns a numeric vector or matrix with intraclass correlation coefficient(s).
In a three level model, the label <code>L2</code> is used for ICCs at Level 2 and <code>L3</code> for ICCs at Level 3.
</p>


<h3>Author(s)</h3>

<p>Takuya Yanagida <a href="mailto:takuya.yanagida@univie.ac.at">takuya.yanagida@univie.ac.at</a>
</p>


<h3>References</h3>

<p>Hox, J., Moerbeek, M., &amp; van de Schoot, R. (2018). <em>Multilevel analysis:
Techniques and applications</em> (3rd. ed.). Routledge.
</p>
<p>Snijders, T. A. B., &amp; Bosker, R. J. (2012). <em>Multilevel analysis: An introduction
to basic and advanced multilevel modeling</em> (2nd ed.). Sage Publishers.
</p>


<h3>See Also</h3>

<p><code>multilevel.cfa</code>, <code>multilevel.cor</code>,
<code>multilevel.descript</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Load data set "Demo.twolevel" in the lavaan package
data("Demo.twolevel", package = "lavaan")

#----------------------------------------------------------------------------
# Two-Level Models

#..........
# Cluster variable specification

# Example 1a: Cluster variable 'cluster' in '...'
multilevel.icc(Demo.twolevel[, c("y1", "cluster")], cluster = "cluster")

# Example 1b: Cluster variable 'cluster' not in '...'
multilevel.icc(Demo.twolevel$y1, cluster = Demo.twolevel$cluster)

# Example 1c: Alternative specification using the 'data' argument
multilevel.icc(y1, data = Demo.twolevel, cluster = "cluster")

#..........

# Example 2: ICC(1) for 'y1'
multilevel.icc(Demo.twolevel$y1, cluster = Demo.twolevel$cluster)

# Example 3: ICC(2)
multilevel.icc(Demo.twolevel$y1, cluster = Demo.twolevel$cluster, type = 2)

# Example 4: ICC(1)
# use lme() function in the lme4 package to estimate ICC
multilevel.icc(Demo.twolevel$y1, cluster = Demo.twolevel$cluster, method = "nlme")

# Example 5a: ICC(1) for 'y1', 'y2', and 'y3'
multilevel.icc(Demo.twolevel[, c("y1", "y2", "y3")], cluster = Demo.twolevel$cluster)

# Example 5b: Alternative specification using the 'data' argument
multilevel.icc(y1:y3, data = Demo.twolevel, cluster = "cluster")

#----------------------------------------------------------------------------
# Three-Level Models

# Create arbitrary three-level data
Demo.threelevel &lt;- data.frame(Demo.twolevel, cluster2 = Demo.twolevel$cluster,
                                             cluster3 = rep(1:10, each = 250))

#..........
# Cluster variable specification

# Example 6a: Cluster variables 'cluster' in '...'
multilevel.icc(Demo.threelevel[, c("y1", "cluster3", "cluster2")],
               cluster = c("cluster3", "cluster2"))

# Example 6b: Cluster variables 'cluster' not in '...'
multilevel.icc(Demo.threelevel$y1, cluster = Demo.threelevel[, c("cluster3", "cluster2")])

# Example 6c: Alternative specification using the 'data' argument
multilevel.icc(y1, data = Demo.threelevel, cluster = c("cluster3", "cluster2"))

#..........

# Example 7a: ICC(1), proportion of variance at Level 2 and Level 3
multilevel.icc(y1, data = Demo.threelevel, cluster = c("cluster3", "cluster2"))

# Example 7b: ICC(1), expected correlation between two randomly chosen elements
# in the same group
multilevel.icc(y1, data = Demo.threelevel, cluster = c("cluster3", "cluster2"),
               type = "1b")

# Example 7c: ICC(2)
multilevel.icc(y1, data = Demo.threelevel, cluster = c("cluster3", "cluster2"),
type = "2")
</code></pre>


</div>