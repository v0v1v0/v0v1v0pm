<div class="container">

<table style="width: 100%;"><tr>
<td>MVNmixture</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Mixture of (multivariate) normal distributions
</h2>

<h3>Description</h3>

<p>Density and random generation for the mixture of the <code class="reqn">p</code>-variate normal distributions
with means given by <code>mean</code>, precision matrix given by <code>Q</code> (or covariance
matrices given by<code>Sigma</code>).  
</p>


<h3>Usage</h3>

<pre><code class="language-R">dMVNmixture(x, weight, mean, Q, Sigma, log=FALSE)

dMVNmixture2(x, weight, mean, Q, Sigma, log=FALSE)

rMVNmixture(n, weight, mean, Q, Sigma)

rMVNmixture2(n, weight, mean, Q, Sigma)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>weight</code></td>
<td>
<p>vector of length <code class="reqn">K</code> with the mixture weights or
values which are proportional to the weights.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mean</code></td>
<td>
<p>vector or matrix of mixture means.
</p>
<p>For <code class="reqn">p=1</code> this
should be a vector of length <code class="reqn">K</code>, for <code class="reqn">p&gt;1</code> this should be a
<code class="reqn">K\times p</code> matrix with mixture means in rows.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Q</code></td>
<td>
<p>precision matrices of the multivariate normal
distribution. Ignored if <code>Sigma</code> is given.
</p>
<p>For <code class="reqn">p=1</code> this should be a vector of length <code class="reqn">K</code>, for <code class="reqn">p
      &gt; 1</code> this should be a list of length <code class="reqn">K</code> with the mixture
precision matrices as components of the list.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma</code></td>
<td>
<p>covariance matrix of the multivariate normal
distribution. If <code>Sigma</code> is supplied, precisions
are computed from <code class="reqn">\Sigma</code> as
<code class="reqn">Q = \Sigma^{-1}</code>.
</p>
<p>For <code class="reqn">p=1</code> this should be a vector of length <code class="reqn">K</code>, for <code class="reqn">p
      &gt; 1</code> this should be a list of length <code class="reqn">K</code> with the mixture
covariance matrices as components of the list.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>number of observations to be sampled.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector or matrix of the points where the density should be
evaluated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log</code></td>
<td>
<p>logical; if <code>TRUE</code>, log-density is computed</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Functions <code>dMVNmixture</code> and <code>dMVNmixture2</code> differ only
internally in the way they compute the mixture density. In
<code>dMVNmixture</code>, only multivariate normal densities are evaluated
in compiled C++ code and mixing is done directly in R. In
<code>dMVNmixture2</code>, everything is evaluated in compiled C++
code. Normally, both <code>dMVNmixture</code> and <code>dMVNmixture2</code> should
return the same results.
</p>
<p>Similarly for <code>rMVNmixture</code> and <code>rMVNmixture2</code>. Another
difference is that <code>rMVNmixture</code> returns only random generated
points and <code>rMVNmixture2</code> also values of the density evaluated in
the generated points.
</p>


<h3>Value</h3>

<p>Some objects.
</p>


<h3>Value for dMVNmixture</h3>

<p>A vector with evaluated values of the (log-)density.
</p>


<h3>Value for dMVNmixture2</h3>

<p>A vector with evaluated values of the (log-)density.
</p>


<h3>Value for rMVNmixture</h3>

<p>A vector (for <code>n=1</code> or for univariate mixture)
or matrix with sampled values (in rows of the matrix).
</p>


<h3>Value for rMVNmixture2</h3>

<p>A list with components named <code>x</code> which is 
a vector (for <code>n=1</code> or for univariate mixture)
or matrix with sampled values (in rows of the matrix)
and <code>dens</code> which are the values of the density evaluated in <code>x</code>.
</p>


<h3>Author(s)</h3>

<p>Arnošt Komárek <a href="mailto:arnost.komarek@mff.cuni.cz">arnost.komarek@mff.cuni.cz</a>
</p>


<h3>See Also</h3>

<p><code>dnorm</code>, <code>MVN</code>, <code>Mvnorm</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(1977)

##### Univariate normal mixture
##### =========================
mu &lt;- c(-1, 1)
Sigma &lt;- c(0.25^2, 0.4^2)
Q &lt;- 1/Sigma
w &lt;- c(0.3, 0.7)

xx &lt;- seq(-2, 2.5, length=100)
yyA &lt;- dMVNmixture(xx, weight=w, mean=mu, Sigma=Sigma)
yyB &lt;- dMVNmixture(xx, weight=w, mean=mu, Q=Q)
yyC &lt;- dMVNmixture2(xx, weight=w, mean=mu, Sigma=Sigma)
yyD &lt;- dMVNmixture2(xx, weight=w, mean=mu, Q=Q)

xxSample &lt;- rMVNmixture(1000, weight=w, mean=mu, Sigma=Sigma)
xxSample2 &lt;- rMVNmixture2(1000, weight=w, mean=mu, Sigma=Sigma)

sum(abs(xxSample2$dens - dMVNmixture(xxSample2$x, weight=w, mean=mu, Sigma=Sigma)) &gt; 1e-15)
xxSample2 &lt;- xxSample2$x

par(mfrow=c(2, 2), bty="n")
plot(xx, yyA, type="l", col="red", xlab="x", ylab="f(x)")
points(xx, yyB, col="darkblue")
hist(xxSample, col="lightblue", prob=TRUE, xlab="x", xlim=range(xx), ylim=c(0, max(yyA)),
     main="Sampled values")
lines(xx, yyA, col="red")
plot(xx, yyC, type="l", col="red", xlab="x", ylab="f(x)")
points(xx, yyD, col="darkblue")
hist(xxSample2, col="sandybrown", prob=TRUE, xlab="x", xlim=range(xx), ylim=c(0, max(yyA)),
     main="Sampled values")
lines(xx, yyC, col="red")


##### Bivariate normal mixture
##### ========================
### Choice 1
sd11 &lt;- sd12 &lt;- 1.1
sd21 &lt;- 0.5
sd22 &lt;- 1.5
rho2 &lt;- 0.7
Xlim &lt;- c(-3, 4)
Ylim &lt;- c(-6, 4)

### Choice 2
sd11 &lt;- sd12 &lt;- 0.3
sd21 &lt;- 0.5
sd22 &lt;- 0.3
rho2 &lt;- 0.8
Xlim &lt;- c(-3, 2.5)
Ylim &lt;- c(-2.5, 2.5)

mu &lt;- matrix(c(1,1, -1,-1), nrow=2, byrow=TRUE)
Sigma &lt;- list(diag(c(sd11^2, sd12^2)),
              matrix(c(sd21^2, rho2*sd21*sd22, rho2*sd21*sd22, sd22^2), nrow=2))
Q &lt;- list(chol2inv(chol(Sigma[[1]])), chol2inv(chol(Sigma[[2]])))
w &lt;- c(0.3, 0.7)

xx1 &lt;- seq(mu[2,1]-3*sd21, mu[1,1]+3*sd11, length=100)
xx2 &lt;- seq(mu[2,2]-3*sd22, mu[1,2]+3*sd12, length=90)
XX &lt;- cbind(rep(xx1, length(xx2)), rep(xx2, each=length(xx1)))
yyA &lt;- matrix(dMVNmixture(XX, weight=w, mean=mu, Sigma=Sigma), nrow=length(xx1), ncol=length(xx2))
yyB &lt;- matrix(dMVNmixture(XX, weight=w, mean=mu, Q=Q), nrow=length(xx1), ncol=length(xx2))
yyC &lt;- matrix(dMVNmixture2(XX, weight=w, mean=mu, Sigma=Sigma), nrow=length(xx1), ncol=length(xx2))
yyD &lt;- matrix(dMVNmixture2(XX, weight=w, mean=mu, Q=Q), nrow=length(xx1), ncol=length(xx2))

#xxSample &lt;- rMVNmixture(1000, weight=w, mean=mu, Sigma=Sigma)
### Starting from version 3.6, the above command led to SegFault
### on CRAN r-patched-solaris-sparc check.
### Commented here on 20140806 (version 3.6-1).
xxSample2 &lt;- rMVNmixture2(1000, weight=w, mean=mu, Sigma=Sigma)

sum(abs(xxSample2$dens - dMVNmixture(xxSample2$x, weight=w, mean=mu, Sigma=Sigma)) &gt; 1e-15)
xxSample2 &lt;- xxSample2$x

par(mfrow=c(1, 2), bty="n")
plot(xxSample, col="darkblue", xlab="x1", ylab="x2", xlim=Xlim, ylim=Ylim)
contour(xx1, xx2, yyA, col="red", add=TRUE)
plot(xxSample2, col="darkblue", xlab="x1", ylab="x2", xlim=Xlim, ylim=Ylim)
contour(xx1, xx2, yyC, col="red", add=TRUE)

par(mfrow=c(2, 2), bty="n")
contour(xx1, xx2, yyA, col="red", xlab="x1", ylab="x2")
points(mu[,1], mu[,2], col="darkgreen")
persp(xx1, xx2, yyA, col="lightblue", xlab="x1", ylab="x2", zlab="f(x1, x2)")
contour(xx1, xx2, yyB, col="red", xlab="x1", ylab="x2")
points(mu[,1], mu[,2], col="darkgreen")
persp(xx1, xx2, yyB, col="lightblue", xlab="x1", ylab="x2", zlab="f(x1, x2)", phi=30, theta=30)

par(mfrow=c(2, 2), bty="n")
contour(xx1, xx2, yyC, col="red", xlab="x1", ylab="x2")
points(mu[,1], mu[,2], col="darkgreen")
persp(xx1, xx2, yyC, col="lightblue", xlab="x1", ylab="x2", zlab="f(x1, x2)")
contour(xx1, xx2, yyD, col="red", xlab="x1", ylab="x2")
points(mu[,1], mu[,2], col="darkgreen")
persp(xx1, xx2, yyD, col="lightblue", xlab="x1", ylab="x2", zlab="f(x1, x2)", phi=30, theta=30)
</code></pre>


</div>