<div class="container">

<table style="width: 100%;"><tr>
<td>mmVarFit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit  Mixed Membership models using variational EM</h2>

<h3>Description</h3>

<p><code>mmVarFit</code> is the primary function of the <code>mixedMem</code> package. The function fits parameters <code class="reqn">\phi</code> and <code class="reqn">\delta</code> for the variational
distribution of latent variables as well as psuedo-MLE estimates for
the population parameters <code class="reqn">\alpha</code> and <code class="reqn">\theta</code>. See documentation for
<code>mixedMemModel</code> or the package vignette, "Fitting Mixed Membership Models Using <code>mixedMem</code>" for a more detailed description of
the variables and notation in a mixed membership model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mmVarFit(model, printStatus = 1, printMod = 1, stepType = 3,
  maxTotalIter = 500, maxEIter = 1000, maxAlphaIter = 200,
  maxThetaIter = 1000, maxLSIter = 400, elboTol = 1e-06,
  alphaTol = 1e-06, thetaTol = 1e-10, aNaught = 1, tau = 0.899,
  bMax = 3, bNaught = 1000, bMult = 1000, vCutoff = 13,
  holdConst = c(-1))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>a <code>mixedMemModel</code> object created by the <code>mixedMemModel</code> constructor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>printStatus</code></td>
<td>
<p>an integer 0 or 1. When <code>printStatus</code> is 1 <code>mmVarFit</code> will print status updates, when
<code>printStatus</code> is 0 <code>mmVarFit</code> will not print status updates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>printMod</code></td>
<td>
<p>a positive integer which specifies how often to print status updates. The
status will be printed at each step which is a multiple of <code>printMod</code>. The default value is 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stepType</code></td>
<td>
<p>an integer from 0-3 which specifies what steps to carry out in estimation. 0 performs a single E-Step; this can be used
to find the held out ELBO. 1 performs iterates between E-steps and M-steps for estimating theta but keeps alpha constant.
2 iterates between  E-steps and M-steps for estimating alpha, but keeps theta constant. 3 completes full
E and M steps. The default is 3.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxTotalIter</code></td>
<td>
<p>the maximum total steps before termination. A full E and M step together count as 1 step.
If this maximum is ever achieved, a warning message will be printed at convergence. The default is 500.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxEIter</code></td>
<td>
<p>the maximum iterations for each E-Step. If this maximum is ever achieved, a warning
message will be printed at convergence. The default is 1000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxAlphaIter</code></td>
<td>
<p>the maximum iterations when fitting alpha. If this maximum is ever achieved,
a warning message will be printed at convergence. The default is 200.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxThetaIter</code></td>
<td>
<p>the maximum iterations when fitting theta. If this maximum is ever achieved,
a warning message will be printed at convergence. The default is 1000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxLSIter</code></td>
<td>
<p>the maximum backtracking iterations in the line search for updating alpha and theta for rank data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>elboTol</code></td>
<td>
<p>the convergence criteria for the EM Algorithim. When the relative increase in the ELBO is less than the convergence critiera,
the algorithm converges. The default is 400.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alphaTol</code></td>
<td>
<p>the convergence criteria for updates to alpha. When the relative increase in the ELBO is less than the convergence critiera,
the update to alpha converges. The defualt is 1e-6.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thetaTol</code></td>
<td>
<p>the convergence criteria for updates to theta. When the relative increase in the ELBO is less than the convergence critiera,
the update to theta converges. The default is 1e-10.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aNaught</code></td>
<td>
<p>the first step size in the backtracking line search used to update alpha and theta for rank data. The default is 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>the backtracking factor in the backtracking line search used to update alpha and theta for rank data. The default is .899.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bMax</code></td>
<td>
<p>the number of times the penalization factor is increased in the interior point method
for fitting theta for rank data. The default is 3.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bNaught</code></td>
<td>
<p>the initial penalization factor in the interior point method for fitting theta for rank data.
<code>bNaught</code> must be positive and the default value is 1000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bMult</code></td>
<td>
<p>a positive number by which bNaught is multiplied by in each iteration of the interior point method
for fitting theta for rank data. The default is 1000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vCutoff</code></td>
<td>
<p>a positive integer cutoff for Vj at which a gradient ascent method is used instead of the Newton Raphson interior point method. This is used to avoid inverting
a large matrix. The default is 13.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>holdConst</code></td>
<td>
<p>a vector of integers specifying groups to be held fixed during the estimation procedure. The estimation algorithim will hold the
theta parameters of these specific groups constant, but update all other parameters. The group numbers range from 0 to K - 1. To estimate all groups, use the default value of c(-1).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>mmVarFit</code> selects psuedo-MLE estimates for <code class="reqn">\alpha</code> and <code class="reqn">\theta</code> and approximates
the posterior distribution for the latent variables through a mean field variational approach.
The variational lower bound on the log-likelihood at the data given model parameters is given by Jensen's inequality:
</p>
<p><code class="reqn">E_Q{\log[p(X,Z, \Lambda)]} - E_Q{\log[Q(Z, \Lambda|\phi, \delta)]} \le \log P(obs |\alpha, \theta)</code> where
</p>
<p><code class="reqn">Q = \prod_i [Dirichlet(\lambda_i|\phi_i) \prod_j^J \prod_r^{R_j} \prod_n^{N_{i,j,r}}Multinomial(Z_{i,j,r,n}|\delta_{i,j,r,n})]</code>
</p>
<p>The left hand side of the above equation is often referred to as the Evidence Lower Bound (ELBO). The global parameters
<code class="reqn">\alpha</code> and <code class="reqn">\theta</code> are selected to maximize this bound as a psuedo-MLE procedure. In addition, it can be shown that
maximizing the ELBO with respect to the variational parameters <code class="reqn">\phi</code> and <code class="reqn">\delta</code> is equivalent to
minimizing the KL divergence between the tractable variational distribution and the true posterior.
</p>
<p>The method uses a variational EM approach. The E-step considers the global parameters <code class="reqn">\alpha</code> and <code class="reqn">\theta</code> fixed
and picks appropriate variational parameters <code class="reqn">\phi</code> and <code class="reqn">\delta</code> to minimize the KL divergence between the
true posterior and the variational distribution (or maximize the ELBO). The M-step considers
the variational parameters  fixed and global parameters <code class="reqn">\theta</code> and <code class="reqn">\alpha</code> are selected which maximize the lower bound
on the log-likelihood (ELBO).
</p>


<h3>Value</h3>

<p><code>mmVarFit</code> returns a <code>mixedMemModel</code> object containing updated variational parameters and global parameters.
</p>


<h3>References</h3>

<p>Beal, Matthew James. Variational algorithms for approximate Bayesian inference. Diss. University of London, 2003.
</p>


<h3>See Also</h3>

<p>mixedMemModel
</p>


<h3>Examples</h3>

<pre><code class="language-R">## The following example generates multivariate observations (both variables are multinomial)
## from a mixed membership model. The observed data is then used to fit a
## mixed membership model using mmVarFit

## Generate Data
Total &lt;- 30 #30 Individuals
J &lt;- 2 # 2 variables
dist &lt;- rep("multinomial",J) # both variables are multinomial
Rj &lt;- rep(100,J) # 100 repititions for each variable
# Nijr will always be 1 for multinomials and bernoulli's
Nijr &lt;- array(1, dim = c(Total, J, max(Rj)))
K &lt;- 4 # 4 sub-populations
alpha &lt;- rep(.5, K) # hyperparameter for dirichlet distribution
Vj &lt;- rep(5, J) # each multinomial has 5 categories
theta &lt;- array(0, dim = c(J, K, max(Vj)))
theta[1,,] &lt;- gtools::rdirichlet(K, rep(.3, 5))
theta[2,,] &lt;- gtools::rdirichlet(K, rep(.3, 5))
obs &lt;- rmixedMem(Total, J, Rj, Nijr, K, Vj, dist, theta, alpha)$obs

## Initialize a mixedMemModel object
test_model &lt;- mixedMemModel(Total = Total, J = J,Rj = Rj, Nijr= Nijr,
 K = K, Vj = Vj,dist = dist, obs = obs,
  alpha = alpha, theta = theta+0)

## Fit the mixed membership model
out &lt;-mmVarFit(test_model)
</code></pre>


</div>