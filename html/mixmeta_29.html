<div class="container">

<table style="width: 100%;"><tr>
<td>mixmetaSim</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> Simulating Responses for mixmeta Models </h2>

<h3>Description</h3>

<p>These functions simulate sets of responses (either univariate or multivariate) for a group of units, in terms of their mean (expected) values and within and between-group (co)variances. These sets of outcomes can be used in meta-analytical models for simulation purposes.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mixmetaSim(y, S, Psi, random, data, nsim=1, seed=NULL, ...)

## S3 method for class 'mixmeta'
simulate(object, nsim=1, seed=NULL, ...)
</code></pre>


<h3>Arguments</h3>

<p>In order to simulate <code class="reqn">k</code> outcomes for <code class="reqn">n</code> units:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>y </code></td>
<td>
<p> a <code class="reqn">n</code>-dimensional vector (for simulating univariate responses) or <code class="reqn">m \times k</code> matrix (for simulating multivariate responses) of mean (expected) outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S </code></td>
<td>
<p> series of within-unit variances (or (co)variance matrices for multivariate models) of the estimated outcome(s). For the list of accepted format, see the argument with the same name in <code>mixmeta</code>. Covariances or more complex error structures can be passed through additional arguments. See Details below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Psi </code></td>
<td>
<p> the random-effects (co)variance matrix (or a list of matrices for multilevel models) of the outcomes. Dimension must be consistent with the specification of the random-effects structure in <code>random</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random </code></td>
<td>
<p> a one-sided formula (or a list of formulae for multilevel models) offering a symbolic description of the linear predictor(s) and grouping structure for the random-effects part of the model. See the argument with the same name in <code>mixmeta</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data </code></td>
<td>
<p> an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame), optionally containing the variables in <code>y</code>, <code>S</code>, and <code>random</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim </code></td>
<td>
<p> number of simulation sets.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed </code></td>
<td>
<p> an object specifying if and how the random number generator should be initialized.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object </code></td>
<td>
<p>  an object of class <code>"mixmeta"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>... </code></td>
<td>
<p> further optional arguments.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The set(s) of responses can be simulated either from a fitted model, using the method function <code>simulate</code> for objects of class <code>"mixmeta"</code>, or directly through the function <code>mixmetaSim</code>. In the former case, the fitted values from the model are used as mean (expected) outcomes, together with the within-unit and estimated random-effects (co)variance structure. In the latter option, this information need to be provided by the user in the correct dimensions and forms.
</p>
<p>Additional arguments can be passed in <code>'...'</code>. Specifically, arguments <code>Scor</code> and <code>addSlist</code> can be added to input missing within-unit error covariances, or to specify more complex within-unit error structures, respectively. Another argument can be <code>checkPD</code> (logical), that checks the semi-positive definiteness of the matrices). See  <code>mixmeta.control</code> for details.
</p>
<p>The functions simulate the responses for each study separately from a marginal multivariate normal distribution with mean equal to the expected values and (co)variance equal to the sum of the within-unit errors and random-effects components. The computation is identical to that implemented in the function <code>mvrnorm</code> of the package <span class="pkg">MASS</span>, involving a eigen decomposition of the marginal (co)variance matrix. Numerical negative definiteness is checked, and positive semi-definiteness then forced by truncating the eigenvalues at a value close to zero (see <code>control</code>).
</p>


<h3>Value</h3>

<p>If <code>nsim=1</code>, a matrix or vector of simulated <code class="reqn">k</code> outcomes for the <code class="reqn">n</code> units. If more simulation sets are required (<code>nsim</code> higher than 1), a list of matrices or vectors.
</p>


<h3>Note</h3>

<p>Studies with missing values in the fitted values or in the components of the within (co)variances are excluded by <code>simulate</code>. Missing values are instead not accepted in <code>metaSim</code>.
</p>


<h3>Author(s)</h3>

<p>Antonio Gasparrini &lt;<a href="mailto:antonio.gasparrini@lshtm.ac.uk">antonio.gasparrini@lshtm.ac.uk</a>&gt; and Francesco Sera &lt;<a href="mailto:francesco.sera@lshtm.ac.uk">francesco.sera@lshtm.ac.uk</a>&gt;</p>


<h3>References</h3>

<p>Sera F, Armstrong B, Blangiardo M, Gasparrini A (2019). An extended mixed-effects framework for meta-analysis.<em>Statistics in Medicine</em>. 2019;38(29):5429-5444. [Freely available <a href="http://www.ag-myresearch.com/2019_sera_statmed.html"><b>here</b></a>].
</p>


<h3>See Also</h3>

<p>See <code>simulate</code> for the general method function. See <code>inputcov</code> for inputting correlations. See <code>mixmeta-package</code> for an overview of the package and modelling framework.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># RUN A MODEL
model &lt;- mixmeta(cbind(PD,AL) ~ pubyear, S=berkey98[5:7], data=berkey98)

# SIMULATE A NEW SET OF OUTCOMES
simulate(model)

# SIMULATE FROM SCRATCH: 3 OUTCOMES, 8 STUDIES
(y &lt;- matrix(0, 8, 3))
(S &lt;- inputcov(matrix(runif(8*3, 0.1, 2), 8, 3, dimnames=list(NULL,
  c("V1","V2","V3"))), cor=c(0,0.5,0.7)))
(Psi &lt;- inputcov(1:3, cor=0.3))
mixmetaSim(y, S, Psi)

# 2 SIMULATION SETS
mixmetaSim(y, S, Psi, nsim=2)
</code></pre>


</div>