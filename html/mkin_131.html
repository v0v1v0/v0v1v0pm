<div class="container">

<table style="width: 100%;"><tr>
<td>saem</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit nonlinear mixed models with SAEM</h2>

<h3>Description</h3>

<p>This function uses <code>saemix::saemix()</code> as a backend for fitting nonlinear mixed
effects models created from mmkin row objects using the Stochastic Approximation
Expectation Maximisation algorithm (SAEM).
</p>


<h3>Usage</h3>

<pre><code class="language-R">saem(object, ...)

## S3 method for class 'mmkin'
saem(
  object,
  transformations = c("mkin", "saemix"),
  error_model = "auto",
  degparms_start = numeric(),
  test_log_parms = TRUE,
  conf.level = 0.6,
  solution_type = "auto",
  covariance.model = "auto",
  omega.init = "auto",
  covariates = NULL,
  covariate_models = NULL,
  no_random_effect = NULL,
  error.init = c(1, 1),
  nbiter.saemix = c(300, 100),
  control = list(displayProgress = FALSE, print = FALSE, nbiter.saemix = nbiter.saemix,
    save = FALSE, save.graphs = FALSE),
  verbose = FALSE,
  quiet = FALSE,
  ...
)

## S3 method for class 'saem.mmkin'
print(x, digits = max(3, getOption("digits") - 3), ...)

saemix_model(
  object,
  solution_type = "auto",
  transformations = c("mkin", "saemix"),
  error_model = "auto",
  degparms_start = numeric(),
  covariance.model = "auto",
  no_random_effect = NULL,
  omega.init = "auto",
  covariates = NULL,
  covariate_models = NULL,
  error.init = numeric(),
  test_log_parms = FALSE,
  conf.level = 0.6,
  verbose = FALSE,
  ...
)

saemix_data(object, covariates = NULL, verbose = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An mmkin row object containing several fits of the same
mkinmod model to different datasets</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further parameters passed to saemix::saemixModel.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transformations</code></td>
<td>
<p>Per default, all parameter transformations are done
in mkin. If this argument is set to 'saemix', parameter transformations
are done in 'saemix' for the supported cases, i.e. (as of version 1.1.2)
SFO, FOMC, DFOP and HS without fixing <code>parent_0</code>, and SFO or DFOP with
one SFO metabolite.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>error_model</code></td>
<td>
<p>Possibility to override the error model used in the mmkin object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degparms_start</code></td>
<td>
<p>Parameter values given as a named numeric vector will
be used to override the starting values obtained from the 'mmkin' object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test_log_parms</code></td>
<td>
<p>If TRUE, an attempt is made to use more robust starting
values for population parameters fitted as log parameters in mkin (like
rate constants) by only considering rate constants that pass the t-test
when calculating mean degradation parameters using mean_degparms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>Possibility to adjust the required confidence level
for parameter that are tested if requested by 'test_log_parms'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>solution_type</code></td>
<td>
<p>Possibility to specify the solution type in case the
automatic choice is not desired</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariance.model</code></td>
<td>
<p>Will be passed to <code>saemix::saemixModel()</code>. Per
default, uncorrelated random effects are specified for all degradation
parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>omega.init</code></td>
<td>
<p>Will be passed to <code>saemix::saemixModel()</code>. If using
mkin transformations and the default covariance model with optionally
excluded random effects, the variances of the degradation parameters
are estimated using mean_degparms, with testing of untransformed
log parameters for significant difference from zero. If not using
mkin transformations or a custom covariance model, the default
initialisation of saemix::saemixModel is used for omega.init.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates</code></td>
<td>
<p>A data frame with covariate data for use in
'covariate_models', with dataset names as row names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariate_models</code></td>
<td>
<p>A list containing linear model formulas with one explanatory
variable, i.e. of the type 'parameter ~ covariate'. Covariates must be available
in the 'covariates' data frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>no_random_effect</code></td>
<td>
<p>Character vector of degradation parameters for
which there should be no variability over the groups. Only used
if the covariance model is not explicitly specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>error.init</code></td>
<td>
<p>Will be passed to <code>saemix::saemixModel()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbiter.saemix</code></td>
<td>
<p>Convenience option to increase the number of
iterations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>Passed to saemix::saemix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Should we print information about created objects of
type saemix::SaemixModel and saemix::SaemixData?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>Should we suppress the messages saemix prints at the beginning
and the end of the optimisation process?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An saem.mmkin object to print</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>Number of digits to use for printing</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>An mmkin row object is essentially a list of mkinfit objects that have been
obtained by fitting the same model to a list of datasets using mkinfit.
</p>
<p>Starting values for the fixed effects (population mean parameters, argument
psi0 of <code>saemix::saemixModel()</code> are the mean values of the parameters found
using mmkin.
</p>


<h3>Value</h3>

<p>An S3 object of class 'saem.mmkin', containing the fitted
saemix::SaemixObject as a list component named 'so'. The
object also inherits from 'mixed.mmkin'.
</p>
<p>An saemix::SaemixModel object.
</p>
<p>An saemix::SaemixData object.
</p>


<h3>See Also</h3>

<p>summary.saem.mmkin plot.mixed.mmkin
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
ds &lt;- lapply(experimental_data_for_UBA_2019[6:10],
 function(x) subset(x$data[c("name", "time", "value")]))
names(ds) &lt;- paste("Dataset", 6:10)
f_mmkin_parent_p0_fixed &lt;- mmkin("FOMC", ds,
  state.ini = c(parent = 100), fixed_initials = "parent", quiet = TRUE)
f_saem_p0_fixed &lt;- saem(f_mmkin_parent_p0_fixed)

f_mmkin_parent &lt;- mmkin(c("SFO", "FOMC", "DFOP"), ds, quiet = TRUE)
f_saem_sfo &lt;- saem(f_mmkin_parent["SFO", ])
f_saem_fomc &lt;- saem(f_mmkin_parent["FOMC", ])
f_saem_dfop &lt;- saem(f_mmkin_parent["DFOP", ])
anova(f_saem_sfo, f_saem_fomc, f_saem_dfop)
anova(f_saem_sfo, f_saem_dfop, test = TRUE)
illparms(f_saem_dfop)
f_saem_dfop_red &lt;- update(f_saem_dfop, no_random_effect = "g_qlogis")
anova(f_saem_dfop, f_saem_dfop_red, test = TRUE)

anova(f_saem_sfo, f_saem_fomc, f_saem_dfop)
# The returned saem.mmkin object contains an SaemixObject, therefore we can use
# functions from saemix
library(saemix)
compare.saemix(f_saem_sfo$so, f_saem_fomc$so, f_saem_dfop$so)
plot(f_saem_fomc$so, plot.type = "convergence")
plot(f_saem_fomc$so, plot.type = "individual.fit")
plot(f_saem_fomc$so, plot.type = "npde")
plot(f_saem_fomc$so, plot.type = "vpc")

f_mmkin_parent_tc &lt;- update(f_mmkin_parent, error_model = "tc")
f_saem_fomc_tc &lt;- saem(f_mmkin_parent_tc["FOMC", ])
anova(f_saem_fomc, f_saem_fomc_tc, test = TRUE)

sfo_sfo &lt;- mkinmod(parent = mkinsub("SFO", "A1"),
  A1 = mkinsub("SFO"))
fomc_sfo &lt;- mkinmod(parent = mkinsub("FOMC", "A1"),
  A1 = mkinsub("SFO"))
dfop_sfo &lt;- mkinmod(parent = mkinsub("DFOP", "A1"),
  A1 = mkinsub("SFO"))
# The following fit uses analytical solutions for SFO-SFO and DFOP-SFO,
# and compiled ODEs for FOMC that are much slower
f_mmkin &lt;- mmkin(list(
    "SFO-SFO" = sfo_sfo, "FOMC-SFO" = fomc_sfo, "DFOP-SFO" = dfop_sfo),
  ds, quiet = TRUE)
# saem fits of SFO-SFO and DFOP-SFO to these data take about five seconds
# each on this system, as we use analytical solutions written for saemix.
# When using the analytical solutions written for mkin this took around
# four minutes
f_saem_sfo_sfo &lt;- saem(f_mmkin["SFO-SFO", ])
f_saem_dfop_sfo &lt;- saem(f_mmkin["DFOP-SFO", ])
# We can use print, plot and summary methods to check the results
print(f_saem_dfop_sfo)
plot(f_saem_dfop_sfo)
summary(f_saem_dfop_sfo, data = TRUE)

# The following takes about 6 minutes
f_saem_dfop_sfo_deSolve &lt;- saem(f_mmkin["DFOP-SFO", ], solution_type = "deSolve",
  nbiter.saemix = c(200, 80))

#anova(
#  f_saem_dfop_sfo,
#  f_saem_dfop_sfo_deSolve))

# If the model supports it, we can also use eigenvalue based solutions, which
# take a similar amount of time
#f_saem_sfo_sfo_eigen &lt;- saem(f_mmkin["SFO-SFO", ], solution_type = "eigen",
#  control = list(nbiter.saemix = c(200, 80), nbdisplay = 10))

## End(Not run)
</code></pre>


</div>