<div class="container">

<table style="width: 100%;"><tr>
<td>mlVAR</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Multilevel VAR Estimation for Multiple Time Series
</h2>

<h3>Description</h3>

<p>The function <code>mlVAR</code> computes estimates of the multivariate vector autoregression model. This model returns three stuctures: temporal effects (e.g., lag-1 regression weights), contemporaneous relationships (correlations or partial correlations) and between-subject effects (correlations and partial correlations). See details.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mlVAR(data, vars, idvar, lags = 1, dayvar, beepvar,
                 estimator = c("default", "lmer", "lm","Mplus"),
                 contemporaneous = c("default", "correlated",
                 "orthogonal", "fixed", "unique"), temporal =
                 c("default", "correlated", "orthogonal", "fixed",
                 "unique"), nCores = 1, verbose = TRUE, compareToLags,
                 scale = TRUE, scaleWithin = FALSE, AR = FALSE, 
                 MplusSave = TRUE, MplusName = "mlVAR", iterations = "(2000)", 
                 chains = nCores, signs, orthogonal
  )
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>Data frame
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>

<p>Vectors of variables to include in the analysis
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>idvar</code></td>
<td>

<p>String indicating the subject ID
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lags</code></td>
<td>

<p>Vector indicating the lags to include
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dayvar</code></td>
<td>

<p>String indicating assessment day. Adding this argument makes sure that the first measurement of a day is not regressed on the last measurement of the previous day. IMPORTANT: only add this if the data has multiple observations per day.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beepvar</code></td>
<td>

<p>Optional string indicating assessment beep per day. Adding this argument will cause non-consecutive beeps to be treated as missing!
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimator</code></td>
<td>

<p>The estimator to be used. <code>"lmer"</code> for sequential univariate multi-level estimation, <code>"Mplus"</code> for multivariate Bayesian estimation (requires Mplus), and <code>"lm"</code> for fixed effects estimation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contemporaneous</code></td>
<td>

<p>How should the contemporaneous networks be estimated? These networks are always estimated post-hoc by investigating the residuals of the temporal models. <code>"correlated"</code> and <code>"orthogonal"</code> run second multi-level models in which the networks are estimated using node-wise estimation. <code>"fixed"</code> and <code>"unique"</code> simply correlate the residuals, either by computing one network for all subjects (fixed) or a single network per per subject.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>temporal</code></td>
<td>

<p>How should the temporal effects be estimated? <code>"correlated"</code> estimates correlated random effects, <code>"orthogonal"</code> estimates non-correlated random effects and <code>"fixed"</code> estimates a model in which only the intercept is random. Defaults to <code>"correlated"</code> when the number of variables is less than 6 and <code>"orthogonal"</code> otherwise. <code>"unique"</code> uses <code>lm</code> to estimate an unique model for each subject.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nCores</code></td>
<td>
<p>Number of cores to use in computation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>

<p>Logical indicating if console messages and the progress bar should be shown.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>Logical, should variables be standardized before estimation?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scaleWithin</code></td>
<td>
<p>Logial, should variables be scaled within-person (set to <code>FALSE</code> to only center within-person)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compareToLags</code></td>
<td>

<p>A vector indicating which lags to base the data on. If the model is to be compared with a model with multiple lags using <code>mlVARcompare</code>, this argument must be used to make sure the number of observations is the same in both models (e.g., a lag 1 model can model the second observation of a day and a lag-2 model can't, causing different number of observations and incomparable models). It is suggested to not use this argument unless you want to compare models, and always run <code>mlVAR</code> without using this argument afterwards in the selected model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AR</code></td>
<td>
<p>Logical, should an auto-regression only model be fitted?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MplusSave</code></td>
<td>
<p>Logical, should the Mplus model file and output be saved?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MplusName</code></td>
<td>
<p>Name of the Mplus model file and output (without extensions)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iterations</code></td>
<td>
<p>The string used to define the number of iterations in Mplus</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chains</code></td>
<td>
<p>Number of Mplus chains</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>signs</code></td>
<td>
<p>Optional matrix fixing the signs of contemporaneous correlations. Is estimated by running mlVAR with <code>estimator = "lmer"</code> if missing.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>orthogonal</code></td>
<td>

<p>Deprecated argument only added for backward competability. Ignore.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function estimates the multi-level VAR model to obtain temporal, contemporaneous and between-subject effects using nodewise estimation. Temporal and between-subject effects are obtained directly from the models and contemporaneous effects are estimated post-hoc by correlating the residuals. See arxiv.org/abs/1609.04156 for details.
</p>
<p>Setting <code>estimator = "Mplus"</code> will generate a Mplus model, run the analysis and read the results into R. Mplus 8 is required for this estimation. It is recommended to set <code>contemporaneous = "fixed"</code>, though not required. For the estimation of contemporaneous random effects, the signs of contemporaneous *correlations * (not partial correlations) need be set (or estimated) via the <code>signs</code> argument.
</p>


<h3>Value</h3>

<p>An <code>mlVAR</code> object 
</p>


<h3>Author(s)</h3>

<p>Sacha Epskamp (mail@sachaepskamp.com)
</p>


<h3>References</h3>

<p>Bringmann, L. F., Vissers, N., Wichers, M., Geschwind, N., Kuppens, P., Peeters, F., ... &amp; Tuerlinckx, F. (2013). A network approach to psychopathology: New insights into clinical longitudinal data. PloS one, 8(4), e60188.
</p>
<p>Hamaker, E. L., &amp; Grasman, R. P. (2014). To center or not to center? Investigating inertia with a multilevel autoregressive model. Frontiers in psychology, 5.
</p>
<p>Epskamp, S., Waldorp, L. J., Mottus, R., &amp; Borsboom, D. (2017). Discovering Psychological Dynamics: The Gaussian Graphical Model in Cross-sectional and Time-series Data. arxiv.org/abs/1609.04156.
</p>


<h3>See Also</h3>

<p><code>mlVARcompare</code>, <code>summary.mlVAR</code>, <code>plot.mlVAR</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
### Small example ###
# Simulate data:
Model &lt;- mlVARsim(nPerson = 50, nNode = 3, nTime = 50, lag=1)

# Estimate using correlated random effects:
fit1 &lt;- mlVAR(Model$Data, vars = Model$vars, idvar = Model$idvar, lags = 1, temporal = "correlated")

# Print some pointers:
print(fit1)

# Summary of all parameter estimates:
summary(fit1)

# Compare temporal relationships:
layout(t(1:2))
plot(Model, "temporal", title = "True temporal relationships", layout = "circle")
plot(fit1, "temporal", title = "Estimated temporal relationships", layout = "circle")

# Compare contemporaneous partial correlations:
layout(t(1:2))
plot(Model, "contemporaneous", title = "True contemporaneous relationships", 
    layout = "circle")
plot(fit1, "contemporaneous", title = "Estimated contemporaneous relationships", 
    layout = "circle")

# Compare between-subjects partial correlations:
layout(t(1:2))
plot(Model, "between", title = "True between-subjects relationships", layout = "circle")
plot(fit1, "between", title = "Estimated between-subjects relationships", 
    layout = "circle")

# Run same model with non-correlated temporal relationships and fixed-effect model:
fit2 &lt;- mlVAR(Model$Data, vars = Model$vars, idvar = Model$idvar, lags = 1, 
    temporal = "orthogonal")
fit3 &lt;- mlVAR(Model$Data, vars = Model$vars, idvar = Model$idvar, lags = 1, 
    temporal = "fixed")

# Compare models:
mlVARcompare(fit1,fit2,fit3)

# Inspect true parameter correlation matrix:
Model$model$Omega$cor$mean
# Even though correlations are high, orthogonal model works well often!


### Large example ###
Model &lt;- mlVARsim(nPerson = 100, nNode = 10, nTime = 100,lag=1)

# Correlated random effects no longer practical. Use orthogonal or fixed:
fit4 &lt;- mlVAR(Model$Data, vars = Model$vars, idvar = Model$idvar, lags = 1, 
    temporal = "orthogonal")
fit5 &lt;- mlVAR(Model$Data, vars = Model$vars, idvar = Model$idvar, lags = 1, 
    temporal = "fixed")

# Compare models:
mlVARcompare(fit4, fit5)

# Compare temporal relationships:
layout(t(1:2))
plot(Model, "temporal", title = "True temporal relationships", layout = "circle")
plot(fit4, "temporal", title = "Estimated temporal relationships", layout = "circle")

# Compare contemporaneous partial correlations:
layout(t(1:2))
plot(Model, "contemporaneous", title = "True contemporaneous relationships", 
    layout = "circle")
plot(fit4, "contemporaneous", title = "Estimated contemporaneous relationships", 
    layout = "circle")

# Compare between-subjects partial correlations:
layout(t(1:2))
plot(Model, "between", title = "True between-subjects relationships", layout = "circle")
plot(fit4, "between", title = "Estimated between-subjects relationships", 
    layout = "circle")

## End(Not run)
</code></pre>


</div>