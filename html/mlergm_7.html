<div class="container">

<table style="width: 100%;"><tr>
<td>mlergm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Multilevel Exponential-Family Random Graph Models</h2>

<h3>Description</h3>

<p>This function estimates an exponential-family random graph model for multilevel network data. At present, <code>mlergm</code> covers network data where the set of nodes is nested within known blocks (see, e.g., Schweinberger and Handcock, 2015). An example is groups of students nested within classrooms, which is covered in the <code>classes</code> data set. It is assumed that the node membership, that to which block each node is associated, is known (or has been previously estimated).
</p>


<h3>Usage</h3>

<pre><code class="language-R">mlergm(
  form,
  node_memb,
  parameterization = "standard",
  options = set_options(),
  theta_init = NULL,
  verbose = 0,
  eval_loglik = TRUE,
  seed = NULL
)

## S3 method for class 'mlergm'
print(x, ...)

## S3 method for class 'mlergm'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>form</code></td>
<td>
<p>Formula of the form:  <code>network ~ term1 + term2 + ...</code>; allowable model terms are a subset of those in R package ergm,
see <code>ergm.terms</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>node_memb</code></td>
<td>
<p>Vector (length equal to the number of nodes in the network) indicating to which  block or group the nodes belong.
If the network provided in <code>form</code> is an object of class <code>mlnet</code>, 
then <code>node_memb</code> can be exctracted directly from the network and need not be provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameterization</code></td>
<td>
<p>Parameterization options include 'standard', 'offset', or 'size'. 
</p>

<ul>
<li>
<p> 'standard' : Does not adjust the individual block parameters for size. 
</p>
</li>
<li>
<p> 'offset' : The offset parameterization uses edge and mutual offsets along the lines of Krivitsky, Handcock, and Morris (2011) and Krivitsky and Kolaczyk (2015). The edge parameter is offset by <code class="reqn">-log n(k)</code> and the mutual parameter is offset by <code class="reqn">+log n(k)</code>, where <code class="reqn">n(k)</code> is the size of the kth block.  
</p>
</li>
<li>
<p> 'size' : Multiplies the block parameters by <code class="reqn">log n(k)</code>, where <code class="reqn">n(k)</code> is the size of the kth block.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>options</code></td>
<td>
<p>See <code>set_options</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta_init</code></td>
<td>
<p>Parameter vector of initial estimates for theta to be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Controls the level of output. A value of <code>0</code> corresponds to no output, except for warnings; a value of <code>1</code> corresponds to minimal output, and a value of <code>2</code> corresponds to full output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eval_loglik</code></td>
<td>
<p>(Logical <code>TRUE</code> or <code>FALSE</code>) If set to <code>TRUE</code>, the bridge estimation procedure of Hunter and Handcock (2006) is used to estimate the loglikelihood for BIC calculations, otherwise the loglikelihood and therefore the BIC is not estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>For reproducibility, an integer-valued seed may be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An object of class <code>mlergm</code>, probably produced by <code>mlergm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to be passed if necessary.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>An object of class <code>mlergm</code>, probably produced by <code>mlergm</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The estimation procedures performs Monte-Carlo maximum likelihood for the specified ERGM using a version of the Fisher scoring method detailed by Hunter and Handcock (2006). Settings governing the MCMC procedure (such as <code>burnin</code>, <code>interval</code>, and <code>sample_size</code>) as well as more general settings for the estimation procedure can be adjusted through <code>set_options</code>. The estimation procedure uses the the stepping algorithm of Hummel, et al., (2012) for added stability.
</p>


<h3>Value</h3>

<p><code>mlergm</code> returns an object of class <code>mlergm</code> which is a list containing:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>Estimated parameter vector of the exponential-family random graph model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>between_theta</code></td>
<td>
<p>Estimated parameter vector of the between group model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>Standard error vector for theta.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>between_se</code></td>
<td>
<p>Standard error vector for between_theta.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pvalue</code></td>
<td>
<p>A vector of p-values for the estimated parameter vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>between_pvalue</code></td>
<td>
<p>A vector of p-values for the estimated parameter vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logLikval</code></td>
<td>
<p>The loglikelihood for at the estimated MLE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bic</code></td>
<td>
<p>The BIC for the estimated model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc_chain</code></td>
<td>
<p>The MCMC sample used in the final estimation step, which can be used to diagnose non-convergence.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimation_status</code></td>
<td>
<p>Indicator of whether the estimation procedure had <code>succcess</code> or <code>failed</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameterization</code></td>
<td>
<p>The model parameterization (either <code>standard</code> or <code>offset</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>The model formula.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>network</code></td>
<td>
<p>The network for which the model is estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>node_memb</code></td>
<td>
<p>Vector indicating to which group or block the nodes belong.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>size_quantiles</code></td>
<td>
<p>The quantiles of the block sizes.</p>
</td>
</tr>
</table>
<h3>Methods (by generic)</h3>


<ul>
<li> <p><code>print</code>: Print method for objects of class <code>mlergm</code>. Indicates whether the model was succesfully estimated, as well as the model formula provided.
</p>
</li>
<li> <p><code>summary</code>: Prints a summary of the estimated <code>mlergm</code> model.
</p>
</li>
</ul>
<h3>References</h3>

<p>Schweinberger, M. and Stewart, J. (2019) 
Concentration and consistency results for canonical and curved exponential-family random graphs. 
The Annals of Statistics, to appear.
</p>
<p>Schweinberger, M. and Handcock, M. S. (2015).
Local dependence in random graph models: characterization, properties and statistical inference.
Journal of the Royal Statistical Society: Series B (Statistical Methodology), 77(3), 647-676.
</p>
<p>Hunter, D. R., and Handcock, M. S. (2006). 
Inference in curved exponential family models for networks. 
Journal of Computational and Graphical Statistics, 15(3), 565-583.
</p>
<p>Hummel, R. M., Hunter, D. R., and Handcock, M. S. (2012). 
Improving simulation-based algorithms for fitting ERGMs. 
Journal of Computational and Graphical Statistics, 21(4), 920-939.
</p>
<p>Krivitsky, P. N., Handcock, M. S., &amp; Morris, M. (2011). 
Adjusting for network size and composition effects in exponential-family random graph models. 
Statistical methodology, 8(4), 319-339.
</p>
<p>Krivitsky, P.N, and Kolaczyk, E. D. (2015). 
On the question of effective sample size in network modeling: An asymptotic inquiry. 
Statistical science: a review journal of the Institute of Mathematical Statistics, 30(2), 184.
</p>
<p>Hunter D., Handcock M., Butts C., Goodreau S., and Morris M. (2008).
ergm: A Package to Fit, Simulate and Diagnose Exponential-Family Models for Networks.
Journal of Statistical Software, 24(3), 1-29.
</p>
<p>Butts, C. (2016).
sna: Tools for Social Network Analysis.
R package version 2.4. <a href="https://CRAN.R-project.org/package=sna">https://CRAN.R-project.org/package=sna</a>.
</p>
<p>Butts, C. (2008).
network: a Package for Managing Relational Data in R.
Journal of Statistical Software, 24(2). 
</p>
<p>Stewart, J., Schweinberger, M., Bojanowski, M., and M. Morris (2019). 
Multilevel network data facilitate statistical inference for curved ERGMs with geometrically weighted terms. 
Social Networks, 59, 98-119.
</p>
<p>Schweinberger, M., Krivitsky, P. N., Butts, C.T. and J. Stewart (2018). 
Exponential-family models of random graphs: Inference in finite-, super-, and infinite-population scenarios. 
https://arxiv.org/abs/1707.04800
</p>


<h3>See Also</h3>

<p><code>gof.mlergm</code>, <code>mlnet</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
### Load the school classes data-set 
data(classes) 

# Estimate a curved multilevel ergm model with offset parameter 
# Approximate run time (2 cores): 1.2m, Run time (3 cores): 55s 
model_est &lt;- mlergm(classes ~ edges + mutual + nodematch("sex") +  gwesp(fixed = FALSE), 
                    seed = 123, 
                    options = set_options(number_cores = 2))

# To access a summary of the fitted model, call the 'summary' function 
summary(model_est)

# Goodness-of-fit can be run by calling the 'gof.mlergm' method 
# Approximate run time (2 cores): 48s, Run time (3 cores): 34s  
gof_res &lt;- gof(model_est, options = set_options(number_cores = 2))
plot(gof_res, cutoff = 15)
 
</code></pre>


</div>