<div class="container">

<table style="width: 100%;"><tr>
<td>ml_problem</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create an instance of a fitting problem</h2>

<h3>Description</h3>

<p>The <code>ml_problem()</code> function is the first step for fitting a reference
sample to known control totals with mlfit.
All algorithms (see <code>ml_fit()</code>) expect an object created by this function (or
optionally processed with <code>flatten_ml_fit_problem()</code>).
</p>
<p>The <code>special_field_names()</code> function is useful for the <code>field_names</code> argument
to <code>ml_problem</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ml_problem(
  ref_sample,
  controls = list(individual = individual_controls, group = group_controls),
  field_names,
  individual_controls,
  group_controls,
  prior_weights = NULL,
  geo_hierarchy = NULL
)

is_ml_problem(x)

## S3 method for class 'ml_problem'
format(x, ...)

## S3 method for class 'ml_problem'
print(x, ...)

special_field_names(
  groupId,
  individualId,
  individualsPerGroup = NULL,
  count = NULL,
  zone = NULL,
  region = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ref_sample</code></td>
<td>
<p>The reference sample</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>controls</code></td>
<td>
<p>Control totals, by default initialized from the
<code>individual_controls</code> and <code>group_controls</code> arguments</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>field_names</code></td>
<td>
<p>Names of special fields, construct using
<code>special_field_names()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>individual_controls, group_controls</code></td>
<td>
<p>Control totals at individual
and group level, given as a list of data frames where each data frame
defines a control</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior_weights</code></td>
<td>
<p>Prior (or design) weights at group level; by default
a vector of ones will be used, which corresponds to random sampling of
groups</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>geo_hierarchy</code></td>
<td>
<p>A table shows mapping between a larger zoning level to
many zones of a smaller zoning level. The column name of the larger level
should be specified in <code>field_names</code> as 'region' and the smaller one as
'zone'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groupId, individualId</code></td>
<td>
<p>Name of the column that defines the ID of the
group or the individual</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>individualsPerGroup</code></td>
<td>
<p>Obsolete.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>count</code></td>
<td>
<p>Name of control total column in control tables (use first numeric
column in each control by default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>region, zone</code></td>
<td>
<p>Name of the column that defines the region of the reference
sample or the zone of the controls. Note that region is a larger area that contains
more than one zone.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>ml_problem</code> or a list of them if <code>geo_hierarchy</code>
was given, essentially a named list with the following components:
</p>

<dl>
<dt><code>refSample</code></dt>
<dd>
<p>The reference sample, a <code>data.frame</code>.</p>
</dd>
<dt><code>controls</code></dt>
<dd>
<p>A named list with two components, <code>individual</code>
and <code>group</code>. Each contains a list of controls as <code>data.frame</code>s.</p>
</dd>
<dt><code>fieldNames</code></dt>
<dd>
<p>A named list with the names of special fields.</p>
</dd>
</dl>
<p><code>is_ml_problem()</code> returns a logical.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Create example from Ye et al., 2009

# Provide reference sample
ye &lt;- tibble::tribble(
  ~HHNR, ~PNR, ~APER, ~HH_VAR, ~P_VAR,
  1, 1, 3, 1, 1,
  1, 2, 3, 1, 2,
  1, 3, 3, 1, 3,
  2, 4, 2, 1, 1,
  2, 5, 2, 1, 3,
  3, 6, 3, 1, 1,
  3, 7, 3, 1, 1,
  3, 8, 3, 1, 2,
  4, 9, 3, 2, 1,
  4, 10, 3, 2, 3,
  4, 11, 3, 2, 3,
  5, 12, 3, 2, 2,
  5, 13, 3, 2, 2,
  5, 14, 3, 2, 3,
  6, 15, 2, 2, 1,
  6, 16, 2, 2, 2,
  7, 17, 5, 2, 1,
  7, 18, 5, 2, 1,
  7, 19, 5, 2, 2,
  7, 20, 5, 2, 3,
  7, 21, 5, 2, 3,
  8, 22, 2, 2, 1,
  8, 23, 2, 2, 2
)
ye

# Specify control at household level
ye_hh &lt;- tibble::tribble(
  ~HH_VAR, ~N,
  1,       35,
  2,       65
)
ye_hh

# Specify control at person level
ye_ind &lt;- tibble::tribble(
  ~P_VAR, ~N,
  1, 91,
  2, 65,
  3, 104
)
ye_ind

ye_problem &lt;- ml_problem(
  ref_sample = ye,
  field_names = special_field_names(
    groupId = "HHNR", individualId = "PNR", count = "N"
  ),
  group_controls = list(ye_hh),
  individual_controls = list(ye_ind)
)
ye_problem

fit &lt;- ml_fit_dss(ye_problem)
fit$weights
</code></pre>


</div>