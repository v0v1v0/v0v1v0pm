<div class="container">

<table style="width: 100%;"><tr>
<td>mlr_pipeops_vtreat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Interface to the vtreat Package</h2>

<h3>Description</h3>

<p>Provides an interface to the vtreat package.
</p>
<p><code>PipeOpVtreat</code> naturally works for classification tasks and regression tasks.
Internally, <code>PipeOpVtreat</code> follows the fit/prepare interface of vtreat, i.e., first creating a data treatment transform object via
<code>vtreat::NumericOutcomeTreatment()</code>, <code>vtreat::BinomialOutcomeTreatment()</code>, or <code>vtreat::MultinomialOutcomeTreatment()</code>, followed by calling
<code>vtreat::fit_prepare()</code> on the training data and <code>vtreat::prepare()</code> during predicton.
</p>


<h3>Format</h3>

<p><code>R6Class</code> object inheriting from <code>PipeOpTaskPreproc</code>/<code>PipeOp</code>.
</p>


<h3>Construction</h3>

<div class="sourceCode"><pre>PipeOpVreat$new(id = "vtreat", param_vals = list())
</pre></div>

<ul>
<li> <p><code>id</code> :: <code>character(1)</code><br>
Identifier of resulting object, default <code>"vtreat"</code>.
</p>
</li>
<li> <p><code>param_vals</code> :: named <code>list</code><br>
List of hyperparameter settings, overwriting the hyperparameter settings that would otherwise be set during construction. Default <code>list()</code>.
</p>
</li>
</ul>
<h3>Input and Output Channels</h3>

<p>Input and output channels are inherited from <code>PipeOpTaskPreproc</code>.
</p>
<p>The output is the input <code>Task</code> with all affected features "prepared" by vtreat.
If vtreat found "no usable vars", the input <code>Task</code> is returned unaltered.
</p>


<h3>State</h3>

<p>The <code style="white-space: pre;">⁠$state⁠</code> is a named <code>list</code> with the <code style="white-space: pre;">⁠$state⁠</code> elements inherited from <code>PipeOpTaskPreproc</code>, as well as:
</p>

<ul><li> <p><code>treatment_plan</code> :: object of class <code>vtreat_pipe_step</code> | <code>NULL</code><br>
The treatment plan as constructed by vtreat based on the training data, i.e., an object of class <code>treatment_plan</code>.
If vtreat found "no usable vars" and designing the treatment would have failed, this is <code>NULL</code>.
</p>
</li></ul>
<h3>Parameters</h3>

<p>The parameters are the parameters inherited from <code>PipeOpTaskPreproc</code>, as well as:
</p>

<ul>
<li> <p><code>recommended</code> :: <code>logical(1)</code><br>
Whether only the "recommended" prepared features should be returned, i.e., non constant
variables with a significance value smaller than vtreat's threshold. Initialized to <code>TRUE</code>.
</p>
</li>
<li> <p><code>cols_to_copy</code> :: <code>function</code> | <code>Selector</code> <br><code>Selector</code> function, takes a <code>Task</code> as argument and returns a <code>character()</code> of features to copy.<br>
See <code>Selector</code> for example functions. Initialized to <code>selector_none()</code>.
</p>
</li>
<li> <p><code>minFraction</code> :: <code>numeric(1)</code><br>
Minimum frequency a categorical level must have to be converted to an indicator column.
</p>
</li>
<li> <p><code>smFactor</code> :: <code>numeric(1)</code><br>
Smoothing factor for impact coding models.
</p>
</li>
<li> <p><code>rareCount</code> :: <code>integer(1)</code><br>
Allow levels with this count or below to be pooled into a shared rare-level.
</p>
</li>
<li> <p><code>rareSig</code> :: <code>numeric(1)</code><br>
Suppress levels from pooling at this significance value greater.
</p>
</li>
<li> <p><code>collarProb</code> :: <code>numeric(1)</code><br>
What fraction of the data (pseudo-probability) to collar data at if <code>doCollar = TRUE</code>.
</p>
</li>
<li> <p><code>doCollar</code> :: <code>logical(1)</code><br>
If <code>TRUE</code> collar numeric variables by cutting off after a tail-probability specified by <code>collarProb</code> during treatment design.
</p>
</li>
<li> <p><code>codeRestriction</code> :: <code>character()</code><br>
What types of variables to produce.
</p>
</li>
<li> <p><code>customCoders</code> :: named <code>list</code><br>
Map from code names to custom categorical variable encoding functions.
</p>
</li>
<li> <p><code>splitFunction</code> :: <code>function</code><br>
Function taking arguments nSplits, nRows, dframe, and y; returning a user desired split.
</p>
</li>
<li> <p><code>ncross</code> :: <code>integer(1)</code><br>
Integer larger than one, number of cross-validation rounds to design.
</p>
</li>
<li> <p><code>forceSplit</code> :: <code>logical(1)</code><br>
If <code>TRUE</code> force cross-validated significance calculations on all variables.
</p>
</li>
<li> <p><code>catScaling</code> :: <code>logical(1)</code><br>
If <code>TRUE</code> use <code>stats::glm()</code> linkspace, if FALSE use <code>stats::lm()</code> for scaling.
</p>
</li>
<li> <p><code>verbose</code> :: <code>logical(1)</code><br>
If <code>TRUE</code> print progress.
</p>
</li>
<li> <p><code>use_paralell</code> :: <code>logical(1)</code><br>
If <code>TRUE</code> use parallel methods.
</p>
</li>
<li> <p><code>missingness_imputation</code> :: <code>function</code><br>
Function of signature f(values: numeric, weights: numeric), simple missing value imputer.<br>
Typically, an imputation via a <code>PipeOp</code> should be preferred, see <code>PipeOpImpute</code>.
</p>
</li>
<li> <p><code>pruneSig</code> :: <code>numeric(1)</code><br>
Suppress variables with significance above this level.
Only effects [regression tasksmlr3::TaskRegr and binary classification tasks.
</p>
</li>
<li> <p><code>scale</code> :: <code>logical(1)</code><br>
If <code>TRUE</code> replace numeric variables with single variable model regressions ("move to outcome-scale").
These have mean zero and (for variables with significant less than 1) slope 1 when regressed (lm for regression problems/glm for classification problems) against outcome.
</p>
</li>
<li> <p><code>varRestriction</code> :: <code>list()</code><br>
List of treated variable names to restrict to.
Only effects [regression tasksmlr3::TaskRegr and binary classification tasks.
</p>
</li>
<li> <p><code>trackedValues</code> :: named <code>list()</code><br>
Named list mapping variables to know values, allows warnings upon novel level appearances (see <code>vtreat::track_values()</code>).
Only effects [regression tasksmlr3::TaskRegr and binary classification tasks.
</p>
</li>
<li> <p><code>y_dependent_treatments</code> :: <code>character()</code><br>
Character what treatment types to build per-outcome level.
Only effects multiclass classification tasks.
</p>
</li>
<li> <p><code>imputation_map</code> :: named <code>list</code><br>
List of map from column names to functions of signature f(values: numeric, weights: numeric), simple missing value imputers.<br>
Typically, an imputation via a <code>PipeOp</code> is to be preferred, see <code>PipeOpImpute</code>.
</p>
</li>
</ul>
<p>For more information, see <code>vtreat::regression_parameters()</code>, <code>vtreat::classification_parameters()</code>, or <code>vtreat::multinomial_parameters()</code>.
</p>


<h3>Internals</h3>

<p>Follows vtreat's fit/prepare interface. See <code>vtreat::NumericOutcomeTreatment()</code>, <code>vtreat::BinomialOutcomeTreatment()</code>,
<code>vtreat::MultinomialOutcomeTreatment()</code>, <code>vtreat::fit_prepare()</code> and <code>vtreat::prepare()</code>.
</p>


<h3>Methods</h3>

<p>Only methods inherited from <code>PipeOpTaskPreproc</code>/<code>PipeOp</code>.
</p>


<h3>See Also</h3>

<p>https://mlr-org.com/pipeops.html
</p>
<p>Other PipeOps: 
<code>PipeOp</code>,
<code>PipeOpEnsemble</code>,
<code>PipeOpImpute</code>,
<code>PipeOpTargetTrafo</code>,
<code>PipeOpTaskPreproc</code>,
<code>PipeOpTaskPreprocSimple</code>,
<code>mlr_pipeops</code>,
<code>mlr_pipeops_adas</code>,
<code>mlr_pipeops_blsmote</code>,
<code>mlr_pipeops_boxcox</code>,
<code>mlr_pipeops_branch</code>,
<code>mlr_pipeops_chunk</code>,
<code>mlr_pipeops_classbalancing</code>,
<code>mlr_pipeops_classifavg</code>,
<code>mlr_pipeops_classweights</code>,
<code>mlr_pipeops_colapply</code>,
<code>mlr_pipeops_collapsefactors</code>,
<code>mlr_pipeops_colroles</code>,
<code>mlr_pipeops_copy</code>,
<code>mlr_pipeops_datefeatures</code>,
<code>mlr_pipeops_encode</code>,
<code>mlr_pipeops_encodeimpact</code>,
<code>mlr_pipeops_encodelmer</code>,
<code>mlr_pipeops_featureunion</code>,
<code>mlr_pipeops_filter</code>,
<code>mlr_pipeops_fixfactors</code>,
<code>mlr_pipeops_histbin</code>,
<code>mlr_pipeops_ica</code>,
<code>mlr_pipeops_imputeconstant</code>,
<code>mlr_pipeops_imputehist</code>,
<code>mlr_pipeops_imputelearner</code>,
<code>mlr_pipeops_imputemean</code>,
<code>mlr_pipeops_imputemedian</code>,
<code>mlr_pipeops_imputemode</code>,
<code>mlr_pipeops_imputeoor</code>,
<code>mlr_pipeops_imputesample</code>,
<code>mlr_pipeops_kernelpca</code>,
<code>mlr_pipeops_learner</code>,
<code>mlr_pipeops_missind</code>,
<code>mlr_pipeops_modelmatrix</code>,
<code>mlr_pipeops_multiplicityexply</code>,
<code>mlr_pipeops_multiplicityimply</code>,
<code>mlr_pipeops_mutate</code>,
<code>mlr_pipeops_nmf</code>,
<code>mlr_pipeops_nop</code>,
<code>mlr_pipeops_ovrsplit</code>,
<code>mlr_pipeops_ovrunite</code>,
<code>mlr_pipeops_pca</code>,
<code>mlr_pipeops_proxy</code>,
<code>mlr_pipeops_quantilebin</code>,
<code>mlr_pipeops_randomprojection</code>,
<code>mlr_pipeops_randomresponse</code>,
<code>mlr_pipeops_regravg</code>,
<code>mlr_pipeops_removeconstants</code>,
<code>mlr_pipeops_renamecolumns</code>,
<code>mlr_pipeops_replicate</code>,
<code>mlr_pipeops_rowapply</code>,
<code>mlr_pipeops_scale</code>,
<code>mlr_pipeops_scalemaxabs</code>,
<code>mlr_pipeops_scalerange</code>,
<code>mlr_pipeops_select</code>,
<code>mlr_pipeops_smote</code>,
<code>mlr_pipeops_smotenc</code>,
<code>mlr_pipeops_spatialsign</code>,
<code>mlr_pipeops_subsample</code>,
<code>mlr_pipeops_targetinvert</code>,
<code>mlr_pipeops_targetmutate</code>,
<code>mlr_pipeops_targettrafoscalerange</code>,
<code>mlr_pipeops_textvectorizer</code>,
<code>mlr_pipeops_threshold</code>,
<code>mlr_pipeops_tunethreshold</code>,
<code>mlr_pipeops_unbranch</code>,
<code>mlr_pipeops_updatetarget</code>,
<code>mlr_pipeops_yeojohnson</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library("mlr3")

set.seed(2020)

make_data &lt;- function(nrows) {
    d &lt;- data.frame(x = 5 * rnorm(nrows))
    d["y"] = sin(d[["x"]]) + 0.01 * d[["x"]] + 0.1 * rnorm(nrows)
    d[4:10, "x"] = NA  # introduce NAs
    d["xc"] = paste0("level_", 5 * round(d$y / 5, 1))
    d["x2"] = rnorm(nrows)
    d[d["xc"] == "level_-1", "xc"] = NA  # introduce a NA level
    return(d)
}

task = TaskRegr$new("vtreat_regr", backend = make_data(100), target = "y")

pop = PipeOpVtreat$new()
pop$train(list(task))

</code></pre>


</div>