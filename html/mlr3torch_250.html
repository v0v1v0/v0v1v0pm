<div class="container">

<table style="width: 100%;"><tr>
<td>torch_callback</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a Callback Desctiptor</h2>

<h3>Description</h3>

<p>Convenience function to create a custom <code>TorchCallback</code>.
All arguments that are available in <code>callback_set()</code> are also available here.
For more information on how to correctly implement a new callback, see <code>CallbackSet</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">torch_callback(
  id,
  classname = paste0("CallbackSet", capitalize(id)),
  param_set = NULL,
  packages = NULL,
  label = capitalize(id),
  man = NULL,
  on_begin = NULL,
  on_end = NULL,
  on_exit = NULL,
  on_epoch_begin = NULL,
  on_before_valid = NULL,
  on_epoch_end = NULL,
  on_batch_begin = NULL,
  on_batch_end = NULL,
  on_after_backward = NULL,
  on_batch_valid_begin = NULL,
  on_batch_valid_end = NULL,
  on_valid_end = NULL,
  state_dict = NULL,
  load_state_dict = NULL,
  initialize = NULL,
  public = NULL,
  private = NULL,
  active = NULL,
  parent_env = parent.frame(),
  inherit = CallbackSet,
  lock_objects = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>(<code>character(1)</code>)<br>'<br>
The id for the torch callback.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>classname</code></td>
<td>
<p>(<code>character(1)</code>)<br>
The class name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>param_set</code></td>
<td>
<p>(<code>ParamSet</code>)<br>
The parameter set, if not present it is inferred from the <code style="white-space: pre;">⁠$initialize()⁠</code> method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>packages</code></td>
<td>
<p>(<code>character()</code>)<br><code style="white-space: pre;">⁠The packages the callback depends on. Default is⁠</code>NULL'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label</code></td>
<td>
<p>(<code>character(1)</code>)<br>
The label for the torch callback.
Defaults to the capitalized <code>id</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>man</code></td>
<td>
<p>(<code>character(1)</code>)<br>
String in the format <code style="white-space: pre;">⁠[pkg]::[topic]⁠</code> pointing to a manual page for this object.
The referenced help package can be opened via method <code style="white-space: pre;">⁠$help()⁠</code>.
The default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>on_begin, on_end, on_epoch_begin, on_before_valid, on_epoch_end, on_batch_begin, on_batch_end, on_after_backward, on_batch_valid_begin, on_batch_valid_end, on_valid_end, on_exit</code></td>
<td>
<p>(<code>function</code>)<br>
Function to execute at the given stage, see section <em>Stages</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>state_dict</code></td>
<td>
<p>(<code style="white-space: pre;">⁠function()⁠</code>)<br>
The function that retrieves the state dict from the callback.
This is what will be available in the learner after training.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>load_state_dict</code></td>
<td>
<p>(<code style="white-space: pre;">⁠function(state_dict)⁠</code>)<br>
Function that loads a callback state.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initialize</code></td>
<td>
<p>(<code style="white-space: pre;">⁠function()⁠</code>)<br>
The initialization method of the callback.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>public, private, active</code></td>
<td>
<p>(<code>list()</code>)<br>
Additional public, private, and active fields to add to the callback.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parent_env</code></td>
<td>
<p>(<code>environment()</code>)<br>
The parent environment for the <code>R6Class</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inherit</code></td>
<td>
<p>(<code>R6ClassGenerator</code>)<br>
From which class to inherit.
This class must either be <code>CallbackSet</code> (default) or inherit from it.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lock_objects</code></td>
<td>
<p>(<code>logical(1)</code>)<br>
Whether to lock the objects of the resulting <code>R6Class</code>.
If <code>FALSE</code> (default), values can be freely assigned to <code>self</code> without declaring them in the
class definition.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>TorchCallback</code>
</p>


<h3>Internals</h3>

<p>It first creates an <code>R6</code> class inheriting from <code>CallbackSet</code> (using <code>callback_set()</code>) and
then wraps this generator in a <code>TorchCallback</code> that can be passed to a torch learner.
</p>


<h3>Stages</h3>


<ul>
<li> <p><code>begin</code> :: Run before the training loop begins.
</p>
</li>
<li> <p><code>epoch_begin</code> :: Run he beginning of each epoch.
</p>
</li>
<li> <p><code>batch_begin</code> :: Run before the forward call.
</p>
</li>
<li> <p><code>after_backward</code> :: Run after the backward call.
</p>
</li>
<li> <p><code>batch_end</code> :: Run after the optimizer step.
</p>
</li>
<li> <p><code>batch_valid_begin</code> :: Run before the forward call in the validation loop.
</p>
</li>
<li> <p><code>batch_valid_end</code> :: Run after the forward call in the validation loop.
</p>
</li>
<li> <p><code>valid_end</code> :: Run at the end of validation.
</p>
</li>
<li> <p><code>epoch_end</code> :: Run at the end of each epoch.
</p>
</li>
<li> <p><code>end</code> :: Run after last epoch.
</p>
</li>
<li> <p><code>exit</code> :: Run at last, using <code>on.exit()</code>.
</p>
</li>
</ul>
<h3>See Also</h3>

<p>Other Callback: 
<code>TorchCallback</code>,
<code>as_torch_callback()</code>,
<code>as_torch_callbacks()</code>,
<code>callback_set()</code>,
<code>mlr3torch_callbacks</code>,
<code>mlr_callback_set</code>,
<code>mlr_callback_set.checkpoint</code>,
<code>mlr_callback_set.progress</code>,
<code>mlr_context_torch</code>,
<code>t_clbk()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
custom_tcb = torch_callback("custom",
  initialize = function(name) {
    self$name = name
  },
  on_begin = function() {
    cat("Hello", self$name, ", we will train for ", self$ctx$total_epochs, "epochs.\n")
  },
  on_end = function() {
    cat("Training is done.")
  }
)

learner = lrn("classif.torch_featureless",
  batch_size = 16,
  epochs = 1,
  callbacks = custom_tcb,
  cb.custom.name = "Marie",
  device = "cpu"
)
task = tsk("iris")
learner$train(task)

</code></pre>


</div>