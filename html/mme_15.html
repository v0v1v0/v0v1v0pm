<div class="container">

<table style="width: 100%;"><tr>
<td>modelfit3</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Function used to fit Model 3</h2>

<h3>Description</h3>

<p>This function fits the multinomial mixed model with two independent random effects
for each category of the response variable: one domain random effect and another correlated time and domain random effect (Model 3). The formulation is described in Lopez-Vizcaino et al. (2013).
The fitting algorithm combine the penalized quasi-likelihood method (PQL) for estimating
and predicting the fixed and random effects, respectively, with the residual maximun likelihood method (REML)
for estimating the variance components. This function uses as initial values the output of the function
<code>initial.values</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">modelfit3(d, t, pp, Xk, X, Z, initial, y, M, MM, b)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>number of areas.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>
<p>number of time periods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pp</code></td>
<td>
<p>vector with the number of the auxiliary variables per category.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xk</code></td>
<td>
<p>list of matrices with the auxiliary variables per category obtained from <code>data.mme</code>. The dimension of the list is the number of domains.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>list of matrices with the auxiliary variables obtained from <code>data.mme</code>. The dimension of the list is the number of categories of the response variable minus one.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p>design matrix  of random effects obtained from <code>data.mme</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial</code></td>
<td>
<p>output of the function <code>initial.values</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>matrix with the response variable obtained from <code>data.mme</code>, except the reference category. The rows are the domains and the columns are the categories of the response variable minus one.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M</code></td>
<td>
<p>vector with the area sample sizes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MM</code></td>
<td>
<p>vector with the population sample sizes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b</code></td>
<td>
<p>parameter that indicates the bootstrap.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list containing the following components.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Estimated.probabilities</code></td>
<td>
<p>matrix with the estimated probabilities
for the categories of response variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Fisher.information.matrix.phi</code></td>
<td>
<p>Fisher information matrix of phi.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Fisher.information.matrix.beta</code></td>
<td>
<p>Fisher information matrix of beta.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u1</code></td>
<td>
<p>matrix with the estimated first random effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u2</code></td>
<td>
<p>matrix with the estimated second random effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mean</code></td>
<td>
<p>matrix with the estimated mean of the response variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warning1</code></td>
<td>
<p>0=OK,1=The model could not be fitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warning2</code></td>
<td>
<p>0=OK,1=The value of the variance component is negative: the initial value
is taken.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta.Stddev.p.value</code></td>
<td>
<p>matrix with the estimated fixed effects, its standard
deviations and its p-values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi.Stddev.p.value</code></td>
<td>
<p>matrix with the estimated variance components, its
standard deviations and its p-values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>estimated correlation parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho.Stddev.p.value</code></td>
<td>
<p>matrix with the estimated correlation parameter, its
standard deviations and its p-values.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Lopez-Vizcaino, ME, Lombardia, MJ and Morales, D (2013).
Small area estimation of labour force indicators under a multinomial mixed model
with correlated time and area effects. Submitted for review.
</p>


<h3>See Also</h3>

<p><code>data.mme</code>, <code>initial.values</code>,
<code>wmatrix</code>, <code>phi.mult.ct</code>,
<code>prmu.time</code>, <code>phi.direct.ct</code>,
<code>sPhikf.ct</code>, <code>omega</code>, <code>ci</code>,
<code>Fbetaf.ct</code>, <code>msef.ct</code>,
<code>mseb</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

k=3 #number of categories of the response variable
pp=c(1,1) #vector with the number of auxiliary variables in each category
mod=3 #type of model
data(simdata3)   #data
datar=data.mme(simdata3,k,pp,mod)

##Model fit
result=modelfit3(datar$d,datar$t,pp,datar$Xk,datar$X,datar$Z,datar$initial,datar$y[,1:(k-1)],
       datar$n,datar$N,0)
## End(Not run)
</code></pre>


</div>