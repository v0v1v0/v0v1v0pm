<div class="container">

<table style="width: 100%;"><tr>
<td>geem2</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit Generalized Estimating Equation Models</h2>

<h3>Description</h3>

<p><code>geem2</code> is a modified version of <code>geem</code> to fit generalized estimating equation models and to provide objects that can be used
for simultaneous inference across multiple marginal models using <code>mmmgee</code> and <code>mmmgee.test</code>.
Like <code>geem</code>, <code>geem2</code> estimates coefficients and nuisance parameters using generalized estimating equations. The link and variance functions can be
specified by the user and the syntax is similar to <code>glm</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">geem2(formula, id, waves = NULL, data = parent.frame(),
  family = gaussian, corstr = "independence", Mv = 1,
  weights = NULL, corr.mat = NULL, init.beta = NULL,
  init.alpha = NULL, init.phi = 1, scale.fix = FALSE,
  nodummy = FALSE, sandwich = TRUE, useP = TRUE, maxit = 20,
  tol = 1e-05, restriction = NULL, conv.criterion = c("ratio",
  "difference"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a formula expression similar to that for <code>glm</code>, of the form <code>response~predictors</code>. An offset is allowed, as in glm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>a vector identifying the clusters. By default, data are assumed to be sorted such that observations in a cluster are in consecutive rows and higher
numbered rows in a cluster are assumed to be later. If <code>NULL</code>, then each observation is assigned its own cluster.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>waves</code></td>
<td>
<p>a non-negative integer vector identifying components of a cluster. For example, this could be a time ordering. If integers are skipped within a cluster,
then dummy rows with weight 0 are added in an attempt to preserve the correlation structure (except if <code>corstr = "exchangeable"</code> or <code>"independent"</code>).
This can be skipped by setting <code>nodummy=TRUE</code>. When assessing missing values, waves are assumed to start at 1, starting at a larger integer is therefore computationally
inefficient.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional data frame containing the variables in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>will determine the link and variance functions. The argument can be one of three options: a family object, a character string, or a list of functions. 
For more information on how to use family objects, see <code>family</code>. If the supplied argument is a character string, then the string should
correspond to one of the family objects.
In order to define a link function, a list must be created with the components <code>(LinkFun, VarFun, InvLink, InvLinkDeriv)</code>, all of which are vectorized functions.
If the components in the list are not named as <code>(LinkFun, VarFun, InvLink, InvLinkDeriv)</code>, then <code>geem2</code> assumes that the functions are given in that order.
<code>LinkFun</code> and <code>VarFun</code> are the link and variance functions. <code>InvLink</code> and <code>InvLinkDeriv</code> are the inverse of the link function and the derivative
of the inverse of the link function and so are decided by the choice of the link function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corstr</code></td>
<td>
<p>a character string specifying the correlation structure. Allowed structures are: <code>"independence", "exchangeable", "ar1", "m-dependent", "unstructured", "fixed"</code>,
and <code>"userdefined"</code>. Any unique substring may be supplied. If <code>"fixed"</code> or <code>"userdefined"</code>, then <code>corr.mat</code> must be specified. If <code>"m-dependent"</code>,
then <code>Mv</code> is relevant.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Mv</code></td>
<td>
<p>for <code>"m-dependent"</code>, the value for <code>m</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>A vector of weights for the inverse of the scale factor each observation. 
If an observation is assigned weight 0, it is excluded from the calculations of any parameters. 
Observations with a <code>NA</code> in any variable will be assigned a weight of 0.
Note that weights are defined differently in <code>geem2</code> and <code>geem</code>, see details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corr.mat</code></td>
<td>
<p>the correlation matrix for <code>"fixed"</code>. Matrix should be symmetric with dimensions &gt;= the maximum cluster size.
If the correlation structure is <code>"userdefined"</code>, then this is a matrix describing which correlations are the same. In that case, all entries have to be integers,
and values less or equal zero indicate a correlation of zero. The information regarding the user-defined structure are extracted from the upper triangle of the provided matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init.beta</code></td>
<td>
<p>an optional vector with the initial values of beta. If not specified, then the intercept will be set to <code>InvLink(mean(response))</code>.
<code>init.beta</code> must be specified if not using an intercept.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init.alpha</code></td>
<td>
<p>an optional scalar or vector giving the initial values for the correlation. If provided along with <code>Mv&gt;1</code> or unstructured correlation,
then the user must ensure that the vector is of the appropriate length.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init.phi</code></td>
<td>
<p>an optional initial scale parameter. If not supplied, initialized to 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale.fix</code></td>
<td>
<p>if set to <code>TRUE</code>, then the scale parameter is fixed at the value of init.phi. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nodummy</code></td>
<td>
<p>if set to <code>TRUE</code>, then dummy rows will not be added based on the values in waves.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sandwich</code></td>
<td>
<p>if <code>TRUE</code>, calculate robust variance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useP</code></td>
<td>
<p>if set to <code>FALSE</code>, do not use the n-p correction for dispersion and correlation estimates, as in Liang and Zeger. This can be useful when the number
of observations is small, as subtracting p may yield correlations greater than 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>
<p>maximum number of iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>tolerance in calculation of coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>restriction</code></td>
<td>
<p>either a contrast matrix or a list of a contrast matrix and a right hand side vector, defining a restriction on the regression coefficients. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conv.criterion</code></td>
<td>
<p>convergence criterion, either <code>"ratio"</code> or <code>"difference"</code>. The default is <code>"ratio"</code>, using the relative change in regression coefficient
estimates as convergence criterion, like in <code>geem</code>.
With <code>"difference"</code> the maximum absolute difference in regression coefficient estimates is used. The latter is required if some coefficient is 0,
e.g. by estimation under some restriction.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function is a modification of <code>geem</code> from the geeM package, such that
additional output is returned that is required for the calculation of covariance
matrix across multiple marginal models. In particular the contributions of each subject to the estimating equation are made available in the output. Internal functions regarding
the calculation of matrix inverses were modified to improve the handling of missing data.
</p>
<p>In <code>geem2</code>, weights are defined as scale weights, similar to most othe software. Note that, in contrast, the current version of <code>geem</code> (version 0.10.1) uses 
residual weights.
</p>
<p>The scale parameter <code>phi</code> is used in estimating the residual working correlation parameters and in estimating the model based (naiv) covariance matrix of the regression coefficients.
Similar as in most other software, requesting <code>scale.fix=TRUE</code> only has an impact on the latter, while the working correlation is still estimated using an empirical 
scale factor for the residuals. In contrast, <code>geem</code> uses the fixed scale factor also when estimating the working correlation.
</p>
<p><code>geem2</code> allows for estimation of regression coefficients under linear restrictions <code class="reqn">L\beta=r</code>, where <code class="reqn">L</code> is a contrast matrix, <code class="reqn">\beta</code>
the vector of regression coefficients and <code class="reqn">r</code> a real valued right hand side vector. Using the argument <code>restriction</code>, <code class="reqn">L</code> and <code class="reqn">r</code> can be specified.
If only <code class="reqn">L</code> is specified, <code class="reqn">r</code> is assumed as null vector. The functionality is in particular required to calculate the generalized score test for linear hypotheses about
<code class="reqn">\beta</code>. Use <code>conv.criterion="difference"</code> if any regression coefficient is restricted to 0.
</p>


<h3>Value</h3>

<p>A list with class <code>geem2</code>, similar to the output
of <code>geem</code> from the geeM package. The additional slot <code>sandwich.args</code> contains components to calculate the sandwich variance estimator for the
fitted model and across models if
applied in the multiple marginal model framework.
</p>


<h3>Note</h3>

<p>The option to fit a model with linear restrictions concerning the coefficients is implemented to enable the calculation of a generalized score test.
It may also be used to obtain estimates of the coefficients under restrictions. The model based and robust variance estimates of the restricted 
coefficient estimates are found in the slots <code>restricted.naiv.var</code> and <code>restricted.var</code>, respectively. Note that the variance of estimates restricted to a single value
is supposed to be zero, however the calculated variance estimate may deviate from zero within machine accuracy.
</p>


<h3>Author(s)</h3>

<p>The <code>geem</code> function was written by Lee McDaniel and Nick Henderson, modifications for <code>geem2</code> are by Robin Ristl <a href="mailto:robin.ristl@meduniwien.ac.at">robin.ristl@meduniwien.ac.at</a>
</p>


<h3>References</h3>

<p>Lee S. McDaniel, Nicholas C. Henderson, Paul J. Rathouz. Fast pure R implementation of GEE: application of the matrix package. The R journal 5.1 (2013): 181.
</p>


<h3>See Also</h3>

<p><code>mmmgee</code>, <code>geem</code>, <code>mmmgee.test</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(keratosis)
m1&lt;-geem2(clearance~trt,id=id,data=keratosis,family=binomial,corstr="independence")
summary(m1)
m2&lt;-geem2(pain~trt,id=id,data=keratosis[keratosis$lesion==1,],family=gaussian,corstr="independence")
summary(m2)
geem2(pain~trt,id=id,data=keratosis[keratosis$lesion==1,],family=gaussian,corstr="exchangeable")
#
data(datasim)
mod1&lt;-geem2(Y.lin~gr.lang+x1,id=id,data=datasim,family="gaussian",corstr="exchangeable")
summary(mod1)
mod2&lt;-geem2(Y.poi~gr.lang+x2,id=id,data=datasim,family="poisson",corstr="unstructured")
summary(mod2)
mod3&lt;-geem2(Y.bin~gr.lang+x3,id=id,data=datasim,family="binomial",corstr="user",
	corr.mat=matrix(c(1,2,3,0, 2,1,2,3, 3,2,1,2, 0,3,2,1),4,4))
summary(mod3)

</code></pre>


</div>