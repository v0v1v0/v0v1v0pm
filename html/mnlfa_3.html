<div class="container">

<table style="width: 100%;"><tr>
<td>mnlfa</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Moderated Nonlinear Factor Analysis
</h2>

<h3>Description</h3>

<p>General function for conducting moderated nonlinear factor analysis
(Curran et al., 2014). Item slopes and item intercepts can be modeled as functions
of person covariates.
</p>
<p>Parameter regularization is allowed. For categorical covariates,
group lasso can be used for regularization.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mnlfa(dat, items, item_type="2PL", formula_int=~1, formula_slo=~1, formula_mean=~0,
   formula_sd=~0, theta=NULL, parm_list_init=NULL, parm_trait_init=NULL, prior_init=NULL,
   regular_lam=c(0, 0), regular_type=c("none", "none"), maxit=1000, msteps=4, conv=1e-05,
   conv_mstep=1e-04, h=1e-04, parms_regular_types=NULL, parms_regular_lam=NULL,
   parms_iterations=NULL, center_parms=NULL, center_max_iter=6, L_max=.07,
   verbose=TRUE)

## S3 method for class 'mnlfa'
summary(object, file=NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>

<p>Data frame with item responses
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>items</code></td>
<td>

<p>Vector containing item names
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>item_type</code></td>
<td>

<p>String or vector of item types. Currently, only item types <code>"1PL"</code> or
<code>"2PL"</code> can be chosen.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula_int</code></td>
<td>

<p>String or list with formula for item intercepts
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula_slo</code></td>
<td>

<p>String or list with formula for item slopes
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula_mean</code></td>
<td>

<p>Formula for mean of the trait distribution
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula_sd</code></td>
<td>

<p>Formula for standard deviation of the trait distribution
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>

<p>Grid of <code class="reqn">\theta</code> values used for approximation of normally
distributed trait
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parm_list_init</code></td>
<td>

<p>Optional list of initial item parameters
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parm_trait_init</code></td>
<td>
<p>Optional list of initial parameters for trait distribution</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior_init</code></td>
<td>
<p>Optional matrix of prior distribution for persons</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regular_lam</code></td>
<td>

<p>Vector of length two containing two general regularization
parameters for item intercepts and item slopes
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regular_type</code></td>
<td>

<p>Type of regularization method. Can be <code>"none"</code>,
<code>"lasso"</code>, <code>"scad"</code> or <code>"mcp"</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>

<p>Maximum number of iterations
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>msteps</code></td>
<td>

<p>Maximum number of M-steps
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conv</code></td>
<td>

<p>Convergence criterion with respect to parameters
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conv_mstep</code></td>
<td>

<p>Convergence criterion in M-step
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h</code></td>
<td>

<p>Numerical differentiation parameter
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parms_regular_types</code></td>
<td>

<p>Optional list containing parameter specific regularization types
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parms_regular_lam</code></td>
<td>

<p>Optional list containing parameter specific regularization parameters
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parms_iterations</code></td>
<td>

<p>Optional list containing sequence of parameter indices used for updating
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>center_parms</code></td>
<td>
<p>Optional list indicating which parameters
should be centered during initial iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>center_max_iter</code></td>
<td>
<p>Maximum number of iterations in which parameters
should be centered.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>L_max</code></td>
<td>
<p>Majorization parameter used in regularization</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>

<p>Logical indicating whether output should be printed
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>Object of class <code>mnlfa</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>Optional file name</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments to be passed</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The moderated factor analysis model for dichotomous responses defined as
</p>
<p style="text-align: center;"><code class="reqn">P(X_{pi}=1 | \theta_p )=invlogit( a_{pi} \theta_p - b_{pi} ) </code>
</p>

<p>The trait distribution <code class="reqn">\theta_p \sim N( \mu_p, \sigma_p^2)</code>
allows a latent regression of person covariates on the mean
with <code class="reqn">\mu_p=\bold{X}_p \bold{\gamma}</code> (to be specified in <code>formula_mean</code>)
and the logarithm of the standard deviation <code class="reqn">\log \sigma_p=\bold{Z}_p \bold{\delta} </code>
(to be specified in <code>formula_sd</code>).
Item intercepts and item slopes can be moderated by person covariates, i.e.
<code class="reqn">a_{pi}=\bold{W}_{pi} \bold{\alpha}_i </code> and
<code class="reqn">b_{pi}=\bold{V}_{pi} \bold{\beta}_i </code>. Regularization on (some of) the
<code class="reqn">\bold{\alpha}_i</code> or <code class="reqn">\bold{\beta}_i</code> parameters is allowed.
</p>
<p>The model is estimated using an EM algorithm with the coordinate descent
method during the M-step (Sun et al., 2016).
</p>


<h3>Value</h3>

<p>List with model results including
</p>
<table>
<tr style="vertical-align: top;">
<td><code>item</code></td>
<td>
<p>Summary table for item parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trait</code></td>
<td>
<p>Summary table for trait parameters</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Curran, P. J., McGinley, J. S., Bauer, D. J., Hussong, A. M., Burns, A.,
Chassin, L., Sher, K., &amp; Zucker, R. (2014).
A moderated nonlinear factor model for the development of commensurate measures
in integrative data analysis. <em>Multivariate Behavioral Research, 49</em>(3),
214-231.
http://dx.doi.org/10.1080/00273171.2014.889594
</p>
<p>Sun, J., Chen, Y., Liu, J., Ying, Z., &amp; Xin, T. (2016). Latent variable selection for
multidimensional item response theory models via L1 regularization.
<em>Psychometrika, 81</em>(4), 921-939.
https://doi.org/10.1007/s11336-016-9529-6
</p>


<h3>See Also</h3>

<p>See also the <span class="pkg">aMNLFA</span> package for automatized moderated nonlinear factor analysis
which provides convenient wrapper functions for automized analysis
in the <em>Mplus</em> software.
</p>
<p>See the <span class="pkg">GPCMlasso</span> package for the regularized generalized partial credit model.
</p>


<h3>Examples</h3>

<pre><code class="language-R">#############################################################################
# EXAMPLE 1: Dichotomous data, 1PL model
#############################################################################

data(data.mnlfa01, package="mnlfa")

dat &lt;- data.mnlfa01
# extract items from dataset
items &lt;- grep("I[0-9]", colnames(dat), value=TRUE)
I &lt;- length(items)

# maximum number of iterations (use only few iterations for the only purpose of
# providing CRAN checks)
maxit &lt;- 10

#***** Model 1: 1PL model without moderating parameters and without covariates for traits

# no covariates for trait
formula_mean &lt;- ~0
formula_sd &lt;- ~1
# no item covariates
formula_int &lt;- ~1
formula_slo &lt;- ~1

mod1 &lt;- mnlfa::mnlfa( dat=dat, items, item_type="1PL", formula_int=formula_int,
             formula_slo=formula_slo, formula_mean=formula_mean, formula_sd=formula_sd,
             maxit=maxit )
summary(mod1)


#***** Model 2: 1PL model without moderating parameters and with covariates for traits

# covariates for trait
formula_mean &lt;- ~female + age
formula_sd &lt;- ~1

mod2 &lt;- mnlfa::mnlfa( dat=dat, items, item_type="1PL", formula_int=formula_int,
             formula_slo=formula_slo, formula_mean=formula_mean, formula_sd=formula_sd)
summary(mod2)

#***** Model 3: 1PL model with moderating parameters and with covariates for traits
#***   Regularization method 'mcp'

# covariates for trait
formula_mean &lt;- ~female + age
formula_sd &lt;- ~1
# moderation effects for items
formula_int &lt;- ~1+female+age
formula_slo &lt;- ~1

# center parameters for female and age in initial iterations for improving convergence
center_parms &lt;- list( rep(2,I), rep(3,I) )

# regularization parameters for item intercept and item slope, respectively
regular_lam &lt;- c(.06, .25)
regular_type &lt;- c("mcp","none")

mod3 &lt;- mnlfa::mnlfa( dat=dat, items, item_type="1PL", formula_int=formula_int,
            formula_slo=formula_slo, formula_mean=formula_mean, formula_sd=formula_sd,
            center_parms=center_parms, regular_lam=regular_lam, regular_type=regular_type )
summary(mod3)


#***** Model 4: 1PL model with selected moderated item parameters

#* trait distribution
formula_mean &lt;- ~0+female+age
formula_sd &lt;- ~1

#* formulas for item intercepts
formula_int &lt;- ~1
formula_int &lt;- mnlfa::mnlfa_expand_to_list(x=formula_int, names_list=items)
mod_items &lt;- c(4,5,6,7)
for (ii in mod_items){
    formula_int[[ii]] &lt;- ~1+female+age
}
formula_slo &lt;- ~1

mod4 &lt;- mnlfa::mnlfa( dat=dat, items, item_type="1PL", formula_int=formula_int,
              formula_slo=formula_slo, formula_mean=formula_mean, formula_sd=formula_sd)
mod4$item
mod4$trait
summary(mod4)

</code></pre>


</div>