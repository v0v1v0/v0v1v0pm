<div class="container">

<table style="width: 100%;"><tr>
<td>mock</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Mocking helper functions</h2>

<h3>Description</h3>

<p>Calls to mock-objects either constructed using <code>mock()</code> or returned by
<code>local_mock()</code> can keep track of how they were called and functions
<code>mock_call()</code>, <code>mock_arg/s()</code> and <code>mock_n_called()</code> can be used to retrieve
related information.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mock(expr, env = parent.frame())

mock_call(x, call_no = mock_n_called(x))

mock_args(x, call_no = mock_n_called(x))

mock_arg(x, arg, call_no = mock_n_called(x))

mock_n_called(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>expr</code></td>
<td>
<p>Expression to be used as body of the function to be mocked.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>env</code></td>
<td>
<p>Environment used as ancestor to the mock function environment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Object of class <code>mock_fun</code> to be queried for call and argument
information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call_no</code></td>
<td>
<p>The call number of interest (in case the function was called
multiple times).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>arg</code></td>
<td>
<p>String-valued argument name to be retrieved.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A mocking function can be created either from a single object to be used
as return value or from an expression which is used as function body. In
both cases, the function signature is inferred from the mock-target.
Furthermore, closures constructed by <code>mock()</code> are able to keep track of
call objects and arguments passed to their respective targets. The
following utility functions are available to query this information:
</p>

<ul>
<li> <p><code>mock_call()</code>: retrieves the call captured by <code>base::match.call()</code>
</p>
</li>
<li> <p><code>mock_arg()</code>: retrieves the value of the argument with name passed as
string-valued argument <code>arg</code>
</p>
</li>
<li> <p><code>mock_args()</code>: retrieves a list of all arguments used for calling the
mocked function
</p>
</li>
<li> <p><code>mock_n_called()</code>: counts the number of times the mocked function was
called
</p>
</li>
</ul>
<p>Calls to mock objects are indexed chronologically and both <code>mock_call()</code>
and <code>mock_args()</code> provide an argument <code>call_no</code> which can be used to specify
which call is of interest, with the default being the most recent (or last)
one.
</p>


<h3>Value</h3>


<ul>
<li> <p><code>mock()</code>: a <code>mock_fun</code> object
</p>
</li>
<li> <p><code>mock_call()</code>: a call (created by <code>base::match.call()</code>)
</p>
</li>
<li> <p><code>mock_arg()</code>: the object used as specified function argument
</p>
</li>
<li> <p><code>mock_args()</code>: a list of all function arguments used to create a call to
the <code>mock_fun</code> object in question
</p>
</li>
<li> <p><code>mock_n_called()</code>: a scalar integer
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">url &lt;- "https://eu.httpbin.org/get?foo=123"

mk &lt;- mock("mocked request")
dl &lt;- function(x) curl::curl(x)

with_mock(`curl::curl` = mk, dl(url))

mock_call(mk)
mock_args(mk)
mock_n_called(mk)

mk &lt;- mock({
  url
})

with_mock(`curl::curl` = mk, dl(url))

my_return_val &lt;- "mocked request"
mk &lt;- mock(my_return_val)

with_mock(`curl::curl` = mk, dl(url))

</code></pre>


</div>