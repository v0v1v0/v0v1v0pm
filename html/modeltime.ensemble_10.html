<div class="container">

<table style="width: 100%;"><tr>
<td>ensemble_nested_average</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Nested Ensemble Average</h2>

<h3>Description</h3>

<p>Creates an Ensemble Model using Mean/Median Averaging in the
Modeltime Nested Forecasting Workflow.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ensemble_nested_average(
  object,
  type = c("mean", "median"),
  keep_submodels = TRUE,
  model_ids = NULL,
  control = control_nested_fit()
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>A nested modeltime object (inherits class <code>nested_mdl_time</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>One of "mean" for mean averaging or "median" for median averaging</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep_submodels</code></td>
<td>
<p>Whether or not to keep the submodels in the
nested modeltime table results</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_ids</code></td>
<td>
<p>A vector of id's (<code>.model_id</code>) identifying which submodels to
use in the ensemble.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>Controls various aspects of the ensembling process. See <code>modeltime::control_nested_fit()</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If we start with a nested modeltime table, we can add ensembles.
</p>
<div class="sourceCode r"><pre>nested_modeltime_tbl

# Nested Modeltime Table
Trained on: .splits | Model Errors: [0]
# A tibble: 2 x 5
  id    .actual_data       .future_data      .splits         .modeltime_tables
  &lt;fct&gt; &lt;list&gt;             &lt;list&gt;            &lt;list&gt;          &lt;list&gt;
1 1_1   &lt;tibble [104 x 2]&gt; &lt;tibble [52 x 2]&gt; &lt;split [52|52]&gt; &lt;mdl_time_tbl [2 x 5]&gt;
2 1_3   &lt;tibble [104 x 2]&gt; &lt;tibble [52 x 2]&gt; &lt;split [52|52]&gt; &lt;mdl_time_tbl [2 x 5]&gt;
</pre></div>
<p>An ensemble can be added to a Nested modeltime table.
</p>
<div class="sourceCode r"><pre>ensem &lt;- nested_modeltime_tbl %&gt;%
    ensemble_nested_average(
        type           = "mean",
        keep_submodels = TRUE,
        control        = control_nested_fit(allow_par = FALSE, verbose = TRUE)
    )
</pre></div>
<p>We can then verify the model has been added.
</p>
<div class="sourceCode r"><pre>ensem %&gt;% extract_nested_modeltime_table()
</pre></div>
<p>This produces an ensemble .model_id 3, which is an ensemble of the first two models.
</p>
<div class="sourceCode"><pre># A tibble: 4 x 6
  id    .model_id .model         .model_desc                 .type .calibration_data
  &lt;fct&gt;     &lt;dbl&gt; &lt;list&gt;         &lt;chr&gt;                       &lt;chr&gt; &lt;list&gt;
1 1_1           1 &lt;workflow&gt;     PROPHET                     Test  &lt;tibble [52 x 4]&gt;
2 1_1           2 &lt;workflow&gt;     XGBOOST                     Test  &lt;tibble [52 x 4]&gt;
3 1_1           3 &lt;ensemble [2]&gt; ENSEMBLE (MEAN): 2 MODELS   Test  &lt;tibble [52 x 4]&gt;
</pre></div>
<p>Additional ensembles can be added by simply adding onto the nested modeltime table.
Notice that we make use of <code>model_ids</code> to make sure it only uses model id's 1 and 2.
</p>
<div class="sourceCode r"><pre>ensem_2 &lt;- ensem %&gt;%
    ensemble_nested_average(
        type           = "median",
        keep_submodels = TRUE,
        model_ids      = c(1,2),
        control        = control_nested_fit(allow_par = FALSE, verbose = TRUE)
    )
</pre></div>
<p>This returns a 4th model that is a median ensemble of the first two models.
</p>
<div class="sourceCode"><pre>ensem_2 %&gt;% extract_nested_modeltime_table()
# A tibble: 4 x 6
  id    .model_id .model         .model_desc                 .type .calibration_data
  &lt;fct&gt;     &lt;dbl&gt; &lt;list&gt;         &lt;chr&gt;                       &lt;chr&gt; &lt;list&gt;
1 1_1           1 &lt;workflow&gt;     PROPHET                     Test  &lt;tibble [52 x 4]&gt;
2 1_1           2 &lt;workflow&gt;     XGBOOST                     Test  &lt;tibble [52 x 4]&gt;
3 1_1           3 &lt;ensemble [2]&gt; ENSEMBLE (MEAN): 2 MODELS   Test  &lt;tibble [52 x 4]&gt;
4 1_1           4 &lt;ensemble [2]&gt; ENSEMBLE (MEDIAN): 2 MODELS Test  &lt;tibble [52 x 4]&gt;
</pre></div>


<h3>Value</h3>

<p>The nested modeltime table with an ensemble model added.
</p>


</div>