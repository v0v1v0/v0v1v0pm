<div class="container">

<table style="width: 100%;"><tr>
<td>qVA</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>R wrapper that accesses C code to fit quantile value-added model</h2>

<h3>Description</h3>

<p><code>qVA</code> is the main function used to fit hierarchical model that produces quantile value-added estimates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">qVA(y,
    xmat,
    school,
    tau=0.5,
    draws=1100, burn=100, thin=1,
    priorVal=c(100^2, 1, 1, 1, 1, 0, 100^2),
    verbose=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>numeric vector response variable.  Must be in long format.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xmat</code></td>
<td>
<p>N x p matrix of covariates (column of 1's must NOT be included) where N is total number of observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>school</code></td>
<td>
<p>vector indicating to which school each student belongs.  School labels must be contiguous and start with 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>quantile specification.  The median is used as a default (tau=0.5)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorVal</code></td>
<td>
<p>vector of prior distribution parameter values.
</p>
<p>s2b - prior variance for beta, default is 100^2.
</p>
<p>al - prior shape for lambda, default is 1.
</p>
<p>bl - prior rate for lambda, default is 1.
</p>
<p>as - prior shape for sigma2, default is 1.
</p>
<p>bs - prior rate for sigma2, default is 1.
</p>
<p>ma - mean for a, default is 0.
</p>
<p>s2a - variance for a, default is 100^2
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draws</code></td>
<td>
<p>total number of MCMC iterates to be collected. default is 1100</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>burn</code></td>
<td>
<p>number of total MCMC iterates discared as burn-in. default is 100</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thin</code></td>
<td>
<p>number by which the MCMC chain is thinned. default is 1.  Note that the number of MCMC iterates provided is (draws - burn)/thin.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical indicating if MCMC progress and other data summaries should be printed to screen</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>This function returns a list containing MCMC iterates that correspond to model parameters and school-specific quantile value-added estimates.  In order to provide more detail, in what follows let
</p>
<p>"T" - be the number of MCMC iterates collected (draws - burn)/thin,
</p>
<p>"M" - be the number of schools,
</p>
<p>"N" - be the total number of observations.
</p>
<p>"p" - be the number of covariates
</p>
<p>The output list contains the following
</p>
<p>beta - an matrix of dimension (T, p) containing MCMC iterates associated with quantile regression covariate estimates.
</p>
<p>alpha - an matrix of dimension (T, M) containing MCMC iterates assocated with school-specific random effects.
</p>
<p>v - matrix of dimension (T, N) containing MCMC iterates of auxiliary variable.
</p>
<p>a - matrix of dimension (T, 1) contaning MCMC iterates of mean of the school-specific random effects (alpha).
</p>
<p>sig2a - a matrix of dimension (T, 1) containing MCMC iterates of variance of the school-specific random effects (alpha).
</p>
<p>lambda - a matrix of dimension (T, M) containing MCMC interates associated with the lambda parameter of asymmetric laplace distribution.
</p>
<p>cVA - a matrix of dimension (T, M) containing MCMC interates associated with conditional value-added for each school.
</p>
<p>mVA - a matrix of dimension (T, M) containing MCMC iterates associated with the marginal value-added for each school.
</p>
<p>qVA - a matrix of dimension (T, M) containing MCMC iterates associated with each schools quantile value-added.
</p>
<p>Q - a matrix of dimension (T, N) containing MCMC iterates associated with the marginal quantile valued-added regression value for each student (i.e., averaging over school).
</p>


<h3>References</h3>

<p>Page, Garritt L.; San Martín, Ernesto; Orellana, Javiera; Gonzalez, Jorge. (2017) “Exploring Complete School Effectiveness via Quantile Value-Added” Journal of the Royal Statistical Society: Series A 180(1) 315-340
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Example with synthetic data
tau &lt;- 0.75

m &lt;- 4 # number of schools
n &lt;- 25 # number of students
N &lt;- m*n
p &lt;- 1 # number of covariates
betaT &lt;- 0.5
alphaT &lt;- seq(-10,10, length=m)

# Generate from the asymmetric Laplace
# using a mixture of a Normal and an Exponential
lambdaT &lt;- 0.1;
xi &lt;- rexp(N, 1/lambdaT)
epsilon &lt;- (sqrt((lambdaT*2*xi)/(tau*(1-tau)))*rnorm(N,0,1) +
           (1-2*tau)/(tau*(1-tau))*xi)
epsilon &lt;- rnorm(N,0,1)
alphavec &lt;-  rep(alphaT, each=n)

x &lt;- rnorm(N,250,1)
y &lt;- x*betaT  + alphavec + epsilon

X &lt;- cbind(x)


school &lt;- rep(1:m, each=n)



fitQ3 &lt;- qVA(y=y, xmat=X, school=school, tau=0.75, verbose=FALSE)

# quantile value-added estimates with 95% credible intervals for each school
qVA.est &lt;- apply(fitQ3$qVA,2,mean)
qVA.int &lt;- apply(fitQ3$qVA,2,function(x) quantile(x, c(0.025, 0.975)))

beta &lt;- fitQ3$beta
alpha &lt;- fitQ3$alpha

mVA &lt;- fitQ3$mVA
cVA &lt;- fitQ3$cVA
Q &lt;- fitQ3$Q

# Plot results.
plot(x,y, col=rep(c("red","blue","green","orange"), each=n), pch=19)

# Plot Q3 quantile regression line for each school
lines(X[school==1,],
       (X[school==1,])*mean(beta) + apply(alpha,2,mean)[1], col='red', lwd=3)
lines(X[school==2,],
       (X[school==2,])*mean(beta) + apply(alpha,2,mean)[2], col='blue', lwd=3)
lines(X[school==3,],
       (X[school==3,])*mean(beta) + apply(alpha,2,mean)[3], col='green', lwd=3)
lines(X[school==4,],
       (X[school==4,])*mean(beta) + apply(alpha,2,mean)[4], col='orange', lwd=3)

# Plot the marginal VA for each school
points(tapply(X, school,mean), apply(mVA,2,mean),
       col=c("red","blue","green","orange"), pch=4, cex=2, lwd=2)

# Plot the conditional VA for each school
points(tapply(X, school,mean), apply(cVA,2,mean),
      col=c("red","blue","green","orange"),pch=10,cex=2, lwd=2)

# Plot the "global" Q3 quantile regression line.
points(X, apply(Q,2,mean), type='l', lwd=2)

</code></pre>


</div>