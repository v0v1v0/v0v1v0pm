<div class="container">

<table style="width: 100%;"><tr>
<td>cil</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Treatment effect estimation for linear models via Confounder Importance
Learning using non-local priors.</h2>

<h3>Description</h3>

<p>Treatment effect estimation for linear models in the presence of
multiple treatments and a potentially high-dimensional number of controls,
i.e. <code class="reqn">p \gg n</code> can be handled.
</p>
<p>Confounder Importance Learning (CIL) proposes an estimation framework where
the importance of the relationship between treatments and controls is
factored in into the establishment of prior inclusion probabilities for each
of these controls on the response model. This is combined with the use of
non-local priors to obtain BMA estimates and posterior model probabilities.
</p>
<p><code>cil</code> is built on <code>modelSelection</code> and produces objects of type
<code>cilfit</code>. Use <code>coef</code> and <code>postProb</code> to obtain treatment effect
point estimates and posterior model probabilities, respectively, on this
object class.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cil(y, D, X, I = NULL, family = 'normal', familyD = 'normal',
  R = 1e4, Rinit = 500, th.search = 'EB', mod1 = 'lasso_bic',
  th.prior = 'unif', priorCoef, rho.min = NULL,
  th.range = NULL, max.mod = 2^20, lpen = 'lambda.1se',
  eps = 1e-10, bvs.fit0 = NULL, th.EP = NULL, center = TRUE, scale =
  TRUE, includevars, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>one-column matrix containing the observed responses. The response must
be continuous (currently the only type supported)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D</code></td>
<td>
<p>treatment matrix with numeric columns, continuous or discrete. Any finite
number of treatments are supported. If only one treatment is provided, supply
this object in the same format used for <code>y</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>matrix of controls with numeric columns, continuous or discrete. If only
one treatment is provided, supply this object in the same format used for <code>y</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>I</code></td>
<td>
<p>matrix with the desired interaction terms between <code>D</code> and
<code>X</code>. If not informed, i.e. supplied as the default <code>NULL</code>, this term
will not be included into the response model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>Distribution of the outcome, e.g. 'normal', 'binomial' or
'poisson'. See <code>help</code>(modelSelection) for a full list of options</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>familyD</code></td>
<td>
<p>Distribution of the treatment(s). Only 'normal' or
'binomial' currently allowed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>Number of MCMC iterations to be
run by <code>modelSelection</code> on each stage of CIL (see argument <code>niter</code>
therein)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Rinit</code></td>
<td>
<p>MCMC iterations to estimate marginal posterior
inclusion probabilities under a uniform model prior, needed for EP</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>th.search</code></td>
<td>
<p>method to estimate theta values in the marginal prior inclusion
probabilities of the CIL model. Options are: <code>EB</code> (Empirical Bayes, based
on maximum marginal likelihood) and <code>EP</code> (Expectation propagation
approximation)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mod1</code></td>
<td>
<p>method to estimate the feature parameters corresponding to the
influence of the controls on the treatments. Supported values for this
argument are 'ginv' (generalised pseudo-inverse), <code>lasso</code> (see
argument <code>lpen</code>), <code>lasso_bic</code> (default), and <code>ridge</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>th.prior</code></td>
<td>
<p>prior associated to the thetas for the Empirical Bayes
estimation. Currently only <code>unif</code> (Uniform prior) is supported,
effectively making the EB approach the maximisation of the marginal likelihood</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorCoef</code></td>
<td>
<p>Prior on the response model parameters, see <code>modelSelection</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho.min</code></td>
<td>
<p>value of <code class="reqn">\rho</code> in (0, 1/2) employed in the prior probability
model of CIL. If left uninformed, i.e. supplied as the default <code>NULL</code>,
it will be set to <code class="reqn">1/p^2</code>, where p is the dimension of the response model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>th.range</code></td>
<td>
<p>sequence of values to be considered in the grid when searching
for points to initialise the search for the optimal theta parameters. If left
uninformed, the function will determine a computationally suitable grid
depending on the number of parameters to be estimated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.mod</code></td>
<td>
<p>Maximum number of models considered when computing the marginal
likelihood required by empirical Bayes.
If set to <code>Inf</code> all visited models by the enumeration/MCMC
are considered, but it might be computationally desirable to restrict this
number when the dimension of <code>D</code> and/or <code>X</code> is large</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lpen</code></td>
<td>
<p>penalty type supplied to <code>glmnet</code> if <code>mod1</code> is set to
<code>lasso</code>. Default is <code>lambda.1se</code> (see documentation corresponding to
<code>glmnet</code> for options on how to set this parameter)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps</code></td>
<td>
<p>small scalar used to avoid round-offs to absolute zeroes or ones in
marginal prior inclusion probabilities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bvs.fit0</code></td>
<td>
<p>object returned by <code>modelSelection</code> under <code class="reqn">\theta = 0</code>,
used as a model exploration tool to compute EB approximation on the thetas.
This argument is only supposed to be used in case of a second computation the
model on the same data where <code>th.search</code> has ben changed to <code>EB</code>,
in order to avoid repeating the computation of the initial
<code>modelSelection</code> fit. To use this argument, supply the object residing
in the slot <code>init.msfit</code> of a <code>cilfit</code>-class object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>th.EP</code></td>
<td>
<p>Optimal theta values under the EP approximation, obtained in a
previous CIL run. This argument is only supposed to be used in case of
a second computation the model on the same data where <code>th.search</code>
has ben changed to <code>EB</code>, in order to save the cost of the EP search
to initialise the optimisation algorithm. To use this argument, supply the
object residing int the slot <code>th.hat</code> of a <code>cilfit</code>-class
object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>center</code></td>
<td>
<p>If <code>TRUE</code>, <code>y</code> and <code>x</code> are centered to have
zero mean. Dummy variables corresponding to factors are NOT centered</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>If <code>TRUE</code>, <code>y</code> and columns in <code>x</code> are
scaled to have variance=1. Dummy variables corresponding to factors are NOT scaled</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>includevars</code></td>
<td>
<p>Logical vector of length ncol(x) indicating variables
that should always be included in the model, i.e. variable selection is
not performed for these variables</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Set <code>verbose==TRUE</code> to print iteration progress</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>We estimate treatment effects for the features present in the treatment
matrix <code>D</code>. Features in <code>X</code>, which may or may not be causal
factors of the treatments of interest, only act as controls and, therefore,
are not used as inferential subjects.
</p>
<p>Confounder importance learning is a flexible treatment effect estimation
framework that essentially determines how the role of the influence of
<code>X</code> on <code>D</code> should affect their relationship with the response,
through establishing prior inclusion probabilities on the response model
for <code>y</code> according to said role. This is regulated through a hyper-
parameter theta that is set according to the method supplied to
<code>th.search</code>. While the <code>EB</code> option obtains a more precise estimate
a priori, the <code>EP</code> alternative achieves a reasonable approximation at a
fraction of the computational cost.
</p>
<p>See references for further details on implementation and computation.
</p>


<h3>Value</h3>

<p>Object of class <code>cilfit</code>, which extends a list with elements
</p>
<table>
<tr style="vertical-align: top;">
<td><code>cil.teff</code></td>
<td>
<p>BMA estimates, 0.95 intervals and posterior inclusion
probabilities for treatment effects in <code>D</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coef</code></td>
<td>
<p>BMA inference for treatment effects and all other covariates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model.postprobs</code></td>
<td>
<p><code>matrix</code> returning the posterior model probabilities
computed in the CIL model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>margpp</code></td>
<td>
<p><code>numeric</code> vector containing the estimated marginal
posterior inclusion probabilities of the featured treatments and controls</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>margprior</code></td>
<td>
<p>Marginal prior inclusion probabilities, as estimated by
CIL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>margpp.unif</code></td>
<td>
<p>Marginal posterior inclusion probabilities that would
be obtained under a uniform model prior</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta.hat</code></td>
<td>
<p>Values used for the hyper-parameter theta, estimated according
to the argument <code>th.search</code> specified</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>treat.coefs</code></td>
<td>
<p>Estimated weights of the effect of the control variables
on each of the treatments, as estimated with the method specified in argument
<code>mod1</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>msfit</code></td>
<td>
<p>Object returned by <code>modelSelection</code> (of class <code>msfit</code>)
of the final model estimated by CIL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta.EP</code></td>
<td>
<p>Estimated values of theta using the EP algorithm. It coincides
with <code>theta.hat</code> if the argument <code>th.search</code> is set to <code>EB</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init.msfit</code></td>
<td>
<p>Initial <code>msfit</code> object used to estimate the inital model
where all elements in theta are set to zero (used in the optimisation process
of this hyper-parameter)</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Miquel Torrens
</p>


<h3>References</h3>

<p>Torrens i Dinares M., Papaspiliopoulos O., Rossell D. Confounder
importance learning for treatment effect inference.
https://arxiv.org/abs/2110.00314, 2021, 1–48.
</p>


<h3>See Also</h3>

<p><code>postProb</code> to obtain posterior model probabilities.
</p>
<p><code>coef</code> for inference on the treatment parameters.



</p>


<h3>Examples</h3>

<pre><code class="language-R"># Simulate data
set.seed(1)
X &lt;- matrix(rnorm(100 * 50), nrow = 100, ncol = 50)
beta_y &lt;- matrix(c(rep(1, 6), rep(0, 44)), ncol = 1)
beta_d &lt;- matrix(c(rep(1, 6), rep(0, 44)), ncol = 1)
alpha &lt;- 1
d &lt;- X %*% beta_d + rnorm(100)
y &lt;- d * alpha + X %*% beta_y + rnorm(100)

# Confounder Importance Learning
fit1 &lt;- cil(y = y, D = d, X = X, th.search = 'EP')

# BMA for treatment effects
coef(fit1)

# BMA for all covariates
head(fit1$coef)

# Estimated prior inclusion prob
# vs. treatment regression coefficients
plotprior(fit1)

</code></pre>


</div>