<div class="container">

<table style="width: 100%;"><tr>
<td>crawlWrap</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit and predict tracks for using crawl</h2>

<h3>Description</h3>

<p>Wrapper function for fitting crawl::crwMLE models and predicting locations with crawl::crwPredict for multiple individuals.
</p>


<h3>Usage</h3>

<pre><code class="language-R">crawlWrap(
  obsData,
  timeStep = 1,
  ncores = 1,
  retryFits = 0,
  retrySD = 1,
  retryParallel = FALSE,
  mov.model = ~1,
  err.model = NULL,
  activity = NULL,
  drift = NULL,
  coord = c("x", "y"),
  proj = NULL,
  Time.name = "time",
  time.scale = "hours",
  theta,
  fixPar,
  method = "L-BFGS-B",
  control = NULL,
  constr = NULL,
  prior = NULL,
  need.hess = TRUE,
  initialSANN = list(maxit = 200),
  attempts = 1,
  predTime = NULL,
  fillCols = FALSE,
  coordLevel = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>obsData</code></td>
<td>
<p>data.frame object containing fields for animal ID ('ID'), time of observation (identified by <code>Time.name</code>, must be numeric or POSIXct), 
and observed locations (x- and y- coordinates identified by <code>coord</code>), such as that returned by <code>simData</code> when temporally-irregular observed locations or
measurement error are included. Alternatively, a <code>SpatialPointsDataFrame</code> or <code>sf</code> object will 
also be accepted, in which case the <code>coord</code> values will be taken from the spatial data set and ignored in the arguments.  
Note that <code>crwMLE</code> requires that longitude/latitude coordinates be projected to UTM (i.e., easting/northing). For further details see <code>crwMLE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timeStep</code></td>
<td>
<p>Length of the time step at which to predict regular locations from the fitted model. Unless <code>predTime</code> is specified, the sequence of times
is <code>seq(a_i,b_i,timeStep)</code> where a_i and b_i are the times of the first and last observations for individual i. <code>timeStep</code> can be numeric (regardless of
whether <code>obsData[[Time.name]]</code> is numeric or POSIXct) or a character string (if <code>obsData[[Time.name]]</code> is of class POSIXct) containing one of "sec", "min", "hour", "day", "DSTday", "week", "month", "quarter" or "year". 
This can optionally be preceded by a positive integer and a space, or followed by "s" (e.g., “2 hours”; see <code>seq.POSIXt</code>). <code>timeStep</code> is not used for individuals for which <code>predTime</code> is specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>Number of cores to use for parallel processing. Default: 1 (no parallel processing).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>retryFits</code></td>
<td>
<p>Number of times to attempt to achieve convergence and valid (i.e., not NaN) variance estimates after the initial model fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>retrySD</code></td>
<td>
<p>An optional list of scalars or vectors for each individual indicating the standard deviation to use for normal perturbations of <code>theta</code> when <code>retryFits&gt;0</code> (or <code>attempts&gt;1</code>). 
Instead of a list object, <code>retrySD</code> can also be a scalar or a vector, in which case the same values are used for each each individual.
If a scalar is provided, then the same value is used for each parameter. If a vector is provided, it must be of length <code>length(theta)</code> for the corresponding individual(s). Default: 1, i.e., a standard deviation of 1 is used
for all parameters of all individuals. Ignored unless <code>retryFits&gt;0</code> (or <code>attempts&gt;1</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>retryParallel</code></td>
<td>
<p>Logical indicating whether or not to perform <code>retryFits</code> attempts for each individual in parallel. Default: FALSE. Ignored unless <code>retryFits&gt;0</code> and <code>ncores&gt;1</code>.
Note that when attempts are done in parallel (i.e. <code>retryParallel=TRUE</code>), the current value for the log-likelihood of each individual and warnings about convergence are not printed to the console.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mov.model</code></td>
<td>
<p>List of mov.model objects (see <code>crwMLE</code>) containing an element for each individual. If only one movement model is provided, then the same movement model is used
for each individual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>err.model</code></td>
<td>
<p>List of err.model objects (see <code>crwMLE</code>) containing an element for each individual. If only one error model is provided, then the same error model is used
for each individual (in which case the names of the <code>err.model</code> components corresponding to easting/longitudinal and northing/latitudinal location error must match <code>coord</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>activity</code></td>
<td>
<p>List of activity objects (see <code>crwMLE</code>) containing an element for each individual. If only one activity covariate is provided, then the same activity covariate is used
for each individual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drift</code></td>
<td>
<p>List of drift objects (see <code>crwMLE</code>) containing an element for each individual. If only one drift component is provided, then the same drift component is used
for each individual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coord</code></td>
<td>
<p>A 2-vector of character values giving the names of the "x" and
"y" coordinates in <code>data</code>. See <code>crwMLE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>proj</code></td>
<td>
<p>A list of valid epsg integer codes or proj4string for <code>obsData</code> that does not
inherit either 'sf' or 'sp'. A valid 'crs' list is also accepted. Otherwise, ignored. If only one proj is provided, then the same projection is used
for each individual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Time.name</code></td>
<td>
<p>Character indicating name of the location time column.  See <code>crwMLE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time.scale</code></td>
<td>
<p>character. Scale for conversion of POSIX time to numeric for modeling. Defaults to "hours".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>List of theta objects (see <code>crwMLE</code>) containing an element for each individual. If only one theta is provided, then the same starting values are used
for each individual. If theta is not specified, then <code>crwMLE</code> default values are used (i.e. each parameter is started at zero).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixPar</code></td>
<td>
<p>List of fixPar objects (see <code>crwMLE</code>) containing an element for each individual. If only one fixPar is provided, then the same parameters are held fixed to the given value
for each individual. If fixPar is not specified, then no parameters are fixed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Optimization method that is passed to <code>optim</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>Control list which is passed to <code>optim</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constr</code></td>
<td>
<p>List of constr objects (see <code>crwMLE</code>) containing an element for each individual. If only one constr is provided, then the same box constraints for the parameters are used
for each individual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior</code></td>
<td>
<p>List of prior objects (see <code>crwMLE</code>) containing an element for each individual. If only one prior is provided, then the same prior is used
for each individual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>need.hess</code></td>
<td>
<p>A logical value which decides whether or not to evaluate
the Hessian for parameter standard errors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initialSANN</code></td>
<td>
<p>Control list for <code>optim</code> when simulated
annealing is used for obtaining start values. See details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>attempts</code></td>
<td>
<p>The number of times likelihood optimization will be
attempted in cases where the fit does not converge or is otherwise non-valid. Note this is not the same as <code>retryFits</code> because <code>attempts</code> only applies when the current fit clearly does not appear to have converged; <code>retryFits</code> will proceed with additional model fitting attempts regardless of the model output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predTime</code></td>
<td>
<p>List of predTime objects (see <code>crwPredict</code>) containing an element for each individual. <code>predTime</code> can 
be specified as an alternative to the automatic sequences generated according to <code>timeStep</code>.  If only one predTime object is provided, then the same prediction times are used
for each individual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fillCols</code></td>
<td>
<p>Logical indicating whether or not to use the crawl::<code>fillCols</code> function for filling in missing values in <code>obsData</code> for which
there is a single unique value. Default: FALSE. If the output from <code>crawlWrap</code> is intended for analyses using <code>fitHMM</code> or <code>MIfitHMM</code>, 
setting <code>fillCols=TRUE</code> should typically be avoided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coordLevel</code></td>
<td>
<p>Character string indicating the level of the hierarchy for the location data. Ignored unless <code>obsData</code> includes a 'level' field.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments that are ignored.</p>
</td>
</tr>
</table>
<h3>Details</h3>


<ul>
<li>
<p> Consult <code>crwMLE</code> and <code>crwPredict</code> for futher details about model fitting and prediction. 
</p>
</li>
<li>
<p> Note that the names of the list elements corresponding to each individual in <code>mov.model</code>, <code>err.model</code>, <code>activity</code>, <code>drift</code>,
<code>theta</code>, <code>fixPar</code>, <code>constr</code>, <code>prior</code>, and <code>predTime</code> must match the individual IDs in <code>obsData</code>.  If only one element is provided
for any of these arguments, then the same element will be applied to all individuals.
</p>
</li>
</ul>
<h3>Value</h3>

<p>A <code>crwData</code> or <code>crwHierData</code> object, i.e. a list of:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>crwFits</code></td>
<td>
<p>A list of <code>crwFit</code> objects returned by crawl::crwMLE. See <code>crwMLE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>crwPredict</code></td>
<td>
<p>A <code>crwPredict</code> data frame with <code>obsData</code> merged with the predicted locations. See <code>crwPredict</code>.</p>
</td>
</tr>
</table>
<p>The <code>crwData</code> object is used in <code>MIfitHMM</code> analyses that account for temporal irregularity or location measurement error.
</p>


<h3>See Also</h3>

<p><code>MIfitHMM</code>, <code>simData</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# extract simulated obsData from example data
obsData &lt;- miExample$obsData

# error ellipse model
err.model &lt;- list(x= ~ ln.sd.x - 1, y =  ~ ln.sd.y - 1, rho =  ~ error.corr)

# Fit crwMLE models to obsData and predict locations 
# at default intervals for both individuals
crwOut1 &lt;- crawlWrap(obsData=obsData,
         theta=c(4,0),fixPar=c(1,1,NA,NA),
         err.model=err.model,attempts=100)

# Fit the same crwMLE models and predict locations 
# at same intervals but specify for each individual using lists
crwOut2 &lt;- crawlWrap(obsData=obsData,
         theta=list(c(4,0),c(4,0)), fixPar=list(c(1,1,NA,NA),c(1,1,NA,NA)),
         err.model=list(err.model,err.model),
         predTime=list('1'=seq(1,633),'2'=seq(1,686)))

## End(Not run)

</code></pre>


</div>