<div class="container">

<table style="width: 100%;"><tr>
<td>ordmonoreg</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bayesian monotonic regression</h2>

<h3>Description</h3>

<p>This function implements the non-parametric Bayesian monotonic regression procedure for 
ordinal outcomes described in Saarela, Rohrbeck &amp; Arjas (2023). 
</p>


<h3>Usage</h3>

<pre><code class="language-R">
ordmonoreg(niter=15000, burnin=5000, adapt=5000, refresh=10, thin=20, 
		   birthdeath=1, logit=FALSE, gam=FALSE, seed=1, rhoa=0.1, rhob=0.1, 
		   deltai=0.5, dlower=0, dupper=1, invprob=1.0, dc=0.0, 
		   predict, include, outcome, axes, covariates=NULL, 
		   cluster=NULL, ncluster=NULL, settozero)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>niter</code></td>
<td>
<p>Total number of MCMC iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>burnin</code></td>
<td>
<p>Number of iterations used for burn-in period.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adapt</code></td>
<td>
<p>Number of iterations used for adapting Metropolis-Hastings proposals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refresh</code></td>
<td>
<p>Interval for producing summary output of the state of the MCMC sampler.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thin</code></td>
<td>
<p>Interval for saving the state of the MCMC sampler.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>birthdeath</code></td>
<td>
<p>Number of birth-death proposals attempted at each iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logit</code></td>
<td>
<p>Indicator for fitting the model on logit scale.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gam</code></td>
<td>
<p>Indicator for fitting non-monotonic generalized additive models for covariate effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Seed for the random generator.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rhoa</code></td>
<td>
<p>Shape parameter of a Gamma hyperprior for the Poisson process rate parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rhob</code></td>
<td>
<p>Scale parameter of a Gamma hyperprior for the Poisson process rate parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deltai</code></td>
<td>
<p>Range for a uniform proposal for the function level parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dlower</code></td>
<td>
<p>Lower bound for the allowed range for the monotonic function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dupper</code></td>
<td>
<p>Upper bound for the allowed range for the monotonic function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>invprob</code></td>
<td>
<p>Probability with which to propose keeping the original direction of monotonicity.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dc</code></td>
<td>
<p>First parameter of the conditional beta prior to counter spiking behaviour near the origin - 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predict</code></td>
<td>
<p>Indicator vector for the observations for which absolute risks are calculated (not included in the likelihood expression).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include</code></td>
<td>
<p>Indicator vector for  the observations to be included in the likelihood expression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcome</code></td>
<td>
<p>Vector of outcome variable values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>axes</code></td>
<td>
<p>A matrix where the columns specify the covariate axes in the non-parametrically specified regression functions. Each variable here must be scaled to zero-one interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates</code></td>
<td>
<p>A matrix of additional covariates to be included in the linear predictor of the events of interest (optional).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster</code></td>
<td>
<p>A vector of indicators for cluster membership, numbered from 0 to ncluster-1 (optional).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncluster</code></td>
<td>
<p>Number of clusters (optional).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>settozero</code></td>
<td>
<p>A zero-one matrix specifying the point process construction. Each row represents a point process,
while columns correspond to the columns of the argument <code>axes</code>, indicating whether the column is one of the dimensions specifying the domain of the point process.
(See function <code>getcmat</code>.)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list with elements
</p>
<table>
<tr style="vertical-align: top;">
<td><code>steptotal</code></td>
<td>
<p>A sample of total number of points in the marked point process construction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>steps</code></td>
<td>
<p>A sample of the number of points used per each additive component.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>A sample of the Poisson process rate parameters (one per each point process specified).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loglik</code></td>
<td>
<p>A sample of log-likelihood values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>A sample of random intercept variances.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>A sample of random intercepts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>A sample of regression coefficients for the variables specified in the argument <code>covariates</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>A sample of non-parametric regression function levels for each observation specified in the argument <code>predict</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pred</code></td>
<td>
<p>A sample of predicted means for each observation specified in the argument <code>predict</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigmasq</code></td>
<td>
<p>A sample of autoregressive prior variances.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Olli Saarela &lt;olli.saarela@utoronto.ca&gt;, Christian Rohrbeck &lt;cr777@bath.ac.uk&gt;</p>


<h3>References</h3>

<p>Saarela O., Rohrbeck C., Arjas E. (2023). Bayesian non-parametric ordinal regression under a monotonicity constraint. Bayesian Analysis, 18:193â€“221.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(monoreg)
expit &lt;- function(x) {1/(1+exp(-x))}
logit &lt;- function(p) {log(p)-log(1-p)}
set.seed(1)
# nobs &lt;- 500
nobs &lt;- 200
x &lt;- sort(runif(nobs))
ngrid &lt;- 100
xgrid &lt;- seq(1/ngrid, (ngrid-1)/ngrid, by=1/ngrid)
ngrid &lt;- length(xgrid)
ncat &lt;- 4
beta &lt;- 0.75
disc &lt;- c(Inf, Inf, 0.75, 0.5)
gamma &lt;- c(0,0,0.25,0.5)

surv &lt;- matrix(NA, nobs, ncat)
cdf &lt;- matrix(NA, nobs, ncat)
cols &lt;- c('black','red','blue','green')
for (i in 1:ncat) {
    surv[,i] &lt;- expit(logit((ncat-(i-1))/ncat) + beta * x + 
	                  gamma[i] * (x &gt; disc[i]) - gamma[i] * (x &lt; disc[i]))
    if (i==1)
        plot(x, surv[,i], type='l', col=cols[i], ylim=c(0,1), lwd=2, ylab='S')
    else
        lines(x, surv[,i], col=cols[i], lwd=2)
}
head(surv)

for (i in 1:ncat) {
    if (i&lt;ncat)
        cdf[,i] &lt;- 1.0 - surv[,i+1]
    else
        cdf[,i] &lt;- 1.0
    if (0) {
        if (i==1)
            plot(x, cdf[,i], type='l', col=cols[i], ylim=c(0,1), lwd=2, ylab='F')
        else
            lines(x, cdf[,i], col=cols[i], lwd=2)
    }
}
head(cdf)

u &lt;- runif(nobs)
y &lt;- rep(NA, nobs)
for (i in 1:nobs)
    y[i] &lt;- findInterval(u[i], cdf[i,]) + 1
table(y)

xwindow &lt;- 0.1/2
mw &lt;- matrix(NA, nobs, ncat)
grid &lt;- sort(x)
for (i in 1:nobs) {
    idx &lt;- (x &gt; grid[i] - xwindow) &amp; (x &lt; grid[i] + xwindow)
    for (j in 1:ncat)
        mw[i,j] &lt;- sum(y[idx] &gt;= j)/sum(idx)
}
for (j in 1:ncat) {
    lines(grid, mw[,j], lty='dashed', col=cols[j])
}

# results &lt;- ordmonoreg(niter=15000, burnin=5000, adapt=5000, refresh=10, thin=5, 
results &lt;- ordmonoreg(niter=3000, burnin=1000, adapt=1000, refresh=10, thin=4, 
           birthdeath=1, logit=FALSE, gam=FALSE, seed=1, rhoa=0.1, rhob=0.1, 
           deltai=0.2, dlower=0, dupper=1, invprob=1.0, dc=0.0, 
           predict=c(rep(0,nobs),rep(1,ngrid)), 
           include=c(rep(1,nobs),rep(0,ngrid)), 
           outcome=c(y, rep(1,ngrid)), 
           axes=c(x, xgrid), covariates=NULL, cluster=NULL, ncluster=NULL, 
           settozero=getcmat(1))
		   
s &lt;- results$lambda
dim(s)
lines(xgrid, colMeans(subset(s, s[,1]==0)[,2:(ngrid+1)]))
lines(xgrid, colMeans(subset(s, s[,1]==1)[,2:(ngrid+1)]), col='red')
lines(xgrid, colMeans(subset(s, s[,1]==2)[,2:(ngrid+1)]), col='blue')
lines(xgrid, colMeans(subset(s, s[,1]==3)[,2:(ngrid+1)]), col='green')
legend('bottomright', legend=c(expression(P(Y&gt;=1)), expression(P(Y&gt;=2)), 
expression(P(Y&gt;=3)), expression(P(Y&gt;=4))), 
lwd=2, col=cols)
</code></pre>


</div>