<div class="container">

<table style="width: 100%;"><tr>
<td>risks</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Absolute risks from 7 survival models</h2>

<h3>Description</h3>

<p>This example dataset includes time-to-event outcomes and
absolute risks for reproducing the ROC curves in Figure 3 of Saarela &amp; Arjas (2015), please see the example code below.</p>


<h3>Usage</h3>

<pre><code class="language-R">data(risks)</code></pre>


<h3>Format</h3>

<p>A data frame containing the elements
</p>

<dl>
<dt>tstop</dt>
<dd>
<p>Age at the end of the follow-up (scaled to zero-one interval)</p>
</dd>
<dt>censvar</dt>
<dd>
<p>Case status (0=censoring, 1=CVD event, 2=other death).</p>
</dd>
<dt>tstart</dt>
<dd>
<p>Age at the start of the follow-up (scaled to zero-one interval).</p>
</dd>
<dt>model1</dt>
<dd>
<p>Absolute risk from model 1.</p>
</dd>
<dt>model2</dt>
<dd>
<p>Absolute risk from model 2.</p>
</dd>
<dt>model3</dt>
<dd>
<p>Absolute risk from model 3.</p>
</dd>
<dt>model4</dt>
<dd>
<p>Absolute risk from model 4.</p>
</dd>
<dt>model5</dt>
<dd>
<p>Absolute risk from model 5.</p>
</dd>
<dt>model6</dt>
<dd>
<p>Absolute risk from model 6.</p>
</dd>
<dt>model7</dt>
<dd>
<p>Absolute risk from model 7.</p>
</dd>
</dl>
<h3>References</h3>

<p>Saarela O., Arjas E. (2015). Non-parametric Bayesian hazard regression for chronic disease risk assessment. Scandinavian Journal of Statistics, 42:609â€“626.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
rm(list=ls())
library(monoreg)
library(eha)

# Read the example data:

data(risks)
ftime &lt;- (risks$tstop - risks$tstart)/max(risks$tstop - risks$tstart)
ftime &lt;- ifelse(ftime == 0, ftime + 0.00001, ftime)
censvar &lt;- risks$censvar
case &lt;- censvar == 1
dcase &lt;- censvar == 2
a &lt;- risks$tstart
a2 &lt;- a^2
nobs &lt;- nrow(risks)

# Fit a simple parametric model to remove the effect of baseline age:

wmodel &lt;- weibreg(Surv(ftime, case) ~ a + a2, shape=1)
summary(wmodel)
wcoef &lt;- c(coef(wmodel), 0.0)
wlp &lt;- crossprod(t(cbind(a, a2)), wcoef[1:(length(wcoef)-2)])
wpar &lt;- exp(wcoef[(length(wcoef)-1):length(wcoef)])

whaz &lt;- function(x, bz) {
    return(exp(bz) * (wpar[2] / wpar[1]) * (x / wpar[1])^(wpar[2] - 1))
}
chint &lt;- function(x, bz) {
    return(exp(bz) * (x / wpar[1])^wpar[2])
}
croot &lt;- function(x, bz, c) {
    return(chint(x, bz) - c)
}

# Age-matched case-base sample for model validation:

set.seed(1)
crate &lt;- chint(ftime, wlp)
csrate &lt;- cumsum(crate)
m &lt;- sum(case) * 10
persons &lt;- rep(1:nobs, rmultinom(1, m, crate/sum(crate)))
moments &lt;- rep(NA, m)
for (i in 1:m) {
    u &lt;- runif(1, 0.0, crate[persons[i]])
    moments[i] &lt;- uniroot(croot, c(0.0, ftime[persons[i]]), c=u, 
                          bz=wlp[persons[i]])$root
}
plot(ecdf(risks$tstart[case]), pch=20, col='red')
plot(ecdf(risks$tstart[persons]), pch=20, col='blue', add=TRUE)

rate &lt;- whaz(moments, wlp[persons])
mrate &lt;- mean(rate)

d &lt;- c(rep(0, m), rep(1, sum(censvar == 1)), rep(2, sum(censvar == 2)), censvar)
mom &lt;- c(moments, ftime[censvar == 1], ftime[censvar == 2], rep(1.0, nobs))
per &lt;- c(persons, (1:nobs)[censvar == 1], (1:nobs)[censvar == 2], 1:nobs)

include &lt;- rep(c(1,0), c(m + sum(censvar == 1) + sum(censvar == 2), nobs))
predict &lt;- as.numeric(!include)

offset &lt;- log(sum(crate)/(m * whaz(mom, wlp[per])))
moffset &lt;- rep(log(sum(crate)/(m * mrate)), length(mom))

sprob &lt;- 1/exp(offset)
msprob &lt;- 1/exp(moffset)

stz &lt;- getcmat(2)
settozero &lt;- rbind(stz[1,], stz[1,], stz[2:3,], stz[2:3,])
package &lt;- 1:nrow(settozero)
cr &lt;- c(1,0,rep(1,2),rep(0,2))

# Fit models removing the age effect:

agecir &lt;- matrix(NA, nobs, 7)
for (i in 1:7) {
    agecir[,i] &lt;- as.numeric(colMeans(
monosurv(niter=15000, burnin=5000, adapt=5000, refresh=10, thin=5, 
         birthdeath=10, timevar=1, seed=1, rhoa=0.1, rhob=0.1, 
         years=1.0, deltai=0.1, drange=6.0, predict=predict, include=include, 
         casestatus=d, sprob=msprob, offset=NULL, tstart=NULL, 
         axes=cbind(mom, risks[per,paste('model', i, sep='')]), 
         covariates=rep(1.0, length(per)), ccovariates=rep(1.0, length(per)), 
         settozero=settozero, package=package, cr=cr)$risk))
    print(i)
}

# Fit models without removing the age effect:

cir &lt;- matrix(NA, nobs, 7)
for (i in 1:7) {
    cir[,i] &lt;- as.numeric(colMeans(
monosurv(niter=15000, burnin=5000, adapt=5000, refresh=10, thin=5, 
         birthdeath=10, timevar=1, seed=1, rhoa=0.1, rhob=0.1, 
         years=1.0, deltai=0.1, drange=6.0, predict=predict, include=include, 
         casestatus=d, sprob=sprob, offset=NULL, tstart=NULL, 
         axes=cbind(mom, risks[per,paste('model', i, sep='')]), 
         covariates=rep(1.0, length(per)), ccovariates=rep(1.0, length(per)), 
         settozero=settozero, package=package, cr=cr)$risk))
    print(i)
}

# Calculate ROC curves:

for (i in 1:7) {
    probs &lt;- as.numeric(risks[,paste('model', i, sep='')])
    cutoffs &lt;- sort(unique(probs), decreasing=TRUE)
    truepos &lt;- rep(NA, length(cutoffs))
    falsepos &lt;- rep(NA, length(cutoffs))
    auc &lt;- rep(0.0, length(cutoffs))
    for (j in 1:length(cutoffs)) {
        ind &lt;- as.numeric(probs &gt; cutoffs[j])    
        truepos[j] &lt;- sum(ind * agecir[,i])/sum(agecir[,i])
        falsepos[j] &lt;- sum(ind * (1.0 - agecir[,i]))/sum(1.0 - agecir[,i])
        if (j &gt; 1)
            auc[j] = (truepos[j] + truepos[j-1]) * (falsepos[j] - falsepos[j-1])
    }
    auc &lt;- cumsum(auc) * 0.5
    roc &lt;- cbind(cutoffs, truepos, falsepos, auc)
    save(roc, file=paste('ageroc', i, sep=''))
}

for (i in 1:7) {
    probs &lt;- as.numeric(risks[,paste('model', i, sep='')])
    cutoffs &lt;- sort(unique(probs), decreasing=TRUE)
    truepos &lt;- rep(NA, length(cutoffs))
    falsepos &lt;- rep(NA, length(cutoffs))
    auc &lt;- rep(0.0, length(cutoffs))
    for (j in 1:length(cutoffs)) {
        ind &lt;- as.numeric(probs &gt; cutoffs[j])    
        truepos[j] &lt;- sum(ind * cir[,i])/sum(cir[,i])
        falsepos[j] &lt;- sum(ind * (1.0 - cir[,i]))/sum(1.0 - cir[,i])
        if (j &gt; 1)
            auc[j] = (truepos[j] + truepos[j-1]) * (falsepos[j] - falsepos[j-1])
    }
    auc &lt;- cumsum(auc) * 0.5
    roc &lt;- cbind(cutoffs, truepos, falsepos, auc)
    save(roc, file=paste('roc', i, sep=''))
}

# Plot ROC curves:

# postscript(file.path(getwd(), 'rocs.eps'), paper='special', width=10, height=5, 
#            horizontal=FALSE)
op &lt;- par(cex=1, mar=c(3.75,3.75,0.25,0.25), mfrow=c(1,2), mgp=c(2.5,1,0))

plot(1, xlim=c(0,1), ylim=c(0,1), type='n', xlab='False positive fraction', 
     ylab='True positive fraction')
abline(0, 1, lty='dashed')
cols=c('darkgray','red','blue','darkgreen','orange','purple','magenta')
aucs &lt;- NULL
for (i in 1:7) {
    load(file=paste('roc', i, sep=''))
    aucs &lt;- c(aucs, max(roc[,4]))
    lines(roc[,3], roc[,2], type='s', lwd=2, col=cols[i])
    for (j in c(0.05,0.1,0.15,0.2)) {
        tp &lt;- approx(roc[,1], roc[,2], xout=j)$y
        fp &lt;- approx(roc[,1], roc[,3], xout=j)$y
        idx &lt;- nobs - findInterval(j,sort(roc[,1]))
            points(fp, tp, col=cols[i], pch=20)
        if (i == 1)
            text(fp, tp-0.015, labels=j, pos=4, offset=0.25, col=cols[i], 
                 cex=0.9)
    }
}
legend('bottomright', legend=paste('Model ', 1:7, '; AUC=',     
       format(round(aucs, 3), nsmall=3, scientific=FALSE), sep=''), 
        col=cols, lty=rep('solid',7), lwd=rep(2,7))

plot(1, xlim=c(0,1), ylim=c(0,1), type='n', xlab='False positive fraction', 
     ylab='True positive fraction')
abline(0, 1, lty='dashed')
cols=c('darkgray','red','blue','darkgreen','orange','purple','magenta')
aucs &lt;- NULL
for (i in 1:7) {
    load(file=paste('ageroc', i, sep=''))
    aucs &lt;- c(aucs, max(roc[,4]))
    lines(roc[,3], roc[,2], type='s', lwd=2, col=cols[i])
    for (j in c(0.05,0.1,0.15,0.2)) {
        tp &lt;- approx(roc[,1], roc[,2], xout=j)$y
        fp &lt;- approx(roc[,1], roc[,3], xout=j)$y
        idx &lt;- nobs - findInterval(j,sort(roc[,1]))
        points(fp, tp, col=cols[i], pch=20)
        if (i == 1)
            text(fp, tp-0.015, labels=j, pos=4, offset=0.25, col=cols[i], 
                 cex=0.9)
    }
}
legend('bottomright', legend=paste('Model ', 1:7, '; AUC=',     
       format(round(aucs, 3), nsmall=3, scientific=FALSE), sep=''), 
        col=cols, lty=rep('solid',7), lwd=rep(2,7))

par(op)
# dev.off()

## End(Not run)
</code></pre>


</div>