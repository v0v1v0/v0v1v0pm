<div class="container">

<table style="width: 100%;"><tr>
<td>derivedVariable</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create new variables from logicals</h2>

<h3>Description</h3>

<p>Utility functions for creating new variables from logicals describing the levels
</p>


<h3>Usage</h3>

<pre><code class="language-R">derivedVariable(
  ...,
  .ordered = FALSE,
  .method = c("unique", "first", "last"),
  .debug = c("default", "always", "never"),
  .sort = c("given", "alpha"),
  .default = NULL,
  .asFactor = FALSE
)

derivedFactor(..., .asFactor = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>named logical "rules" defining the levels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.ordered</code></td>
<td>
<p>a logical indicating whether the resulting factored should be ordered
Ignored if <code>.asFactor</code> is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.method</code></td>
<td>
<p>one of <code>"unique"</code>, <code>"first"</code>, and <code>"last"</code>.
If <code>"unique"</code>, exactly one rule must be <code>TRUE</code> for each position.
If <code>"first"</code>, the first <code>TRUE</code> rule defines the level.
If <code>"last"</code>, the last <code>TRUE</code> rule defines the level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.debug</code></td>
<td>
<p>one of <code>"default"</code>, <code>"always"</code>, and <code>"never"</code>, indicating
whether debugging information should be printed.  If <code>"default"</code>, debugging
information is printed only when multiple rules give conflicting definitions
for some positions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.sort</code></td>
<td>
<p>One of <code>"given"</code> (the default) or <code>"alpha"</code> or
a vector of integers the same length as the number of levels indicating the
order in which the levels should appear in the resulting factor.
Ignored if <code>.asFactor</code> is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.default</code></td>
<td>
<p>character vector of length 1 giving name of default level or
<code>NULL</code> for no default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.asFactor</code></td>
<td>
<p>A logical indicating whether the returned value should be a factor.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Each logical "rule" corresponds to a level in the resulting variable.
If <code>.default</code> is defined, an implicit rule is added that is <code>TRUE</code>
whenever all other rules are <code>FALSE</code>.
When there are multiple <code>TRUE</code> rules for a slot, the first or last such is used
or an error is generated, depending on the value of <code>method</code>.
</p>
<p><code>derivedVariable</code> is designed to be used with <code>transform()</code> or
<code>dplyr::mutate()</code> to add new
variables to a data frame.  <code>derivedFactor</code>() is the same but that the
default value for <code>.asFactor</code> is <code>TRUE</code>.  See the examples.
</p>


<h3>Examples</h3>

<pre><code class="language-R">Kf &lt;- mutate(KidsFeet, biggerfoot2 = derivedFactor(
                   dom = biggerfoot == domhand,
                   nondom = biggerfoot != domhand)
                   )
tally( ~ biggerfoot + biggerfoot2, data = Kf)
tally( ~ biggerfoot + domhand, data = Kf)

# Three equivalent ways to define a new variable
# Method 1: explicitly define all levels
modHELP &lt;- mutate(HELPrct, drink_status = derivedFactor( 
  abstinent = i1 == 0,
  moderate = (i1&gt;0 &amp; i1&lt;=1 &amp; i2&lt;=3 &amp; sex=='female') |
     (i1&gt;0 &amp; i1&lt;=2 &amp; i2&lt;=4 &amp; sex=='male'),
  highrisk = ((i1&gt;1 | i2&gt;3) &amp; sex=='female') | 
      ((i1&gt;2 | i2&gt;4) &amp; sex=='male'),
  .ordered = TRUE)
)
tally( ~ drink_status, data = modHELP)

# Method 2: Use .default for last level
modHELP &lt;- mutate(HELPrct, drink_status = derivedFactor( 
  abstinent = i1 == 0,
  moderate = (i1&lt;=1 &amp; i2&lt;=3 &amp; sex=='female') |
     (i1&lt;=2 &amp; i2&lt;=4 &amp; sex=='male'),
  .ordered = TRUE,
  .method = "first",
  .default = "highrisk")
)
tally( ~ drink_status, data = modHELP)

# Method 3: use TRUE to catch any fall through slots
modHELP &lt;- mutate(HELPrct, drink_status = derivedFactor( 
  abstinent = i1 == 0,
  moderate = (i1&lt;=1 &amp; i2&lt;=3 &amp; sex=='female') |
     (i1&lt;=2 &amp; i2&lt;=4 &amp; sex=='male'),
  highrisk=TRUE,
  .ordered = TRUE,
  .method = "first"
  )
)
tally( ~ drink_status, data = modHELP)
is.factor(modHELP$drink_status)

modHELP &lt;- mutate(HELPrct, drink_status = derivedVariable( 
  abstinent = i1 == 0,
  moderate = (i1&lt;=1 &amp; i2&lt;=3 &amp; sex=='female') |
     (i1&lt;=2 &amp; i2&lt;=4 &amp; sex=='male'),
  highrisk=TRUE,
  .ordered = TRUE,
  .method = "first"
  )
)
is.factor(modHELP$drink_status)
</code></pre>


</div>