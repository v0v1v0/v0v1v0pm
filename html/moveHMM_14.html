<div class="container">

<table style="width: 100%;"><tr>
<td>fitHMM</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit an HMM to the data</h2>

<h3>Description</h3>

<p>Fit an hidden Markov model to the data provided, using numerical optimization of the log-likelihood
function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fitHMM(
  data,
  nbStates,
  stepPar0,
  anglePar0 = NULL,
  beta0 = NULL,
  delta0 = NULL,
  formula = ~1,
  stepDist = c("gamma", "weibull", "lnorm", "exp"),
  angleDist = c("vm", "wrpcauchy", "none"),
  angleMean = NULL,
  stationary = FALSE,
  knownStates = NULL,
  verbose = 0,
  nlmPar = NULL,
  fit = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>An object <code>moveData</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbStates</code></td>
<td>
<p>Number of states of the HMM.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stepPar0</code></td>
<td>
<p>Vector of initial state-dependent step length distribution parameters.
The parameters should be in the order expected by the pdf of <code>stepDist</code>, and the zero-mass
parameter should be the last. Note that zero-mass parameters are mandatory if there are steps of
length zero in the data.
For example, for a 2-state model using the gamma distribution and
including zero-inflation, the vector of initial parameters would be something like:
<code>c(mu1,mu2,sigma1,sigma2,zeromass1,zeromass2)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>anglePar0</code></td>
<td>
<p>Vector of initial state-dependent turning angle distribution parameters.
The parameters should be in the order expected by the pdf of <code>angleDist</code>. For example, for a 2-state
model using the Von Mises (vm) distribution, the vector of initial parameters would be something like:
<code>c(mu1,mu2,kappa1,kappa2)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta0</code></td>
<td>
<p>Initial matrix of regression coefficients for the transition probabilities (more
information in "Details").
Default: <code>NULL</code>. If not specified, <code>beta0</code> is initialized such that the diagonal elements
of the transition probability matrix are dominant.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta0</code></td>
<td>
<p>Initial value for the initial distribution of the HMM. Default: <code>rep(1/nbStates,nbStates)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Regression formula for the covariates. Default: <code>~1</code> (no covariate effect).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stepDist</code></td>
<td>
<p>Name of the distribution of the step lengths (as a character string).
Supported distributions are: gamma, weibull, lnorm, exp. Default: gamma.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>angleDist</code></td>
<td>
<p>Name of the distribution of the turning angles (as a character string).
Supported distributions are: vm, wrpcauchy. Set to <code>"none"</code> if the angle distribution should
not be estimated. Default: vm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>angleMean</code></td>
<td>
<p>Vector of means of turning angles if not estimated (one for each state).
Default: <code>NULL</code> (the angle mean is estimated).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stationary</code></td>
<td>
<p><code>FALSE</code> if there are covariates. If <code>TRUE</code>, the initial distribution is considered
equal to the stationary distribution. Default: <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knownStates</code></td>
<td>
<p>Vector of values of the state process which are known prior to fitting the
model (if any). Default: NULL (states are not known). This should be a vector with length the number
of rows of 'data'; each element should either be an integer (the value of the known states) or NA if
the state is not known.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Determines the print level of the optimizer. The default value of 0 means that no
printing occurs, a value of 1 means that the first and last iterations of the optimization are
detailed, and a value of 2 means that each iteration of the optimization is detailed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nlmPar</code></td>
<td>
<p>List of parameters to pass to the optimization function <code>nlm</code> (which should be either
'<code>gradtol</code>', '<code>stepmax</code>', '<code>steptol</code>', or '<code>iterlim</code>' â€“ see <code>nlm</code>'s documentation
for more detail)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p><code>TRUE</code> if an HMM should be fitted to the data, <code>FALSE</code> otherwise.
If fit=<code>FALSE</code>, a model is returned with the MLE replaced by the initial parameters given in
input. This option can be used to assess the initial parameters. Default: <code>TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>


<ul>
<li>
<p> The matrix <code>beta</code> of regression coefficients for the transition probabilities has
one row for the intercept, plus one row for each covariate, and one column for
each non-diagonal element of the transition probability matrix. For example, in a 3-state
HMM with 2 covariates, the matrix <code>beta</code> has three rows (intercept + two covariates)
and six columns (six non-diagonal elements in the 3x3 transition probability matrix -
filled in row-wise).
In a covariate-free model (default), <code>beta</code> has one row, for the intercept.
</p>
</li>
<li>
<p> The choice of initial parameters is crucial to fit a model. The algorithm might not find
the global optimum of the likelihood function if the initial parameters are poorly chosen.
</p>
</li>
</ul>
<h3>Value</h3>

<p>A <code>moveHMM</code> object, i.e. a list of:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>mle</code></td>
<td>
<p>The maximum likelihood estimates of the parameters of the model
(if the numerical algorithm has indeed identified the global maximum of the
likelihood function), which is a list of: <code>stepPar</code> (step distribution
parameters), <code>anglePar</code> (angle distribution parameters), <code>beta</code>
(transition probabilities regression coefficients - more information in
"Details"), and <code>delta</code> (initial distribution).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>The movement data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mod</code></td>
<td>
<p>The object returned by the numerical optimizer <code>nlm</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conditions</code></td>
<td>
<p>A few conditions used to fit the model (<code>stepDist</code>,
<code>angleDist</code>, <code>zeroInflation</code>, <code>estAngleMean</code>,
<code>stationary</code>, and <code>formula</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rawCovs</code></td>
<td>
<p>Raw covariate values, as found in the data (if any). Used in
<code>plot.moveHMM</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knownStates</code></td>
<td>
<p>Vector of states known a priori, as provided in input (if
any, <code>NULL</code> otherwise).
Used in <code>viterbi</code>,<code>logAlpha</code>, and
<code>logBeta</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nlmTime</code></td>
<td>
<p>Computing time for optimisation, obtained with system.time</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Patterson T.A., Basson M., Bravington M.V., Gunn J.S. 2009.
Classifying movement behaviour in relation to environmental conditions using hidden Markov models.
Journal of Animal Ecology, 78 (6), 1113-1123.
</p>
<p>Langrock R., King R., Matthiopoulos J., Thomas L., Fortin D., Morales J.M. 2012.
Flexible and practical modeling of animal telemetry data: hidden Markov models and extensions.
Ecology, 93 (11), 2336-2342.
</p>


<h3>Examples</h3>

<pre><code class="language-R">### 1. simulate data
# define all the arguments of simData
nbAnimals &lt;- 2
nbStates &lt;- 2
nbCovs &lt;- 2
mu&lt;-c(15,50)
sigma&lt;-c(10,20)
angleMean &lt;- c(pi,0)
kappa &lt;- c(0.7,1.5)
stepPar &lt;- c(mu,sigma)
anglePar &lt;- c(angleMean,kappa)
stepDist &lt;- "gamma"
angleDist &lt;- "vm"
zeroInflation &lt;- FALSE
obsPerAnimal &lt;- c(50,100)

data &lt;- simData(nbAnimals=nbAnimals,nbStates=nbStates,stepDist=stepDist,angleDist=angleDist,
                 stepPar=stepPar,anglePar=anglePar,nbCovs=nbCovs,zeroInflation=zeroInflation,
                 obsPerAnimal=obsPerAnimal)

### 2. fit the model to the simulated data
# define initial values for the parameters
mu0 &lt;- c(20,70)
sigma0 &lt;- c(10,30)
kappa0 &lt;- c(1,1)
stepPar0 &lt;- c(mu0,sigma0) # no zero-inflation, so no zero-mass included
anglePar0 &lt;- kappa0 # the angle mean is not estimated, so only the concentration parameter is needed
formula &lt;- ~cov1+cos(cov2)

m &lt;- fitHMM(data=data,nbStates=nbStates,stepPar0=stepPar0,anglePar0=anglePar0,formula=formula,
              stepDist=stepDist,angleDist=angleDist,angleMean=angleMean)

print(m)

</code></pre>


</div>