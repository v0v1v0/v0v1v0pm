<div class="container">

<table style="width: 100%;"><tr>
<td>plotraster</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plots a group-level utilization distribution</h2>

<h3>Description</h3>

<p>Plots 50 and 95pct contours of a group-level utilization distribution raster on a spatial map
background. Contains functionality to also visualize geographic locations of individual listening
stations (e.g., acoustic receivers) as well as the entire surface UD.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plotraster(
  x = file.path("Scaled", "All_Rasters_Scaled_Weighted_UDScaled.asc"),
  crsloc = NULL,
  xlatlon = NULL,
  locationpoints = NULL,
  calcCOA = FALSE,
  pointsincontourssave = NULL,
  trim = TRUE,
  myLocation = NULL,
  googlemap = FALSE,
  gmapsAPI = NULL,
  expandfactor = 1.6,
  mapzoom = NULL,
  mapsource = "google",
  maptype = "satellite",
  contour1colour = "red",
  contour2colour = "orange",
  positionscolour = "white",
  positionsalpha = 0.33,
  positionssize = 0.1,
  COAcolour = "black",
  COAalpha = 1,
  COAshape = 4,
  COAsize = 1,
  plottitle = "Aggregated 95% and 50% UD contours",
  plotsubtitle = "Scaled contours",
  legendtitle = "Percent UD Contours",
  plotcaption = paste0("movegroup, ", lubridate::today()),
  axisxlabel = "Longitude",
  axisylabel = "Latitude",
  legendposition = c(0.105, 0.8),
  fontsize = 12,
  fontfamily = "Times New Roman",
  filesavename = paste0(lubridate::today(), "_dBBMM-contours.png"),
  savedir = tempdir(),
  receiverlats = NULL,
  receiverlons = NULL,
  receivernames = NULL,
  receiverrange = NULL,
  recpointscol = "black",
  recpointsfill = "white",
  recpointsalpha = 0.5,
  recpointssize = 1,
  recpointsshape = 21,
  recbufcol = "grey75",
  recbuffill = "grey",
  recbufalpha = 0.5,
  reclabcol = "black",
  reclabfill = NA,
  reclabnudgex = 0,
  reclabnudgey = -200,
  reclabpad = 0,
  reclabrad = 0.15,
  reclabbord = 0,
  surface = TRUE,
  cropsavedimage = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Path to scaled raster generated by movegroup (/scaleraster/alignraster). Likely
file.path(movegroupsavedir, "Scaled", "All_Rasters_Scaled_Weighted_UDScaled.asc").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>crsloc</code></td>
<td>
<p>Location of saved CRS Rds file from movegroup.R. Likely the same as path. Likely
movegroup's savedir.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlatlon</code></td>
<td>
<p>If you want to also return a csv of your original locations labelled with which UD
contours they fall within, include the location of the LatLon raster here. Try
file.path(crsloc, "Scaled", "All_Rasters_Scaled_Weighted_LatLon.asc") . Default NULL will not produce
the csv output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>locationpoints</code></td>
<td>
<p>If you want to also return a csv of your original locations labelled with which UD
contours they fall within, include the original input location points of animals, for xlatlon.
This should be a data frame which MUST have columns labelled "lat" and "lon".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calcCOA</code></td>
<td>
<p>Calculate the centre of activity i.e. mean lat &amp; lon point. Requires
locationpoints. Default FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pointsincontourssave</code></td>
<td>
<p>Location and name to save the 'location in contours' csv related to
xlatlon and locationpoints, including the ".csv".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trim</code></td>
<td>
<p>Remove NA &amp; 0 UD values and crop the plot to remaining date extents? Shrinks lots of
dead space at the edges of the raster. Default TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>myLocation</code></td>
<td>
<p>Location for extents, format c(xmin, ymin, xmax, ymax). Default NULL, extents
auto-created from data. Set this if you want to expand or crop your map to cover a specific area.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>googlemap</code></td>
<td>
<p>If pulling basemap from Google maps, this sets expansion factors since Google
Maps tiling zoom setup doesn't align to myLocation extents. Default FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gmapsAPI</code></td>
<td>
<p>Enter your google maps API here, quoted character string. Can leave NULL if
already registered with ggmap::register_google(). See Details for instructions. If you don't have
an API or don't want to get one, leave NULL, ensure mapsource is stamen, and maptype is
stamen-compatible.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expandfactor</code></td>
<td>
<p>Extents expansion factor for basemap. 1.3 to 1.5 are the same zoom as 1. 1.6
is a big leap up in zoom out. 1.9 &amp; maybe 1.7 or 1.8 is another step out. Ignored if not using
Google Maps.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mapzoom</code></td>
<td>
<p>Highest number = zoomed in. Google: 3 (continent) - 21 (building). stamen: 0-18.
Default NULL is calculated based on your data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mapsource</code></td>
<td>
<p>Source for ggmap::get_map; google needs Google Maps API present. Options
“google”, “osm”, “stadia”.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maptype</code></td>
<td>
<p>Type of map for ggmap::get_map param maptype. Options: Google mapsource: "terrain",
"terrain-background", "satellite", "roadmap", "hybrid". Stadia mapsource: "stamen_terrain",
"stamen_toner", "stamen_toner_lite", "stamen_watercolor", "stamen_terrain_background",
"stamen_toner_background", "stamen_terrain_lines", "stamen_terrain_labels", "stamen_toner_lines",
"stamen_toner_labels".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contour1colour</code></td>
<td>
<p>Colour for contour 1, typically 95pct, default "red".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contour2colour</code></td>
<td>
<p>Colour for contour 2, typically 50pct, default "orange".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>positionscolour</code></td>
<td>
<p>Colour for original animal locations, if xlatlon not NULL. Default "white".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>positionsalpha</code></td>
<td>
<p>Alpha value for positions, default 0.33, values from 0 (fully transparent)
to 1 (fully parent).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>positionssize</code></td>
<td>
<p>Point size for positions, default 0.1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>COAcolour</code></td>
<td>
<p>Colour for Centre of Activity marker, if plotted. Default "black".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>COAalpha</code></td>
<td>
<p>Alpha value for Centre of Activity point, default 1, values from 0 (fully transparent)
to 1 (fully parent).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>COAshape</code></td>
<td>
<p>Shape of Centre of Activity marker, default 4, an X. Permissible values 0 to 25.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>COAsize</code></td>
<td>
<p>Size of COA point, default 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plottitle</code></td>
<td>
<p>Title of the resultant plot, default "Aggregated 95pct and 50pct UD contours".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotsubtitle</code></td>
<td>
<p>Plot subtitle, default "Scaled contours". Can add the n of your individuals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legendtitle</code></td>
<td>
<p>Legend title, default "Percent UD Contours".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotcaption</code></td>
<td>
<p>Plot caption, default "movegroup" + today's date.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>axisxlabel</code></td>
<td>
<p>Default "Longitude".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>axisylabel</code></td>
<td>
<p>Default "Latitude".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legendposition</code></td>
<td>
<p>Vector of 2, format c(1,2), Proportional distance of (middle?) of legend
box from L to R, percent distance from Bottom to Top. Values 0 to 1. Default c(0.11, 0.85).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fontsize</code></td>
<td>
<p>Font size, default 12.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fontfamily</code></td>
<td>
<p>= Font family, default "Times New Roman".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filesavename</code></td>
<td>
<p>File savename, default today's date + "_dBBMM-contours.png".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>savedir</code></td>
<td>
<p>Save outputs to a temporary directory (default) else change to current directory
e.g. "/home/me/folder". Do not use getwd() here. No terminal slash. E.g.
file.path(movegroupsavedir, "Plot") . Auto-created if it doesn't exist.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>receiverlats</code></td>
<td>
<p>Vector of latitudes for receivers to be plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>receiverlons</code></td>
<td>
<p>Vector of longitudes for receivers to be plotted. Same length as receiverlats.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>receivernames</code></td>
<td>
<p>Vector of names for receivers to be plotted. Same length as receiverlats.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>receiverrange</code></td>
<td>
<p>Single (will be recycled), or vector (same length as receiverlats) of
detection ranges in metres for receivers to be plotted. If you have a max and a (e.g.) 90 percent
detection range, probably use max.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recpointscol</code></td>
<td>
<p>Colour of receiver centrepoint outlines. Default "black".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recpointsfill</code></td>
<td>
<p>Colour of receiver centrepoint fills. Default "white".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recpointsalpha</code></td>
<td>
<p>Alpha value of receiver centrepoint fills, 0 (invisible) to 1 (fully
visible). Default 0.5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recpointssize</code></td>
<td>
<p>Size of receiver points. Default 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recpointsshape</code></td>
<td>
<p>Shape of receiver points, default 21, circle with outline and fill.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recbufcol</code></td>
<td>
<p>Colour of the receiver buffer circle outlines. Default "grey75"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recbuffill</code></td>
<td>
<p>Colour of the receiver buffer circle fills. Default "grey".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recbufalpha</code></td>
<td>
<p>Alpha value of receiver buffer fills, 0 (invisible) to 1 (fully visible).
Default 0.5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reclabcol</code></td>
<td>
<p>Receiver label text colour. Default "black".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reclabfill</code></td>
<td>
<p>Receiver label fill colour, NA for no fill. Default NA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reclabnudgex</code></td>
<td>
<p>Receiver label offset nudge in X dimension. Default 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reclabnudgey</code></td>
<td>
<p>Receiver label offset nudge in Y dimension. Default -200.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reclabpad</code></td>
<td>
<p>Receiver label padding in lines. Default 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reclabrad</code></td>
<td>
<p>Receiver label radius in lines. Default 0.15.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reclabbord</code></td>
<td>
<p>Receiver label border in mm. Default 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surface</code></td>
<td>
<p>Plot complete UD surface along with contours. Default TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cropsavedimage</code></td>
<td>
<p>Crop the output image with knitr::plot_crop which uses pdfcrop on PDFs,
otherwise magick::image_trim. magick requires system pre-install. deb: libmagick++-dev (Debian,
Ubuntu), rpm: ImageMagick-c++-devel (Fedora, CentOS, RHEL), csw: imagemagick_dev (Solaris), brew:
imagemagick@6 (MacOS). Default FALSE.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For plottitle, you can use the term 'home range' when an animal can be detected wherever it goes
i.e. using GPS, satellite or acoustic telemetry whereby it is known that acoustic receivers cover
the entire home range of the study species. This term is problematic when applied to a passive
acoustic telemetry setting where an array of non-overlapping receivers are used to assess local
space use patterns i.e. the home range is bigger than the coverage by the acoustic array.
</p>
<p>Errors and their origins:
</p>

<ol>
<li>
<p> Error in gzfile(file, "rb") : cannot open the connection. In addition: Warning message: In
gzfile(file, "rb"): cannot open compressed file '/var/folders/dl/etc/ggmap/index.rds',
probable reason 'No such file or directory'. Cause: index.rds may not have been created, due to a
problem with ggmap::get_map, likely due to your API key failing silently.
Filename too long - solve with filename = "whatever" but doesn't do anything. Added issue in
github: https://github.com/dkahle/ggmap/issues/346 .
API key help: https://github.com/dkahle/ggmap/issues/235 .
</p>
</li>
<li>
<p> trying to read file: All_Rasters_Scaled_Weighted_UDScaled.asc: Error in CPL_read_gdal(
as.character(x), as.character(options), as.character(driver),: file not found. Check x is correct.
</p>
</li>
<li>
<p> Error in grid.Call.graphics...: Empty raster: mapzoom likely set too low, returning no tiles.
Increase mapzoom number.
</p>
</li>
<li>
<p> Not Found (HTTP 404). Failed to acquire tile /...png: Tiles are unavailable for ocean, and may
be unavailable at the chosen zoom level for the specific region of interest. Inspect the output
map and try a lower level (number) of mapzoom.
</p>
</li>
</ol>
<h4>How to get Google map basemaps</h4>

<p>(from https://www.youtube.com/watch?v=O5cUoVpVUjU):
</p>

<ol>
<li>
<p> Sign up with dev console: a. You must enter credit card details, but won’t be charged if your
daily API requests stay under the limit. b. Follow the link:
https://console.cloud.google.com/projectselector2/apis/dashboard?supportedpurview=project c.
Sign up for Google cloud account (it may auto populate your current gmail), click agree and
continue. d. Click the navigation email in the top left corner and click on Billing. e. Create a
billing account – they will NOT auto charge after trial ends. f. Enter information, click on
'start my free trial'. They may offer a free credit for trying out their service. More pricing
details: https://mapsplatform.google.com/pricing/ . g. Click “Select a Project” then
“New project” in the top right corner. h. Enter Project Name, leave Location as is, click
“Create”. i. You should now see your project name at the top, where the drop-down menu is.
</p>
</li>
<li>
<p> Enable Maps and Places API: a. Click 'Library' on the left. b. In the search field type “Maps”
. c. Scroll down, click “Maps Java Script API”. d. Click Enable. e. Click 'Library' again, search
“Places”, click on “Places API”. f. Click Enable.
</p>
</li>
<li>
<p> Create Credentials for API  Key: a. Return to 'APIs &amp; Services' page. b. Click on Credentials.
c. At the top click 'Create Credentials &gt; API Key'. d. API key should pop up with option to copy
it. e. You can restrict the key if you want by following steps 4 &amp; 5 here:
https://www.youtube.com/watch?v=O5cUoVpVUjU&amp;t=232s
</p>
</li>
</ol>
<h3>Value</h3>

<p>Individual-level utilization distributions, saved as rasters, as well as calculated
volume area estimates for 50 and 95pct contours, saved in a .csv file.
</p>


<h3>Author(s)</h3>

<p>Simon Dedman, <a href="mailto:simondedman@gmail.com">simondedman@gmail.com</a>
</p>
<p>Maurits van Zinnicq Bergmann, <a href="mailto:mauritsvzb@gmail.com">mauritsvzb@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Having run the movegroup and scaleraster function examples:
plotraster(
  x = file.path(tempdir(), "Scaled", "All_Rasters_Scaled_Weighted_UDScaled.asc"),
  mapzoom = 14,
  mapsource = "stamen",
  maptype = "terrain",
  savedir = file.path(tempdir(), "Plot"),
  xlatlon = file.path(tempdir(), "Scaled", "All_Rasters_Scaled_Weighted_LatLon.asc"),
  locationpoints = TracksCleaned |&gt; dplyr::rename(lat = "Lat", lon = "Lon"),
  pointsincontourssave = file.path(tempdir(), "Scaled", "pointsincontours.csv"))

</code></pre>


</div>