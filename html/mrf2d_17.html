<div class="container">

<table style="width: 100%;"><tr>
<td>fit_ghm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>EM estimation for Gaussian Hidden Markov field</h2>

<h3>Description</h3>

<p><code>fit_ghm</code> fits a Gaussian Mixture model with hidden components
driven by a Markov random field with known parameters. The inclusion of a
linear combination of basis functions as a fixed effect is also possible.
</p>
<p>The algorithm is a modification of of
(Zhang et al. 2001), which is
described in (Freguglia et al. 2020).
</p>


<h3>Usage</h3>

<pre><code class="language-R">fit_ghm(
  Y,
  mrfi,
  theta,
  fixed_fn = list(),
  equal_vars = FALSE,
  init_mus = NULL,
  init_sigmas = NULL,
  maxiter = 100,
  max_dist = 10^-3,
  icm_cycles = 6,
  verbose = interactive(),
  qr = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>A matrix of observed (continuous) pixel values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mrfi</code></td>
<td>
<p>A <code>mrfi</code> object representing the
interaction structure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>A 3-dimensional array describing potentials. Slices represent
interacting positions, rows represent pixel values and columns represent
neighbor values. As an example: <code>theta[1,3,2]</code> has the potential for the
pair of values 0,2 observed in the second relative position of <code>mrfi</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed_fn</code></td>
<td>
<p>A list of functions <code>fn(x,y)</code> to be considered as a fixed
effect. See <code>basis_functions</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>equal_vars</code></td>
<td>
<p><code>logical</code> indicating if the mixture model has the same
variances in all mixture components.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init_mus</code></td>
<td>
<p>Optional. A <code>numeric</code> with length (C+1) with the initial mean
estimate for each component.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init_sigmas</code></td>
<td>
<p>Otional. A <code>numeric</code> with length (C+1) with initial sample
deviation estimate for each component.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter</code></td>
<td>
<p>The maximum number of iterations allowed. Defaults to 100.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_dist</code></td>
<td>
<p>Defines a stopping condition. The algorithm stops if the
maximum absolute difference between parameters of two consecutive iterations
is less than <code>max_dist</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>icm_cycles</code></td>
<td>
<p>Number of steps used in the Iterated Conditional Modes
algorithm executed in each interaction. Defaults to 6.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p><code>logical</code> indicating wheter to print the progress or not.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qr</code></td>
<td>
<p>The QR decomposition of the design matrix. Used internally.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If either <code>init_mus</code> or <code>init_sigmas</code> is <code>NULL</code> an EM algorithm
considering an independent uniform distriburion for the hidden component is
fitted first and its estimated means and sample deviations are used as
initial values. This is necessary because the algorithm may not converge if
the initial parameter configuration is too far from the maximum likelihood
estimators.
</p>
<p><code>max_dist</code> defines a stopping condition. The algorithm will stop if the
maximum absolute difference between (<code class="reqn">\mu</code> and <code class="reqn">\sigma</code>) parameters
in consecutive iterations is less than <code>max_dist</code>.
</p>


<h3>Value</h3>

<p>A <code>hmrfout</code> containing:
</p>

<ul>
<li> <p><code>par</code>: A <code>data.frame</code> with <code class="reqn">\mu</code> and <code class="reqn">\sigma</code> estimates for each
component.
</p>
</li>
<li> <p><code>fixed</code>: A <code>matrix</code> with the estimated fixed effect in each pixel.
</p>
</li>
<li> <p><code>Z_pred</code>: A <code>matrix</code> with the predicted component (highest probability) in
each pixel.
</p>
</li>
<li> <p><code>predicted</code>: A <code>matrix</code> with the fixed effect + the <code class="reqn">\mu</code> value for
the predicted component in each pixel.
</p>
</li>
<li> <p><code>iterations</code>: Number of EM iterations done.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Victor Freguglia
</p>


<h3>References</h3>

<p>Freguglia V, Garcia NL, Bicas JL (2020).
“Hidden Markov random field models applied to color homogeneity evaluation in dyed textile images.”
<em>Environmetrics</em>, <b>31</b>(4), e2613.<br><br> Zhang Y, Brady M, Smith S (2001).
“Segmentation of brain MR images through a hidden Markov random field model and the expectation-maximization algorithm.”
<em>IEEE transactions on medical imaging</em>, <b>20</b>(1), 45–57.
</p>


<h3>See Also</h3>

<p>A paper with detailed description of the package can be found at
doi: <a href="https://doi.org/10.18637/jss.v101.i08">10.18637/jss.v101.i08</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Sample a Gaussian mixture with components given by Z_potts
# mean values are 0, 1 and 2 and a linear effect on the x-axis.

set.seed(2)
Y &lt;- Z_potts + rnorm(length(Z_potts), sd = 0.4) +
      (row(Z_potts) - mean(row(Z_potts)))*0.01
# Check what the data looks like
cplot(Y)

fixed &lt;- polynomial_2d(c(1,0), dim(Y))
fit &lt;- fit_ghm(Y, mrfi = mrfi(1), theta = theta_potts, fixed_fn = fixed)
fit$par
cplot(fit$fixed)


</code></pre>


</div>