<div class="container">

<table style="width: 100%;"><tr>
<td>mrbayes</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bayesian linear regression using Merge and Reduce</h2>

<h3>Description</h3>

<p><code>mrbayes</code> is used to conduct Bayesian linear regression on
very large data sets using Merge and Reduce as described in Geppert et al. (2020).
Package <code>rstan</code> needs to be installed. When calling the function this
is checked using <code>requireNamespace</code> as suggested by
Hadley Wickham in "R packages" (section Dependencies, 
http://r-pkgs.had.co.nz/description.html, accessed 2020-07-31).
</p>


<h3>Usage</h3>

<pre><code class="language-R">mrbayes(
  y,
  intercept = TRUE,
  fileMr = NULL,
  dataMr = NULL,
  obsPerBlock,
  dataStan = NULL,
  sep = "auto",
  dec = ".",
  header = TRUE,
  naStrings = "NA",
  colNames = NULL,
  naAction = na.fail,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p><code>(character)</code> <br> Column name of the dependent variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p><code>(logical)</code> <br> Argument specifying whether the model
should have an intercept term or not. Defaults to <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fileMr</code></td>
<td>
<p>(<code>character</code>) <br> The name of a file, including the
filepath, to be read in blockwise. Either <code>fileMr</code> or <code>dataMr</code>
needs to be specified. When using this argument, the arguments <code>sep</code>, 
<code>dec</code>, <code>header</code>, <code>naStrings</code>, <code>colNames</code> (as in <code>fread</code>) 
are of relevance. Further options from <code>fread</code> are currently not supported.
Also note that defaults might differ. In case the data to be read in has row names,
note that these will be read in as regular column. This may need
special treatment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataMr</code></td>
<td>
<p>(<code>data.frame</code>) <br> The data to be used for the regression
analysis. Either <code>fileMr</code> or <code>dataMr</code> needs to be specified.
Note that the arguments <code>sep</code>, <code>dec</code>, <code>header</code>, <code>naStrings</code>, 
and <code>colNames</code> are ignored when <code>dataMr</code> is specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obsPerBlock</code></td>
<td>
<p><code>(numeric)</code> <br> Value specifying the number of
observations in each block. This number has to be larger than the number of 
regression coefficients. Moreover, the recommended ratio of 
observations per regression coefficient is larger than 25 (Geppert et al., 2020). 
Note that the last block may contain less observations than specified 
depending on the sample size. If the number of observations in this last 
block is too small it is not included in the model and a warning is 
issued.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataStan</code></td>
<td>
<p>(<code>list</code>) <br> Optional argument. This argument is
equivalent to the argument <code>data</code> in <code>stan</code>. If not
specified the default <code>dataStan</code>, which makes use of all predictors is used.
See section Details for the default <code>dataStan</code> and further notes on the syntax
to be used when specifiying this argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sep</code></td>
<td>
<p>See documentation of <code>fread</code>. Default is
"auto". Ignored when <code>dataMr</code> is specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dec</code></td>
<td>
<p>See documentation of <code>fread</code>. Default is 
".". Ignored when <code>dataMr</code> is specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>header</code></td>
<td>
<p><code>(logical)</code> <br> See documentation of
<code>fread</code>. Defaults to <code>TRUE</code>. Ignored when
<code>dataMr</code> is specified. If <code>header</code> is set to <code>FALSE</code> and no 
<code>colNames</code> are given, then column names default to "V" followed by the 
column number.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>naStrings</code></td>
<td>
<p><code>(character)</code> <br> Optional argument.
See argument na.strings of <code>fread</code>.
Default is "NA". Ignored when <code>dataMr</code> is specified and optional
when <code>fileMr</code> is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colNames</code></td>
<td>
<p><code>(character vector)</code> <br> Same as argument
col.names of <code>fread</code>. Ignored when <code>dataMr</code> is
specified and optional when <code>fileMr</code> is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>naAction</code></td>
<td>
<p><code>(function)</code> <br> Action to be taken when missing values
are present in the data. Currently only <code>na.fail</code> is 
supported.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further optional arguments to be passed on to
<code>stan</code>, especially <code>pars</code> and arguments that
control the behaviour of the sampling in <code>rstan</code> such as <code>chains</code>,
<code>iter</code>, <code>warmup</code>, and <code>thin</code>. Please refer to 
<code>rstan</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns an object of class <code>"mrbayes"</code> which is a list
containing the following components: 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>Number of level of the final model in Merge and Reduce. This is equal
to <code class="reqn">\lceil \log_2{(\code{numberObs}/\code{obsPerBlock})} \rceil + 1</code> 
and corresponds to the number of buckets in Figure 1 of Geppert et al. (2020).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numberObs</code></td>
<td>
<p>The total number of observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>summaryStats</code></td>
<td>
<p>Summary statistics including the mean, median,
quartiles, 2.5% and 97.5% quantiles of the posterior distributions for each
regression coefficient and the error term's standard deviation sigma.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>diagnostics</code></td>
<td>
<p>Effective sample size (n_eff) and potential
scale reduction factor on split chains (Rhat) calculated from the output of
summary,stanfit-method. Note that, using Merge and Reduce,
for each regression coefficient only one value is reported: For n_eff the
minimum observed value on level 1 is reported and for Rhat the maximum
observed value on level 1 is reported.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modelCode</code></td>
<td>
<p>The model. Syntax
as in argument <code>model_code</code> of stan.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataHead</code></td>
<td>
<p>First six rows of the data in the first block. This serves
as a sanity check, especially when using the argument <code>fileMr</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Code of default <code>dataStan</code> makes use of all predictors: <br><code>dataStan = list(n = nrow(currentBlock),</code> <br><code>d = (ncol(currentBlock) -
  1),</code> <br><code>X = currentBlock[, -colNumY],</code> <br><code>y = currentBlock[, colNumY])</code> <br>
where <code>currentBlock</code>
is the current block of data to be evaluated, <code>n</code> the number of observations, 
<code>d</code> the number of variables (without intercept), <code>X</code> contains the predictors,
and <code>y</code> the dependent variable. <code>colNumY</code> is the column number of the 
dependent variable that the function finds internally. <br><br>
When specifying the argument <code>dataStan</code>, note two things: <br> 
1. Please use the syntax of the default <code>dataStan</code>, i.e. the object 
containing the data of the block to be evaluated is called 
<code>currentBlock</code>, the number of observations must be set to
<code>n = nrow(currentBlock)</code>, <code>d</code> needs to be set to the number of
variables without intercept, the dependent variable must be named <code>y</code>,
and the independent variables must be named <code>X</code>. <br> 
2. The expressions
within the list must be unevaluated: Therefore, use the function
<code>quote</code>. <br></p>


<h3>References</h3>

<p>Geppert, L.N., Ickstadt, K., Munteanu, A., &amp; Sohler, C. (2020).
Streaming statistical models via Merge &amp; Reduce. International Journal
of Data Science and Analytics, 1-17, <br>
doi: https://doi.org/10.1007/s41060-020-00226-0
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Package rstan needs to be installed for running this example.
 
if (requireNamespace("rstan", quietly = TRUE)) {
  n = 2000
  p = 4
  set.seed(34)
  x1 = rnorm(n, 10, 2)
  x2 = rnorm(n, 5, 3)
  x3 = rnorm(n, -2, 1)
  x4 = rnorm(n, 0, 5)
  y = 2.4 - 0.6 * x1 + 5.5 * x2 - 7.2 * x3 + 5.7 * x4 + rnorm(n)
  data = data.frame(x1, x2, x3, x4, y)

  normalmodell = '
  data {
  int&lt;lower=0&gt; n;
  int&lt;lower=0&gt; d;
  matrix[n,d] X; // predictor matrix
  vector[n] y; // outcome vector
  }
  parameters {
  real alpha; // intercept
  vector[d] beta; // coefficients for predictors
  real&lt;lower=0&gt; sigma; // error scale
  }
  model {
  y ~ normal(alpha + X * beta, sigma); // likelihood
  }
  ' 

  datas = list(n = nrow(data), d = ncol(data)-1,
               y = data[, dim(data)[2]], X = data[, 1:(dim(data)[2]-1)])
  fit0 = rstan::stan(model_code = normalmodell, data = datas, chains = 4, iter = 1000)
  fit1 = mrbayes(dataMr = data, obsPerBlock = 500, y = 'y')
}

</code></pre>


</div>