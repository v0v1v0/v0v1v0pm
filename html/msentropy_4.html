<div class="container">

<table style="width: 100%;"><tr>
<td>clean_spectrum</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Clean a spectrum</h2>

<h3>Description</h3>

<p>Clean a spectrum
</p>
<p>This function will clean the peaks by the following steps:
1. Remove empty peaks (mz &lt;= 0 or intensity &lt;= 0).
2. Remove peaks with mz &gt;= max_mz or mz &lt; min_mz.
3. Centroid the spectrum by merging peaks within min_ms2_difference_in_da or min_ms2_difference_in_ppm.
4. Remove peaks with intensity &lt; noise_threshold * max_intensity.
5. Keep only the top max_peak_num peaks.
6. Normalize the intensity to sum to 1.
</p>
<p>Note: The only one of min_ms2_difference_in_da and min_ms2_difference_in_ppm should be positive.
</p>


<h3>Usage</h3>

<pre><code class="language-R">clean_spectrum(
  peaks,
  min_mz,
  max_mz,
  noise_threshold,
  min_ms2_difference_in_da,
  min_ms2_difference_in_ppm,
  max_peak_num,
  normalize_intensity
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>peaks</code></td>
<td>
<p>A matrix of spectral peaks, with two columns: mz and intensity</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_mz</code></td>
<td>
<p>The minimum mz value to keep, set to -1 to disable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_mz</code></td>
<td>
<p>The maximum mz value to keep, set to -1 to disable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>noise_threshold</code></td>
<td>
<p>The noise threshold, set to -1 to disable, all peaks have intensity &lt; noise_threshold * max_intensity will be removed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_ms2_difference_in_da</code></td>
<td>
<p>The minimum mz difference in Da to merge peaks, set to -1 to disable, any two peaks with mz difference &lt; min_ms2_difference_in_da will be merged</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_ms2_difference_in_ppm</code></td>
<td>
<p>The minimum mz difference in ppm to merge peaks, set to -1 to disable, any two peaks with mz difference &lt; min_ms2_difference_in_ppm will be merged</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_peak_num</code></td>
<td>
<p>The maximum number of peaks to keep, set to -1 to disable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>normalize_intensity</code></td>
<td>
<p>Whether to normalize the intensity to sum to 1</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A matrix of spectral peaks, with two columns: mz and intensity
</p>


<h3>Examples</h3>

<pre><code class="language-R">mz &lt;- c(100.212, 169.071, 169.078, 300.321)
intensity &lt;- c(0.3716, 7.917962, 100., 66.83)
peaks &lt;- matrix(c(mz, intensity), ncol = 2, byrow = FALSE)
clean_spectrum(peaks, min_mz = 0, max_mz = 1000, noise_threshold = 0.01,
               min_ms2_difference_in_da = 0.02, min_ms2_difference_in_ppm = -1,
               max_peak_num = 100, normalize_intensity = TRUE)

</code></pre>


</div>