<div class="container">

<table style="width: 100%;"><tr>
<td>msm2Surv</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Convert data for ‘msm’ to data for ‘survival’, ‘mstate’ or ‘flexsurv’
analysis</h2>

<h3>Description</h3>

<p>Converts longitudinal data for a <code>msm</code> model fit, where
observations represent the exact transition times of the process, to
counting process data.  This enables, for example, flexible parametric
multi-state models to be fitted with <code>flexsurvreg</code>
from the <span class="pkg">flexsurv</span> package, or semiparametric models to be implemented
with <code>coxph</code> and the <span class="pkg">mstate</span> package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">msm2Surv(data, subject, time, state, covs = NULL, Q)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data frame in the format expected by a <code>msm</code> model
fit with <code>exacttimes=TRUE</code> or all <code>obstype=2</code>.  Each row
represents an observation of a state, and the time variable contains the
exact and complete transition times of the underlying process.  This is
explained in more detail in the help page for <code>msm</code>, section
<code>obstype=2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subject</code></td>
<td>
<p>Name of the subject ID in the data (character format, i.e.
quoted).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>Name of the time variable in the data (character).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>state</code></td>
<td>
<p>Name of the state variable in the data (character).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covs</code></td>
<td>
<p>Vector of covariate names to carry through (character).  If not
supplied, this is taken to be all remaining variables in the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Q</code></td>
<td>
<p>Transition intensity matrix.  This should have number of rows and
number of columns both equal to the number of states.  If an instantaneous
transition is not allowed from state <code class="reqn">r</code> to state <code class="reqn">s</code>, then <code>Q</code>
should have <code class="reqn">(r,s)</code> entry 0, otherwise it should be non-zero.  The
diagonal entries are ignored.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For example, if the data supplied to <code>msm</code> look like this:
</p>

<table>
<tr>
<td style="text-align: left;"> <code>subj</code> </td>
<td style="text-align: left;"> <code>days</code> </td>
<td style="text-align: left;"> <code>status</code> </td>
<td style="text-align: left;">
<code>age</code> </td>
<td style="text-align: left;"> <code>treat</code> </td>
</tr>
<tr>
<td style="text-align: left;"> 1</td>
<td style="text-align: left;"> 0</td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 66</td>
<td style="text-align: left;"> 1</td>
</tr>
<tr>
<td style="text-align: left;"> 1</td>
<td style="text-align: left;"> 27</td>
<td style="text-align: left;">
2 </td>
<td style="text-align: left;"> 66</td>
<td style="text-align: left;"> 1</td>
</tr>
<tr>
<td style="text-align: left;"> 1</td>
<td style="text-align: left;"> 75</td>
<td style="text-align: left;"> 3 </td>
<td style="text-align: left;"> 66</td>
<td style="text-align: left;"> 1</td>
</tr>
<tr>
<td style="text-align: left;"> 1</td>
<td style="text-align: left;"> 97</td>
<td style="text-align: left;"> 4 </td>
<td style="text-align: left;">
66</td>
<td style="text-align: left;"> 1</td>
</tr>
<tr>
<td style="text-align: left;"> 1</td>
<td style="text-align: left;"> 1106</td>
<td style="text-align: left;"> 4 </td>
<td style="text-align: left;"> 69</td>
<td style="text-align: left;"> 1</td>
</tr>
<tr>
<td style="text-align: left;"> 2</td>
<td style="text-align: left;"> 0</td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 49</td>
<td style="text-align: left;"> 0</td>
</tr>
<tr>
<td style="text-align: left;">
2</td>
<td style="text-align: left;"> 90</td>
<td style="text-align: left;"> 2 </td>
<td style="text-align: left;"> 49</td>
<td style="text-align: left;"> 0</td>
</tr>
<tr>
<td style="text-align: left;"> 2</td>
<td style="text-align: left;"> 1037</td>
<td style="text-align: left;"> 2 </td>
<td style="text-align: left;"> 51</td>
<td style="text-align: left;"> 0</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
</tr>
</table>
<p>then the output of <code>msm2Surv</code> will be a data frame looking like
this:
</p>

<table>
<tr>
<td style="text-align: left;"> <code>id</code> </td>
<td style="text-align: left;"> <code>from</code> </td>
<td style="text-align: left;"> <code>to</code> </td>
<td style="text-align: left;">
<code>Tstart</code> </td>
<td style="text-align: left;"> <code>Tstop</code> </td>
<td style="text-align: left;"> <code>time</code> </td>
<td style="text-align: left;"> <code>status</code> </td>
<td style="text-align: left;">
<code>age</code> </td>
<td style="text-align: left;"> <code>treat</code> </td>
<td style="text-align: left;"> <code>trans</code>
</td>
</tr>
<tr>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 2 </td>
<td style="text-align: left;"> 0
</td>
<td style="text-align: left;"> 27 </td>
<td style="text-align: left;"> 27 </td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 66 </td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 1</td>
</tr>
<tr>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 4 </td>
<td style="text-align: left;"> 0 </td>
<td style="text-align: left;">
27 </td>
<td style="text-align: left;"> 27 </td>
<td style="text-align: left;"> 0 </td>
<td style="text-align: left;"> 66 </td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 2</td>
</tr>
<tr>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 2 </td>
<td style="text-align: left;"> 3 </td>
<td style="text-align: left;"> 27 </td>
<td style="text-align: left;"> 75
</td>
<td style="text-align: left;"> 48 </td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 66 </td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 3</td>
</tr>
<tr>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 2 </td>
<td style="text-align: left;"> 4 </td>
<td style="text-align: left;"> 27 </td>
<td style="text-align: left;"> 75 </td>
<td style="text-align: left;">
48 </td>
<td style="text-align: left;"> 0 </td>
<td style="text-align: left;"> 66 </td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 4</td>
</tr>
<tr>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 3 </td>
<td style="text-align: left;"> 4 </td>
<td style="text-align: left;"> 75 </td>
<td style="text-align: left;"> 97 </td>
<td style="text-align: left;"> 22
</td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 69 </td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 5</td>
</tr>
<tr>
<td style="text-align: left;"> 2 </td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 2 </td>
<td style="text-align: left;"> 0 </td>
<td style="text-align: left;"> 90 </td>
<td style="text-align: left;"> 90 </td>
<td style="text-align: left;">
1 </td>
<td style="text-align: left;"> 49 </td>
<td style="text-align: left;"> 0 </td>
<td style="text-align: left;"> 1</td>
</tr>
<tr>
<td style="text-align: left;"> 2 </td>
<td style="text-align: left;"> 1 </td>
<td style="text-align: left;"> 4 </td>
<td style="text-align: left;"> 0 </td>
<td style="text-align: left;"> 90 </td>
<td style="text-align: left;"> 90 </td>
<td style="text-align: left;"> 0
</td>
<td style="text-align: left;"> 49 </td>
<td style="text-align: left;"> 0 </td>
<td style="text-align: left;"> 2</td>
</tr>
<tr>
<td style="text-align: left;"> 2 </td>
<td style="text-align: left;"> 2 </td>
<td style="text-align: left;"> 3 </td>
<td style="text-align: left;"> 90 </td>
<td style="text-align: left;"> 1037 </td>
<td style="text-align: left;"> 947 </td>
<td style="text-align: left;"> 0
</td>
<td style="text-align: left;"> 49 </td>
<td style="text-align: left;"> 0 </td>
<td style="text-align: left;"> 3</td>
</tr>
<tr>
<td style="text-align: left;"> 2 </td>
<td style="text-align: left;"> 2 </td>
<td style="text-align: left;"> 4 </td>
<td style="text-align: left;"> 90 </td>
<td style="text-align: left;"> 1037 </td>
<td style="text-align: left;"> 947 </td>
<td style="text-align: left;">
0</td>
<td style="text-align: left;"> 49 </td>
<td style="text-align: left;"> 0 </td>
<td style="text-align: left;"> 4</td>
</tr>
<tr>
<td style="text-align: left;"> </td>
</tr>
</table>
<p>At 27 days, subject 1 is observed to move from state 1 to state 2 (first
row, status 1), which means that their potential transition from state 1 to
state 4 is censored (second row, status 0).
</p>
<p>See the <span class="pkg">mstate</span> package and the references below for more details of
this data format and using it for semi-parametric multi-state modelling.
</p>


<h3>Value</h3>

<p>A data frame of class <code>"msdata"</code>, with rows representing
observed or censored transitions.  There will be one row for each observed
transition in the original data, and additional rows for every potential
transition that could have occurred out of each observed state.
</p>
<p>The data frame will have columns called:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>Subject ID</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>from</code></td>
<td>
<p>Starting state of the transition</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to</code></td>
<td>
<p>Finishing state of the transition</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Tstart</code></td>
<td>
<p>The starting time
of the transition</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Tstop</code></td>
<td>
<p>The finishing time of the transition</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>The time difference = <code>Tstop</code> - <code>Tstart</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>status</code></td>
<td>
<p>Event or censoring indicator, with 1 indicating an observed
transition, and 0 indicating censoring</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trans</code></td>
<td>
<p>Transition number</p>
</td>
</tr>
</table>
<p>and any remaining columns will represent covariates.  Any covariates whose
names clash with the standard variables in the returned data (<code>"id"</code>,
<code>"from"</code>, <code>"to"</code>, <code>"Tstart"</code>, <code>"Tstop"</code>, <code>"time"</code>,
<code>"status"</code> or <code>"trans"</code>) have <code>".2"</code> appended to their names.
</p>
<p>The transition matrix in <span class="pkg">mstate</span> format is stored in the <code>trans</code>
attribute of the returned object.  See the example code below.
</p>


<h3>Author(s)</h3>

<p>C. H. Jackson <a href="mailto:chris.jackson@mrc-bsu.cam.ac.uk">chris.jackson@mrc-bsu.cam.ac.uk</a>
</p>


<h3>References</h3>

<p>Putter H, Fiocco M, Geskus RB (2007). Tutorial in biostatistics:
Competing risks and multi-state models. <em>Statistics in Medicine</em> 26:
2389-2430.
</p>
<p>Liesbeth C. de Wreede, Marta Fiocco, Hein Putter (2011). <span class="pkg">mstate</span>: An R
Package for the Analysis of Competing Risks and Multi-State Models.
<em>Journal of Statistical Software</em>, 38(7), 1-30.
</p>
<p>Jackson, C. H. (2014). flexsurv: Flexible parametric survival and
multi-state models.  R package version 0.5.
</p>


<h3>See Also</h3>

<p><code>msprep</code>, in <span class="pkg">mstate</span>, which produces data
in a similar format, given data in "wide" format with one row per subject.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
msmdat &lt;- data.frame(
 subj = c(1, 1, 1, 1, 1, 2, 2, 2),
 days = c(0, 27, 75, 97, 1106, 0, 90, 1037),
 status = c(1, 2, 3, 4, 4, 1, 2, 2),
 age = c(66, 66, 66, 66, 69, 49, 49, 51),
 treat = c(1, 1, 1, 1, 1, 0, 0, 0)
)
# transitions only allowed to next state up or state 4
Q &lt;- rbind(c(1, 1, 0, 1), 
           c(0, 1, 1, 1),
           c(0, 0, 1, 1),
           c(0, 0, 0, 0))
dat &lt;- msm2Surv(data=msmdat, subject="subj", time="days", state="status", 
         Q=Q)
dat
attr(dat, "trans")

</code></pre>


</div>