<div class="container">

<table style="width: 100%;"><tr>
<td>pearson.msm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Pearson-type goodness-of-fit test</h2>

<h3>Description</h3>

<p>Pearson-type goodness-of-fit test for multi-state models fitted to
panel-observed data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pearson.msm(
  x,
  transitions = NULL,
  timegroups = 3,
  intervalgroups = 3,
  covgroups = 3,
  groups = NULL,
  boot = FALSE,
  B = 500,
  next.obstime = NULL,
  N = 100,
  indep.cens = TRUE,
  maxtimes = NULL,
  pval = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A fitted multi-state model, as returned by <code>msm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transitions</code></td>
<td>
<p>This should be an integer vector indicating which
interval transitions should be grouped together in the contingency table.
Its length should be the number of allowed interval transitions, excluding
transitions from absorbing states to absorbing states.
</p>
<p>The allowed interval transitions are the set of pairs of states <code class="reqn">(a,b)</code>
for which it is possible to observe <code class="reqn">a</code> at one time and <code class="reqn">b</code> at any
later time.  For example, in a "well-disease-death" model with allowed
<em>instantaneous</em> 1-2, 2-3 transitions, there are 5 allowed
<em>interval</em> transitions. In numerical order, these are 1-1, 1-2, 1-3,
2-2 and 2-3, excluding absorbing-absorbing transitions.
</p>
<p>Then, to group transitions 1-1,1-2 together, and transitions 2-2,2-3
together, specify
</p>
<p><code>transitions = c(1,1,2,3,3)</code>.
</p>
<p>Only transitions from the same state may be grouped.  By default, each
interval transition forms a separate group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timegroups</code></td>
<td>
<p>Number of groups based on quantiles of the time since the
start of the process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intervalgroups</code></td>
<td>
<p>Number of groups based on quantiles of the time
interval between observations, within time groups</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covgroups</code></td>
<td>
<p>Number of groups based on quantiles of <code class="reqn">\sum_r
q_{irr}</code>, where <code class="reqn">q_{irr}</code> are the diagonal entries of the
transition intensity matrix for the <em>i</em>th transition.  These are a
function of the covariate effects and the covariate values at the <em>i</em>th
transition: <code class="reqn">q_{irr}</code> is minus the sum of the off-diagonal entries
<code class="reqn">q_{rs}^{(0)} exp (\beta_{rs}^T z_i)</code> on the <em>r</em>th row.
</p>
<p>Thus <code>covgroups</code> summarises the impact of covariates at each
observation, by calculating the overall rate of progression through states
at that observation.
</p>
<p>For time-inhomogeneous models specified using the <code>pci</code> argument to
<code>msm</code>, if the only covariate is the time period,
<code>covgroups</code> is set to 1, since <code>timegroups</code> ensures that
transitions are grouped by time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groups</code></td>
<td>
<p>A vector of arbitrary groups in which to categorise each
transition. This can be an integer vector or a factor.  This can be used to
diagnose specific areas of poor fit.  For example, the contingency table
might be grouped by arbitrary combinations of covariates to detect types of
individual for whom the model fits poorly.
</p>
<p>The length of <code>groups</code> should be <code>x$data$n</code>, the number of
observations used in the model fit, which is the number of observations in
the original dataset with any missing values excluded.  The value of
<code>groups</code> at observation <code class="reqn">i</code> is used to categorise the transition
which <em>ends</em> at observation i. Values of <code>groups</code> at the first
observation for each subject are ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot</code></td>
<td>
<p>Estimate an "exact" p-value using a parametric bootstrap.
</p>
<p>All objects used in the original call to <code>msm</code> which produced
<code>x</code>, such as the <code>qmatrix</code>, should be in the working environment,
or else an “object not found” error will be given.  This enables the
original model to be refitted to the replicate datasets.
</p>
<p>Note that <code>groups</code> cannot be used with bootstrapping, as the simulated
observations will not be in the same categories as the original
observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>Number of bootstrap replicates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>next.obstime</code></td>
<td>
<p>This is a vector of length <code>x$data$n</code> (the number
of observations used in the model fit) giving the time to the next
<em>scheduled</em> observation following each time point.  This is only used
when times to death are known exactly.
</p>
<p>For individuals who died (entered an absorbing state) before the next
scheduled observation, and the time of death is known exactly,
<code>next.obstime</code> would be <em>greater</em> than the observed death time.
</p>
<p>If the individual did not die, and a scheduled observation did follow that
time point, <code>next.obstime</code> should just be the same as the time to that
observation.
</p>
<p><code>next.obstime</code> is used to determine a grouping of the time interval
between observations, which should be based on scheduled observations. If
exact times to death were used in the grouping, then shorter intervals would
contain excess deaths, and the goodness-of-fit statistic would be biased.
</p>
<p>If <code>next.obstime</code> is unknown, it is multiply-imputed using a
product-limit estimate based on the intervals to observations other than
deaths. The resulting tables of transitions are averaged over these
imputations.  This may be slow.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>Number of imputations for the estimation of the distribution of the
next scheduled observation time, when there are exact death times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>indep.cens</code></td>
<td>
<p>If <code>TRUE</code>, then times to censoring are included in
the estimation of the distribution to the next scheduled observation time.
If <code>FALSE</code>, times to censoring are assumed to be systematically
different from other observation times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxtimes</code></td>
<td>
<p>A vector of length <code>x$data$n</code>, or a common scalar,
giving an upper bound for the next scheduled observation time.  Used in the
multiple imputation when times to death are known exactly.  If a value
greater than <code>maxtimes</code> is simulated, then the next scheduled
observation is taken as censored.  This should be supplied, if known.  If
not supplied, this is taken to be the maximum interval occurring in the
data, plus one time unit.  For observations which are not exact death times,
this should be the time since the previous observation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pval</code></td>
<td>
<p>Calculate a p-value using the improved approximation of Titman
(2009).  This is optional since it is not needed during bootstrapping, and
it is computationally non-trivial.  Only available currently for non-hidden
Markov models for panel data without exact death times.  Also not available
for models with censoring, including time-homogeneous models fitted with the
<code>pci</code> option to <code>msm</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This method (Aguirre-Hernandez and Farewell, 2002) is intended for data
which represent observations of the process at arbitrary times ("snapshots",
or "panel-observed" data). For data which represent the exact transition
times of the process, <code>prevalence.msm</code> can be used to assess
fit, though without a formal test.
</p>
<p>When times of death are known exactly, states are misclassified, or an
individual's final observation is a censored state, the modification by
Titman and Sharples (2008) is used. The only form of censoring supported is
a state at the end of an individual's series which represents an unknown
transient state (i.e. the individual is only known to be alive at this
time). Other types of censoring are omitted from the data before performing
the test.
</p>
<p>See the references for further details of the methods.  The method used for
censored states is a modification of the method in the appendix to Titman
and Sharples (2008), described at
<a href="https://chjackson.github.io/msm/misc/robustcensoring.pdf">https://chjackson.github.io/msm/misc/robustcensoring.pdf</a>
(Titman, 2007).
</p>
<p>Groupings of the time since initiation, the time interval and the impact of
covariates are based on equally-spaced quantiles.  The number of groups
should be chosen that there are not many cells with small expected numbers
of transitions, since the deviance statistic will be unstable for sparse
contingency tables.  Ideally, the expected numbers of transitions in each
cell of the table should be no less than about 5.  Conversely, the power of
the test is reduced if there are too few groups. Therefore, some sensitivity
analysis of the test results to the grouping is advisable.
</p>
<p>Saved model objects fitted with previous versions of R (versions less than
1.2) will need to be refitted under the current R for use with
<code>pearson.msm</code>.
</p>


<h3>Value</h3>

<p>A list whose first two elements are contingency tables of observed
transitions <code class="reqn">O</code> and expected transitions <code class="reqn">E</code>, respectively, for each
combination of groups.  The third element is a table of the deviances
<code class="reqn">(O - E)^2 / E</code> multiplied by the sign of <code class="reqn">O - E</code>.  If the expected
number of transitions is zero then the deviance is zero.  Entries in the
third matrix will be bigger in magnitude for groups for which the model fits
poorly.  <br></p>
<table>
<tr style="vertical-align: top;">
<td><code>list("\"test\"")</code></td>
<td>
<p>the fourth element of the list, is a data frame with
one row containing the Pearson-type goodness-of-fit test statistic
<code>stat</code>.  The test statistic is the sum of the deviances.  For
panel-observed data without exact death times, misclassification or censored
observations, <code>p</code> is the p-value for the test statistic calculated
using the improved approximation of Titman (2009).
</p>
<p>For these models, for comparison with older versions of the package,
<code>test</code> also presents <code>p.lower</code> and <code>p.upper</code>, which are
theoretical lower and upper limits for the p-value of the test statistic,
based on chi-squared distributions with
<code>df.lower</code> and <code>df.upper</code> degrees of freedom, respectively.
<code>df.upper</code> is the number of independent cells in the contingency table,
and <code>df.lower</code> is <code>df.upper</code> minus the number of estimated
parameters in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>list("\"intervalq\"")</code></td>
<td>
<p>(not printed by default) contains the
definition of the grouping of the intervals between observations.  These
groups are defined by quantiles within the groups corresponding to the time
since the start of the process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>list("\"sim\"")</code></td>
<td>
<p>If there are exact death times, this contains
simulations of the contingency tables and test statistics for each
imputation of the next scheduled sampling time.  These are averaged over to
produce the presented tables and test statistic. This element is not printed
by default.
</p>
<p>With exact death times, the null variance of the test statistic (formed by
taking mean of simulated test statistics) is less than twice the mean
(Titman, 2008), and the null distribution is not
chi-squared.  In this case, <code>p.upper</code> is an
upper limit for the true asymptotic p-value, but <code>p.lower</code> is not a
lower limit, and is not presented.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>list("\"boot\"")</code></td>
<td>
<p>If the bootstrap has been used, the element will
contain the bootstrap replicates of the test statistics (not printed by
default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>list("\"lambda\"")</code></td>
<td>
<p>If the Titman (2009) p-value has been calculated,
this contains the weights defining the null distribution of the test
statistic as a weighted sum of chi-squared(1)
random variables (not printed by default).</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Andrew Titman <a href="mailto:a.titman@lancaster.ac.uk">a.titman@lancaster.ac.uk</a>, Chris Jackson
<a href="mailto:chris.jackson@mrc-bsu.cam.ac.uk">chris.jackson@mrc-bsu.cam.ac.uk</a>
</p>


<h3>References</h3>

<p>Aguirre-Hernandez, R. and Farewell, V. (2002) A Pearson-type
goodness-of-fit test for stationary and time-continuous Markov regression
models. <em>Statistics in Medicine</em> 21:1899-1911.
</p>
<p>Titman, A. and Sharples, L. (2008) A general goodness-of-fit test for Markov
and hidden Markov models. <em>Statistics in Medicine</em> 27(12):2177-2195
</p>
<p>Titman, A. (2009) Computation of the asymptotic null distribution of
goodness-of-fit tests for multi-state models. <em>Lifetime Data Analysis</em>
15(4):519-533.
</p>
<p>Titman, A. (2008) Model diagnostics in multi-state models of biological
systems. PhD thesis, University of Cambridge.
</p>


<h3>See Also</h3>

<p><code>msm</code>, <code>prevalence.msm</code>,
<code>scoreresid.msm</code>,
</p>


<h3>Examples</h3>

<pre><code class="language-R">
psor.q &lt;- rbind(c(0,0.1,0,0),c(0,0,0.1,0),c(0,0,0,0.1),c(0,0,0,0))
psor.msm &lt;- msm(state ~ months, subject=ptnum, data=psor,
                qmatrix = psor.q, covariates = ~ollwsdrt+hieffusn,
                constraint = list(hieffusn=c(1,1,1),ollwsdrt=c(1,1,2)))
pearson.msm(psor.msm, timegroups=2, intervalgroups=2, covgroups=2)
# More 1-2, 1-3 and 1-4 observations than expected in shorter time
# intervals - the model fits poorly.
# A random effects model might accommodate such fast progressors.

</code></pre>


</div>