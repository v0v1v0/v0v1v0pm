<div class="container">

<table style="width: 100%;"><tr>
<td>survplot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plot and get survival data from a multi-state model</h2>

<h3>Description</h3>

<p>Plot the fitted survival probability computed over a <code>msm</code> model and
compare it with the Kaplan-Meier. Fast build and return the underlying data structures.
</p>


<h3>Usage</h3>

<pre><code class="language-R">survplot(
  x,
  from = 1,
  to = NULL,
  range = NULL,
  covariates = "mean",
  exacttimes = TRUE,
  times,
  grid = 100L,
  km = FALSE,
  out = c("none", "fitted", "km", "all"),
  ci = c("none", "normal", "bootstrap"),
  interp = c("start", "midpoint"),
  B = 100L,
  ci_km = c("none", "plain", "log", "log-log", "logit", "arcsin")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A <code>msm</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>from</code></td>
<td>
<p>State from which to compute the estimated survival.
Default to state 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to</code></td>
<td>
<p>The absorbing state to which compute the estimated survival.
Default to the highest state found by <code>absorbing.msm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>range</code></td>
<td>
<p>A numeric vector of two elements which gives the time range of
the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates</code></td>
<td>
<p>Covariate values for which to evaluate the expected
probabilities. These can either be: the string <code>"mean"</code>, denoting the
means of the covariates in the data (default), the number 0,
indicating that all the covariates should be set to zero, or a list of values,
with optional names. For example:<br><code>list (75, 1)</code><br>
where the order of the list follows the order of the covariates originally
given in the model formula, or a named list:<br><code>list (age = 75, gender = "M")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exacttimes</code></td>
<td>
<p>If <code>TRUE</code> (default) then transition times are known
and exact. This is inherited from <code>msm</code> and should be set the same way.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>times</code></td>
<td>
<p>An optional numeric vector giving the times at which to compute
the fitted survival.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grid</code></td>
<td>
<p>An integer specifying the grid points at which to compute the fitted
survival (see 'Details').
If <code>times</code> is passed, <code>grid</code> is ignored. Default to 100 points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>km</code></td>
<td>
<p>If <code>TRUE</code>, then the Kaplan-Meier curve is plotted. Default is
<code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>out</code></td>
<td>
<p>A character vector specifying what the function has to return. Accepted values are
<code>"none"</code> (default) to return just the plot, <code>"fitted"</code> to return the fitted survival
curve only, <code>"km"</code> to return the Kaplan-Meier only, <code>"all"</code> to return all of the above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci</code></td>
<td>
<p>A character vector with the type of confidence intervals to compute for the fitted
survival curve. Specify either <code>"none"</code> (default), for no confidence intervals,
<code>"normal"</code> or <code>"bootstrap"</code>, for confidence intervals computed with the respective
method in <code>pmatrix.msm</code>. This is very computationally-intensive,
since intervals must be computed at a series of times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interp</code></td>
<td>
<p>If <code>"start"</code> (default), then the entry time into the
absorbing state is assumed to be the time it is first observed in the data.
If <code>"midpoint"</code>, then the entry time into the absorbing state is assumed
to be halfway between the time it is first observed and the previous
observation time. This is generally more reasonable for "progressive"
models with observations at arbitrary times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>Number of bootstrap or normal replicates for the confidence interval.
The default is 100 rather than the usual 1000, since these plots are for
rough diagnostic purposes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci_km</code></td>
<td>
<p>A character vector with the type of confidence intervals to compute for the
Kaplan-Meier curve. Specify either <code>"none"</code>, <code>"plain"</code>, <code>"log"</code>, <code>"log-log"</code>,
<code>"logit"</code>, or <code>"arcsin"</code>, as coded in <code>survfit</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function is a wrapper of <code>plot.survfit.msm</code>
and does more things. <code>survplot</code> manages correctly the plot of a fitted
survival in an exact times framework (when <code>exacttimes = TRUE</code>) by just
resetting the time scale and looking at the follow-up time. It can quickly
build and return to the user the data structures used to compute the Kaplan-Meier
and the fitted survival probability by specifying <code>out = "all"</code>.
</p>
<p>The user can defined custom times (through <code>times</code>) or let
<code>survplot</code> choose them on its own (through <code>grid</code>).
In the latter case, <code>survplot</code> looks for the follow-up time and divides
it by <code>grid</code>. The higher it is, the finer the grid will be so that computing
the fitted survival will take longer, but will be more precise.
</p>


<h3>Value</h3>

<p>When <code>out = "none"</code>, a <code>gg/ggplot</code> object is returned. If <code>out</code> is anything
else, then a named list is returned. The Kaplan-Meier data can be accessed with <code>$km</code> while
the estimated survival data with <code>$fitted</code>. If <code>out = "all"</code>, the plot, the Kaplan-Meier
and the estimated curve are returned.
</p>


<h3>Author(s)</h3>

<p>Francesco Grossetti <a href="mailto:francesco.grossetti@unibocconi.it">francesco.grossetti@unibocconi.it</a>.
</p>


<h3>References</h3>

<p>Titman, A. and Sharples, L.D. (2010). Model diagnostics for
multi-state models, <em>Statistical Methods in Medical Research</em>, 19,
621-651.<br></p>
<p>Titman, A. and Sharples, L.D. (2008). A general goodness-of-fit test for
Markov and hidden Markov models, <em>Statistics in Medicine</em>, 27,
2177-2195. <br></p>
<p>Jackson, C.H. (2011). Multi-State Models for Panel Data:<br>
The <em>msm</em> Package for R. Journal of Statistical Software, 38(8), 1-29.<br>
URL <a href="https://www.jstatsoft.org/v38/i08/">https://www.jstatsoft.org/v38/i08/</a>.
</p>


<h3>See Also</h3>

<p><code>plot.survfit.msm</code> <code>msm</code>,
<code>pmatrix.msm</code>, <code>setDF</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
data( hosp )

# augmenting the data
hosp_augmented = augment( data = hosp, data_key = subj, n_events = adm_number,
                          pattern = label_3, t_start = dateIN, t_end = dateOUT,
                          t_cens = dateCENS )

# let's define the initial transition matrix for our model
Qmat = matrix( data = 0, nrow = 3, ncol = 3, byrow = TRUE )
Qmat[ 1, 1:3 ] = 1
Qmat[ 2, 1:3 ] = 1
colnames( Qmat ) = c( 'IN', 'OUT', 'DEAD' )
rownames( Qmat ) = c( 'IN', 'OUT', 'DEAD' )

# attaching the msm package and running the model using
# gender and age as covariates
library( msm )
msm_model = msm( status_num ~ augmented_int, subject = subj,
                 data = hosp_augmented, covariates = ~ gender + age,
                 exacttimes = TRUE, gen.inits = TRUE, qmatrix = Qmat,
                 method = 'BFGS', control = list( fnscale = 6e+05, trace = 0,
                 REPORT = 1, maxit = 10000 ) )

# plotting the fitted and empirical survival from state = 1
theplot = survplot( x = msm_model, km = TRUE )

# plotting the fitted and empirical survival from state = 2 and
and returning both the fitted and the empirical curve
out_all = survplot( msm_model, from = 2, km = TRUE, out = "all" )


## End(Not run)

</code></pre>


</div>