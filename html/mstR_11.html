<div class="container">

<table style="width: 100%;"><tr>
<td>nextModule</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Selection of the next module in MST</h2>

<h3>Description</h3>

<p>This command selects the next module to be administered in the multistage test, either bases on IRT scoring or on test score and by either providing thresholds or optimally selecting the next module. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">nextModule(itemBank, modules, transMatrix, model = NULL, current.module,
   out, x = NULL, cutoff = NULL, theta = 0, criterion = "MFI",
   priorDist = "norm", priorPar = c(0, 1), D = 1, range = c(-4, 4), 
   parInt = c(-4, 4, 33), randomesque = 1, random.seed = NULL)
 </code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>itemBank</code></td>
<td>
<p>a suitable matrix of item parameters. See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modules</code></td>
<td>
<p>a binary matrix that specifies the item membership to the modules. See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transMatrix</code></td>
<td>
<p>a binary squared matrix representing the structure of the MST and the transitions between the moduels and the stages. See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>either <code>NULL</code> (default) for dichotomous models, or any suitable acronym for polytomous models. Possible values are <code>"GRM"</code>, <code>"MGRM"</code>, <code>"PCM"</code>, <code>"GPCM"</code>, <code>"RSM"</code> and <code>"NRM"</code>. See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>current.module</code></td>
<td>
<p>integer: the module number (defined as the corresponding column number in the <code>modules</code> matrix) that indicates the last administered module.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>out</code></td>
<td>
<p>numeric: the vector of item indicators (defined as the row numbers in the <code>itemBank</code> matrix) of previously administered items.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>either a numeric vector of responses to previously administered items or <code>NULL</code> (default). Ignored if <code>criterion</code> is either <code>MFI</code> or <code>random</code>. See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p>either a suitable matrix of cut-off values or <code>NULL</code> (default). See <code>Details</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>numeric: the current ability level for selecting the next module (default is 0). It can also hold the current test score made of the sum of responses to all administered items (when <code>cutoff</code> is provided). See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>criterion</code></td>
<td>
<p>character: the method for next item selection. Possible values are <code>"MFI"</code> (default), <code>"MLWMI"</code>, <code>"MPWMI"</code>, <code>"MKL"</code>, <code>"MKLP"</code> and <code>"random"</code>. Ignored if <code>cutoff</code> is not <code>NULL</code>. See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorDist</code></td>
<td>
<p>character: the prior ability distribution. Possible values are <code>"norm"</code> (default) for the normal distribution, and <code>"unif"</code> for the uniform distribution. Ignored if <code>criterion</code> is neither <code>"MPWMI"</code> nor <code>"KLP"</code>, or if <code>cutoff</code> is not <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorPar</code></td>
<td>
<p>numeric: a vector of two components with the prior parameters. If <code>priorDist</code> is <code>"norm"</code>, then <code>priorPar</code> contains the mean and the standard deviation of the normal distribution. If <code>priorDist</code> is <code>"unif"</code>, then <code>priorPar</code> contains the bounds of the uniform distribution. The default values are 0 and 1 respectively. Ignored if <code>criterion</code> is neither <code>"MPWI"</code> nor <code>"KLP"</code>, or if <code>cutoff</code> is not <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D</code></td>
<td>
<p>numeric: the metric constant. Default is <code>D=1</code> (for logistic metric); <code>D=1.702</code> yields approximately the normal metric (Haley, 1952).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>range</code></td>
<td>
<p>numeric: vector of two components specifying the range wherein the ability estimate must be looked for (default is <code>c(-4,4)</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parInt</code></td>
<td>
<p>numeric: a vector of three numeric values, specifying respectively the lower bound, the upper bound and the number of quadrature points for numerical integration (default is <code>c(-4,4,33)</code>). Ignored if <code>method</code> is neither <code>"MLWMI"</code>, <code>"MPWMI"</code>, <code>"KL"</code>, nor <code>"KLP"</code>, or if <code>cutoff</code> is not <code>NULL</code>. See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>randomesque</code></td>
<td>
<p>numeric: a probability value to select the optimal module. Default is one so optimal module is always chosen. See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.seed</code></td>
<td>
<p>either <code>NULL</code> (default) or a numeric value to fix the random seed of randomesque selection of the module. Ignored if <code>randomesque</code> is equal to one.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function permits to select the next module of the MST. It works with both dichotomous and polytomous item banks.
</p>
<p>Dichotomous IRT models are considered whenever <code>model</code> is set to <code>NULL</code> (default value). In this case, <code>it</code> must be a matrix with one row per item and four columns, with the values of the discrimination, the difficulty, the pseudo-guessing and the inattention parameters (in this order). These are the parameters of the four-parameter logistic (4PL) model
(Barton and Lord, 1981). 
</p>
<p>Polytomous IRT models are specified by their respective acronym: <code>"GRM"</code> for Graded Response Model, <code>"MGRM"</code> for Modified Graded Response Model, <code>"PCM"</code> for Partical Credit Model, <code>"GPCM"</code> for Generalized Partial Credit Model, <code>"RSM"</code> for Rating Scale Model and <code>"NRM"</code> for Nominal Response Model. The <code>it</code> still holds one row per item, end the number of columns and their content depends on the model. See <code>genPolyMatrix</code> for further information and illustrative examples of suitable polytomous item banks.
</p>
<p>The <code>modules</code> argument must be a binary 0/1 matrix with as many rows as the item bank <code>itemBank</code> and as many columns as the number of modules. Values of 1 indicate to which module(s) the items belong to, i.e. a value of 1 on row <em>i</em> and column <em>j</em> means that the <em>i</em>-th item belongs to the <em>j</em>-th module.
</p>
<p>The <code>transMatrix</code> argument must be a binary 0/1 square matrix with as many rows (and columns) as the number of modules. All values of 1 indicate the possible transitions from one module to another, i.e. a value of 1 on row <em>i</em> and column <em>j</em> means that the MST can move from <em>i</em>-th module to <em>j</em>-th module.
</p>
<p>The two main approaches to select the next module are based on cut-off scores (to be provided) or by optimal module selection.
</p>
<p>Optimal module selection is performed by providing an appropriate value to the <code>criterion</code> argument. Possible methods are: 
</p>

<ol>
<li>
<p><code>"MFI"</code> for maximum Fisher information(default);
</p>
</li>
<li>
<p><code>"MLWMI"</code> for maximum likelihood weighted module information;
</p>
</li>
<li>
<p><code>"MPWMI"</code> for maximum posterior weighted module information;
</p>
</li>
<li>
<p><code>"MKL"</code> for module Kullabck-Leibler selection;
</p>
</li>
<li>
<p><code>"MKLP"</code> for module posterior Kullabck-Leibler selection;
</p>
</li>
<li>
<p><code>"random"</code> for random selection.
</p>
</li>
</ol>
<p>See <code>MWMI</code> and <code>MKL</code> for further details.
</p>
<p>In case of selection by predefined cut-off scores, the <code>cutoff</code> argument must be supplied by a matrix with as many rows as the number of thresholds between pairs of modules, and with three columns. Each row of the <code>cutoff</code> matrix holds first the two module indicators (i.e., their column number in the <code>modules</code> matrix) and then the threshold. For instance, the row <code>c(3, 4, 1)</code> indicates that the selection threshold between modules 3 and 4 is 1. Thus, if the next module must be chosen between modules 3 and 4, the module 3 is selected if the score is <em>strictly smaller</em> than 1, and module 4 is chosen if the score is gretar than or equal to 1.
</p>
<p>This allows the selection among multiple modules within a stage as follows. Let modules 5 to 7 be the allowed moduels for selection, and set -1 and 1 as thresholds to distinguish between modules 5 and 6 and modules 6 and 7. By this way, module 5 is chosen if the score is strictly smaller than -1, module 7 if the score is larger than (or equal to) 1, and module 6 otherwise. This design is simply modeled through the <code>cutoff</code> matrix by including the rows <code>c(5, 6, -1)</code> nd <code>c(6, 7, 1)</code>. Note that the order of the rows in the <code>cutoff</code> matrix is irrelevant. Moreover, integer cut-off scores (when <code>theta</code> is the test score) or numeric values (when <code>theta</code> is an ability estimate) are allowed in the <code>cutoff</code> matrix.
</p>
<p>By default <code>cutoff</code> is <code>NULL</code> and optimal module selection is performed). 
</p>
<p>Whatever the method for next module selection (by optimal criterion or via cut-off scores), the <code>randomesque</code> argument allows for selecting a module that is not the optimal one. This argument takes a probability value (i.e., between zero and one) that sets the probability that the optimal module is eventually selected. All other elligible modules from the stage will be randomly chosen with a probability equal to (1-<code>randomesque</code>)/<code class="reqn">K-1</code> where <code class="reqn">K</code> is he number of elligible modules in the stage (including the optimal one). This allows for module overexposure control. The <code>random.seed</code> argument permits ot fix the seed for random selection. 
</p>


<h3>Value</h3>

<p>A list with six arguments:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>module</code></td>
<td>
<p>the selected module (identified by its column number in the <code>modules</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>items</code></td>
<td>
<p>the items that belong to the selected module (identified by their number in the item bank).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par</code></td>
<td>
<p>the matrix of item parameters of the selected items (one row per item).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>info</code></td>
<td>
<p>either the provisional ability level or score when <code>cutoff</code> is not <code>NULL</code>; or <code>NA</code> when random selection is performed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>criterion</code></td>
<td>
<p>the value of the <code>criterion</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>best.module</code></td>
<td>
<p>logical value indicating whether the optimal module was eventually returned or not.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>David Magis <br>
Department of Psychology, University of Liege, Belgium <br><a href="mailto:david.magis@uliege.be">david.magis@uliege.be</a>
</p>


<h3>References</h3>

<p>Barton, M.A., and Lord, F.M. (1981). <em>An upper asymptote for the three-parameter logistic item-response model</em>. Research Bulletin 81-20. Princeton, NJ: Educational Testing Service.
</p>
<p>Haley, D.C. (1952). <em>Estimation of the dosage mortality relationship when the dose is subject to error.</em> 
Technical report no 15. Palo Alto, CA: Applied Mathematics and Statistics Laboratory, Stanford University. 
</p>


<h3>See Also</h3>

<p><code>genPolyMatrix</code>, <code>MWMI</code>, <code>MKL</code> 
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Dichotomous models ##

 # Generation of an item bank under 2PL, made of 7 successive modules that target
 # different average ability levels and with different lengths
 # (the first generated item parameters hold two modules of 8 items each)
 it &lt;- rbind(genDichoMatrix(16, model = "2PL"),
             genDichoMatrix(6, model = "2PL", bPrior = c("norm", -1, 1)),
             genDichoMatrix(6, model = "2PL", bPrior = c("norm", 1, 1)),
             genDichoMatrix(9, model = "2PL", bPrior = c("norm", -2, 1)),
             genDichoMatrix(9, model = "2PL", bPrior = c("norm", 0, 1)),
             genDichoMatrix(9, model = "2PL", bPrior = c("norm", 2, 1)))
 it &lt;- as.matrix(it)

 # Creation of the 'modules' matrix to list item membership in each module
 modules &lt;- matrix(0, 55, 7)
 modules[1:8, 1] &lt;- modules[9:16, 2] &lt;- modules[17:22, 3] &lt;- 1
 modules[23:28, 4] &lt;- modules[29:37, 5] &lt;- modules[38:46, 6] &lt;- 1
 modules[47:55, 7] &lt;- 1

 # Creation of the transition matrix to define a 1-2-3 MST
trans &lt;- matrix(0, 7, 7)
trans[1, 3:4] &lt;- trans[2, 3:4] &lt;- trans[3, 5:7] &lt;- trans[4, 5:7] &lt;- 1

 # Module 1 previously administered, provisional ability 0, MFI criterion
 nextModule(it, modules, trans, current.module = 1, out = 1:8)

 # Generation of item responses for module 1
 x &lt;- genPattern(0, it[1:8,])

 # MLWMI criterion 
 nextModule(it, modules, trans, current.module = 1, out = 1:8, x = x, criterion = "MLWMI")

 # MPWMI criterion
 nextModule(it, modules, trans, current.module = 1, out = 1:8, x = x, criterion = "MPWMI")

 # MKL criterion
 nextModule(it, modules, trans, current.module = 1, out = 1:8, x = x, criterion = "MKL")

 # MKLP criterion
 nextModule(it, modules, trans, current.module = 1, out = 1:8, x = x, criterion = "MKLP")

 # Creation of cut-off scores for ability levels: cut score 0 between modules 3 and 4
 # and cut scores -1 and 1 between modules 5, 6 and 7
 cut &lt;- rbind(c(3, 4, 0), c(5, 6, -1), c(6, 7, 1))

 # Selection by cut-off score, module 1 previously administered, current ability level 0 
 # (=&gt; module 4 is chosen)
 nextModule(it, modules, trans, current.module = 1, out = 1:8, cutoff = cut, theta = 0)

 # Same with current ability level -0.5 (=&gt; module 3 is chosen)
 nextModule(it, modules, trans, current.module = 1, out = 1:8, cutoff = cut, theta = -0.5)

 # Modules 1 and 3 previously administered, current ability level 0 (=&gt; module 6 is chosen)
 nextModule(it, modules, trans, current.module = 3, out = c(1:8, 17:22), cutoff = cut,  
           theta = 0)

 # Same with current ability level 2 (=&gt; module 7 is chosen)
 nextModule(it, modules, trans, current.module = 3, out = c(1:8, 17:22), cutoff = cut, 
           theta = 2)

 # Ranomesque probability 0.5 and random.seed value 2 (=&gt; module 6 is chosen)
 nextModule(it, modules, trans, current.module = 3, out = c(1:8, 17:22), cutoff = cut, 
           theta = 2, randomesque = 0.5, random.seed = 2)

 # Creation of cut-off scores for test scores: cut score 4 between modules 3 and 4
 # and cut scores 5 and 9 between modules 5, 6 and 7
 cut.score &lt;- rbind(c(3, 4, 4), c(5, 6, 5), c(6, 7, 9))

 # Module 1 previously administered, current test score 1 (=&gt; module 3 is chosen)
 nextModule(it, modules, trans, current.module = 1, out = 1:8, cutoff = cut.score, 
           theta = 1)

 # Modules 1 and 3 previously administered, current tes score 6 (=&gt; module 6 is chosen)
 nextModule(it, modules, trans, current.module = 3, out = c(1:8, 17:22), cutoff = cut.score, 
           theta = 6)


## Polytomous models ##

 # Same structure as above but parameters are now generated from PCM with at most
 # 4 categories
 it.pol &lt;- genPolyMatrix(55, model = "PCM", nrCat = 4)
 it.pol &lt;- as.matrix(it)

 # Module 1 previously administered, provisional ability 0, MFI criterion
 nextModule(it.pol, modules, trans, model = "PCM", current.module = 1, out = 1:8)

 # MLWMI criterion 
 nextModule(it.pol, modules, trans, model = "PCM", current.module = 1, out = 1:8, x = x, 
           criterion = "MLWMI")

# MKL criterion 
 nextModule(it.pol, modules, trans, model = "PCM", current.module = 1, out = 1:8, x = x, 
           criterion = "MKL")

# MKLP criterion 
 nextModule(it.pol, modules, trans, model = "PCM", current.module = 1, out = 1:8, x = x, 
           criterion = "MKLP")

# Selection by cut-off score, module 1 previously administered, current ability level 0 
 # (=&gt; module 4 is chosen)
 nextModule(it.pol, modules, trans, model = "PCM", current.module = 1, out = 1:8, 
           cutoff = cut, theta = 0)
  </code></pre>


</div>