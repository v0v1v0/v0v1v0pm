<div class="container">

<table style="width: 100%;"><tr>
<td>MarkovTest</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Log-rank based test for the validity of the Markov assumption</h2>

<h3>Description</h3>

<p>Log-rank based test for the validity of the Markov assumption
</p>


<h3>Usage</h3>

<pre><code class="language-R">MarkovTest(
  data,
  id,
  formula = NULL,
  transition,
  grid,
  B = 1000,
  fn = list(function(x) mean(abs(x), na.rm = TRUE)),
  fn2 = list(function(x) mean(x, na.rm = TRUE)),
  min_time = 0,
  other_weights = NULL,
  dist = c("poisson", "normal")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Multi-state data in <code>msdata</code> format. Should also contain
(dummy codings of) the relevant covariates; no factors allowed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>Column name in <code>data</code> containing subject id</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Right-hand side of the formula. If NULL will fit with no
covariates (formula="1" will also work), offset terms can also be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transition</code></td>
<td>
<p>Transition number of the transition to be tested (in the
transition matrix as attribute to <code>data</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grid</code></td>
<td>
<p>Grid of time points at which to compute the statistic</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>Number of wild bootstrap replications to perform</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fn</code></td>
<td>
<p>A list of summary functions to be applied to the individual zbar
traces (or a list of lists)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fn2</code></td>
<td>
<p>A list of summary functions to be applied to the overall
chi-squared trace</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_time</code></td>
<td>
<p>The minimum time for calculating optimal weights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>other_weights</code></td>
<td>
<p>Other (than optimal) weights can be specified here</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>Distribution of wild bootstrap random weights, either "poisson"
for centred Poisson (default), or "normal" for standard normal</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Function MarkovTest performs the log-rank test described in Titman &amp; Putter
(2020). Function optimal_weights_matrix implements the optimal weighting for
the state-specific trace. Function optimal_weights_multiple implements the
optimal weighting for the chi-squared trace.
</p>


<h3>Value</h3>

<p>MarkovTest returns an object of class "MarkovTest", which is a list
with the following items: </p>
<table>
<tr style="vertical-align: top;">
<td><code>orig_stat</code></td>
<td>
<p>Summary statistic for each of the
starting states</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>orig_ch_stat</code></td>
<td>
<p>Overall chi-squared summary statistic</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_stat_wb</code></td>
<td>
<p>P-values corresponding to each of the summary statistics
for each starting state</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_ch_stat_wb</code></td>
<td>
<p>P-values for overall
chi-squared summary statistic</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b_stat_wb</code></td>
<td>
<p>Bootstrap summary statistics
for each of the starting states</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zbar</code></td>
<td>
<p>Individual traces for each of
the starting states</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nobs_grid</code></td>
<td>
<p>The number of events after time s for
each s in the grid</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Nsub</code></td>
<td>
<p>Number of patients who are ever at risk of
the transition of interest</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est_quant</code></td>
<td>
<p>Pointwise 2.5 and 97.5 quantile
limits for each of the traces</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs_chisq_trace</code></td>
<td>
<p>Trace of the
chi-squared statistic</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nch_wb_trace</code></td>
<td>
<p>Individual values of the
chi-squared statistic trace for the wild bootstrap samples</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_wb_trace</code></td>
<td>
<p>Individual values of the log-rank z statistic traces for
the wild bootstrap samples</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>est_cov</code></td>
<td>
<p>Estimated covariance matrix
between the log-rank statistics at each grid point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transition</code></td>
<td>
<p>The
transition number tested</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>from</code></td>
<td>
<p>The from state of the transition
tested</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to</code></td>
<td>
<p>The to state of the transition tested</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>The number
of wild bootstrap replications</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>The distribution used in the
wild bootstrap</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qualset</code></td>
<td>
<p>Set of qualifying states corresponding to the
components of the above traces</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coxfit</code></td>
<td>
<p>Fitted coxph object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fn</code></td>
<td>
<p>List of functions applied to state-specific trace</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fn2</code></td>
<td>
<p>List
of functions applied to overall trace</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Andrew Titman <a href="mailto:a.titman@lancaster.ac.uk">a.titman@lancaster.ac.uk</a>, transported to
mstate by Hein Putter <a href="mailto:H.Putter@lumc.nl">H.Putter@lumc.nl</a>
</p>


<h3>References</h3>

<p>Titman AC, Putter H (2020). General tests of the Markov property
in multi-state models. <em>Biostatistics</em> To appear.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 
# Example provided by the prothrombin data
data("prothr")
# Apply Markov test to grid of monthly time points over the first 7.5 years
year &lt;- 365.25
month &lt;- year / 12
grid &lt;- month * (1 : 90)
# Markov test for transition 1 (wild bootstrap based on 25 replications, 1000 recommended)
MT &lt;- MarkovTest(prothr, id = "id", transition = 1,
                 grid = grid, B = 25)

# Plot traces
plot(MT, grid, what="states", idx=1:10, states=rownames(attr(prothr, "trans")),
     xlab="Days since randomisation", ylab="Log-rank test statistic",
     main="Transition Normal -&gt; Low")
plot(MT, grid,what="overall", idx=1:10,
     xlab="Days since randomisation", ylab="Chi-square test statistic",
     main="Transition Normal -&gt; Low")

# Example using optimal weights and adjustment for covariates
oweights_fun &lt;-
  optimal_weights_matrix(prothr, id = "id", grid=grid, transition = 1,
                         other_weights=list(
                           function(x) mean(abs(x),na.rm=TRUE),
                           function(x) max(abs(x),na.rm=TRUE)))

oweights_chi &lt;- optimal_weights_multiple(prothr, id = "id", grid=grid, transition = 1)

# Formula in MarkovTest only works for continuous covariates and dummy coded variables
# No factors allowed
prothr$prednisone &lt;- as.numeric(prothr$treat == "Prednisone")
MT &lt;- MarkovTest(prothr, id = "id", 
                 formula = "prednisone",
                 transition = 1,
                 grid = grid, B = 25,
                 fn = oweights_fun,
                 fn2 = list(
                   function(x) weighted.mean(x, w=oweights_chi, na.rm=TRUE),
                   function(x) mean(x, na.rm=TRUE),
                   function(x) max(x, na.rm=TRUE)))

## End(Not run)

</code></pre>


</div>