<div class="container">

<table style="width: 100%;"><tr>
<td>multiFAMM</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Multivariate Functional Additive Mixed Model Regression</h2>

<h3>Description</h3>

<p>This is the main function of the package and fits the multivariate functional
additive regression model with potentially nested or crossed functional
random intercepts.
</p>


<h3>Usage</h3>

<pre><code class="language-R">multiFAMM(data, fRI_B = FALSE, fRI_C = FALSE, nested = FALSE,
  bs = "ps", bf_mean = 8, bf_covariates = 8, m_mean = c(2, 3),
  covariate = FALSE, num_covariates = NULL, covariate_form = NULL,
  interaction = FALSE, which_interaction = matrix(NA), bf_covs, m_covs,
  var_level = 1, use_famm = FALSE, save_model_famm = FALSE,
  one_dim = NULL, mfpc_weight = FALSE, mfpc_cutoff = 0.95,
  number_mfpc = NULL, mfpc_cut_method = c("total_var", "unidim"),
  final_method = c("w_bam", "bam", "gaulss"), weight_refit = FALSE,
  verbose = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data.table that contains the information with some fixed variable
names, see Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fRI_B</code></td>
<td>
<p>Boolean for including functional random intercept for individual
(B in Cederbaum). Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fRI_C</code></td>
<td>
<p>Boolean for including functional random intercept
for word (C in Cederbaum). Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nested</code></td>
<td>
<p><code>TRUE</code> to specify a model with nested functional random
intercepts for the first and second grouping variable and a smooth error
curve. Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bs</code></td>
<td>
<p>Spline basis function, only tested for "ps" (as in sparseFLMM).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bf_mean</code></td>
<td>
<p>Basis dimension for functional intercept (as in sparseFLMM).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bf_covariates</code></td>
<td>
<p>Basis dimension for all covariates (as in sparseFLMM).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m_mean</code></td>
<td>
<p>Order of penalty for basis function (as in sparseFLMM).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariate</code></td>
<td>
<p>Covariate effects (as in sparseFLMM).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_covariates</code></td>
<td>
<p>Number of covariates included in the model (as in
sparseFLMM).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariate_form</code></td>
<td>
<p>Vector of strings for type of covariate (as in
sparseFLMM).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interaction</code></td>
<td>
<p>TRUE if there are interactions between covariates (as in
sparseFLMM). Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>which_interaction</code></td>
<td>
<p>Symmetric matrix specifying the interaction terms
(as in sparseFLMM).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bf_covs</code></td>
<td>
<p>Vector of marginal basis dimensions for fRI covariance
estimation (as in sparseFLMM).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m_covs</code></td>
<td>
<p>List of marginal orders for the penalty in fRI covariance
estimation (as in sparseFLMM).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var_level</code></td>
<td>
<p>Pre-specified level of explained variance on each
dimension (as in sparseFLMM). Defaults to including all non-negative
Eigenvalues.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_famm</code></td>
<td>
<p>Re-estimate the mean in FAMM context (as in sparseFLMM) -
overwritten by one_dim.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save_model_famm</code></td>
<td>
<p>Give out the FAMM model object (as in sparseFLMM) -
overwritten by one_dim.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>one_dim</code></td>
<td>
<p>Specify the name of the dimension if sparseFLMM is to be
computed only on one dimension.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mfpc_weight</code></td>
<td>
<p>TRUE if the estimated univariate error variance is to be
used as weights in the scalar product of the MFPCA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mfpc_cutoff</code></td>
<td>
<p>Pre-specified level of explained variance of results of
MFPCA. Defaults to 0.95.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>number_mfpc</code></td>
<td>
<p>List containing the number of mfPCs needed for each
variance component e.g. list("E" = x, "B" = y).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mfpc_cut_method</code></td>
<td>
<p>Method to determine the level of explained variance
</p>

<ul>
<li>
<p> total_var: (weighted) sum of variation over the dimensions.
</p>
</li>
<li>
<p> unidim: separate on each dimension.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>final_method</code></td>
<td>
<p>Function used for estimation of final model to allow for
potential heteroscedasticity ("w_bam", "bam", "gaulss").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight_refit</code></td>
<td>
<p>Get the weights for the weighted bam by first refitting
the model under an independence assumption but with mfpc basis functions.
Defaults to FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Print progress of the multifamm. Defaults to TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to be passed to (mainly) the underlying
sparseFLMM function.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Expand the method proposed by Fabian Scheipl to incorporate the variance
decomposition developed by Cederbaum et al. (2016). To account for the
correlation between the dimensions, the MFPCA approach by Happ and Greven
(2016) is applied.
</p>
<p>The data set has to be of the following format:
</p>

<ul>
<li>
<p> y_vec (numeric): vector of response values
</p>
</li>
<li>
<p> t (numeric): observation point locations
</p>
</li>
<li>
<p> n_long (integer): curve identification
</p>
</li>
<li>
<p> subject_long (integer): subject identification (NEEDS TO BE
SPECIFIED)
</p>
</li>
<li>
<p> word_long (integer): word identification
</p>
</li>
<li>
<p> combi_long (integer): repetition
</p>
</li>
<li>
<p> dim (factor): level of the dimension
</p>
</li>
<li>
<p> covariate.1 (numeric): potential covariate(s) named with trailing
1,2,3,...
</p>
</li>
</ul>
<p>It is possible to introduce weights for the final estimation of the
multiFAMM. Currently, it is only implemented to use the inverse of the
univariate measurement error estimates as weights. Note that negative
values of variance estimates are set to zero in fast symmetric additive
covariance smoothing. In order to still include weights, zero-values are
substituted by values of the smallest positive variance estimate.
</p>


<h3>Value</h3>

<p>A list with five elements
</p>

<ul>
<li>
<p> the final multivariate FAMM
</p>
</li>
<li>
<p> the sparseFLMM output for each of the dimensions
</p>
</li>
<li>
<p> information on the untruncated MPFCA results
</p>
</li>
<li>
<p> the truncated MFPC output
</p>
</li>
<li>
<p> the data used to fit the model.</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">
# subset of the phonetic data (very small subset, no meaningful results can
# be expected and no random effects other than the random smooth should be
# included in the model)

data(phonetic_subset)

m &lt;- multiFAMM(data = phonetic_subset, covariate = TRUE, num_covariates = 2,
               covariate_form = c("by", "by"), interaction = TRUE,
               which_interaction = matrix(c(FALSE, TRUE, TRUE, FALSE),
               nrow = 2, ncol = 2), bf_covs = c(5), m_covs = list(c(2, 3)),
               mfpc_cut_method = "total_var", final_method = "w_bam")

</code></pre>


</div>