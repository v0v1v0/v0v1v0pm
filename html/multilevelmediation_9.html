<div class="container">

<table style="width: 100%;"><tr>
<td>modmed.mlm.brms</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Custom model fitting function for a 1-1-1 (moderated) mediation for the brms code</h2>

<h3>Description</h3>

<p>Custom model fitting function for a 1-1-1 (moderated) mediation for the brms code
</p>


<h3>Usage</h3>

<pre><code class="language-R">modmed.mlm.brms(
  data,
  L2ID,
  X,
  Y,
  M,
  moderator = NULL,
  mod.a = FALSE,
  mod.b = FALSE,
  mod.cprime = FALSE,
  covars.m = NULL,
  covars.y = NULL,
  random.a = FALSE,
  random.b = FALSE,
  random.cprime = FALSE,
  random.mod.a = FALSE,
  random.mod.b = FALSE,
  random.mod.cprime = FALSE,
  random.mod.m = FALSE,
  random.mod.y = FALSE,
  random.covars.m = NULL,
  random.covars.y = NULL,
  returndata = FALSE,
  family = gaussian,
  iter = 7000,
  control = list(adapt_delta = 0.95),
  chains = 4,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data frame in long format.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>L2ID</code></td>
<td>
<p>(Character) Name of column that contains grouping variable in <code>data</code> (e.g., <code>"SubjectID"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>(Character) Name of column that contains the X independent variable in <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>(Character) Name of column that contains the Y dependent variable in <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M</code></td>
<td>
<p>(Character) Name of column that contains the M mediating variable in <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>moderator</code></td>
<td>
<p>Optional Character that contains name of column that contains the moderator variable in <code>data</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mod.a</code></td>
<td>
<p>(Logical) Add moderator to 'a' path (i.e., SmX:W, where W is the moderator)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mod.b</code></td>
<td>
<p>(Logical) Add moderator to 'b' path (i.e., SyM:W, where W is the moderator)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mod.cprime</code></td>
<td>
<p>(Logical) Add moderator to 'c' path (i.e., SyX:W, where W is the moderator)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covars.m</code></td>
<td>
<p>(Character vector) Optional covariates to include in the model for M. (not yet implemented for brms)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covars.y</code></td>
<td>
<p>(Character vector) Optional covariates to include in the model for Y. (not yet implemented for brms)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.a</code></td>
<td>
<p>(Logical) Add random slope for 'a' path (i.e,. SmX)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.b</code></td>
<td>
<p>(Logical) Add random slope for 'b' path (i.e., SyM)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.cprime</code></td>
<td>
<p>(Logical) Add random slope for 'cprime' direct effect path (i.e., SyX)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.mod.a</code></td>
<td>
<p>(Logical) Add random slope for 'a' path moderator?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.mod.b</code></td>
<td>
<p>(Logical) Add random slope for 'b' path moderator?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.mod.cprime</code></td>
<td>
<p>(Logical) Add random slope for 'c' path moderator?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.mod.m</code></td>
<td>
<p>(Logical) Add random slope for effect of moderator on M?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.mod.y</code></td>
<td>
<p>(Logical) Add random slope for effect of moderator on Y?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.covars.m</code></td>
<td>
<p>(Logical vector) Add random slopes for covariates on M? (not yet implemented for brms)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.covars.y</code></td>
<td>
<p>(Logical vector) Add random slopes for covariates on Y? (not yet implemented for brms)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returndata</code></td>
<td>
<p>(Logical) Whether to save restructured data in its own slot. Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>Argument passed to <code>brm</code> A character string naming the distribution of the response variable to be used in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>
<p>Argument passed to <code>brm</code> Number of total iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>Argument passed to <code>brm</code> To decrease (or eliminate at best) the number of divergent transitions that cause a bias in the obtained posterior samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chains</code></td>
<td>
<p>Argument passed to <code>brm</code> Set the number of chains</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to pass to <code>brm</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Implements custom function to do (moderated) mediation with two-level multilevel models
with Bayesian estimation via the <code>brms</code> package. Does not handle covariates at the moment.
Bayesian estimation using <code>brms</code> was studied by Falk, Vogel, Hammami &amp; Miočević (in press). It is
suggested if you use this function that you also do <code>cite("brms")</code> to figure out how to cite that package.
</p>


<h3>Value</h3>

<p>A list with the following elements:
</p>

<ul>
<li>
<p><code>model</code> The fitted model from <code>brm</code>. Use as you would a fitted model from that package.
</p>
</li>
<li>
<p><code>args</code> Arguments used to call the function. Useful for later automating extraction of the indirect
effect or other quantities.
</p>
</li>
<li>
<p><code>conv</code> Whether <code>brm</code> finished estimation, not diagnostic of convergence.
</p>
</li>
</ul>
<h3>References</h3>

<p>Falk, C. F., Vogel, T., Hammami, S., &amp; Miočević, M. (in press). Multilevel mediation analysis in R: A comparison of bootstrap and Bayesian approaches. Behavior Research Methods. <a href="https://doi.org/10.3758/s13428-023-02079-4">doi:10.3758/s13428-023-02079-4</a>  Preprint: <a href="https://doi.org/10.31234/osf.io/ync34">doi:10.31234/osf.io/ync34</a>
</p>
<p>Paul-Christian Bürkner (2017). brms: An R Package for Bayesian Multilevel Models Using Stan. Journal of Statistical Software, 80(1), 1-28. doi:10.18637/jss.v080.i01
</p>


<h3>Examples</h3>

<pre><code class="language-R">

# Note: 2000 iterations is just an example so that run time is not too long.
# Pick something larger (e.g., 5000+) in practice

# Example data for 1-1-1 w/o moderation
data(BPG06dat)

# random effects for a and b paths (and intercept), no moderation
# (For moderation, note that modmed.mlm syntax is typically the same)
fit&lt;-modmed.mlm.brms(BPG06dat,"id", "x", "y" , "m", cores=2,
                     random.a=TRUE, random.b=TRUE,
                     iter = 2000, control = list(adapt_delta=0.95),
                     seed = 1234)

# Examine model results and some diagnostics
summary(fit$model)

# Potential scale reduction (PSR) or Rhat guidelines vary but the largest
#  should be close to 1 ( &lt; 1.1, &lt; 1.05, &lt; 1.01).
# It is also possible to extract all of them.
max(brms::rhat(fit$model)) # largest rhat

# Fit (loo and WAIC)
brms::loo(fit$model)
brms::waic(fit$model)

# Point and interval estimates, diagnostics, for quantities of interest

# Traceplots: TODO, list conversions for how brms represents parameters with
# How these are colloquially referred to in mediation literature.
plot(fit$model, variable="b_SmX") # this is traceplot for one parameter

# Example of extracting/computing intervals for particular quantities
res.indirect &lt;- extract.modmed.mlm.brms(fit, "indirect")
res.a &lt;- extract.modmed.mlm.brms(fit, "a")
res.b &lt;- extract.modmed.mlm.brms(fit, "b")
res.cprime &lt;- extract.modmed.mlm.brms(fit, "cprime")

# Summary of results is in CI slot, example:
res.indirect$CI

# 99% CI
res.indirect &lt;- extract.modmed.mlm.brms(fit, "indirect", ci.conf = .99)


</code></pre>


</div>