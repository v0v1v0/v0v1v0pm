<div class="container">

<table style="width: 100%;"><tr>
<td>multisite.accuracy</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate accuracy in multisite machine learning studies</h2>

<h3>Description</h3>

<p>Function to estimate the accuracy of the predictions of a multisite machine-learning model, controlling the effects of the site.</p>


<h3>Usage</h3>

<pre><code class="language-R">multisite.accuracy(y, y.pred, site, estimate = c("auc", "bac", "cor", "hr", "mse"),
                   site.method = "covar", mixed = FALSE, min.n = 10, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>actual value of the variable that you want to predict. For <code>"auc"</code> estimates, it must be a binary vector. For <code>"bac"</code> estimates, it must be either a binary vector or a factor. For <code>"cor"</code> and <code>"mse"</code> estimates, it must be a numeric vector. For <code>"hr"</code> estimates, it must be an object of class <code>"Surv"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y.pred</code></td>
<td>
<p>predicted value of the variable. For <code>"auc"</code>, <code>"cor"</code>, <code>"hr"</code>, and <code>"mse"</code> estimates, it must be a numeric vector. For <code>"bac"</code> estimates, it must be either a binary vector or a factor with the same levels as <code>"y"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>site</code></td>
<td>
<p>vector with the name of the site for each observation. Ignored if <code>site.method</code> is <code>"none"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimate</code></td>
<td>
<p><code>"auc"</code> (area under the ROC curve, when <code>"y"</code> is a binary variable and <code>"y.pred"</code> is a continous variable), <code>"bac"</code> (balanced accuracy, along with sensitivity and specificity when both <code>"y"</code> and <code>"y.pred"</code> are binary variables; or along with the sensitivity to detect each group when both <code>"y"</code> and <code>"y.pred"</code> are factors), <code>"cor"</code> and <code>"mse"</code> (correlation and mean squared error, when both <code>"y"</code> and <code>"y.pred"</code> are numeric variables), <code>"hr"</code> (hazard ratio, when <code>"y"</code> is an object of class <code>"Surv"</code> and <code>"y.pred"</code> is a numeric variable).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>site.method</code></td>
<td>
<p><code>"covar"</code> (site as covariate, e.g., using <code>lm</code>), <code>"meta"</code> (meta-analysis across sites), or <code>"none"</code> (no control of the effects of the site).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mixed</code></td>
<td>
<p>try to fit mixed-effects models, only for <code>site.method</code> = <code>"covar"</code> and <code>estimate</code> = <code>"cor"</code>, <code>"mse"</code>, or <code>"hr"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.n</code></td>
<td>
<p>sites below this minimum sample size will be ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments for <code>logistf</code>, <code>lm</code>, <code>rma</code>, etc.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>We refer the reader to the publication below for details on the calculations.</p>


<h3>Value</h3>

<p>A data frame with the estimated accuracy, the methods used, and any warning or error.</p>


<h3>References</h3>

<p>Solanes, A., Palau, P., Fortea, L., Salvador, R., Gonzalez-Navarro, L., Llach, C.D., Valenti, M., Vieta, E., Radua, J. (2021)
Biased accuracy in multisite machine-learning studies due to incomplete removal of the effects of the site.
<em>Psychiatry Research: Neuroimaging</em>, 314:111313.
Solanes, A., Gosling, C.J., Fortea, L., Ortuno, M., Lopez-Soley, E., Llufriu, S., Madero, S., Martinez-Heras, E., Pomarol-Clotet, E., Solana, E., Vieta, E., Radua, J. (2021)
Removing the effects of the site in brain imaging machine-learning - Measurement and extendable benchmark.
<em>Neuroimage</em>, 265:119800.
</p>


<h3>Examples</h3>

<pre><code class="language-R">for (real_effects in c(FALSE, TRUE)) {
  for (eos in c(FALSE, TRUE)) {
    
    # Simulate data
    site = rep(c("Site A", "Site B"), 200)
    y = c(scale(rnorm(400)))
    y.pred = c(scale(residuals(lm(rnorm(400) ~ y))))
    # If real effects:
    if (real_effects) {
      y.pred = c(scale(y.pred + y))
    }
    # If effects of the site:
    if (eos) {
      y = c(scale(y + 2 * (site == "Site B")))
      y.pred = c(scale(y.pred + 2 * (site == "Site B")))
    }
    cat("\n=== Real effects:", ifelse(real_effects, "yes", "no"),
        "\n=== Effects of the site:", ifelse(eos, "yes", "no"), "\n\n")
    
    # Numeric: without real effects, mse.pred should not be &lt; mse.mean and cor should be ~0
    print(rbind(
      multisite.accuracy(y, y.pred, site, "mse", site.method = "covar"),
      multisite.accuracy(y, y.pred, site, "mse", site.method = "meta"),
      multisite.accuracy(y, y.pred, site, "mse", site.method = "none"))[,1:5])
    print(rbind(
      multisite.accuracy(y, y.pred, site, "cor", site.method = "covar"),
      multisite.accuracy(y, y.pred, site, "cor", site.method = "meta"),
      multisite.accuracy(y, y.pred, site, "cor", site.method = "none"))[,1:3])

  }
}
</code></pre>


</div>