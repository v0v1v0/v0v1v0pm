<div class="container">

<table style="width: 100%;"><tr>
<td>nscale</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Scale n-th Dimension of Array
</h2>

<h3>Description</h3>

<p>Slab-scale within each level of the specified mode. Can input 2-way, 3-way, and 4-way arrays, or input a list containing array elements (see Note).
</p>


<h3>Usage</h3>

<pre><code class="language-R">nscale(X, mode = 1, ssnew = NULL, newscale = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>

<p>Array (2-way, 3-way, or 4-way) or a list containing array elements.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mode</code></td>
<td>

<p>Mode to scale within (set <code>mode = 0</code> to scale across all modes).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ssnew</code></td>
<td>

<p>Desired sum-of-squares for each level of scaled mode.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newscale</code></td>
<td>

<p>Desired root-mean-square for each level of scaled mode. Ignored if <code>ssnew</code> is supplied.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Default (as of ver 1.0-5) uses <code>newscale</code> argument...
</p>
<p>With <code>X</code> a matrix (I-by-J) there are two options:
</p>

<table>
<tr>
<td style="text-align: right;">
 <code> mode=1: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j] * newscale / sqrt(meansq(x[i,])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 <code> mode=2: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j] * newscale / sqrt(meansq(x[,j])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
</tr>
</table>
<p>With <code>X</code> a 3-way array (I-by-J-by-K) there are three options:
</p>

<table>
<tr>
<td style="text-align: right;">
 <code> mode=1: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k] * newscale / sqrt(meansq(x[i,,])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 <code> mode=2: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k] * newscale / sqrt(meansq(x[,j,]))) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 <code> mode=3: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k] * newscale / sqrt(meansq(x[,,k])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
</tr>
</table>
<p>With <code>X</code> a 4-way array (I-by-J-by-K-by-L) there are four options:
</p>

<table>
<tr>
<td style="text-align: right;">
 <code> mode=1: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k,l] * newscale / sqrt(meansq(x[i,,,])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 <code> mode=2: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k,l] * newscale / sqrt(meansq(x[,j,,])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 <code> mode=3: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k,l] * newscale / sqrt(meansq(x[,,k,])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 <code> mode=4: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k,l] * newscale / sqrt(meansq(x[,,,l])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
</tr>
</table>
<p>If argument <code>ssnew</code> is provided...
</p>
<p>With <code>X</code> a matrix (I-by-J) there are two options:
</p>

<table>
<tr>
<td style="text-align: right;">
 <code> mode=1: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j] * sqrt(ssnew / sumsq(x[i,])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 <code> mode=2: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j] * sqrt(ssnew / sumsq(x[,j])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
</tr>
</table>
<p>With <code>X</code> a 3-way array (I-by-J-by-K) there are three options:
</p>

<table>
<tr>
<td style="text-align: right;">
 <code> mode=1: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k] * sqrt(ssnew / sumsq(x[i,,])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 <code> mode=2: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k] * sqrt(ssnew / sumsq(x[,j,]))) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 <code> mode=3: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k] * sqrt(ssnew / sumsq(x[,,k])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
</tr>
</table>
<p>With <code>X</code> a 4-way array (I-by-J-by-K-by-L) there are four options:
</p>

<table>
<tr>
<td style="text-align: right;">
 <code> mode=1: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k,l] * sqrt(ssnew / sumsq(x[i,,,])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 <code> mode=2: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k,l] * sqrt(ssnew / sumsq(x[,j,,])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 <code> mode=3: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k,l] * sqrt(ssnew / sumsq(x[,,k,])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 <code> mode=4: </code> </td>
<td style="text-align: center;"> </td>
<td style="text-align: left;"> <code> x[i,j,k,l] * sqrt(ssnew / sumsq(x[,,,l])) </code> </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
</tr>
</table>
<h3>Value</h3>

<p>Returns scaled version of <code>X</code>.
</p>


<h3>Note</h3>

<p>When entering a list with array elements, each element must be a 2-way or 3-way array. The list elements are treated as the 3rd mode (for list of 2-way arrays) or the 4th mode (for list of 3-way arrays) in the formulas provided in the Description.
</p>


<h3>Author(s)</h3>

<p>Nathaniel E. Helwig &lt;helwig@umn.edu&gt;
</p>


<h3>Examples</h3>

<pre><code class="language-R">##########   EXAMPLE 1   ##########
X &lt;- matrix(rnorm(2000), nrow = 100, ncol = 20)
Xr &lt;- nscale(X, mode = 2)                # scale columns to newscale=1
sqrt(colMeans(Xr^2))
Xr &lt;- nscale(X, mode = 2, newscale = 2)  # scale columns to newscale=2
sqrt(colMeans(Xr^2))


##########   EXAMPLE 2   ##########
Xold &lt;- X &lt;- matrix(rnorm(400), nrow = 20, ncol = 20)
iter &lt;- 0
chk &lt;- 1
# iterative scaling of modes 1 and 2
while(iter&lt;500 &amp; chk&gt;=10^-9){
  Xr &lt;- nscale(Xold, mode = 1)
  Xr &lt;- nscale(Xr, mode = 2)
  chk &lt;- sum((Xold-Xr)^2)
  Xold &lt;- Xr
  iter &lt;- iter + 1
}
iter
sqrt(rowMeans(Xr^2))
sqrt(colMeans(Xr^2))


##########   EXAMPLE 3   ##########
X &lt;- array(rnorm(20000), dim = c(100,20,10))
Xc &lt;- nscale(X, mode = 2)   # scale within columns
sqrt(rowMeans(aperm(Xc, perm = c(2,1,3))^2))


##########   EXAMPLE 4   ##########
X &lt;- array(rnorm(100000), dim = c(100,20,10,5))
Xc &lt;- nscale(X, mode = 4)   # scale across 4-th mode
sqrt(rowMeans(aperm(Xc, perm = c(4,1,2,3))^2))


##########   EXAMPLE 5   ##########
X &lt;- replicate(5, array(rnorm(20000), dim = c(100,20,10)), simplify = FALSE)
# mean square of 1 (new way)
Xc &lt;- nscale(X)
rowSums(sapply(Xc, function(x) rowSums(x^2))) / (20*10*5)
# mean square of 1 (old way)
Xc &lt;- nscale(X, ssnew = (20*10*5))
rowSums(sapply(Xc, function(x) rowSums(x^2))) / (20*10*5)



</code></pre>


</div>