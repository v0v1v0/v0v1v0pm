<div class="container">

<table style="width: 100%;"><tr>
<td>manyglm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fitting Generalized Linear Models for Multivariate Abundance Data</h2>

<h3>Description</h3>

<p><code>manyglm</code> is used to fit generalized linear models to high-dimensional data, such as multivariate abundance data in ecology. This is the base model-fitting function - see <code>plot.manyglm</code> for assumption checking, and <code>anova.manyglm</code> or <code>summary.manyglm</code> for significance testing.
</p>


<h3>Usage</h3>

<pre><code class="language-R">manyglm(formula, family="negative.binomial", composition=FALSE, data=NULL, subset=NULL,
    na.action=options("na.action"), K=1, theta.method = "PHI", model = FALSE,
    x = TRUE, y = TRUE, qr = TRUE, cor.type= "I", shrink.param=NULL,
    tol=sqrt(.Machine$double.eps), maxiter=25, maxiter2=10,
    show.coef=FALSE, show.fitted=FALSE, show.residuals=FALSE,
    show.warning=FALSE, offset, ... )
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>an object of class <code>"formula"</code> (or one that
can be coerced to that class): a symbolic description of the
model to be fitted.  The details of model specification are given
under Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>a description of the distribution function to be used in the
in the model. The default is negative binomial regression (using a log
link, with unknown overdispersion parameter), the following family
functions are also accepted: binomial(), binomial(link="cloglog"),
poisson(), Gamma(link="log"), which can also be specified using character strings as
'binomial', 'cloglog' and 'poisson', 'gamma' respectively. In future we hope
to include other family functions as described in <code>family</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional data frame, list or environment (or object
coercible by <code>as.data.frame</code> to a data frame) containing
the variables in the model. If not found in <code>data</code>, the variables
are taken from <code>environment(formula)</code>, typically the environment
from which <code>glm</code> is called.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>composition</code></td>
<td>
<p><code>FALSE</code> (default) will model abundance, <code>TRUE</code> will model relative abundance, by adding a row effect to the model, and partition effects of environmental variables into main effects (alpha, total abundance/richness) and interactions with response (beta, relative abundance/turnover). See <code>details</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>an optional vector specifying a subset of observations
to be used in the fitting process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>a function which indicates what should happen
when the data contain <code>NA</code>s.  The default is set by
the <code>na.action</code> setting of <code>options</code>, and is
<code>na.fail</code> if that is unset.  The ‘factory-fresh’
default is <code>na.omit</code>.  Another possible value is
<code>NULL</code>, no action.  Value <code>na.exclude</code> can be useful.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>number of trials in binomial regression. By default, K=1 for presence-absence data using logistic regression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta.method</code></td>
<td>
<p>the method used for the estimation of the overdisperson
parameter theta, such that the mean-variance relationship is V=m+m^2/theta for
the negative binomial family. Here offers three options <br>
"PHI" = Maximum likelihood estimation with respect to phi (default)<br>
"ML" = Maximum likelihood estimation with respect to theta, as in Lawless(1987), the default for the gamma family. <br>
"Chi2" = Moment estimation using chi-square dampening on the log scale, as
in Hilbe(2008).
"MM" = Moment estimation for gamma family.




</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model, x, y, qr</code></td>
<td>
<p>logicals. If <code>TRUE</code> the corresponding
components of the fit (the model frame, the model matrix, the model
matrix, the response, the QR decomposition of the model matrix) are
returned.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cor.type</code></td>
<td>
<p>the structure imposed on the estimated correlation
matrix under the fitted model. Can be "I"(default), "shrink", or "R".
See Details. This parameter is merely stored in <code>manyglm</code>, and
will be used as the default value for <code>cor.type</code> in subsequent
functions for inference.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shrink.param</code></td>
<td>

<p>shrinkage parameter to be used if <code>cor.type="shrink"</code>. If a numerical
value is not supplied, it will be estimated from the data by cross
validation-penalised normal likelihood as in Warton (2008). The parameter
value is stored as an attribute of the <code>manyglm</code> object, and will be
used in subsequent functions for inference.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>the tolerance used in estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter</code></td>
<td>
<p>maximum allowed iterations in the weighted least square estimation of beta. The default value is 25.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter2</code></td>
<td>
<p>maximum allowed iterations in the internal ML estimations of negative binomial regression. The default value is 10.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show.coef, show.fitted, show.residuals, show.warning</code></td>
<td>
<p>logical. Whether to show model coefficients, fitted values, standardized pearson residuals, or operation warnings.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>this can be used to specify an _a priori_ known component to be included in the linear predictor during fitting. This should be 'NULL' or a numeric vector of length equal to NROW (i.e. number of observations) or a matrix of NROW times p (i.e. number of species).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments passed to or from other methods.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>manyglm</code> is used to calculate the parameter estimates of generalised linear models fitted to each of many variables simultaneously as in Warton et. al. (2012) and Wang et.al.(2012). Models for <code>manyglm</code> are specified symbolically. For details on how to specify a formula see the details section of <code>lm</code> and <code>formula</code>.
</p>
<p>Generalised linear models are designed for non-normal data for which a distribution can be specified that offers a reasonable model for data, as specified using the argument <code>family</code>. The <code>manyglm</code> function currently handles count and binary data, and accepts either a character argument or a family argument for common choices of family. For binary (presence/absence) data, <code>family=binomial()</code> can be used for logistic regression (logit link, "logistic regression"), or the complementary log-log link can be used <code>family=binomial("cloglog")</code>, arguably a better  choice for presence-absence data. Poisson regression <code>family=poisson()</code> can be used for counts that are not "overdispersed" (that is, if the variance is not larger than the mean), although for multivariate abundance data it has been shown that the negative binomial distribution (<code>family="negative.binomial"</code>) is usually a better choice (Warton 2005). In both cases, a log-link is used. If another link function or family is desired, this can be specified using the <code>manyany</code> function, which accepts regular <code>family</code> arguments.
</p>
<p><code>composition=TRUE</code> allows relative abundance to be modelled rather than absolute abundance, which is useful for partitioning effects of environmental variables on alpha vs beta diversity, and is needed if there is variation in sampling intensity due to variables that haven't been measured. Data are manipulated into "long format", with column factor called <code>cols</code> and row variable called <code>rows</code>, then a model is fitted using main effects for predictors as in the provided formula, plus <code>rows</code>, <code>cols</code> and the interaction of predictors with <code>cols</code>. Inclusion of <code>rows</code> in the model accounts for variation in sampling intensity across rows, main effects for environmental variables capture their effects on total abundance/richness (alpha diversity), and their interaction with <code>cols</code> captures changes in relative abundance/turnover (beta diversity). Unfortunately, data are not efficiently stored in long format, so models are slower to fit using <code>composition=TRUE</code>.
</p>
<p>In negative binomial regression, the overdispersion parameter (<code>theta</code>) is estimated separately for each variable from the data, as controlled by <code>theta.method</code> for negative binomial distributions. We iterate between updates of <code>theta</code> and generalised linear model updates for regression parameters, as many as <code>maxiter2</code> times.
</p>




















<p><code>cor.type</code> is the structure imposed on the estimated correlation
matrix under the fitted model. Possible values are: <br><code>"I"</code>(default) = independence is assumed (correlation matrix is the identity) <br><code>"shrink"</code> = sample correlation matrix is shrunk towards I to improve its stability. <br><code>"R"</code> = unstructured correlation matrix is used.  (Only available when N&gt;p.)
</p>
<p>If <code>cor.type=="shrink"</code>, a numerical value will be assigned to <code>shrink.param</code> either through the argument or by internal estimation. The working horse function for the internal estimation is <code>ridgeParamEst</code>, which is based on cross-validation (Warton 2008). The validation groups are chosen by random assignment, so some slight variation in the estimated values may be observed in repeat analyses. See <code>ridgeParamEst</code> for more details. The shrinkage parameter can be any value between 0 and 1 (0="I" and 1="R", values closer towards 0 indicate more shrinkage towards "I").
</p>


<h3>Value</h3>

<p><code>manyglm</code> returns an object inheriting from <code>"manyglm"</code>,
<code>"manylm"</code> and "mglm".
</p>
<p>The function <code>summary</code> (i.e. <code>summary.manyglm</code>) can be used to obtain or print a summary of the results and the function
<code>anova</code> (i.e. <code>anova.manyglm</code>) to produce an
analysis of variance table, although note that these functions use resampling so they can take a while to fit.
</p>
<p>The generic accessor functions <code>coefficients</code>,
<code>fitted.values</code> and <code>residuals</code> can be used to
extract various useful features of the value returned by <code>manyglm</code>.
</p>

<p>An object of class <code>"manyglm"</code> is a list containing at least the
following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>a named matrix of coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.coefficients</code></td>
<td>
<p>the estimated variances of each coefficient.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted.values</code></td>
<td>
<p>the matrix of fitted mean values, obtained by transforming the linear predictors by the inverse of the link function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linear.predictor</code></td>
<td>
<p>the linear fit on the scale of the linear predictor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals</code></td>
<td>
<p>the matrix of <em>working</em> residuals, that is the Pearson residuals standardized by the leverage adjustment h obtained from the diagonal elements of the hat matrix H. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PIT.residuals</code></td>
<td>
<p>probability integral transform (PIT) residuals - for a model that fits well these should be approximately standard uniform values evenly scattered between 0 and 1. Their calculation involves some randomisation, so different fits will return slightly different values for PIT residuals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sqrt.1_Hii</code></td>
<td>
<p>the matrix of scale terms used to standardize the Pearson reidusals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.estimator</code></td>
<td>
<p>the estimated variance of each observation, computed using the corresponding family function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sqrt.weight</code></td>
<td>
<p>the matrix of square root of <em>working</em> weights,  estimated for the corresponding family function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>the estimated nuisance parameters accounting for overdispersion</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>two.loglike</code></td>
<td>
<p>two times the log likelihood.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deviance</code></td>
<td>
<p>up to a constant, minus twice the maximized log-likelihood.  Where sensible, the constant is chosen so that a saturated model has deviance zero.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>
<p>the number of iterations of IWLS used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame storing the input data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stderr.coefficients</code></td>
<td>
<p>the estimated standard error of each coefficient.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi</code></td>
<td>
<p>the inverse of theta</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>the tolerance used in estimations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter,maxiter2,family,theta.method,cor.type,formula</code></td>
<td>
<p>arguments supplied in the <code>manyglm</code> call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aic</code></td>
<td>
<p>a vector returning Akaike's <em>An Information Criterion</em> for each response variable - minus twice the
maximized log-likelihood plus twice the number of coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AICsum</code></td>
<td>
<p>the sum of the AIC's over all variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shrink.param</code></td>
<td>
<p>the shrink parameter to be used in subsequent inference.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the matched call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>terms</code></td>
<td>
<p>the <code>terms</code> object used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rank</code></td>
<td>
<p>the numeric rank of the fitted linear model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlevels</code></td>
<td>
<p>(where relevant) a record of the levels of the factors used in fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df.residual</code></td>
<td>
<p>the residual degrees of freedom.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>if the argument <code>x</code> is <code>TRUE</code>, this is the design matrix used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>if the argument <code>y</code> is <code>TRUE</code>, this is the response variables used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>if the argument <code>model</code> is <code>TRUE</code>, this is the <code>model.frame</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qr</code></td>
<td>
<p>if the argument <code>qr</code> is <code>TRUE</code>, this is the QR decomposition of the design matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show.coef,show.fitted,show.residuals</code></td>
<td>
<p>arguments supplied in the <code>manyglm</code> call concerning what it presented in output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>the <code>offset</code> data used (where applicable).</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Yi Wang, Ulrike Naumann and David Warton &lt;David.Warton@unsw.edu.au&gt;.
</p>


<h3>References</h3>

<p>Lawless, J. F. (1987)
<em>Negative binomial and mixed Poisson regression</em>,
Canadian Journal of Statistics 15, 209-225.
</p>
<p>Hilbe, J. M. (2008)
<em>Negative Binomial Regression</em>,
Cambridge University Press, Cambridge.
</p>
<p>Warton D.I. (2005)
<em>Many zeros does not mean zero inflation: comparing the
goodness of-fit of parametric models to multivariate abundance data</em>,
Environmetrics 16(3), 275-289.
</p>
<p>Warton D.I. (2008). Penalized normal likelihood and ridge regularization
of correlation and covariance matrices. <em>Journal of the American
Statistical Association</em> 103, 340-349.
</p>
<p>Warton D.I. (2011). Regularized sandwich estimators for analysis of high dimensional data using generalized estimating equations. <em>Biometrics</em>, 67(1), 116-123.
</p>
<p>Warton D. I., Wright S., and Wang, Y. (2012). Distance-based multivariate analyses confound location and dispersion effects. <em>Methods in Ecology and Evolution</em>, 3(1), 89-101.
</p>
<p>Wang Y., Neuman U., Wright S. and Warton D. I. (2012). mvabund: an R package for model-based analysis of multivariate abundance data. <em>Methods in Ecology and Evolution</em>. online 21 Feb 2012.
</p>


<h3>See Also</h3>




<p><code>anova.manyglm</code>, <code>summary.manyglm</code>, <code>residuals.manyglm</code>, <code>plot.manyglm</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(spider)
spiddat &lt;- mvabund(spider$abund)
X &lt;- as.matrix(spider$x)

#To fit a log-linear model assuming counts are poisson:
glm.spid &lt;- manyglm(spiddat~X, family="poisson")
glm.spid

summary(glm.spid, resamp="residual")

#To fit a binomial regression model to presence/absence data:
pres.abs &lt;- spiddat
pres.abs[pres.abs&gt;0] = 1
Xdf &lt;- data.frame(spider$x) #turn into a data frame to refer to variables in formula
glm.spid.bin &lt;- manyglm(pres.abs~soil.dry+bare.sand+moss, data=Xdf, family="binomial")
glm.spid.bin
drop1(glm.spid.bin) #AICs for one-term deletions, suggests dropping bare.sand

glm2.spid.bin &lt;- manyglm(pres.abs~soil.dry+moss, data=Xdf, family="binomial")
drop1(glm2.spid.bin) #backward elimination suggests settling on this model.

</code></pre>


</div>