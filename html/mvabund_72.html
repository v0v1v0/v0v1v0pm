<div class="container">

<table style="width: 100%;"><tr>
<td>manyany</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fitting Many Univariate Models to Multivariate Abundance Data</h2>

<h3>Description</h3>

<p><code>manyany</code> is used to fit many univariate models (GLMs, GAMs, otherwise) to high-dimensional data, such as multivariate abundance data in ecology. This is the base model-fitting function - see <code>plot.manyany</code> for assumption checking, and <code>anova.manyany</code> for significance testing.
</p>


<h3>Usage</h3>

<pre><code class="language-R">manyany(formula, fn, family="negative.binomial", data, composition = FALSE, 
block = NULL, get.what="details", var.power=NA, na.action = "na.exclude", ...)
## S3 method for class 'manyany'
print(x, digits = max(3L, getOption("digits") - 3L), ...) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>an object of class <code>"formula"</code> (or one that
can be coerced to that class): a symbolic description of the
model to be fitted.  The details of model specification are given
under Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fn</code></td>
<td>
<p>a character string giving the name of the function for the univariate
model to be applied. e.g. "glm".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>a description of the error distribution function to be used 
in the model, either as a character string, a <code>family</code> object, or
a list of such objects, one for each response variable in the dataset. Such a
list enables the fitting of models with different distributions for different
responses. See Details for the families currently supported.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional data frame containing predictor variables (a matrix is also acceptable).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>composition</code></td>
<td>
<p>logical. FALSE (default) fits a separate model to each species.
TRUE fits a single model to all variables, including site as a row effect, such
that all other terms model relative abundance (compositional effects).  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>block</code></td>
<td>
<p>a factor specifying the sampling level to be resampled. Default is
resampling rows (if composition=TRUE in the manyany command, this means resampling
rows of data as originally sent to manyany).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>get.what</code></td>
<td>
<p>what to return from each model fit: "details" (default) includes
predicted values and residuals in output, "models" also returns the fitted objects
for each model, "none" returns just the log-likelihood (mostly for internal use).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.power</code></td>
<td>
<p>the power parameter, if using the tweedie distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>Default set to <code>exclude</code> (for details see
<code>na.exclude</code>) to avoid errors when NA's in predictors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments passed to the fitting function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>an object of class "manyany", usually, a result of a call to
<code>manyany</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>how many digits to include in the printed anova table.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>manyany</code> can be used to fit the model type specified in <code>fn</code> to many variables
simultaneously, a generalisation of <code>manyglm</code> to handle other model types.
It should be able to handle any fixed effects modelling function that has 
<code>predict</code> and <code>logLik</code> functions, and that accepts a <code>family</code> argument, 
provided that the family is on our list (currently 'gaussian', 'poisson', 'binomial', 
'negative.binomial' and 'tweedie', although models for ordinal data are also accepted 
if using the <code>clm</code> function from the <code>ordinal</code> package). Models for <code>manyany</code>
are specified symbolically, see for example the details section of <code>lm</code>
and <code>formula</code>.
</p>
<p>Unlike <code>manyglm</code>, this function accepts <code>family</code> functions as arguments
instead of just character strings, giving greater flexibility. For example, you could
use <code>family=binomial(link="probit")</code> to fit a model using the probit link, rather 
than being restricted to the default logit link or <code>cloglog</code> links available in <code>manyglm</code>.
</p>
<p>A <code>data</code> argument is required, and it must be a dataframe.
</p>
<p>Setting <code>composition=TRUE</code> enables compositional analyses, where predictors are
used to model relative abundance rather than mean abundance. This is achieved by
vectorising the response matrix and fitting a single model across all variables, with
a row effect to account for differences in relative abundance across rows.
The default <code>composition=FALSE</code> just fits a separate model for each variable.
</p>


<h3>Value</h3>

<p><code>manyany</code> returns an object inheriting from <code>"manyany"</code>.
</p>
<p>The function <code>anova</code> (i.e. <code>anova.manyany</code>) will produce a significance test comparing two <code>manyany</code> objects.
Currently there is no <code>summary</code> resampling function for objects of this class.
</p>
<p>The generic accessor functions <code>fitted.values</code>, <code>residuals</code>, <code>logLik</code>, <code>AIC</code>, <code>plot</code>
can be used to extract various useful features of the value returned by <code>manyany</code>.
</p>
<p>An object of class <code>"manyany"</code> is a list containing at least the
following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>logL</code></td>
<td>
<p>a vector of log-likelihood terms for each response variable in the fitted model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted.values</code></td>
<td>
<p>the matrix of fitted mean values, obtained by transforming the linear predictors by the inverse of the link function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals</code></td>
<td>
<p>the matrix of probability integral transform (PIT) residuals.
If the fitted model is a good fit, these will be approximately standard uniformly distributed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linear.predictor</code></td>
<td>
<p>the linear fit on link scale. But for ordinal models fitted using <code>clm</code>, these values are for the first category only.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>a vector of <code>family</code> arguments, one for each response variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the matched call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>the <code>model.frame</code> from the model for the last response variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>terms</code></td>
<td>
<p>a list of <code>terms</code> from the model for the last response variable.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>David Warton &lt;David.Warton@unsw.edu.au&gt;.
</p>


<h3>References</h3>

<p>Warton D. I., Wright S., and Wang, Y. (2012). Distance-based multivariate analyses confound location and dispersion effects. <em>Methods in Ecology and Evolution</em>, 3(1), 89-101.
</p>


<h3>See Also</h3>

<p><code>anova.manyany</code>, <code>residuals.manyany</code>, <code>plot.manyany</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(spider)

spider = list(abund=spider$abund, x = as.matrix(spider$x))

## To fit a log-linear model assuming counts are negative binomial, via manyglm:
spidNB &lt;- manyany(abund~x,"manyglm",data=spider,family="negative.binomial")

logLik(spidNB) # a number of generic functions are applible to manyany objects

## To fit a glm with complementary log-log link to presence/absence data:
PAdat = pmin(as.matrix(spider$abund),1) #constructing presence/absence dataset
spidPA &lt;- manyany(PAdat~x,"glm",data=spider,family=binomial("cloglog"))
plot(spidPA)
# There are some wild values in there for the Pardmont variable (residuals &gt;5 or &lt;-8).
#The Pardmont model didn't converge, coefficients are a bit crazy:
coef(spidPA) 

# could try again using the glm2 package to fit the models, this fixes things up:
## Not run: library(glm2)
## Not run: spidPA2&lt;-manyany(PAdat~x,"glm",data=spider,family=binomial("cloglog"),method="glm.fit2")
## Not run: plot(spidPA2) #looks much better.

## To simultaneously fit models to ordinal data using the ordinal package:
## Not run: library(ordinal)
## First construct an ordinal dataset:
## Not run: spidOrd = spider$abund
## Not run: spidOrd[spider$abund&gt;1 &amp; spider$abund&lt;=10]=2
## Not run: spidOrd[spider$abund&gt;10]=3
## Now fit a model using the clm function:
## Not run: manyOrd=manyany(spidOrd~bare.sand+fallen.leaves,"clm",data=data.frame(spider$x))
## Not run: plot(manyOrd)
</code></pre>


</div>