<div class="container">

<table style="width: 100%;"><tr>
<td>do.in.envir</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Modify a function's scope</h2>

<h3>Description</h3>

<p><code>do.in.envir</code> lets you write a function whose scope (enclosing environment) is defined at runtime, rather than by the environment in which it was defined.
</p>


<h3>Usage</h3>

<pre><code class="language-R"># Use only as wrapper of function body, like this:
# my.fun &lt;- function(...) do.in.envir( fbody, envir=)
# ... should be the arg list of "my.fun"
# fbody should be the code of "my.fun"
do.in.envir( fbody, envir=parent.frame(2)) # Don't use it like this!
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code> fbody</code></td>
<td>
<p>the code of the function, usually a braced expression</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code> envir</code></td>
<td>
<p>the environment to become the function's enclosure</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>By default, a <code>do.in.envir</code> function will have, as its enclosing environment, the environment in which it was <b>called</b>, rather than <b>defined</b>. It can therefore read variables in its caller's frame directly (i.e. without using <code>get</code>), and can assign to them via <code>&lt;&lt;-</code>. It's also possible to use <code>do.in.envir</code> to set a completely different enclosing environment; this is exemplified by some of the functions in <code>debug</code>, such as <code>go</code>.
</p>
<p>Note the difference between <code>do.in.envir</code> and <code>mlocal</code>; <code>mlocal</code> functions evaluate in the frame of their caller (by default), whereas <code>do.in.envir</code> functions evaluate in their own frame, but have a non-standard enclosing environment defined by the <code>envir</code> argument.
</p>
<p>Calls to e.g. <code>sys.nframe</code> won't work as expected inside <code>do.in.envir</code> functions. You need to offset the frame argument by 5, so that <code>sys.parent()</code> should be replaced by <code>sys.parent( 5)</code> and <code>sys.call</code> by <code>sys.call(-5)</code>.
</p>
<p><code>do.in.envir</code> functions are awkward inside namespaced packages, because the code in <code>fbody</code> will have "forgotten" its original environment when it is eventually executed. This means that objects in the namespace will not be found.
</p>
<p>The <span class="pkg">debug</span> package does not yet trace inside <code>do.in.envir</code> functionsâ€“ this will change.
</p>


<h3>Value</h3>

<p>Whatever <code>fbody</code> returns.
</p>


<h3>Author(s)</h3>

<p>Mark Bravington</p>


<h3>See Also</h3>

<p><code>mlocal</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">fff &lt;- function( abcdef) ffdie( 3)
ffdie &lt;- function( x) do.in.envir( { x+abcdef} )
fff( 9) # 12; ffdie wouldn't know about abcdef without the do.in.envir call
# Show sys.call issues
# Note that the "envir" argument in this case makes the
# "do.in.envir" call completely superfluous!
ffe &lt;- function(...) do.in.envir( envir=sys.frame( sys.nframe()), sys.call( -5))
ffe( 27, b=4) # ffe( 27, b=4)
</code></pre>


</div>