<div class="container">

<table style="width: 100%;"><tr>
<td>local.on.exit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Macro-like functions</h2>

<h3>Description</h3>

<p><code>local.on.exit</code> is the analogue of <code>on.exit</code> for "nested" or "macro" functions written with <code>mlocal</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R"># Inside an 'mlocal' function of the form
# function( &lt;&lt;args&gt;&gt;, nlocal=sys.parent(), &lt;&lt;temp.params&gt;&gt;) mlocal({ &lt;&lt;code&gt;&gt; })
local.on.exit( expr, add=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code> expr</code></td>
<td>
<p>the expression to evaluate when the function ends</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code> add</code></td>
<td>
<p>if TRUE, the expression will be appended to the existing <code>local.on.exit</code> expression. If FALSE, the latter is overwritten.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>on.exit</code> doesn't work properly inside an <code>mlocal</code> function, because the scoping is wrong (though sometimes you get away with it). Use <code>local.on.exit</code> instead, in exactly the same way. I can't find any way to set the exit code in the <b>calling</b> function from within an <code>mlocal</code> function.
</p>
<p>Exit code will be executed before any temporary variables are removed (see <code>mlocal</code>).
</p>


<h3>Author(s)</h3>

<p>Mark Bravington</p>


<h3>See Also</h3>

<p><code>mlocal</code>, <code>local.return</code>, <code>local.on.exit</code>, <code>do.in.envir</code>, and R-news 1/3
</p>


<h3>Examples</h3>

<pre><code class="language-R">ffin &lt;- function( nlocal=sys.parent(), x1234, yyy) mlocal({
  x1234 &lt;- yyy &lt;- 1 # x1234 &amp; yyy are temporary variables
  # on.exit( cat( yyy)) # would crash after not finding yyy
  local.on.exit( cat( yyy))
  })
ffout &lt;- function() {
  x1234 &lt;- 99
  ffin()
  x1234 # still 99 because x1234 was temporary
}
ffout()
</code></pre>


</div>