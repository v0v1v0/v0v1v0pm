<div class="container">

<table style="width: 100%;"><tr>
<td>mvmetaSim</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> Simulating Responses for mvmeta Models </h2>

<h3>Description</h3>

<p>These functions simulate sets of multivariate or univariate responses for a group of studies, in terms of their mean (expected) values and within and between-study (co)variances. These sets of outcomes can be used in meta-analytical models for simulation purposes.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mvmetaSim(y, S, Psi, sd, cor, nsim=1, seed=NULL, posdeftol)

## S3 method for class 'mvmeta'
simulate(object, nsim=1, seed=NULL, ...)
</code></pre>


<h3>Arguments</h3>

<p>In order to simulate <code class="reqn">k</code> outcomes for <code class="reqn">m</code> studies:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>y </code></td>
<td>
<p> a <code class="reqn">m</code>-dimensional vector (for simulating univariate responses) or <code class="reqn">m \times k</code> matrix (for simulating multivariate responses) of mean (expected) outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S </code></td>
<td>
<p> series of within-study (co)variance matrices of the outcomes for each one of the <code class="reqn">m</code> studies. Accepted formats are a <code class="reqn">m</code>-dimensional list of <code class="reqn">k \times k</code> matrices; a tri-dimensional <code class="reqn">k \times k \times m</code> array; or a <code class="reqn">m \times k(k+1)/2</code> matrix or data frame where each row represents the vectorized entries of the lower triangle of the related (co)variance matrix, taken by column (see <code>xpndMat</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Psi </code></td>
<td>
<p> the between-study (co)variance matrices of the outcomes. Accepted formats are a <code class="reqn">k \times k</code> matrix or a <code class="reqn">k(k+1)/2</code>-dimensional vector, representing the vectorized entries of the lower triangle of the related (co)variance matrix, taken by column (see <code>xpndMat</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sd </code></td>
<td>
<p> a <code class="reqn">k</code>-dimensional vector of between-study standard deviations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cor </code></td>
<td>
<p> between-study correlations. Either a scalar, a vector or a matrix. See <code>inputcov</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim </code></td>
<td>
<p> number of simulation sets.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed </code></td>
<td>
<p> an object specifying if and how the random number generator should be initialized.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>posdeftol </code></td>
<td>
<p> tolerance (relative to largest variance) for numerical lack of positive-definiteness. Default to the square root of the machine precision.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object </code></td>
<td>
<p>  an object of class <code>"mvmeta"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>... </code></td>
<td>
<p> further arguments passed to or from other methods.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The set(s) of responses can be simulated either from a fitted model, using the method function <code>simulate</code> for objects of class <code>"mvmeta"</code>, or directly through the function <code>mvmetaSim</code>. In the former case, the fitted values from the model are used as mean (expected) outcomes, together with the within and estimated between-study (co)variance. In the latter option, this information need to be provided by the user in the correct dimensions and forms.
</p>
<p>In <code>mvmetaSim</code>, the between-study (co)variance matrix can be inputted directly through <code>Psi</code>, or given in the form <code class="reqn">\boldsymbol{DRD}</code>, with a diagonal matrix  <code class="reqn">\boldsymbol{D}</code> of standard deviations and correlation matrix <code class="reqn">\boldsymbol{R}</code>. These values are provided through <code>sd</code> and <code>cor</code>. See <code>inputcov</code> for details.
</p>
<p>The functions simulate the responses for each study separately from a marginal multivariate normal distribution with mean equal to the expected values and (co)variance equal to the sum of the within and between-study components. The computation is identical to that implemented in the function <code>mvrnorm</code> of the package <span class="pkg">MASS</span>, involving a eigen decomposition of the marginal (co)variance matrix. Numerical negative definiteness is allowed with a tolerance specified by <code>posdeftol</code>, and positive semi-definiteness is then forced by truncating the eigenvalues at zero.
</p>


<h3>Value</h3>

<p>If <code>nsim=1</code>, a matrix or vector of simulated <code class="reqn">k</code> outcomes for the <code class="reqn">m</code> studies. If more simulation sets are required (<code>nsim</code> higher than 1), a list of matrices or vectors.
</p>


<h3>Note</h3>

<p>Studies with missing values in the fitted values or in the components of the within (co)variances are excluded by <code>simulate</code>. Missing values are instead not accepted in <code>metaSim</code>.
</p>


<h3>Author(s)</h3>

<p>Antonio Gasparrini, <a href="mailto:antonio.gasparrini@lshtm.ac.uk">antonio.gasparrini@lshtm.ac.uk</a></p>


<h3>References</h3>

<p>Sera F, Armstrong B, Blangiardo M, Gasparrini A (2019). An extended mixed-effects framework for meta-analysis.<em>Statistics in Medicine</em>. 2019;38(29):5429-5444. [Freely available <a href="http://www.ag-myresearch.com/2019_sera_statmed.html"><b>here</b></a>].
</p>


<h3>See Also</h3>

 
<p>See <code>simulate</code> for the general method function. See <code>inputcov</code> for inputting correlations. See <code>mvmeta-package</code> for an overview of the package and modelling framework.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># RUN A MODEL
model &lt;- mvmeta(cbind(PD,AL)~pubyear,S=berkey98[5:7],data=berkey98)

# SIMULATE A NEW SET OF OUTCOMES
simulate(model)

# SIMULATE FROM SCRATCH: 3 OUTCOMES, 8 STUDIES
(y &lt;- matrix(0,8,3))
(S &lt;- inputcov(matrix(runif(8*3,0.1,2),8,3,dimnames=list(NULL,
  c("V1","V2","V3"))),cor=c(0,0.5,0.7)))
(Psi &lt;- inputcov(1:3,cor=0.3))
mvmetaSim(y,S,Psi)

# ALTERNATIVELY, DEFINE Psi THROUGH STANDARD DEVIATIONS AND CORRELATION 0.2
mvmetaSim(y,S,sd=1:3,cor=0.3)

# 2 SIMULATION SETS
mvmetaSim(y,S,Psi,nsim=2)
</code></pre>


</div>