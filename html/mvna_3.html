<div class="container">

<table style="width: 100%;"><tr>
<td>mvna</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Nelson-Aalen estimator in multistate models </h2>

<h3>Description</h3>

<p>This function computes the multivariate Nelson-Aalen estimator of
the cumulative transition hazards in multistate models, that is,
for each possible transition, it computes an estimate of
the cumulative hazard.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mvna(data, state.names, tra, cens.name)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p> A data.frame of the form data.frame(id,from,to,time)
or (id,from,to,entry,exit)
</p>

<dl>
<dt>id:</dt>
<dd>
<p>patient id</p>
</dd>
<dt>from:</dt>
<dd>
<p>the state from where the transition occurs</p>
</dd>
<dt>to:</dt>
<dd>
<p>the state to which a transition occurs</p>
</dd>
<dt>time:</dt>
<dd>
<p>time when a transition occurs</p>
</dd>
<dt>entry:</dt>
<dd>
<p>entry time in a state</p>
</dd>
<dt>exit:</dt>
<dd>
<p>exit time from a state</p>
</dd>
</dl>
<p>This data.frame is transition-oriented, <em>i.e.</em> it contains one
row per transition, and possibly several rows per patient. Specifying
an entry and exit time permits to take into account left-truncation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>state.names</code></td>
<td>
<p> A vector of character giving the states names. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tra</code></td>
<td>
<p>A quadratic matrix of logical values describing the possible
transitions within the multistate model. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cens.name</code></td>
<td>
<p> A character giving the code for censored
observations in the column <code>to</code> of <code>data</code>. If there is no
censored observations in your data, put <code>NULL</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This functions computes the Nelson-Aalen estimator as described in
Anderson et al. (1993), along with the two variance estimators
described in eq. (4.1.6) and (4.1.7) of Andersen et al. (1993) at each
transition time.
</p>


<h3>Value</h3>

<p>Returns a list named after the possible transitions, <em>e.g.</em> if we
define a multistate model with two possible transitions: from state 0 to
state 1, and from state 0 to state 2, the returned list will have two
parts named "0 1" and "0 2". Each part contains a data.frame with
columns:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>na</code></td>
<td>
<p>Nelson-Aalen estimates at each transition times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.aalen</code></td>
<td>
<p>Variance estimator given in eq. (4.1.6) of Andersen et
al. (1993).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.greenwood</code></td>
<td>
<p>Variance estimator given in eq. (4.1.7) of Andersen et
al. (1993).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>The transition times.</p>
</td>
</tr>
</table>
<p>The list also contains:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>All the event times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.risk</code></td>
<td>
<p>A matrix giving the number at individual at risk in the
transient states just before an event.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.event</code></td>
<td>
<p>An array which gives the number of transitions at each
event times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.cens</code></td>
<td>
<p>A matrix giving the number a censored observations at each
event times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>state.names</code></td>
<td>
<p> The same as in the function call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cens.name</code></td>
<td>
<p>The same as in the function call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trans</code></td>
<td>
<p>A data frame, with columns <code>from</code> and <code>to</code>, that gives
the possible transitions.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>The variance estimator (4.1.6) may overestimate the true variance, and
the one defined eq. (4.1.7) may underestimate the true variance (see
Klein (1991) and Andersen et al. (example IV.1.1, 1993)), especially
with small sample set. Klein (1991) recommends the use of the variance
estimator of eq. (4.1.6, "aalen") because he found it to be less biased.
</p>


<h3>Author(s)</h3>

<p>Arthur Allignol, <a href="mailto:arthur.allignol@gmail.com">arthur.allignol@gmail.com</a></p>


<h3>References</h3>

<p>Andersen, P.K., Borgan, O., Gill, R.D. and Keiding,
N. (1993). <em>Statistical models based on counting
processes</em>. Springer Series in Statistics. New York, NY: Springer.
</p>
<p>Beyersmann J, Allignol A, Schumacher M: Competing Risks and Multistate
Models with R (Use R!), Springer Verlag, 2012 (Use R!)
</p>
<p>Klein, J.P. Small sample moments of some estimators of the variance
of the Kaplan-Meier and Nelson-Aalen estimators. <em>Scandinavian
Journal of Statistics</em>, 18:333â€“340, 1991.</p>


<h3>See Also</h3>

<p><code>sir.adm</code>,<code>sir.cont</code></p>


<h3>Examples</h3>

<pre><code class="language-R">data(sir.cont)

# Modification for patients entering and leaving a state
# at the same date
sir.cont &lt;- sir.cont[order(sir.cont$id, sir.cont$time), ]
for (i in 2:nrow(sir.cont)) {
  if (sir.cont$id[i]==sir.cont$id[i-1]) {
    if (sir.cont$time[i]==sir.cont$time[i-1]) {
      sir.cont$time[i-1] &lt;- sir.cont$time[i-1] - 0.5
    }
  }
}

# Matrix of logical giving the possible transitions
tra &lt;- matrix(ncol=3,nrow=3,FALSE)
tra[1, 2:3] &lt;- TRUE
tra[2, c(1, 3)] &lt;- TRUE

# Computation of the Nelson-Aalen estimates
na &lt;- mvna(sir.cont,c("0","1","2"),tra,"cens")

# plot
if (require(lattice))
xyplot(na)

### example with left-truncation
data(abortion)

# Data set modification in order to be used by mvna
names(abortion) &lt;- c("id", "entry", "exit", "from", "to")
abortion$to &lt;- abortion$to + 1

## computation of the matrix giving the possible transitions
tra &lt;- matrix(FALSE, nrow = 5, ncol = 5)
tra[1:2, 3:5] &lt;- TRUE

na.abortion &lt;- mvna(abortion, as.character(0:4), tra, NULL)

plot(na.abortion, tr.choice = c("0 4", "1 4"),
     curvlab = c("Control", "Exposed"),
     bty = "n", legend.pos = "topleft")
</code></pre>


</div>