<div class="container">

<table style="width: 100%;"><tr>
<td>lpmvnorm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Multivariate Normal Log-likelihood and Score Functions
</h2>

<h3>Description</h3>

<p>Computes the log-likelihood (contributions) of multiple exact or 
interval-censored observations (or a mix thereof) from multivariate 
normal distributions and evaluates corresponding score functions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">lpmvnorm(lower, upper, mean = 0, center = NULL, chol, invchol, logLik = TRUE, 
         M = NULL, w = NULL, seed = NULL, tol = .Machine$double.eps, fast = FALSE)
slpmvnorm(lower, upper, mean = 0, center = NULL, chol, invchol, logLik = TRUE, 
          M = NULL, w = NULL, seed = NULL, tol = .Machine$double.eps, fast = FALSE)
ldmvnorm(obs, mean = 0, chol, invchol, logLik = TRUE) 
sldmvnorm(obs, mean = 0, chol, invchol, logLik = TRUE) 
ldpmvnorm(obs, lower, upper, mean = 0, chol, invchol, logLik = TRUE, ...) 
sldpmvnorm(obs, lower, upper, mean = 0, chol, invchol, logLik = TRUE, ...) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>lower</code></td>
<td>
<p>matrix of lower limits (one column for each observation, <code class="reqn">J</code> rows).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upper</code></td>
<td>
<p>matrix of upper limits (one column for each observation, <code class="reqn">J</code> rows).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs</code></td>
<td>
<p>matrix of exact observations (one column for each observation, <code class="reqn">J</code> rows).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mean</code></td>
<td>
<p>matrix of means (one column for each observation, length is
recycled to length of <code>obs</code>, <code>lower</code> and <code>upper</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>center</code></td>
<td>
<p>matrix of negative rescaled means (one column for each observation, length is
recycled to length of <code>lower</code> and <code>upper</code>) as returned by
<code>cond_mvnorm(..., center = TRUE)</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chol</code></td>
<td>
<p>Cholesky factors of covariance matrices as
<code>ltMatrices</code> object, length is recylced to length of
<code>obs</code>, <code>lower</code> and <code>upper</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>invchol</code></td>
<td>
<p>Cholesky factors of precision matrices as
<code>ltMatrices</code> object, length is recylced to length of <code>lower</code> and
<code>upper</code>. Either <code>chol</code> or <code>invchol</code> must be given.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logLik</code></td>
<td>
<p>logical, if <code>TRUE</code>, the log-likelihood is returned,
otherwise the individual contributions to the sum are returned.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M</code></td>
<td>
<p>number of iterations, early stopping based on
estimated errors is NOT implemented.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>an optional matrix of weights with <code class="reqn">J - 1</code> rows. This allows to replace the default
Monte-Carlo procedure (Genz, 1992) with a quasi-Monte-Carlo approach (Genz &amp;
Bretz, 2002). Note that the same weights for evaluating the
multivariate normal probability are used for all observations when
<code>ncol(w) == M</code> is specified. If <code>ncol(w) == ncol(lower) * M</code>, each
likelihood contribution is evaluated on the corresponding sub-matrix.
If <code>w</code> is <code>NULL</code>, different uniform numbers are
drawn for each observation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>an object specifying if and how the random number generator
should be initialized, see <code>simulate</code>. Only 
applied when <code>w</code> is <code>NULL</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>tolerance limit, values smaller than <code>tol</code> are interpreted
as zero.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fast</code></td>
<td>
<p>logical, if <code>TRUE</code>, a faster but less accurate version 
of <code>pnorm</code> is used internally.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments to <code>lpmvnorm</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Evaluates the multivariate normal log-likelihood defined by <code>means</code> and
<code>chol</code> over boxes defined by <code>lower</code> and <code>upper</code> or for
exact observations <code>obs</code>. 
</p>
<p>Monte-Carlo (Genz, 1992, the default) and quasi-Monte-Carlo (Genz &amp; Bretz, 2002)
integration is implemented, the latter with weights obtained, for example,
from packages <span class="pkg">qrng</span> or <span class="pkg">randtoolbox</span>. It is the responsibility of
the user to ensure a meaningful lattice is used. In case of doubt, use
plain Monte-Carlo (<code>w = NULL</code>) or <code>pmvnorm</code>.
</p>
<p><code>slpmvnorm</code> computes both the individual log-likelihood contributions
and the corresponding score matrix (of dimension <code class="reqn">J \times (J + 1) / 2 \times N</code>) if
<code>chol</code> contains diagonal elements. Otherwise, the dimension is <code class="reqn">J
  \times (J - 1) / 2 \times N</code>. The scores for exact or mixed exact-interval 
observations are computed by <code>sldmvnorm</code> and <code>sldpmvnorm</code>,
respectively.
</p>
<p>More details can be found in the <code>lmvnorm_src</code> package vignette.
</p>


<h3>Value</h3>

<p>The log-likelihood (<code>logLik = TRUE</code>) or the individual contributions to the log-likelihood.
<code>slpmvnorm</code>, <code>sldmvnorm</code>, and <code>sldpmvnorm</code> return the score
matrices and, optionally (<code>logLik = TRUE</code>), the individual log-likelihood contributions
as well as scores for <code>obs</code>, <code>lower</code>, <code>upper</code>, and
<code>mean</code>.
</p>


<h3>References</h3>

<p>Genz, A. (1992). Numerical computation of multivariate normal probabilities.
<em>Journal of Computational and Graphical Statistics</em>, <b>1</b>, 141–150.
</p>
<p>Genz, A. and Bretz, F. (2002), Methods for the computation of multivariate
t-probabilities. <em>Journal of Computational and Graphical Statistics</em>,
<b>11</b>, 950–971.
</p>


<h3>See Also</h3>

<p><code>dmvnorm</code>, <code>vignette("lmvnorm_src", package = "mvtnorm")</code></p>


<h3>Examples</h3>

<pre><code class="language-R">
  ### five observations
  N &lt;- 5L
  ### dimension
  J &lt;- 4L

  ### lower and upper bounds, ie interval-censoring
  lwr &lt;- matrix(-runif(N * J), nrow = J)
  upr &lt;- matrix(runif(N * J), nrow = J)

  ### Cholesky factor
  (C &lt;- ltMatrices(runif(J * (J + 1) / 2), diag = TRUE))
  ### corresponding covariance matrix
  (S &lt;- as.array(Tcrossprod(C))[,,1])

  ### plain Monte-Carlo (Genz, 1992)
  w &lt;- NULL
  M &lt;- 25000
  ### quasi-Monte-Carlo (Genz &amp; Bretz, 2002, but with different weights)
  if (require("qrng")) w &lt;- t(ghalton(M * N, J - 1))

  ### log-likelihood
  lpmvnorm(lower = lwr, upper = upr, chol = C, w = w, M = M)

  ### compare with pmvnorm
  exp(lpmvnorm(lower = lwr, upper = upr, chol = C, logLik = FALSE, w = w, M = M))
  sapply(1:N, function(i) pmvnorm(lower = lwr[,i], upper = upr[,i], sigma = S))

  ### log-lik contributions and score matrix
  slpmvnorm(lower = lwr, upper = upr, chol = C, w = w, M = M, logLik = TRUE)

</code></pre>


</div>